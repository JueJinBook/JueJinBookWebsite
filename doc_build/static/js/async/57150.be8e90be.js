"use strict";(self.webpackChunkjue_jin_book_press=self.webpackChunkjue_jin_book_press||[]).push([["57150"],{409966:function(e,n,s){s.r(n),s.d(n,{default:()=>V});var c=s(552676),a=s(740453);let i=s.p+"static/image/229950259a714afebe5435df2aa36905.6f697986.webp",r=s.p+"static/image/5e5b5b93169ab62c592bb56e09f7171e.5dec337d.webp",t=s.p+"static/image/48f8ba9e06a3a2997bcbd1576155dce0.a05bded0.webp",d=s.p+"static/image/398a885b89deb42d4453c4787c365052.4dbcbf18.gif",o=s.p+"static/image/15f34a6c9928d565f4c9e3e33f457627.d40c01fe.webp",l=s.p+"static/image/17f1029c7212cb51d372844769489550.e834038d.gif",p=s.p+"static/image/b07d7ec16cb13d03abaac2a2cf1fb8fd.f1d9862b.webp",h=s.p+"static/image/2fa60125de08a919b4fb6b23b6ee68b8.f1d9862b.webp",x=s.p+"static/image/082a2fe938e40445435f3fa3fe61e92d.25b8f76e.webp",j=s.p+"static/image/09e340396ff2d2f438ff813f1fed1930.b9637c99.webp",m=s.p+"static/image/501bb5648e59f251a25b5f8f74e69b45.d77ae065.gif",g=s.p+"static/image/9861a4bc7a642caedc4ff72fd5b25081.8b2353fd.gif",f=s.p+"static/image/3be7430e5a15c76be7eca696964e3329.37a3cb64.webp",u=s.p+"static/image/b2ff5fd2e111293d5c408c3fa64e8fe9.64ae9231.webp",b=s.p+"static/image/75e632eb2aeebbff76f5612059629083.ce9657e4.webp",k=s.p+"static/image/20483ecd9c89042f3eb39e8b61b5925d.99af5a4d.webp",w=s.p+"static/image/f0ddde72fb5a9b92cdadcab1bb1ac96c.62e40df8.webp",y=s.p+"static/image/1341e0173b3e5a675906ad564dcfe1c6.e31609fc.webp",S=s.p+"static/image/4b5a964185b4db4ee50631ae7a8a871b.d9dfd283.webp",A=s.p+"static/image/34c6a5d873cb475ace7842a02facdaec.a5f0c3ce.webp",N=s.p+"static/image/d872b6edc6deaefd3f1a49e9f22dd46a.7d3dc636.webp",v=s.p+"static/image/f7d6207e733f2b7f4fab0c7f7a05a11b.bae679fa.webp",C=s.p+"static/image/2e672f7dfebcfd4d5f830e731723e3dc.1fee27d4.webp",B=s.p+"static/image/69b06f5827a413ee24bbc16da48779b7.b4e11d27.webp",z=s.p+"static/image/8e5dcd3a075bc24c6231df7115ae5b25.886110a1.webp",F=s.p+"static/image/a1831355d562d0322a3b95e4881a86b2.c52a8401.webp",U=s.p+"static/image/bc5691013ef81bcc1d11c6ecf255d75d.4eb55ddd.webp",E=s.p+"static/image/ab401c970ad788eee14ec8dcaf7aef41.65864341.webp",R=s.p+"static/image/16b372d0e6a61621c44dc2e72bb95eac.f637b056.gif",D=s.p+"static/image/aa19ffaf72d52203f263426b55020e13.14865bcf.webp",J=s.p+"static/image/d88efb17d90a034f083785e30833ce79.a544264e.webp",W=s.p+"static/image/dd7086f6d6d8672249cf8abfcc1cb211.431cd800.webp";function M(e){let n=Object.assign({h1:"h1",a:"a",p:"p",img:"img",pre:"pre",code:"code",h2:"h2"},(0,a.ah)(),e.components);return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)(n.h1,{id:"第50章国际化资源包如何通过excel和googlesheet分享给产品经理",children:["第50章—国际化资源包如何通过Excel和GoogleSheet分享给产品经理",(0,c.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#第50章国际化资源包如何通过excel和googlesheet分享给产品经理",children:"#"})]}),"\n",(0,c.jsx)(n.p,{children:"\uFEFF上节我们学了用 react-intl 做国际化。"}),"\n",(0,c.jsx)(n.p,{children:"我们会把文案抽离出来，放在不同的资源包里维护。"}),"\n",(0,c.jsx)(n.p,{children:"比如 zh-CN.json："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:W,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"en-US.json："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:J,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"而这个文案的翻译一般是产品经理做的。"}),"\n",(0,c.jsx)(n.p,{children:"那怎么把这个资源包给产品经理编辑呢？"}),"\n",(0,c.jsx)(n.p,{children:"直接给他 json 文件么？"}),"\n",(0,c.jsx)(n.p,{children:"这样并不好。"}),"\n",(0,c.jsx)(n.p,{children:"一般我们都是导出 excel。"}),"\n",(0,c.jsx)(n.p,{children:"来写一下："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:D,alt:""})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"mkdir excel-export\ncd excel-export\nnpm init -y\n"})}),"\n",(0,c.jsx)(n.p,{children:"进入项目，安装 exceljs："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"npm install --save exceljs\n"})}),"\n",(0,c.jsx)(n.p,{children:"写下 index.js"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:"const { Workbook } = require('exceljs');\n\nasync function main(){\n    const workbook = new Workbook();\n\n    const worksheet = workbook.addWorksheet('guang111');\n\n    worksheet.columns = [\n        { header: 'ID', key: 'id', width: 20 },\n        { header: '姓名', key: 'name', width: 30 },\n        { header: '出生日期', key: 'birthday', width: 30},\n        { header: '手机号', key: 'phone', width: 50 }\n    ];\n\n    const data = [\n        { id: 1, name: '光光', birthday: new Date('1994-07-07'), phone: '13255555555' },\n        { id: 2, name: '东东', birthday: new Date('1994-04-14'), phone: '13222222222' },\n        { id: 3, name: '小刚', birthday: new Date('1995-08-08'), phone: '13211111111' }\n    ]\n    worksheet.addRows(data);\n\n    workbook.xlsx.writeFile('./data.xlsx');    \n}\n\nmain();\n"})}),"\n",(0,c.jsx)(n.p,{children:"就是按照 workbook（工作簿） > worksheet（工作表）> row （行）的层次来添加数据。"}),"\n",(0,c.jsx)(n.p,{children:"跑一下："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:R,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"生成了 excel 文件。"}),"\n",(0,c.jsx)(n.p,{children:"打开看下："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:E,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"可以看到 worksheet 的名字，还有每行的数据都是对的。"}),"\n",(0,c.jsx)(n.p,{children:"这样，就完成了 excel 的生成。"}),"\n",(0,c.jsx)(n.p,{children:"那我们就可以把 zh-CN.json、en-US.json 等的内容整合到 excel 文件里："}),"\n",(0,c.jsx)(n.p,{children:"把 zh-CN.json 和 en-US.json 复制过来："}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)("img",{src:U,alt:""}),"\nzh-CN.json"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-json",children:'{\n    "username": "用户名 <bbb>{name}</bbb>",\n    "password": "密码",\n    "rememberMe": "记住我",\n    "submit": "提交",\n    "inputYourUsername": "请输入你的用户名！",\n    "inputYourPassword": "请输入你的密码！"\n}\n'})}),"\n",(0,c.jsx)(n.p,{children:"en-US.json"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-json",children:'{\n    "username": "Username <bbb>{name}</bbb>",\n    "password": "Password",\n    "rememberMe": "Remember Me",\n    "submit": "Submit",\n    "inputYourUsername": "Please input your username!",\n    "inputYourPassword": "Please input your password!"\n}\n'})}),"\n",(0,c.jsx)(n.p,{children:"然后写下 index2.js"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:"const { Workbook } = require('exceljs');\nconst fs = require('fs');\n\nconst languages = ['zh-CN', 'en-US'];\n\nasync function main(){\n    const workbook = new Workbook();\n\n    const worksheet = workbook.addWorksheet('test');\n\n    const bundleData = languages.map(item => {\n        return JSON.parse(fs.readFileSync(`./${item}.json`));\n    })\n\n    const data = [];\n\n    bundleData.forEach((item, index) => {\n        for(let key in item) {\n            const foundItem = data.find(item => item.id === key);\n            if(foundItem) {\n                foundItem[languages[index]] = item[key]\n            } else {\n                data.push({\n                    id: key,\n                    [languages[index]]: item[key]\n                })\n            }\n        }\n    })\n\n    console.log(data);\n\n    worksheet.columns = [\n        { header: 'ID', key: 'id', width: 30 },\n        ...languages.map(item => {\n            return {\n                header: item,\n                key: item,\n                width: 30\n            }\n        })\n    ];\n\n    worksheet.addRows(data);\n\n    workbook.xlsx.writeFile('./bundle.xlsx');    \n}\n\nmain();\n"})}),"\n",(0,c.jsx)(n.p,{children:"这里我们读取了 en-US.json 和 zh-CN.json 的内容，然后按照 id、en-US、zh-CN 的 column 来写入 excel。"}),"\n",(0,c.jsx)(n.p,{children:"跑一下："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:F,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"看下生成的 excel："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:z,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"现在这个 excel 已经可以交给产品经理去编辑了，但是还少了一些描述。"}),"\n",(0,c.jsx)(n.p,{children:"可能产品经理看到某个 key 并不知道这个文案是在哪里用的，干啥的。"}),"\n",(0,c.jsx)(n.p,{children:"所以我们最好加一些描述。"}),"\n",(0,c.jsx)(n.p,{children:"打开上节的项目，再次执行 extract 命令："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:'npx formatjs extract "src/**/*.tsx" --out-file messages.json\n'})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:B,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"现在有 defaultMessage，没有 description，我们在 defineMessages 的时候加一下："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:C,alt:""})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:"const messsages = defineMessages({\n  username: {\n    id: \"username\",\n    defaultMessage: '用户名',\n    description: '这是登录的用户名'\n  },\n  password: {\n    id: \"password\",\n    defaultMessage: '密码',\n    description: '这是登录的密码'\n  },\n  rememberMe: {\n    id: 'rememberMe',\n    defaultMessage: '记住我',\n    description: '登录页的记住我复选框'\n  },\n  submit: {\n    id: 'submit',\n    defaultMessage: '提交',\n    description: '登录页的提交按钮'\n  },\n  inputYourUsername: {\n    id: 'inputYourUsername',\n    defaultMessage: '请输入用户名！',\n    description: '登录页的用户名为空的提示'\n  },\n  inputYourPassword: {\n    id: 'inputYourPassword',\n    defaultMessage: '请输入密码！',\n    description: '登录页的密码为空的提示'\n  }\n})\n"})}),"\n",(0,c.jsx)(n.p,{children:"重新 extract 生成 messages.json"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:'npx formatjs extract "src/**/*.tsx" --out-file messages.json\n'})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:v,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"上节我们把这个文件删掉了，其实没必要删掉，可以用它来生成 excel。"}),"\n",(0,c.jsx)(n.p,{children:"把 messages.json 复制过去，我们改下 index2.js"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:N,alt:""})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:"const { Workbook } = require('exceljs');\nconst fs = require('fs');\n\nconst languages = ['zh-CN', 'en-US'];\n\nasync function main(){\n    const workbook = new Workbook();\n\n    const worksheet = workbook.addWorksheet('test');\n\n    const bundleData = languages.map(item => {\n        return JSON.parse(fs.readFileSync(`./${item}.json`));\n    })\n\n    const data = [];\n\n    const messages = JSON.parse(fs.readFileSync('./messages.json'));\n\n    bundleData.forEach((item, index) => {\n        for(let key in messages) {\n            const foundItem = data.find(item => item.id === key);\n            if(foundItem) {\n                foundItem[languages[index]] = item[key]\n            } else {\n                data.push({\n                    id: key,\n                    defaultMessage: messages[key].defaultMessage,\n                    description: messages[key].description,\n                    [languages[index]]: item[key]\n                })\n            }\n        }\n    })\n\n    console.log(data);\n\n    worksheet.columns = [\n        { header: 'ID', key: 'id', width: 30 },\n        { header: 'defaultMessage', key: 'defaultMessage', width: 30 },\n        { header: 'description', key: 'description', width: 50 },\n        ...languages.map(item => {\n            return {\n                header: item,\n                key: item,\n                width: 30\n            }\n        })\n    ];\n\n    worksheet.addRows(data);\n\n    workbook.xlsx.writeFile('./bundle.xlsx');    \n}\n\nmain();\n"})}),"\n",(0,c.jsx)(n.p,{children:"现在生成的是这样的："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:A,alt:""})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:S,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"这样产品经理就知道每个 key 是哪里的文案，什么意思，就知道怎么翻译了。"}),"\n",(0,c.jsx)(n.p,{children:"改一下："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:y,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"然后改完之后要用这个生成 en-US.json 和 zh-CN.json 在项目里引入用。"}),"\n",(0,c.jsx)(n.p,{children:"写一下这个脚本："}),"\n",(0,c.jsx)(n.p,{children:"index3.js"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:"const { Workbook } = require('exceljs');\n\nasync function main(){\n    const workbook = new Workbook();\n\n    const workbook2 = await workbook.xlsx.readFile('./bundle.xlsx');\n\n    workbook2.eachSheet((sheet, index1) => {\n        console.log('工作表' + index1);\n\n        sheet.eachRow((row, index2) => {\n            const rowData = [];\n    \n            row.eachCell((cell, index3) => {\n                rowData.push(cell.value);\n            });\n\n            console.log('行' + index2, rowData);\n        })\n    })\n}\n\nmain();\n"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:w,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"解析也是按照 workbook（工作簿） > worksheet（工作表）> row （行）的层次，调用 eachSheet、eachRow、eachCell 就好了。"}),"\n",(0,c.jsx)(n.p,{children:"然后生成 json："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:"const { Workbook } = require('exceljs');\nconst fs = require('fs');\n\nasync function main(){\n    const workbook = new Workbook();\n\n    const workbook2 = await workbook.xlsx.readFile('./bundle.xlsx');\n\n    const zhCNBundle = {};\n    const enUSBundle = {};\n\n    workbook2.eachSheet((sheet) => {\n\n        sheet.eachRow((row, index) => {\n            if(index === 1) {\n                return;\n            }\n            const key = row.getCell(1).value;\n            const zhCNValue = row.getCell(4).value;\n            const enUSValue = row.getCell(5).value;\n\n            zhCNBundle[key] = zhCNValue;\n            enUSBundle[key] = enUSValue;\n        })\n    });\n\n    console.log(zhCNBundle);\n    console.log(enUSBundle);\n    fs.writeFileSync('zh-CN.json', JSON.stringify(zhCNBundle, null, 2));\n    fs.writeFileSync('en-US.json', JSON.stringify(enUSBundle, null, 2));\n}\n\nmain();\n"})}),"\n",(0,c.jsx)(n.p,{children:"跑一下："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:k,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"这样就把产品经理编辑后的 excel 生成了国际化资源包："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:b,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"项目里直接用这个资源包就好了。"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:u,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"现在这样的工作流是可以的，但是不能协同编辑。"}),"\n",(0,c.jsx)(n.p,{children:"如果能够像在线文档一样协同编辑这个 excel 就好了。"}),"\n",(0,c.jsx)(n.p,{children:"可以的，用 google sheets."}),"\n",(0,c.jsxs)(n.p,{children:["打开 google sheets： ",(0,c.jsx)(n.a,{href:"https://docs.google.com/spreadsheets/",target:"_blank",rel:"noopener noreferrer",children:"https://docs.google.com/spreadsheets/"})]}),"\n",(0,c.jsx)(n.p,{children:"登录之后创建一个新的 sheet："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:f,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"它可以导入 csv 格式的文件："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:g,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"选择 replace 替换当前工作表："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:m,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"这样，就导入了 csv 的数据："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:j,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"可以在线编辑了。"}),"\n",(0,c.jsx)(n.p,{children:"把这个 url 分享出去就行。"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:"data:image/webp;base64,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",alt:""})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:x,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"比如这个 url："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.a,{href:"https://docs.google.com/spreadsheets/d/1FgCNmoTz9FWuR6Jv1SJ9ioWd2bBfrtRAeoi5CYpmXBA/edit?usp=sharing",target:"_blank",rel:"noopener noreferrer",children:"https://docs.google.com/spreadsheets/d/1FgCNmoTz9FWuR6Jv1SJ9ioWd2bBfrtRAeoi5CYpmXBA/edit?usp=sharing"})}),"\n",(0,c.jsx)(n.p,{children:"接下来的问题就变成了如何用 node 生成和解析 csv 文件。"}),"\n",(0,c.jsx)(n.p,{children:"这个可以用 csv-parse 和 csv-stringify 来做。"}),"\n",(0,c.jsx)(n.p,{children:"安装 csv-stringify："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"npm install --save-dev csv-stringify\n"})}),"\n",(0,c.jsx)(n.p,{children:"然后写下 index4.js"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:'const { stringify } = require("csv-stringify");\nconst fs = require(\'fs\');\n\nconst languages = [\'zh-CN\', \'en-US\'];\n\nasync function main(){\n    const bundleData = languages.map(item => {\n        return JSON.parse(fs.readFileSync(`./${item}.json`));\n    })\n\n    const data = [];\n\n    const messages = JSON.parse(fs.readFileSync(\'./messages.json\'));\n\n    bundleData.forEach((item, index) => {\n        for(let key in messages) {\n            const foundItem = data.find(item => item.id === key);\n            if(foundItem) {\n                foundItem[languages[index]] = item[key]\n            } else {\n                data.push({\n                    id: key,\n                    defaultMessage: messages[key].defaultMessage,\n                    description: messages[key].description,\n                    [languages[index]]: item[key]\n                })\n            }\n        }\n    })\n\n    console.log(data);\n\n    const columns = {\n        id: "Message ID",\n        defaultMessage: "Default Message",\n        description: "Description",\n        \'zh-CN\': "zh-CN",\n        \'en-US\': "en-US"\n    };\n      \n    stringify(data, { header: true, columns }, function (err, output) {\n        fs.writeFileSync("./messages.csv", output);\n    });\n}\n\nmain();\n'})}),"\n",(0,c.jsx)(n.p,{children:"也是定义 columns 和 column 对应的 data，调用 stringify 来转成 csv 文件。"}),"\n",(0,c.jsx)(n.p,{children:"跑一下："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:h,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"可以看到，生成了 message.csv 文件。"}),"\n",(0,c.jsx)(n.p,{children:"然后在 google sheet 里导入："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:p,alt:""})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:l,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"你可以点开这个链接看一下："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.a,{href:"https://docs.google.com/spreadsheets/d/1FgCNmoTz9FWuR6Jv1SJ9ioWd2bBfrtRAeoi5CYpmXBA/edit?usp=sharing",target:"_blank",rel:"noopener noreferrer",children:"https://docs.google.com/spreadsheets/d/1FgCNmoTz9FWuR6Jv1SJ9ioWd2bBfrtRAeoi5CYpmXBA/edit?usp=sharing"})}),"\n",(0,c.jsx)(n.p,{children:"改一下这个文案："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:o,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"然后导出到本地再转成 json 就好了。"}),"\n",(0,c.jsx)(n.p,{children:"怎么导出呢？"}),"\n",(0,c.jsx)(n.p,{children:"在现在的 url 后加一个 export?format=csv 就好了："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:d,alt:""})}),"\n",(0,c.jsxs)(n.p,{children:["比如这个链接： ",(0,c.jsx)(n.a,{href:"https://docs.google.com/spreadsheets/d/1FgCNmoTz9FWuR6Jv1SJ9ioWd2bBfrtRAeoi5CYpmXBA/export?format=csv",target:"_blank",rel:"noopener noreferrer",children:"https://docs.google.com/spreadsheets/d/1FgCNmoTz9FWuR6Jv1SJ9ioWd2bBfrtRAeoi5CYpmXBA/export?format=csv"})]}),"\n",(0,c.jsx)(n.p,{children:"然后在代码里下载下导出的 csv："}),"\n",(0,c.jsx)(n.p,{children:"index5.js"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:"const { execSync } = require('child_process');\nconst { parse } = require(\"csv-parse/sync\");\nconst fs = require('fs');\n\nconst sheetUrl = \"https://docs.google.com/spreadsheets/d/1FgCNmoTz9FWuR6Jv1SJ9ioWd2bBfrtRAeoi5CYpmXBA\";\n\nexecSync(`curl -L ${sheetUrl}/export?format=csv -o ./message2.csv`, {\n    stdio: 'ignore'\n});\n\nconst input = fs.readFileSync(\"./message2.csv\");\n\nconst records = parse(input, { columns: true });\n\nconsole.log(records);\n"})}),"\n",(0,c.jsx)(n.p,{children:"这里用 curl 命令来下载，-L 是自动跳转的意思，因为访问这个 url 会跳转一个新的地址。"}),"\n",(0,c.jsx)(n.p,{children:"安装用到的包："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"npm install --save-dev csv-parse\n"})}),"\n",(0,c.jsx)(n.p,{children:"跑一下："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:t,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"可以看到，message2.csv 下载了下来，并且还解析出了其中的数据。"}),"\n",(0,c.jsx)(n.p,{children:"接下来用这个生成 zh-CN.json 和 en-US.json，然后在项目里用就好了。"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:"const { execSync } = require('child_process');\nconst { parse } = require(\"csv-parse/sync\");\nconst fs = require('fs');\n\nconst sheetUrl = \"https://docs.google.com/spreadsheets/d/1FgCNmoTz9FWuR6Jv1SJ9ioWd2bBfrtRAeoi5CYpmXBA\";\n\nexecSync(`curl -L ${sheetUrl}/export?format=csv -o ./message2.csv`, {\n    stdio: 'ignore'\n});\n\nconst input = fs.readFileSync(\"./message2.csv\");\n\nconst data = parse(input, { columns: true });\n\nconst zhCNBundle = {};\nconst enUSBundle = {};\n\ndata.forEach(item => {\n    const keys = Object.keys(item);\n    const key = item[keys[0]];\n    const valueZhCN = item[keys[3]];\n    const valueEnUS = item[keys[4]];\n\n    zhCNBundle[key] = valueZhCN;\n    enUSBundle[key] = valueEnUS;\n})\n\nconsole.log(zhCNBundle);\nconsole.log(enUSBundle);\n\nfs.writeFileSync('zh-CN.json', JSON.stringify(zhCNBundle, null, 2));\nfs.writeFileSync('en-US.json', JSON.stringify(enUSBundle, null, 2));\n"})}),"\n",(0,c.jsx)(n.p,{children:"跑一下："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:r,alt:""})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:i,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"这样，就完成了资源包在 google sheet 的在线编辑，以及编辑完以后下载并解析生成资源包的功能。"}),"\n",(0,c.jsx)(n.p,{children:"相比用 exceljs 生成 excel 文件的方式，google sheet 可以把 url 分享出去，可以协同编辑，更方便一点。"}),"\n",(0,c.jsxs)(n.p,{children:["案例代码上传了",(0,c.jsx)(n.a,{href:"https://github.com/QuarkGluonPlasma/react-course-code/tree/main/excel-export",target:"_blank",rel:"noopener noreferrer",children:"小册仓库"})]}),"\n",(0,c.jsxs)(n.h2,{id:"总结",children:["总结",(0,c.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#总结",children:"#"})]}),"\n",(0,c.jsx)(n.p,{children:"国际化资源包需要交给产品经理去翻译，我们会把 json 转成 excel 交给他。"}),"\n",(0,c.jsx)(n.p,{children:"我们先用 exceljs 实现了 excel 的解析和生成，编辑完之后再转成 en-US.json、zh-CN.json 的资源包。"}),"\n",(0,c.jsx)(n.p,{children:"然后用 google sheet 实现了在线编辑和分享，编辑完之后下载并解析 csv，然后转成 en-US.json、zh-CN.json 的资源包。"}),"\n",(0,c.jsx)(n.p,{children:"用到了 csv-parse、csv-stingify。"}),"\n",(0,c.jsx)(n.p,{children:"这两种方案都可以，确定好方案之后把这些脚本内置到项目里就可以了。"})]})}function Y(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,a.ah)(),e.components);return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(M,{...e})}):M(e)}let V=Y;Y.__RSPRESS_PAGE_META={},Y.__RSPRESS_PAGE_META["React%20%E9%80%9A%E5%85%B3%E7%A7%98%E7%B1%8D%2F%E7%AC%AC50%E7%AB%A0%E2%80%94%E5%9B%BD%E9%99%85%E5%8C%96%E8%B5%84%E6%BA%90%E5%8C%85%E5%A6%82%E4%BD%95%E9%80%9A%E8%BF%87Excel%E5%92%8CGoogleSheet%E5%88%86%E4%BA%AB%E7%BB%99%E4%BA%A7%E5%93%81%E7%BB%8F%E7%90%86.md"]={toc:[{text:"总结",id:"总结",depth:2}],title:"第50章—国际化资源包如何通过Excel和GoogleSheet分享给产品经理",headingTitle:"第50章—国际化资源包如何通过Excel和GoogleSheet分享给产品经理",frontmatter:{}}}}]);