"use strict";(self.webpackChunkjue_jin_book_press=self.webpackChunkjue_jin_book_press||[]).push([["90809"],{342623:function(e,n,s){s.r(n),s.d(n,{default:()=>N});var r=s(552676),i=s(740453);let a=s.p+"static/image/b052439c5854b8013212a4d3d95f09e4.d6aafbae.webp",c=s.p+"static/image/d3704f51be5e063f535e0a43d7f6f469.6775c8d7.webp",d=s.p+"static/image/bb8f55c3f638956d305d54aed3e1409f.f4ad5fe3.webp",l=s.p+"static/image/edaede8c248ce9976dd207b4a59560be.cd1d694d.webp",t=s.p+"static/image/4e32c6450b2310da9fb9e7ee7c7b43a1.a866fd1f.webp",o=s.p+"static/image/37e0091c7539ef72f42b3409ca8c18c1.b59b7c4c.webp",p=s.p+"static/image/adc9239bf85449396d2cc19161751ae8.8aa9d95c.webp",h=s.p+"static/image/fde0ff843059cfe43e1ad0b3102a6420.0633504f.webp",x=s.p+"static/image/710319fc1fade55ca813686e680d8eeb.1f5a5d8b.webp",u=s.p+"static/image/2629e96004c7c9ec655dba8874013baa.89163bbb.webp",j=s.p+"static/image/b0433077113711b45a8c0cd44ec49a7f.13ade4b0.webp",m=s.p+"static/image/b8502f3bb808bbf37d2a93a6bd9b38e4.408d2fe9.webp",f=s.p+"static/image/7a9ca4a1f99189774ecffc9d4b330feb.c972cbe6.webp",g=s.p+"static/image/15990f64b1b2d6c78eb17f63462821e5.36536aa7.webp",b=s.p+"static/image/2ecb4f21a7164351b658aede81034ff1.89163bbb.webp",k=s.p+"static/image/a1462e86731e1b0f892d74fd731677fe.005b6c0b.webp";function w(e){let n=Object.assign({h1:"h1",a:"a",p:"p",h2:"h2",img:"img",h3:"h3",pre:"pre",code:"code",em:"em",ol:"ol",li:"li",ul:"ul",br:"br"},(0,i.ah)(),e.components);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.h1,{id:"26-实战16基于neteasecloudmusicapi接口二次开发和部署",children:["26 实战16：基于NeteaseCloudMusicApi接口二次开发和部署",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#26-实战16基于neteasecloudmusicapi接口二次开发和部署",children:"#"})]}),"\n",(0,r.jsxs)(n.p,{children:["本章先来了解下 NeteaseCloudMusicApi 这个项目，并且我提前把 NeteaseCloudMusicApi 项目 fork 到了 ",(0,r.jsx)(n.a,{href:"https://github.com/front-end-class/uniapp-music-back-code",target:"_blank",rel:"noopener noreferrer",children:"uniapp-music-back-code"})," ，方便后续接口二次开发和部署。"]}),"\n",(0,r.jsxs)(n.h2,{id:"neteasecloudmusicapi项目",children:["NeteaseCloudMusicApi项目",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#neteasecloudmusicapi项目",children:"#"})]}),"\n",(0,r.jsx)(n.p,{children:"NeteaseCloudMusicApi，网易云音乐 NodeJS 版 API。"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:k,alt:""})}),"\n",(0,r.jsxs)(n.h3,{id:"在线文档",children:["在线文档",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#在线文档",children:"#"})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"https://front-end-class.github.io/uniapp-music-back-code/",target:"_blank",rel:"noopener noreferrer",children:(0,r.jsx)(n.a,{href:"https://front-end-class.github.io/uniapp-music-back-code/",target:"_blank",rel:"noopener noreferrer",children:"https://front-end-class.github.io/uniapp-music-back-code/"})})}),"\n",(0,r.jsxs)(n.h3,{id:"安装",children:["安装",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#安装",children:"#"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"$ git clone https://github.com/front-end-class/uniapp-music-back-code.git\n$ npm install\n"})}),"\n",(0,r.jsxs)(n.h3,{id:"运行",children:["运行",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#运行",children:"#"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"$ node app.js\n"})}),"\n",(0,r.jsx)(n.p,{children:"服务器启动默认端口为 3000,若不想使用 3000 端口,可使用以下命令: Mac/Linux"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"$ PORT=4000 node app.js\n"})}),"\n",(0,r.jsx)(n.p,{children:"windows 下使用 git-bash 或者 cmder 等终端执行以下命令:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"$ set PORT=4000 && node app.js\n"})}),"\n",(0,r.jsx)(n.p,{children:"成功启动打开浏览器访问："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:b,alt:""})}),"\n",(0,r.jsxs)(n.h3,{id:"接口二次开发",children:["接口二次开发",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#接口二次开发",children:"#"})]}),"\n",(0,r.jsx)(n.p,{children:"使用 NeteaseCloudMusicApi 项目可以友好的使用网易云的接口，但是还是需要注意一些接口问题。毕竟网易云并没有把 app 应用的接口暴露出来，在 Uniapp 项目中使用特定业务的接口就需要数据模拟来完成了。"}),"\n",(0,r.jsx)(n.p,{children:"NeteaseCloudMusicApi 项目中的 app.js 处理接口是根据文件夹 module 下的文件名称进行接口定义的。比如 banner.js 文件里面处理了网易云的接口再二次转发到客户端。"}),"\n",(0,r.jsx)(n.p,{children:"这样客户端访问 localhost:3000/banner 接口就可以访问到数据了。相关代码："}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"// app.js\n// 读取 module 目录下的所有文件\nfs.readdirSync(path.join(__dirname, 'module')).reverse().forEach(file => {\n    if (!file.endsWith('.js')) return\n	// 提取文件的名称\n    let route = (file in special) ? special[file] : '/' + file.replace(/\\.js$/i, '').replace(/_/g, '/')\n	// 文件的请求promise\n    let question = require(path.join(__dirname, 'module', file))\n	\n	// 以文件名称作为接口路径\n    app.use(route, (req, res) => {\n        let query = Object.assign({}, req.query, req.body, { cookie: req.cookies })\n		// 处理请求响应\n        question(query, request).then(answer => {\n            res.append('Set-Cookie', answer.cookie)\n            res.status(answer.status).send(answer.body)\n        }).catch(answer => {\n            if (answer.body.code == '301') answer.body.msg = '需要登录'\n            res.append('Set-Cookie', answer.cookie)\n            res.status(answer.status).send(answer.body)\n        })\n    })\n})\n"})}),"\n",(0,r.jsx)(n.p,{children:"以上面代码处理作为引导，我们可以在目录下新建一个 mock 文件夹处理模拟数据，也是以文件命名的方式作为接口名。以上面代码的重新改造即可。"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.em,{children:"注：NeteaseCloudMusicApi 项目是基于 express 开发"})}),"\n",(0,r.jsx)(n.p,{children:"项目存在跨域的可能性，express 有一个 npm 模块 cors 处理跨域问题，使用非常简洁方便。"}),"\n",(0,r.jsx)(n.p,{children:"安装模块"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"npm i cors -D\n"})}),"\n",(0,r.jsx)(n.p,{children:"模块使用"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"const express = require('express');\nconst cors = require('cors');\nconst app = express();\n\napp.use(cors());\n"})}),"\n",(0,r.jsx)(n.p,{children:"注：添加中间件要注意顺序。"}),"\n",(0,r.jsx)(n.p,{children:"看一下 app.js 完整代码："}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"const fs = require('fs')\nconst path = require('path')\nconst express = require('express')\nconst bodyParser = require('body-parser')\nconst request = require('./util/request')\nconst packageJSON = require('./package.json')\nconst exec = require('child_process').exec\nconst cache = require('apicache').middleware\nconst cors = require('cors');\n\n// version check\nexec('npm info NeteaseCloudMusicApi version', (err, stdout, stderr) => {\n    if (!err) {\n        let version = stdout.trim()\n        if (packageJSON.version < version) {\n            console.log(`最新版本: ${version}, 当前版本: ${packageJSON.version}, 请及时更新`)\n        }\n    }\n})\n\nconst app = express()\n\napp.use(cors());\n\n// CORS & Preflight request\napp.use((req, res, next) => {\n    if (req.path !== '/' && !req.path.includes('.')) {\n        res.set({\n            'Access-Control-Allow-Credentials': true,\n            // 'Access-Control-Allow-Origin': req.headers.origin || '*',\n            'Access-Control-Allow-Origin': '*',\n            'Access-Control-Allow-Headers': 'X-Requested-With,Content-Type',\n            'Access-Control-Allow-Methods': 'PUT,POST,GET,DELETE,OPTIONS',\n            'Content-Type': 'application/json; charset=utf-8'\n        })\n    }\n    req.method === 'OPTIONS' ? res.status(204).end() : next()\n})\n\n// cookie parser\napp.use((req, res, next) => {\n    req.cookies = {}, (req.headers.cookie || '').split(/\\s*;\\s*/).forEach(pair => {\n        let crack = pair.indexOf('=')\n        if (crack < 1 || crack == pair.length - 1) return\n        req.cookies[decodeURIComponent(pair.slice(0, crack)).trim()] = decodeURIComponent(pair.slice(crack + 1)).trim()\n    })\n    next()\n})\n\n// body parser\napp.use(bodyParser.json())\napp.use(bodyParser.urlencoded({ extended: false }))\n\n// cache\napp.use(cache('2 minutes', ((req, res) => res.statusCode === 200)))\n\n// static\napp.use(express.static(path.join(__dirname, 'public')))\n\n// router\nconst special = {\n    'daily_signin.js': '/daily_signin',\n    'fm_trash.js': '/fm_trash',\n    'personal_fm.js': '/personal_fm'\n}\n\n// mock 本地数据\nfs.readdirSync(path.join(__dirname, 'mock')).reverse().forEach(file => {\n    if (!file.endsWith('.js')) return\n    let route = (file in special) ? special[file] : '/' + file.replace(/\\.js$/i, '').toLowerCase().replace(/_/g, '/')\n    let question = require(path.join(__dirname, 'mock', file))\n\n    app.use(route, (req, res) => {\n        // res.status(200).send(question)\n        let query = Object.assign({}, req.query, req.body, { cookie: req.cookies })\n        question.promise(query, request).then(answer => {\n            console.log('[OK]', decodeURIComponent(req.originalUrl))\n            console.log(answer)\n            res.append('Set-Cookie', answer.cookie)\n\n            answer.body.mock = question.mock\n            res.status(answer.status).send(answer.body)\n        }).catch(answer => {\n            console.log('[ERR]', decodeURIComponent(req.originalUrl))\n            if (answer.body.code == '301') answer.body.msg = '需要登录'\n            res.append('Set-Cookie', answer.cookie)\n            res.status(answer.status).send(answer.body)\n        })\n\n        return\n    })\n})\n\nfs.readdirSync(path.join(__dirname, 'module')).reverse().forEach(file => {\n    if (!file.endsWith('.js')) return\n    let route = (file in special) ? special[file] : '/' + file.replace(/\\.js$/i, '').replace(/_/g, '/')\n    let question = require(path.join(__dirname, 'module', file))\n\n    app.use(route, (req, res) => {\n        let query = Object.assign({}, req.query, req.body, { cookie: req.cookies })\n        question(query, request).then(answer => {\n            console.log('[OK]', decodeURIComponent(req.originalUrl))\n            res.append('Set-Cookie', answer.cookie)\n            res.status(answer.status).send(answer.body)\n        }).catch(answer => {\n            console.log('[ERR]', decodeURIComponent(req.originalUrl))\n            if (answer.body.code == '301') answer.body.msg = '需要登录'\n            res.append('Set-Cookie', answer.cookie)\n            res.status(answer.status).send(answer.body)\n        })\n    })\n})\n\nconst port = process.env.PORT || 3000\n\napp.server = app.listen(port, () => {\n    console.log(`server running @ http://localhost:${port}`)\n})\n\nmodule.exports = app\n\n"})}),"\n",(0,r.jsxs)(n.h2,{id:"注册腾讯云和安装软件",children:["注册腾讯云和安装软件",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#注册腾讯云和安装软件",children:"#"})]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"注册腾讯云和申请域名，这里按照官方指导操作就可以"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"我选的系统是 CentOS 7.5 64位，申请完登录，进入腾讯云，"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:g,alt:""})}),"\n",(0,r.jsxs)(n.p,{children:["选择标准方式",(0,r.jsx)(n.code,{children:"登录"}),"，密码注册时已发",(0,r.jsx)(n.code,{children:"消息中心"}),"里，建议修改密码"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:f,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"登录成功"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:m,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"接下来依次键入命令安装几个软件："}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Node.js"}),"\n",(0,r.jsx)(n.li,{children:"pm2"}),"\n",(0,r.jsx)(n.li,{children:"nginx"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"yum install -y nodejs\nyum install -y git\nyum install -y nginx\n"})}),"\n",(0,r.jsx)(n.p,{children:"Node.js 安装完成就可以使用 npm 安装 pm2"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"npm install pm2 -g\n"})}),"\n",(0,r.jsx)(n.p,{children:"pm2 是 node 进程管理工具，可以利用它来简化很多 node 应用管理的繁琐任务，如性能监控、自动重启、负载均衡等，而且使用非常简单。pm2 功能很强大，入门确非常简单，常用的几个命令是："}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"pm2 start app.js -n uni 启动一个进程并把它命名为 uni\npm2 list/ls 列出所有进程信息\npm2 logs 显示所有进程日志\npm2 stop all 停止所有进程\npm2 restart all 重启所有进程\npm2 reload all 0秒停机重载进程 (用于 NETWORKED 进程)\npm2 stop 0 停止指定的进程\npm2 restart 0 重启指定的进程\npm2 startup 产生 init 脚本 保持进程活着\npm2 delete 0 杀死指定的进程\npm2 delete all 杀死全部进程\npm2 monit 查看进程的资源消耗情况\npm2 start app.js -i max // -i 表示 number-instances 实例数量 max 表示 PM2将自动检测可用CPU的数量 可以自己指定数量\npm2 start app.js -n uni --watch 在文件改变的时候会重新启动程序\npm2 startup centos 设置pm2开机自启\npm2 save 保存设置\n"})}),"\n",(0,r.jsxs)(n.p,{children:["了解更多可以查看 ",(0,r.jsx)(n.a,{href:"http://pm2.keymetrics.io/docs/usage/quick-start",target:"_blank",rel:"noopener noreferrer",children:"官方文档"}),"。"]}),"\n",(0,r.jsxs)(n.h2,{id:"部署项目至腾讯云",children:["部署项目至腾讯云",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#部署项目至腾讯云",children:"#"})]}),"\n",(0,r.jsxs)(n.p,{children:["首先拉取一份代码到本地 ",(0,r.jsx)(n.a,{href:"https://github.com/front-end-class/uniapp-music-back-code",target:"_blank",rel:"noopener noreferrer",children:"uniapp-music-back-code"}),"，然后回到腾讯云后台并输入："]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"git clone https://github.com/front-end-class/uniapp-music-back-code.git\n#之后需要更新可以输入命令：git pull\n\n# 进入文件夹\ncd uniapp-music-back-code\n\n# 安装npm包\nnpm install\n\n# 使用pm2启动\npm2 start app.js -n uni\n\n# 查看状态\npm2 list\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:j,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"已经启动成功，打开浏览器通过域名或 ip（公网ip） 访问。（如果打开不开，有可能是服务器3000端口没打开，需要自行去添加设置规则）"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:u,alt:""})}),"\n",(0,r.jsxs)(n.h2,{id:"安装shell软件",children:["安装Shell软件",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#安装shell软件",children:"#"})]}),"\n",(0,r.jsx)(n.p,{children:"对于操作后台管理系统，更多人会选择可视化的软件。Windows 系统一般推荐就是 Xshell，对于 Mac 系统的，我使用 FinalShell（支持国产的，也没找到更傻瓜的）。\n也是一路安装，然后配置（Xshell 也是类似操作）："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:x,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"登录成功之后："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:h,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"尝试输入："}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"pm2 list\n# 出现上文启动的 uni 项目日志\n"})}),"\n",(0,r.jsxs)(n.h2,{id:"配置https",children:["配置Https",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#配置https",children:"#"})]}),"\n",(0,r.jsxs)(n.p,{children:["众所周知，小程序接口需要使用 https，我们可以利用腾讯云提供的免费 ",(0,r.jsx)(n.a,{href:"https://console.cloud.tencent.com/ssl",target:"_blank",rel:"noopener noreferrer",children:"SSL 证书"})," 来配置 https，点击免费申请按钮，选择域名型的（DV）免费证书即可："]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:p,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"填上申请信息后，等待大概半小时，证书就能申请下来。"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:o,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"在证书申请通过后，进入SSL证书列表，将所申请的域名SSL证书下载到本地后，再上传到域名所在服务器。"}),"\n",(0,r.jsxs)(n.p,{children:["回到 FinalShell，在 ",(0,r.jsx)(n.code,{children:"/etc/nginx/"})," 下创建文件夹 ssl"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# 也可以选择输入命令\ncd /etc/nginx/\nmkdir ssl\n"})}),"\n",(0,r.jsx)(n.p,{children:"将 crt 和 key 两个文件(公钥和私钥)修改好名字上传到 ssl 文件夹"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:t,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"修改 nginx 配置文件"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"vi /etc/nginx/nginz.conf\n"})}),"\n",(0,r.jsx)(n.p,{children:"修改server配置"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-nginx",children:"server{\n      listen 80;    #表示监听80端口\n      server_name gzamon.wang www.gzamon.wang;\n      location / {    #将80端口强制转为https\n          rewrite (.*) https://www.gzamon.wang$1 permanent;\n      }\n}\nserver{\n      listen 443 ssl;    #表示监听443端口即https\n      server_name gzamon.wang www.gzamon.wang;\n      ssl_certificate /etc/nginx/ssl/1_www.gzamon.wang_bundle.crt;   #证书公钥文件路径\n      ssl_certificate_key /etc/nginx/ssl/2_www.gzamon.wang.key;      #证书私钥文件路径\n      ssl_session_timeout 5m;                                         #5分钟session会话保持\n      ssl_protocols TLSv1 TLSv1.1 TLSv1.2;\n      ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE;\n      ssl_prefer_server_ciphers on;\n      \n      location / {    #将80端口强制转为https\n        root /home/nginx/uni-music;  # H5 打包后项目放置目录\n        #固定写法就可以了\n        index  index.html index.htm;\n        try_files $uri $uri/ /index.html;\n      }\n		\n      location /api/ {\n          proxy_pass http://127.0.0.1:3000/; # node后端接口服务\n          proxy_redirect   off;\n          proxy_set_header Host $host;\n          proxy_set_header X-Real-IP $remote_addr;\n          proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n          proxy_set_header X-Forwarded-Proto $scheme;\n    }\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"保存并重启 nginx"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo service nginx restart\n"})}),"\n",(0,r.jsx)(n.p,{children:"如果报错："}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'Job for nginx.service failed because the control process exited with error code. See "systemctl status nginx.service" and "journalctl -xe" for details.\n# 输入 systemctl status nginx.service 会提示是什么错误，修复后再次重启 nginx 即可\n'})}),"\n",(0,r.jsx)(n.p,{children:"如果没有报错你就可以使用 https 访问网站了 ：）"}),"\n",(0,r.jsxs)(n.p,{children:["演示地址：",(0,r.jsx)(n.br,{}),"\n",(0,r.jsx)(n.a,{href:"https://www.gzamon.wang/api/",target:"_blank",rel:"noopener noreferrer",children:"api接口服务"})]}),"\n",(0,r.jsx)(n.p,{children:"参考文档："}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["(域名型证书申请流程)[",(0,r.jsx)(n.a,{href:"https://cloud.tencent.com/document/product/400/6814",target:"_blank",rel:"noopener noreferrer",children:"https://cloud.tencent.com/document/product/400/6814"}),"]"]}),"\n",(0,r.jsxs)(n.li,{children:["(腾讯云实现全站 HTTPS 方案)[",(0,r.jsx)(n.a,{href:"https://cloud.tencent.com/document/product/400/6813",target:"_blank",rel:"noopener noreferrer",children:"https://cloud.tencent.com/document/product/400/6813"}),"]"]}),"\n"]}),"\n",(0,r.jsxs)(n.h2,{id:"通过-docker-部署",children:["通过 Docker 部署",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#通过-docker-部署",children:"#"})]}),"\n",(0,r.jsxs)(n.h3,{id:"安装-docker",children:["安装 Docker",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#安装-docker",children:"#"})]}),"\n",(0,r.jsxs)(n.p,{children:["首先在腾讯云上安装 Docker，参照官方极简教程，成功是分分钟事，",(0,r.jsx)(n.a,{href:"https://cloud.tencent.com/developer/labs/lab/10054",target:"_blank",rel:"noopener noreferrer",children:"搭建 Docker 环境"}),"。"]}),"\n",(0,r.jsx)(n.p,{children:"要知道是否安装成功，执行命令："}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"docker -v\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:"data:image/webp;base64,UklGRvgPAABXRUJQVlA4IOwPAACQRACdASryATAAPp1AnEilo6MhLxOb6LATiWcA0iyPLbTh8htkf+8PyraAfU/0Z/ongN/Tv7r/Wv2m88fxD49+3flr6i38B5G+U/+P/VfUT+M/YD8Z/Uv7p/0PTH/Rf0Txd92387/TfYC/Gv5B/gv7H42f1J7grNf7f/xfUC9TfmP+y/vX+I8e/+b/ovqH+Q/0z/Te4B/Hv5x/tvzW/snwj/nPA++n/379lfgA/k39j/3v+I/KL6QP4D/u/4382PaD+Y/37/vf5L4A/5l/Vv+j/gPbm9n37oe0b+6ySiAjonkIZ4mTWybfa1E18yK5CvshQOg6ZU2H6As8Czo4DiznnuMX/68f6mSYEwW4O1r4XGRyZ1M9VNVSr+qEIZ5I9cccGnh+YLLzbeVDDfJwmwEY1efFCEqMxc/W3EMSv1I9C+DX98su2sAe/7FWuQa1DerxTdFT8NYnhCEjpRykEpIcbKhz6wsOYfY7DTD3nHBxpfMnnVopGwZZ2SUu5Tjkj2rQWkMIcHMeCBEewgzA9mGnj8MSSv+NkAC5iwkF12jGJODFX31b/UOXdCire5MqFs3/kQklJPKG0UcmNt+RIGHj1mQQ94RKuOn3IxlGSFYOwMBVBec33UvdC5Z6/RmMFRmA2bL6M0iYrd9s00W8X0Hg1JOSL4qnBVGlikZ3iW1p90IiO+XJZm0KzEzg941P29KWYQnI8p+wNvDqPNInXUAuOXY83m4E4KBFkpvYgAD+0RIXtSN/TrMo7sRtl3G1243ZfMwl/wtzBjMMrQELYpQQXnyF/QD/yOpozGzPH/Xq+1F+xtNqFVl7RaIiWc/DWWYUdKyEoh0lfjefOOnlJP/fwDYejEJw7EonX2msSq6N5MnCke1KA7iL0LT25pNAOVNMYIrShRKqA7dWabpYX1K0JNDfe91iHYZjKsVt9FYgQ48068Lp7k4C9F473JpmseZ2qAMzcEcQGfNnkXBMAzV6RLQrztGhbFgCbPllI1vig+97+GRVnUiCWKIdWvplKWRY8qJxmgrKrIGl01U/3gAqAlvUwaHAnGx0UqDabpc0+2+pQzidiR0wSj2R2RwYTZ8W7pDK2n4dlFNlH8pTS/hr9xa7jAASGvKKNy5JPtsvw4xN4M2wJXC3AvxI6xfPIo3d+EjODsruBGHsHURHDtxG3dnYz0YdpyjQiPvd9jh6wwlkAj8GG/61xS4/AZzEDONfGffalhyQZ7cNO/ncGiOqkrJa/E7BcZ+v+OU3JjGkOtaJMGd/3i5iVh+NBGeAPNbDPrW2roGGjsW1C3yefgl/xJDCBNieMt9YNzlEemRSr0a4AAWfoM81gLo2qhX05EkeKCAkOYIaPxoI+lRo6+6m2Y0drwCXyYabSSkx7jYb0uHRoRVX7qxJ3BsjmeHpG/K+36CoJrBqgbxBRAsW7DHPX+t7oHdMRHyhmHxZV7aD0rg/R33pdBDZx5VQ9KHlq+7P5JQE6bt6XjojTbhUjTB7gJiYPuzrdYXEpEjq9ucQ/anrE8HXLASTOeAkfe0R0yR40dCDvC/CqU2LpcJn7pVPUFeUaEKe8c5+Crm9JR2j9in/qlY+JI2sWExo25s/cwIuMDubOn8fA8APlEKTh8EPM/IEEd9NwlOiBFFA2Y3bhPB22mv+PS/A9C+ekPpN6JW8ITEEjSZPI8y/UrRGZ7Q9zyDd8psEAThQAAYDgqFXcY0Tq3mNZMLaAu5+FvvCyrvu4vrEoH16AjHw9/MqpwGagTKu1QV+b2nG9lmMSYveTC2o4DeveconG14Ttg1Xl/XR+zJkuc9Y47mZ0/2Bpn6yTf3rtQLUatltGfxwvWJv8WjTt/sdY2DB/EDzXbP/9qV67bVbuIMCH7B1e6Vst3SDP/3s93Z2vo8y443xnSNe7WFx1K/IZyhqQbezgCbmo538WNsG76dVbczsvUb5+aDJYyu5c2wruOjXy93LqkJVLE4OOgQax8IKwrETkwPU23cr5qq7MH4KdCzwGrqt1X4mAC/oYJR0UcyKiqAPT7IpgoiDdXrzsDVBvJnvybT9GGS9AuMXCvVkB7qGOjj2PJTv0yNkKaReLu9V0U+TFZ03UfUGrEDNqfQgzaZLuMQCgXqtxDVFdtinxFT+Owqui/3xfM5+8EkBI299StLnVi5rgu5/jjAWsysPVYwbLaCgds2hvcoedJm+bQoAu+2dD5W6w78KxuAEzQdVJSNUVTZvMR1uNK2ocy2vbhVu/F8/i+lyFOhLHNwct7Chh+SGRzj/LO1T47rcQG/WWAK4/aeQI84s3Vxo0p+ADL5E8HF2FQyES1toPfjYsBHBRP5+ImpksxriSHLcXmscmp4L4STiB0imsluK0YZ9sHEEsqo3Fnrznde9QjDhmEcObu9jELT1Yxsz0F5TCNH7Uvn4xWyPA+DW5ksx0aimRkTU5gHHNQomiQQBpP3uwj6YxPIu6UVxZEFD7AxmoYNdQawrP/LeFCgliDD0b78OuvuuMO63h5urBpYUcTWVjBLZVL8dyykJzOgOERmdSnn9FxNOXpm0ACYM8tNmmWqlj9/hfgTf8+LUe9nXnJrWVlbtF+54c6CI0iX4yWNa/zoaCe+wqDj1rehxc+fKrzex/6pJ1yLwB3m++zGNGTOgUOHobpktSIRdlVtf4i3QObMd6iXTvjpIUCaS94RWvkNvGj1eikj2zrJQ5LMTFE3Z2GUn8urLXNeH0INxntWLQApKET2hRGURtFqgqMHN8iEfGKkBI1bK5Qq234g/4dN8MSIB6lyCZNiR8450JsKQgkluMqyqdV0AaNexOojAES5p855QbcGwLvyk7QzBMFKbrn1nm216+vmqMaZ5ZqygcmIP5YC4Cwv4n8ejeIRyZcWycYuR/XEgLXappjUgsRmA51t07ytwj+Es3NueTfYKsXT5h5E3MnwtV+1XHfd7FRvQ4N09Ch4obJzTbTGRlGU2muS+1vXQF4EBoZ7wt001m9781P8Jmpc004Tr9qfkd7OnA4qw5wAIQ6S3QQBayEzVZxpnYdxdOo+fuMbV1HyIx1XAVQZiCu4Nu2LIrapfeXGVQVXG7c+gvX60930CKD4eKC7LNHbVTJCKBNdVgO8mvRfajLxn0U/5q/UVdcIqqlxTwXFIltFLyjDMhZYzFl1ADn9TziBi6ipOba0wSQqXPw5K51tC/Ukio3Q+FidAXfqGhGmzExPMe6eUx90jA5KN7n0/c93bJhAG+vIZT0cttaT/0O34ffme282XUZV0OyOQ594A5/hXFdjb+SQohDH9tS/m9hl+ZRGKPrRnQ5vHqCf8o9QMT1QnSxfKdKIYvTNAGh5ccUTMKo5+rBwYSWk0MsKBkoGXQ2DjhshxxvKEIQeDBEmHWqL74LhGD2Yw6XCP+rbRM5wdtt4DEJIyt6xsme5Zeaoq/2Y74H0bKIiVVkq2P76mbwNxgYzrR5fEJjdSRPeNNiK/zM4K8lofL1t8G+xdB3qzwlcPBh4j4Sh7vLVBhWXbk7f32Zdudf/Pp4DRu8h06SY0dCJFugrJAljbHsHFkOgdUYny6gueOn+iIuIbkFbc/I2QYBU9foPXu2jVQc98wfh5nWyepJN7B5LAie35g4V0wTRFmOal0KqNoKb0PFOk3xl14igl5YEDCVw8aPn3Gd/uhy8rzUAcWi+pYyHDr7W7LGZAsltQRfDh8e/SFCeiJv1tVMQWxpi0DrmoFWjNQdqXshVEe5Ky99lW/dVpIAwb0mRfjiXvrkIE/aRue1ihbuu1UPoKUC1TXI48rGY9w/Y1JdplzWYyOcw0gyw+l9ZCOCDfrH0oL0Fcr8wzAVDv501nfvpGfKQnfCeFaQ5dtDKp5jjsXKOktFlh8H3KtCxbU/3Kt2J3vEWEDmkG08iHLbyZnfT/6/D5pHMILnPFutnvt8v0yzmklIXGyact2Igjc5/YYCG5mzRMGwcLffNrt70+yrvY6DkgMQxkhTlT1C52kgsbGw5m+4xUhQxAbeRfpXIPnt1Y+UYKadwUsW5RmaNEFtGQIoGpeKfItp2DEgpQTeuedrkJlGFohRpe28OvFlOElzSKtWUZH5nZF+N70aTRAPTx3XR1DbrPeAFJtkoRCqKQx/zgyh26VHhq2Hjypx9srDlSnvIfkynxO0E4FmhHrTZfD/gsY90dR981RSrqCT4pxW7vI/wIx36UjTCGosYvVlDwGVlv3PYeDy63kMBnEt+mfzTnXW2MrZH0HlCX2yeUVb+7MeTcPDdFyFsM5rIHeIbfdNP50XFrs46zR9WV/QADP3+VU8S/E1Z9JICcOIyb7x4tXIucB81w+pqJOhFrxq0TQOoZ7t4CKsbSeBABRYz/RKv2dQ5un4JOhmesYQqhd+e+1EFg3TjV8NROxjSDuWhMOETntzpZyJESitdBLRcjd8F3qsjudTgF9mn6n5k6jcP00PaPSVpx6USE542S+7iueewmPuJQWWMIUgXcWuBZxYhZzMiBpnLCfOVRz/6rYr2Gav9SY78u7xjoResEkIkY1z1tQb60ZGbRfNNeMYUNppX4j8gTafiz4Zh8h6kQ1+SEpwwDhxADbA4u5ENGKamWJFIIdMX4xjOHi0EiT4Fs3ZalTiyUrhuhSWTA2eacI8Y1wZKCCEFNszY2zAfppkEpkPkkXAT8To7kMoj0aqjtnLte1aZUJHDSGBT93O/jJQBSCzMTfUFsZh+SwmR9QuniCEmxKzzR2v/UFAZVrmd9XwvMaofWZ9NE13d8LtLxs0lhNrqjpW0is93ir455i7x0Mt2AvlJ8Vqwlyh7v3amaqnEib0an9z3mPper3XvdL6KCBz9KnvkDLgYvQ+d/2V3Qu7veKKWu8Tb+63BD73b8Dp/PNJjQOjKN2gjHd7awqlfwwB1c3rPNJZahUWpIT7cWFYeB10VusEFsk1Rfw8qAfdmkzfi1LUzlkdJQ0av3YADKVCTajWrQx1QfNhKj3Kxmfqah5zA8UmmJ0j+PNIDP4YFTm4m4eU7+4Jtk3G+i/Hd5VfbR8upsAwgfs4vyRt09FGr9sERzsPu0Tzoaf1Ry7hKp4589ZSrgc8pG9hWd8gUaseAPM3hjty9kfAKuYwlCotIcdp9uJ9ujlA2DNeZohYkPp8cGqfyvJsb32zfpxFGd7jy0jfI7Afm02aU+JZaLC6tFSDehbklAU8ChXK9C7qUwfGV7DwUXo9ASQwNTJ/nk81fKqixgv3ozwrZ72d3PqC0U0US4JsMlLRaqMaU2XaD1qeFTHOZH3JhfN4ygMlFAGI4D+mNr3FkTvLQq4fPNlYzXgRlOkBdy5umwhN05Alum90eGR2dzfUyqG+V+Wcr54PS4D0DKyjpi+PFB/bxm1Q14Q/ViQefi6p05Bh4pSKFx9pcwbhZZVQdnbZomSZO1FfMhoB8zi82DoKSlStmHEfyg8t0lwzNxqMwonL09TQkAAAAAAAAAAA==",alt:""})}),"\n",(0,r.jsx)(n.p,{children:"代表安装成功。"}),"\n",(0,r.jsxs)(n.h3,{id:"dockerfile-文件",children:["Dockerfile 文件",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#dockerfile-文件",children:"#"})]}),"\n",(0,r.jsx)(n.p,{children:"Dockerfile是个关键，它包含各种执行指令，Docker 能够读取 Dockerfile 的指定进行自动构建容器。"}),"\n",(0,r.jsx)(n.p,{children:"在项目根目录新建 Dockerfile，执行命令："}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"touch Dockerfile\n"})}),"\n",(0,r.jsx)(n.p,{children:"放入以下代码："}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:'FROM mhart/alpine-node:9\n\nWORKDIR /app\nCOPY . /app\n\nRUN rm -f package-lock.json \\\n    ; rm -rf .idea \\\n    ; rm -rf node_modules \\\n    ; npm config set registry "https://registry.npm.taobao.org/" \\\n    && npm install\n\nRUN npm install pm2 -g\n\nEXPOSE 3000\nCMD ["pm2-runtime", "start", "app.js", "-n", "uni-docker"]\n'})}),"\n",(0,r.jsx)(n.p,{children:"这个文件包含了以下命令："}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"FROM mhart/alpine-node:9 - 指定使用最新版本的node基础镜像"}),"\n",(0,r.jsx)(n.li,{children:"WORKDIR /app - 将容器内工作目录设置为/app"}),"\n",(0,r.jsx)(n.li,{children:"COPY . /app - 将宿主机当前目录下内容复制到镜像/app目录下"}),"\n",(0,r.jsx)(n.li,{children:"RUN rm / RUN npm install - 删除文件，设置npm源，再执行npm install安装应用所需的包"}),"\n",(0,r.jsx)(n.li,{children:"EXPOSE 3000 - 对外开放容器的3000端口"}),"\n",(0,r.jsx)(n.li,{children:'CMD ["pm2-runtime", "start", "app.js", "-n", "uni-docker"] - 在容器启动时，执行的命令，通过 pm2 来统一管理应用'}),"\n"]}),"\n",(0,r.jsxs)(n.h3,{id:"构建镜像",children:["构建镜像",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#构建镜像",children:"#"})]}),"\n",(0,r.jsxs)(n.p,{children:["编写完 Dockerfile 文件后，就可以通过 ",(0,r.jsx)(n.code,{children:"docker build"})," 命令来构建镜像："]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo docker build -t uni-back .\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:l,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"等待构建成功，执行命令查看："}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"docker images\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:d,alt:""})}),"\n",(0,r.jsxs)(n.h3,{id:"运行容器",children:["运行容器",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#运行容器",children:"#"})]}),"\n",(0,r.jsxs)(n.p,{children:["镜像构建完成后，就可以通过 ",(0,r.jsx)(n.code,{children:"docker run"})," 运行容器，从而实现应用的 docker 化部暑。"]}),"\n",(0,r.jsx)(n.p,{children:"执行命令："}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo docker run -d --name uni-back -p 3000:3000 uni-back\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:c,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"代表启动成功，通过你的域名+/api/ 访问。"}),"\n",(0,r.jsxs)(n.h3,{id:"查看状态",children:["查看状态",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#查看状态",children:"#"})]}),"\n",(0,r.jsxs)(n.p,{children:["记得上面说得 ",(0,r.jsx)(n.code,{children:"pm2 list"})," 来查看应用信息，在 docker 里查看命令需换成 ",(0,r.jsx)(n.code,{children:"docker exec"}),"："]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:" docker container ls -a  #查看容器信息，例如 CONTAINER ID\n docker exec -it CONTAINER ID pm2 list\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:a,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"uni-docker 运行一切良好，部署完成。"}),"\n",(0,r.jsxs)(n.h2,{id:"serverless",children:["Serverless",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#serverless",children:"#"})]}),"\n",(0,r.jsx)(n.p,{children:"目前市面流行有另一种方案 —— Serverless，我在之前项目中分别使用过 Leancloud，小程序云开发和知晓云，重点在于编写云函数，提交部署，前端结合相关的 SDK 调用各自线上的服务，以操作后台的增删改查，对于简单的项目是非常便利的，可以做到快速集成上线，对于不熟悉后端的同学省去了搭建后端服务的时间。"}),"\n",(0,r.jsxs)(n.p,{children:["最新版 HBuilderX 已经支持云开发，详细点击 ",(0,r.jsx)(n.a,{href:"https://uniapp.dcloud.io/uniCloud/README",target:"_blank",rel:"noopener noreferrer",children:"uniCloud"})," 了解，后续我会尝试加入相关代码。"]}),"\n",(0,r.jsxs)(n.h2,{id:"小结",children:["小结",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#小结",children:"#"})]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"本章通过注册开通腾讯云，安装Shell软件，搭建云服务，编写 nginx，配置 https，基于 NeteaseCloudMusicApi 部署项目接口。如果你跟着一步步操作，会发现当前的云服务部署相比以前的购买空间（服务器）部署，那是相当简易了。"}),"\n",(0,r.jsxs)(n.li,{children:["本章代码 ",(0,r.jsx)(n.a,{href:"https://github.com/front-end-class/uniapp-music-back-code",target:"_blank",rel:"noopener noreferrer",children:"uniapp-music-back-code"}),"。"]}),"\n"]})]})}function A(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,i.ah)(),e.components);return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(w,{...e})}):w(e)}let N=A;A.__RSPRESS_PAGE_META={},A.__RSPRESS_PAGE_META["Uniapp%20%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E8%BF%9B%E9%98%B6%2F26%20%E5%AE%9E%E6%88%9816%EF%BC%9A%E5%9F%BA%E4%BA%8ENeteaseCloudMusicApi%E6%8E%A5%E5%8F%A3%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91%E5%92%8C%E9%83%A8%E7%BD%B2.md"]={toc:[{text:"NeteaseCloudMusicApi项目",id:"neteasecloudmusicapi项目",depth:2},{text:"在线文档",id:"在线文档",depth:3},{text:"安装",id:"安装",depth:3},{text:"运行",id:"运行",depth:3},{text:"接口二次开发",id:"接口二次开发",depth:3},{text:"注册腾讯云和安装软件",id:"注册腾讯云和安装软件",depth:2},{text:"部署项目至腾讯云",id:"部署项目至腾讯云",depth:2},{text:"安装Shell软件",id:"安装shell软件",depth:2},{text:"配置Https",id:"配置https",depth:2},{text:"通过 Docker 部署",id:"通过-docker-部署",depth:2},{text:"安装 Docker",id:"安装-docker",depth:3},{text:"Dockerfile 文件",id:"dockerfile-文件",depth:3},{text:"构建镜像",id:"构建镜像",depth:3},{text:"运行容器",id:"运行容器",depth:3},{text:"查看状态",id:"查看状态",depth:3},{text:"Serverless",id:"serverless",depth:2},{text:"小结",id:"小结",depth:2}],title:"26 实战16：基于NeteaseCloudMusicApi接口二次开发和部署",headingTitle:"26 实战16：基于NeteaseCloudMusicApi接口二次开发和部署",frontmatter:{}}}}]);