"use strict";(self.webpackChunkjue_jin_book_press=self.webpackChunkjue_jin_book_press||[]).push([["67743"],{336512:function(e,s,n){n.r(s),n.d(s,{default:()=>w});var c=n(552676),d=n(740453);let r=n.p+"static/image/5ed59bfb51713449aac17be75a9c5874.8ccee1fd.webp",i=n.p+"static/image/214a0bb13d649f4fc25a4b3498e8e3da.57f62eff.webp",l=n.p+"static/image/48c17af337b745351e49beb5a6226d31.b9927f4b.webp",h=n.p+"static/image/fcc4ea5becee6b4b7f0dde940ae36955.e372a6fa.webp",j=n.p+"static/image/49c7cc8169740d7f85f3c7468f9597c2.e3218546.webp",x=n.p+"static/image/87dd97613d12d8161edaab800fd610ca.09adcec7.webp",a=n.p+"static/image/aa0b0e1e7891d792ceb9f7752c822783.f352fc8f.webp",o=n.p+"static/image/a38d76ce33ca560b42499662bbb91311.d1357060.webp",t=n.p+"static/image/0bf31a1852731c1d3199db2c0320e306.77e29b12.webp",p=n.p+"static/image/63ba4c09f6b6a5b732e668d4ffcd426d.8120792a.webp",m=n.p+"static/image/6d26b3574aca0d9b05772a75be152199.2482b8eb.webp",u=n.p+"static/image/f3c5a1384f31559a96c71581ec61ff6a.8caab9f2.webp",g=n.p+"static/image/38bb6ae323de72c0d53872c385ffc132.b8fbcf26.webp",b=n.p+"static/image/3c8633964aca18ed945ae330a397593b.bfe7fcce.webp",f=n.p+"static/image/5a05b96125f0c18567a8405e40bb3a52.c14e813c.webp",y=n.p+"static/image/c6a2f285857a9bfc868acbb47d3481a8.eedfe40e.webp";function A(e){let s=Object.assign({h1:"h1",a:"a",h2:"h2",p:"p",code:"code",h4:"h4",ul:"ul",li:"li",blockquote:"blockquote",img:"img",strong:"strong",pre:"pre"},(0,d.ah)(),e.components);return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)(s.h1,{id:"21项目部署上线",children:["21.项目部署上线",(0,c.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#21项目部署上线",children:"#"})]}),"\n",(0,c.jsxs)(s.h2,{id:"前言",children:["前言",(0,c.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#前言",children:"#"})]}),"\n",(0,c.jsxs)(s.p,{children:["为了能让用户通过线上地址预览项目，我们需要将本次编写的前后端项目部署到服务器上。本章节为大家带来部署 ",(0,c.jsx)(s.code,{children:"Node"})," 服务端项目和前端项目。"]}),"\n",(0,c.jsxs)(s.h4,{id:"知识点",children:["知识点",(0,c.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#知识点",children:"#"})]}),"\n",(0,c.jsxs)(s.ul,{children:["\n",(0,c.jsx)(s.li,{children:"CentOS 服务器"}),"\n",(0,c.jsx)(s.li,{children:"配置 ssh"}),"\n",(0,c.jsx)(s.li,{children:"MySQL 服务器端安装"}),"\n",(0,c.jsx)(s.li,{children:"egg 服务端部署"}),"\n",(0,c.jsx)(s.li,{children:"pm2 进程守护"}),"\n"]}),"\n",(0,c.jsxs)(s.p,{children:["代码都已经推到 ",(0,c.jsx)(s.code,{children:"Github"})," 仓库，地址如下所示："]}),"\n",(0,c.jsxs)(s.blockquote,{children:["\n",(0,c.jsxs)(s.p,{children:["记账本服务端代码仓库地址：",(0,c.jsx)(s.a,{href:"https://github.com/Nick930826/jue-diary-server",target:"_blank",rel:"noopener noreferrer",children:"https://github.com/Nick930826/jue-diary-server"})]}),"\n"]}),"\n",(0,c.jsxs)(s.blockquote,{children:["\n",(0,c.jsxs)(s.p,{children:["记账本前端代码仓库地址：",(0,c.jsx)(s.a,{href:"https://github.com/Nick930826/juejue-vite-h5",target:"_blank",rel:"noopener noreferrer",children:"https://github.com/Nick930826/juejue-vite-h5"})]}),"\n"]}),"\n",(0,c.jsxs)(s.h2,{id:"正文",children:["正文",(0,c.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#正文",children:"#"})]}),"\n",(0,c.jsxs)(s.h4,{id:"购买服务器",children:["购买服务器",(0,c.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#购买服务器",children:"#"})]}),"\n",(0,c.jsx)(s.p,{children:"我们先从服务器的购买谈起，如果已经购买服务器的同学，可以省略这一步的。"}),"\n",(0,c.jsxs)(s.p,{children:["为什么要购买服务器呢，当你本地开发好项目的时候，你只能跑在你的本机电脑上，所以此时你只能独自欣赏自己的项目。别人无法通过访问你的 IP 地址，去浏览你跑在本地的项目。而服务器的能力，就是可以让你把项目跑在服务器上，让用户通过访问你的服务器抛出的",(0,c.jsx)(s.code,{children:"IP"})," + ",(0,c.jsx)(s.code,{children:"端口号"}),"，去浏览你的网页或者使用你抛出的接口。"]}),"\n",(0,c.jsx)(s.p,{children:"服务器的品类也有很多，阿里云、腾讯云、华为云、七牛云等等，都有提供云服务器的功能，这里我选择的是阿里云服务器，同学们可以自行选择。我选择阿里云的原因很简单，它的用户较多，遇到问题的话，网上会有比较多的解决方案，少走弯路。"}),"\n",(0,c.jsx)(s.p,{children:"购买服务器有两种选择，第一种是「包年包月」，有条件的同学可以选择包年，既然接触了全栈开发，或多或少都需要跟服务器打交道；第二种则是「按量收费」，按量收费的特点是可以根据自己的需要，开启或关闭服务器。"}),"\n",(0,c.jsxs)(s.p,{children:["购买时，注意一点，一定要选择 ",(0,c.jsx)(s.code,{children:"CentOS"})," 的镜像，版本尽量选择最高版本。因为它是基于 ",(0,c.jsx)(s.code,{children:"unix"}),"，对开发比较友好。"]}),"\n",(0,c.jsx)(s.p,{children:"这是我购买的配置，如下所示："}),"\n",(0,c.jsx)(s.p,{children:(0,c.jsx)("img",{src:"data:image/webp;base64,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",alt:""})}),"\n",(0,c.jsxs)(s.p,{children:["用于平时部署简单项目，这样的配置基本上是满足的。但是如果你要运行一些比较大型的项目，并且有多个的话，",(0,c.jsx)(s.code,{children:"2G"})," 的内存是不够的，因为考虑到项目会在服务器端进行打包，会占用不少内存，有可能会因为服务器的内存不足，而导致打包失败，到时候再升级内存的话，就会比较费钱。"]}),"\n",(0,c.jsxs)(s.h4,{id:"ssh-配置",children:["ssh 配置",(0,c.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#ssh-配置",children:"#"})]}),"\n",(0,c.jsx)(s.p,{children:"购买服务器之后，首先要做的就是登录服务器，市面上不乏可视化的服务器造作软件，但我的建议是指令操作才是一个程序员应该具备的能力。"}),"\n",(0,c.jsxs)(s.p,{children:["在此之前，我们先在本地配置好 ",(0,c.jsx)(s.code,{children:"ssh"}),"。"]}),"\n",(0,c.jsx)(s.p,{children:(0,c.jsx)(s.strong,{children:"什么是 ssh"})}),"\n",(0,c.jsx)(s.p,{children:"百度百科给出的定义："}),"\n",(0,c.jsxs)(s.blockquote,{children:["\n",(0,c.jsx)(s.p,{children:"SSH 为 Secure Shell 的缩写，由 IETF 的网络小组（Network Working Group）所制定；SSH 为建立在应用层基础上的安全协议。SSH 是较可靠，专为远程登录会话和其他网络服务提供安全性的协议。利用 SSH 协议可以有效防止远程管理过程中的信息泄露问题。SSH最初是UNIX系统上的一个程序，后来又迅速扩展到其他操作平台。SSH在正确使用时可弥补网络中的漏洞。SSH客户端适用于多种平台。几乎所有UNIX平台—包括HP-UX、Linux、AIX、Solaris、Digital UNIX、Irix，以及其他平台，都可运行SSH。"}),"\n"]}),"\n",(0,c.jsx)(s.p,{children:"我用一句话概括它："}),"\n",(0,c.jsxs)(s.blockquote,{children:["\n",(0,c.jsx)(s.p,{children:"SSH是一种网络协议，用于计算机之间的加密登录。"}),"\n"]}),"\n",(0,c.jsxs)(s.p,{children:["服务器也是一台计算机，只不过它是远端的计算机，大家买的阿里云、腾讯云等服务器，相当于一台常年开启状态的计算机，可以通过 ",(0,c.jsx)(s.code,{children:"dos"})," 界面进行操作，也可以通过市面上的服务器可视化工具进行管理。"]}),"\n",(0,c.jsx)(s.p,{children:(0,c.jsx)(s.strong,{children:"本地安装 ssh，实现免密登录"})}),"\n",(0,c.jsx)(s.p,{children:"如果已经安装过，忽略这部分的内容，没有安装的请继续往下看。"}),"\n",(0,c.jsxs)(s.p,{children:["如果开发机器是 ",(0,c.jsx)(s.code,{children:"Windows"})," 系统，可以先在本地安装好 ",(0,c.jsx)(s.code,{children:"git"}),"，然后通过命令行来到项目的 ",(0,c.jsx)(s.code,{children:"~"})," 路径下，运行如下指令生成 ssh key："]}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-bash",children:'ssh-keygen -t rsa -C "xxxxx@xxxxx.com"\n'})}),"\n",(0,c.jsxs)(s.p,{children:["上述邮箱地址写邮箱地址，这里不一定要写邮箱，只是为了方便找到生成的 ",(0,c.jsx)(s.code,{children:"ssh key"})," 是谁的。"]}),"\n",(0,c.jsxs)(s.p,{children:["执行完成后，前往 ",(0,c.jsx)(s.code,{children:"~/.ssh"})," 路径下，查看是否生成好的相应的公钥。笔者的公钥如下所示："]}),"\n",(0,c.jsx)(s.p,{children:(0,c.jsx)("img",{src:y,alt:""})}),"\n",(0,c.jsxs)(s.p,{children:[(0,c.jsx)(s.code,{children:"id_rsa.pub"})," 文件里面的内容，就是需要的公钥内容。"]}),"\n",(0,c.jsxs)(s.p,{children:["拿到本机的公钥之后，进入阿里云服务器，同样先看看服务器是否有设置好公钥，打开 ",(0,c.jsx)(s.code,{children:"~/.ssh"})," 查看。如果是刚买的服务器，建议先全局安装好 ",(0,c.jsx)(s.code,{children:"git"}),"，然后再去查看 ",(0,c.jsx)(s.code,{children:"~/.ssh"}),"，正常情况下是如下所示："]}),"\n",(0,c.jsx)(s.p,{children:(0,c.jsx)("img",{src:f,alt:""})}),"\n",(0,c.jsxs)(s.blockquote,{children:["\n",(0,c.jsx)(s.p,{children:"如果没有内容，建议按照本地配置 ssh key 的方法，在服务器端再做一次配置。"}),"\n"]}),"\n",(0,c.jsxs)(s.p,{children:["上图所示的 ",(0,c.jsx)(s.code,{children:"authorized_keys"})," 文件，便是设置免密登录的配置文件。只需将你本地电脑的 ",(0,c.jsx)(s.code,{children:"id_rsa.pub"})," 公钥内容，拷贝到 ",(0,c.jsx)(s.code,{children:"authorized_keys"})," 中并保存，那么你便可以在本地远程免密登录服务器，如下所示："]}),"\n",(0,c.jsx)(s.p,{children:(0,c.jsx)("img",{src:b,alt:""})}),"\n",(0,c.jsxs)(s.p,{children:["如果没有配置好 ",(0,c.jsx)(s.code,{children:"authorized_keys"}),"，那么你每次做上述操作的时候，都会提示你输入服务器的登录密码。这样就会阻碍我们后续通过 ",(0,c.jsx)(s.code,{children:"pm2"})," 远程自动化登录服务器。"]}),"\n",(0,c.jsxs)(s.p,{children:["既然已经配置好了服务器的 ",(0,c.jsx)(s.code,{children:"ssh"}),"，我们将服务器的公钥 ",(0,c.jsx)(s.code,{children:"id_rsa.pub"}),"，拷贝到我们存放代码仓库的权限配置里，这一步的目的是让服务器可以通过 ",(0,c.jsx)(s.code,{children:"ssh"})," 的方式拉取代码仓库内的最新代码，配置如下："]}),"\n",(0,c.jsx)(s.p,{children:(0,c.jsx)("img",{src:g,alt:""})}),"\n",(0,c.jsxs)(s.p,{children:["笔者将代码放到了 ",(0,c.jsx)(s.code,{children:"Github"})," 仓库，上图为 ",(0,c.jsx)(s.code,{children:"Github"})," 的 ",(0,c.jsx)(s.code,{children:"Setting"})," 界面，点击 ",(0,c.jsx)(s.code,{children:"SSH and GPG keys"}),"，新建一个 ",(0,c.jsx)(s.code,{children:"SSH key"}),"，将服务器的公钥粘贴进去，完成之后，你便可以在服务器通过 ",(0,c.jsx)(s.code,{children:"ssh"})," 的方式拉取代码。"]}),"\n",(0,c.jsx)(s.p,{children:"以上操作是对本地计算机和云端服务器的一些基础配置，目的是为后面的操作打下基础。"}),"\n",(0,c.jsxs)(s.h4,{id:"mysql-服务器端安装",children:["MySQL 服务器端安装",(0,c.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#mysql-服务器端安装",children:"#"})]}),"\n",(0,c.jsxs)(s.p,{children:["第三章笔者讲述了 ",(0,c.jsx)(s.code,{children:"MySQL"})," 在本地的安装，因为那时我们开发也是在本地，所以配置一个本地数据库足矣。而此时，我们需要将服务端的项目上线，",(0,c.jsx)(s.code,{children:"Egg"})," 开发的项目就不能再连接本地数据库，当然，线上服务代码也连接不上我们本地的数据库。"]}),"\n",(0,c.jsx)(s.p,{children:(0,c.jsx)(s.strong,{children:"第一步"})}),"\n",(0,c.jsxs)(s.p,{children:["远程登录服务器之后运行以下命令更新 ",(0,c.jsx)(s.code,{children:"yum"})," 源："]}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-bash",children:"rpm -Uvh  http://dev.mysql.com/get/mysql57-community-release-el7-9.noarch.rpm\n"})}),"\n",(0,c.jsxs)(s.blockquote,{children:["\n",(0,c.jsxs)(s.p,{children:["这里我们使用的 ",(0,c.jsx)(s.code,{children:"MySQL"})," 版本是 5.7.28。"]}),"\n"]}),"\n",(0,c.jsxs)(s.p,{children:["安装 ",(0,c.jsx)(s.code,{children:"MySQL"}),"，注意这里安装稳定社群版："]}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-bash",children:"yum install mysql-community-server\n"})}),"\n",(0,c.jsx)(s.p,{children:"全部安装完成之后，可以通过以下命令查看是否安装成功："}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-bash",children:"[root@iZbp15axph2ymmv3k3i5oxZ ~]# mysql --version\nmysql  Ver 14.14 Distrib 5.7.28, for Linux (x86_64) using  EditLine wrapper\n"})}),"\n",(0,c.jsx)(s.p,{children:(0,c.jsx)(s.strong,{children:"第二步"})}),"\n",(0,c.jsxs)(s.p,{children:["此时需要配置一下安装好后的 ",(0,c.jsx)(s.code,{children:"MySQL"}),"。执行如下命令启动它："]}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-bash",children:"systemctl start mysqld\n"})}),"\n",(0,c.jsx)(s.p,{children:"设置开机自动启动："}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-bash",children:"systemctl enable mysqld\n"})}),"\n",(0,c.jsx)(s.p,{children:"如果遇到一些问题，需要重启数据库的话，执行以下指令："}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-bash",children:"systemctl restart mysqld\n"})}),"\n",(0,c.jsxs)(s.p,{children:["网上说通过以下命令可以看到初始化密码，因为为了安全考虑，5.7 以后的 ",(0,c.jsx)(s.code,{children:"MySQL"})," 版本，都会有一个默认的初始密码，可以通过下列指令来获取："]}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-bash",children:"grep 'temporary password' /var/log/mysqld.log\n"})}),"\n",(0,c.jsxs)(s.p,{children:["如果你通过这条命令行能获取到初始密码，那基本上你就可以进入 ",(0,c.jsx)(s.code,{children:"MySQL"})," 数据库，重制你的密码了。但是我碰到的情况是，",(0,c.jsx)(s.code,{children:"mysqld.log"})," 文件为空，没有内容。"]}),"\n",(0,c.jsxs)(s.p,{children:["于是经过翻阅资料，查到可以设置一些配置，跳过输入密码然后进入 ",(0,c.jsx)(s.code,{children:"MySQL"})," 数据库。操作如下："]}),"\n",(0,c.jsxs)(s.p,{children:["1、修改 ",(0,c.jsx)(s.code,{children:"MySQL"})," 的配置文件（默认为/etc/my.cnf）,在",(0,c.jsx)(s.code,{children:"[mysqld]"}),"下添加一行",(0,c.jsx)(s.code,{children:"skip-grant-tables"}),"，如下："]}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-bash",children:"[mysqld]\nskip-grant-tables\n"})}),"\n",(0,c.jsxs)(s.p,{children:["2、保存配置文件后，重启 ",(0,c.jsx)(s.code,{children:"MySQL"})," 服务 ",(0,c.jsx)(s.code,{children:"systemctl restart mysqld"}),"。"]}),"\n",(0,c.jsxs)(s.p,{children:["3、执行 ",(0,c.jsx)(s.code,{children:"mysql -u root -p"})," 登录 ",(0,c.jsx)(s.code,{children:"MySQL"}),"，然后不输入密码直接回车。"]}),"\n",(0,c.jsx)(s.p,{children:"4、登录之后，修改密码，操作如下："}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-bash",children:"update mysql.user set authentication_string=password('123456') where user='root'\n"})}),"\n",(0,c.jsxs)(s.p,{children:["5、记得去阿里云服务 ",(0,c.jsx)(s.code,{children:"ESC"})," 实例的安全组里把 ",(0,c.jsx)(s.code,{children:"3306"})," 端口开启，因为 ",(0,c.jsx)(s.code,{children:"MySQL"})," 启动之后，默认是跑在 ",(0,c.jsx)(s.code,{children:"3306"})," 端口上的。"]}),"\n",(0,c.jsx)(s.p,{children:(0,c.jsx)("img",{src:"data:image/webp;base64,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",alt:""})}),"\n",(0,c.jsxs)(s.p,{children:["上述一系列操作的目的，就是将 ",(0,c.jsx)(s.code,{children:"MySQL"})," 在服务器内成功安装，并且启动。这样我们便可以通过 ",(0,c.jsx)(s.code,{children:"ip+端口"})," 的形式，在本地通过 ",(0,c.jsx)(s.code,{children:"DBeaver"})," 远程连接服务器端的数据库，下面是连接操作："]}),"\n",(0,c.jsx)(s.p,{children:(0,c.jsx)("img",{src:u,alt:""})}),"\n",(0,c.jsxs)(s.ul,{children:["\n",(0,c.jsxs)(s.li,{children:["\n",(0,c.jsxs)(s.p,{children:["服务器地址：笔者的地址是 ",(0,c.jsx)(s.code,{children:"47.99.134.126"}),"，这里可以填写你们自己的地址。"]}),"\n"]}),"\n",(0,c.jsxs)(s.li,{children:["\n",(0,c.jsxs)(s.p,{children:["端口：默认是 ",(0,c.jsx)(s.code,{children:"3306"}),"。"]}),"\n"]}),"\n",(0,c.jsxs)(s.li,{children:["\n",(0,c.jsxs)(s.p,{children:["用户名：默认是 ",(0,c.jsx)(s.code,{children:"root"}),"。"]}),"\n"]}),"\n",(0,c.jsxs)(s.li,{children:["\n",(0,c.jsxs)(s.p,{children:["密码：这里的密码就是上述我们安装 ",(0,c.jsx)(s.code,{children:"MySQL"})," 时，自己设置的密码。"]}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(s.p,{children:["填写完之后，点击底部的确认按钮，便可连接到服务器的 ",(0,c.jsx)(s.code,{children:"MySQL"}),"，如下所示："]}),"\n",(0,c.jsx)(s.p,{children:(0,c.jsx)("img",{src:m,alt:""})}),"\n",(0,c.jsxs)(s.p,{children:["上图所示，笔者已经在服务器端建好了 ",(0,c.jsx)(s.code,{children:"jue-cost"})," 表，",(0,c.jsx)(s.code,{children:"ER图"})," 如上所示。"]}),"\n",(0,c.jsxs)(s.p,{children:["这里提供给大家一个 ",(0,c.jsx)(s.code,{children:"SQL"})," 文件，可以直接在数据库导入 ",(0,c.jsx)(s.code,{children:"SQL"})," 文件，直接创建好需要的表结构。"]}),"\n",(0,c.jsxs)(s.blockquote,{children:["\n",(0,c.jsxs)(s.p,{children:["SQL文件下载：",(0,c.jsx)(s.a,{href:"https://s.yezgea02.com/1625642433217/jue-cost.sql",target:"_blank",rel:"noopener noreferrer",children:"jue-cost"}),"。"]}),"\n"]}),"\n",(0,c.jsx)(s.p,{children:"新建好一个数据库之后，右键选择导入上述文件即可。当然，你也可以手动新建一个数据库，并在数据库内创建这三张表，可以参照第五章讲述的内容。"}),"\n",(0,c.jsxs)(s.h4,{id:"部署服务端代码",children:["部署服务端代码",(0,c.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#部署服务端代码",children:"#"})]}),"\n",(0,c.jsxs)(s.p,{children:["接下来我们要做两件事情，第一步先将本地的服务端代码上传到代码仓库，",(0,c.jsx)(s.code,{children:"Github"})," 和 ",(0,c.jsx)(s.code,{children:"Gitee"})," 都可以，只要是一个线上管理的代码仓库便可。这样做的目的是便于后续的代码更新，可以在服务器及时地拉取到最新的代码。"]}),"\n",(0,c.jsxs)(s.p,{children:["笔者已经将服务端代码上传到了 ",(0,c.jsx)(s.code,{children:"Github"}),"，地址如下："]}),"\n",(0,c.jsxs)(s.blockquote,{children:["\n",(0,c.jsx)(s.p,{children:(0,c.jsx)(s.a,{href:"https://github.com/Nick930826/jue-diary-server",target:"_blank",rel:"noopener noreferrer",children:"https://github.com/Nick930826/jue-diary-server"})}),"\n"]}),"\n",(0,c.jsxs)(s.p,{children:["这里要注意的是，在 ",(0,c.jsx)(s.code,{children:"/config/config.default.js"})," 文件中，你需要修改你自己的数据库名和密码，如下："]}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-js",children:"exports.mysql = {\n  // 单数据库信息配置\n  client: {\n    // host\n    host: 'localhost',\n    // 端口号\n    port: '',\n    // 用户名\n    user: 'root',\n    // 密码\n    password: '你自己的数据库密码',\n    // 数据库名\n    database: '你自己新建的数据库名称',\n  },\n  // 是否加载到 app 上，默认开启\n  app: true,\n  // 是否加载到 agent 上，默认关闭\n  agent: false,\n};\n"})}),"\n",(0,c.jsx)(s.p,{children:"我们前往服务器拉取最新的服务端代码，如下所示："}),"\n",(0,c.jsx)(s.p,{children:(0,c.jsx)("img",{src:p,alt:""})}),"\n",(0,c.jsx)(s.p,{children:"拉取完成之后，查看文件夹，会多处这么一个项目："}),"\n",(0,c.jsx)(s.p,{children:(0,c.jsx)("img",{src:t,alt:""})}),"\n",(0,c.jsxs)(s.p,{children:["进入项目，安装 ",(0,c.jsx)(s.code,{children:"node_modules"})," 包，如下所示："]}),"\n",(0,c.jsx)(s.p,{children:(0,c.jsx)("img",{src:o,alt:""})}),"\n",(0,c.jsxs)(s.p,{children:["安装完成之后，执行 ",(0,c.jsx)(s.code,{children:"npm run start"}),"，服务端项目就启动完成了，不用担心它会挂掉，",(0,c.jsx)(s.code,{children:"Egg"})," 自带进程守护功能。"]}),"\n",(0,c.jsx)(s.p,{children:"于是乎，项目就被运行在这样一个地址上："}),"\n",(0,c.jsxs)(s.blockquote,{children:["\n",(0,c.jsx)(s.p,{children:(0,c.jsx)(s.a,{href:"http://47.99.134.126:7009",target:"_blank",rel:"noopener noreferrer",children:"http://47.99.134.126:7009"})}),"\n"]}),"\n",(0,c.jsx)(s.p,{children:"我们不妨测试以下获取用户信息接口是否能连通，如下所示："}),"\n",(0,c.jsx)(s.p,{children:(0,c.jsx)("img",{src:a,alt:""})}),"\n",(0,c.jsxs)(s.p,{children:["目前我们尚未登录，请求时没有携带 ",(0,c.jsx)(s.code,{children:"token"}),"，所以此接口返回了 ",(0,c.jsx)(s.code,{children:"token"})," 不存在的错误信息。"]}),"\n",(0,c.jsx)(s.p,{children:"这就表明，服务端部署已经成功，你可以通过该接口地址去访问相应的接口，来制作前端页面。"}),"\n",(0,c.jsxs)(s.h4,{id:"前端-pm2-部署",children:["前端 pm2 部署",(0,c.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#前端-pm2-部署",children:"#"})]}),"\n",(0,c.jsx)(s.p,{children:"服务端项目部署完之后，我们继续部署前端项目。先来描述一下前端项目从打包到部署到服务器上的整个过程。"}),"\n",(0,c.jsxs)(s.p,{children:["1、首先我们需要运行 ",(0,c.jsx)(s.code,{children:"npm run build"})," 对项目进行打包操作，打完包后，在根目录会出现一个 ",(0,c.jsx)(s.code,{children:"dist"})," 目录，如下所示："]}),"\n",(0,c.jsx)(s.p,{children:(0,c.jsx)("img",{src:x,alt:""})}),"\n",(0,c.jsx)(s.p,{children:"如上图所示："}),"\n",(0,c.jsxs)(s.ul,{children:["\n",(0,c.jsxs)(s.li,{children:["\n",(0,c.jsx)(s.p,{children:"assets：存放打包后的静态资源，如 js、css、图片等。"}),"\n"]}),"\n",(0,c.jsxs)(s.li,{children:["\n",(0,c.jsx)(s.p,{children:"index.html：项目入口页面，就是整个项目需要通过这个页面初始化，内部也看到了引入了 index.xxx.js，这是整个项目的 js 脚本。"}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(s.p,{children:["现在需要想方设法让 ",(0,c.jsx)(s.code,{children:"index.html"})," 跑在服务器上的某个端口。"]}),"\n",(0,c.jsx)(s.p,{children:"这里，为大家推荐一个比较好用的一个插件，通过命令行安装它："}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-bash",children:"npm i pushstate-server\n"})}),"\n",(0,c.jsxs)(s.p,{children:[(0,c.jsx)(s.code,{children:"pushstate-server "}),"为什么提供了很便捷的启动 ",(0,c.jsx)(s.code,{children:"web"})," 服务的配置，内部的原理是通过 ",(0,c.jsx)(s.code,{children:"connect"})," 服务器，开启一个端口，将 ",(0,c.jsx)(s.code,{children:"dist/index.html"})," 文件作为静态模板输出。"]}),"\n",(0,c.jsxs)(s.p,{children:["安装好之后，在 ",(0,c.jsx)(s.code,{children:"H5"})," 项目的根目录添加 ",(0,c.jsx)(s.code,{children:"juejue-vite-h5-server"})," 文件，内容如下："]}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-js",children:"const server = require('pushstate-server')\n\nserver.start({\n  port: 5021,\n  directory: './dist'\n})\n"})}),"\n",(0,c.jsxs)(s.ul,{children:["\n",(0,c.jsxs)(s.li,{children:["\n",(0,c.jsx)(s.p,{children:"port：需要启动的端口号。"}),"\n"]}),"\n",(0,c.jsxs)(s.li,{children:["\n",(0,c.jsxs)(s.p,{children:["directory：",(0,c.jsx)(s.code,{children:"index.html"})," 所在的目录路径，这里直接写相对路径就好。"]}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(s.p,{children:["配置好上述内容之后，就需要引入 ",(0,c.jsx)(s.code,{children:"pm2"})," 的概念，它是一个进程管理工具，对于前端而言最重要的功能便是进程守护，通过它启动的 ",(0,c.jsx)(s.code,{children:"node"})," 服务，服务挂了会自动拉起项目。"]}),"\n",(0,c.jsxs)(s.p,{children:["在 ",(0,c.jsx)(s.code,{children:"H5"})," 项目根目录新增 ",(0,c.jsx)(s.code,{children:"ecosystem.config.js"}),"，在项目本地执行 ",(0,c.jsx)(s.code,{children:"pm2 "}),"的时候，会匹配的项目根目录下的 ",(0,c.jsx)(s.code,{children:"ecosystem.config.js"})," 文件，并且执行它的配置。配置如下："]}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-js",children:"module.exports = {\n  apps: [\n    {\n      name: 'juejue-vite-h5',\n      script: 'juejue-vite-h5-server.js'\n    },\n  ],\n  deploy: {\n    production: {\n      user: 'root',\n      host: '47.99.134.126',\n      ref: 'origin/master',\n      repo: 'git@git.zhlh6.cn:Nick930826/juejue-vite-h5.git',\n      path: '/workspace/juejue-vite-h5',\n      'post-deploy': 'git reset --hard && git checkout master && git pull && npm i --production=false && npm run build:release && pm2 startOrReload ecosystem.config.js', // -production=false 下载全量包\n      env: {\n        NODE_ENV: 'production'\n      }\n    }\n  }\n}\n"})}),"\n",(0,c.jsxs)(s.ul,{children:["\n",(0,c.jsxs)(s.li,{children:["\n",(0,c.jsxs)(s.p,{children:["apps：",(0,c.jsx)(s.code,{children:"script"})," 为服务器通过 ",(0,c.jsx)(s.code,{children:"pm2"})," 要执行的脚本，",(0,c.jsx)(s.code,{children:"name"})," 为脚本在 ",(0,c.jsx)(s.code,{children:"pm2"})," 列表中的名称，这个名称要注意，避免后续其他项目重名，在服务器中你会无法区分是哪个项目。"]}),"\n"]}),"\n",(0,c.jsxs)(s.li,{children:["\n",(0,c.jsxs)(s.p,{children:["deploy：",(0,c.jsx)(s.code,{children:"production"})," 为部署正式环境的配置，这里我就不配置 ",(0,c.jsx)(s.code,{children:"beta"})," 环境的代码，因为目前就只有一台服务器。"]}),"\n"]}),"\n",(0,c.jsxs)(s.li,{children:["\n",(0,c.jsx)(s.p,{children:"production.user：默认 root 用户。"}),"\n"]}),"\n",(0,c.jsxs)(s.li,{children:["\n",(0,c.jsxs)(s.p,{children:["production.host：要部署的服务器 ",(0,c.jsx)(s.code,{children:"IP"})," 地址。"]}),"\n"]}),"\n",(0,c.jsxs)(s.li,{children:["\n",(0,c.jsxs)(s.p,{children:["production.ref：要部署的代码，在代码仓库中的哪个分之，如果是测试环境，那么这里应该就是 ",(0,c.jsx)(s.code,{children:"origin/develop"}),"，这里我们默认是正式。"]}),"\n"]}),"\n",(0,c.jsxs)(s.li,{children:["\n",(0,c.jsx)(s.p,{children:"production.repo：代码存放的地址，这里是我的地址，你可以写你自己的代码仓库地址。"}),"\n"]}),"\n",(0,c.jsxs)(s.li,{children:["\n",(0,c.jsxs)(s.p,{children:["production.path：在服务器拉取远程仓库地址之后，存放在服务器中的地址，这里我习惯存放在 ",(0,c.jsx)(s.code,{children:"workspace"})," 文件夹内，同学们可以根据自己的习惯进行操作。"]}),"\n"]}),"\n",(0,c.jsxs)(s.li,{children:["\n",(0,c.jsxs)(s.p,{children:["production.post-deploy：需要执行的一些指令，如 ",(0,c.jsx)(s.code,{children:"git reset"})," 重制、",(0,c.jsx)(s.code,{children:"git checkout master"})," 切换分支、",(0,c.jsx)(s.code,{children:"git pull"})," 拉取最新代码、",(0,c.jsx)(s.code,{children:"npm i"})," 安装依赖、",(0,c.jsx)(s.code,{children:"npm run build"})," 打包构建、",(0,c.jsx)(s.code,{children:"pm2 startOrReload ecosystem.config.js"})," pm2 执行项目。"]}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(s.blockquote,{children:["\n",(0,c.jsxs)(s.p,{children:["这里有一点要注意的是，安装依赖的时候，设置 ",(0,c.jsx)(s.code,{children:"--production=false"})," 的目的是将 ",(0,c.jsx)(s.code,{children:"devDependencies"})," 中的包也进行安装，否则我们无法进行 ",(0,c.jsx)(s.code,{children:"vite"})," 打包操作。"]}),"\n"]}),"\n",(0,c.jsxs)(s.p,{children:["首次执行的时候，由于服务器中并没有 ",(0,c.jsx)(s.code,{children:"juejue-vite-h5"})," 这个项目，所以我们需要初始化一下项目，如下所示："]}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-bash",children:"pm2 deploy ecosystem.config.js production setup\n"})}),"\n",(0,c.jsxs)(s.p,{children:["执行上述代码之前，服务器并没有 ",(0,c.jsx)(s.code,{children:"juejue-vite-h5"})," 项目："]}),"\n",(0,c.jsx)(s.p,{children:(0,c.jsx)("img",{src:j,alt:""})}),"\n",(0,c.jsx)(s.p,{children:"我们尝试在前端项目中执行上诉指令："}),"\n",(0,c.jsx)(s.p,{children:(0,c.jsx)("img",{src:h,alt:""})}),"\n",(0,c.jsx)(s.p,{children:"成功之后，查看服务器中是否拉取成功："}),"\n",(0,c.jsx)(s.p,{children:(0,c.jsx)("img",{src:l,alt:""})}),"\n",(0,c.jsxs)(s.p,{children:["此时服务器中已经存在 ",(0,c.jsx)(s.code,{children:"juejue-vite-h5"})," 项目，接下来就是自动化执行整个部署流程，执行指令："]}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{children:"pm2 deploy production\n"})}),"\n",(0,c.jsxs)(s.blockquote,{children:["\n",(0,c.jsx)(s.p,{children:"注意，代码一定要先提交，因为服务器需要拉取最新的代码，这里必须要保持本地 commit 是没有未提交的。"}),"\n"]}),"\n",(0,c.jsx)(s.p,{children:"上述方式如果是服务器的内存是够的情况下，可以正常自动化部署，但是笔者的服务器跑了太多的项目。导致在服务器执行打包操作的时候，内存不足，将部署进程杀死了。"}),"\n",(0,c.jsxs)(s.p,{children:["于是我采用本地将项目打包好，连同 ",(0,c.jsx)(s.code,{children:"dist"})," 一起上传到仓库，服务器在拉取代码的时候就不用再执行打包操作，直接执行 ",(0,c.jsx)(s.code,{children:"pm2 startOrReload ecosystem.config.js"})," 操作。所以我们需要修改 ",(0,c.jsx)(s.code,{children:"ecosystem.config.js"})," 如下："]}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-js",children:"'post-deploy': 'git reset --hard && git checkout master && git pull && npm i --production=false && pm2 startOrReload ecosystem.config.js', // \n"})}),"\n",(0,c.jsxs)(s.p,{children:["再次执行 ",(0,c.jsx)(s.code,{children:"pm2 deploy production"}),"，如下所示："]}),"\n",(0,c.jsx)(s.p,{children:(0,c.jsx)("img",{src:i,alt:""})}),"\n",(0,c.jsxs)(s.p,{children:["部署成功之后，笔者的前端项目是部署在 ",(0,c.jsx)(s.code,{children:"5021"})," 端口上的，所以直接访问 ",(0,c.jsx)(s.code,{children:"http://47.99.134.126:5021"}),"，如下所示表示成功部署："]}),"\n",(0,c.jsx)(s.p,{children:(0,c.jsx)("img",{src:r,alt:""})}),"\n",(0,c.jsxs)(s.p,{children:["恭喜你，你已经成功将前端项目通过 ",(0,c.jsx)(s.code,{children:"pm2"})," 部署到服务器，并且正常运行了。后续的更新操作，你可以直接将代码在本地打包完，推到代码仓库后，在项目下运行 ",(0,c.jsx)(s.code,{children:"pm2 deploy production"})," 就能自动部署到服务器。"]}),"\n",(0,c.jsxs)(s.h2,{id:"总结",children:["总结",(0,c.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#总结",children:"#"})]}),"\n",(0,c.jsx)(s.p,{children:"部署项目的配置过程可能非常艰辛，但是做程序很多时候就是这样，这种方式部署项目的付出回报率是很可观的，你不必再每次打包之后，将项目压缩拖到服务器，而是通过一条简单的指令，一键部署到服务器，大大提高了工作效率。"}),"\n",(0,c.jsxs)(s.p,{children:["如果有条件的同学，使用的是 ",(0,c.jsx)(s.code,{children:"GitLab"})," 作为代码仓库，还可以通过 ",(0,c.jsx)(s.code,{children:"CI、CD"})," 进行持续集成，这里不展开分析。"]})]})}function k(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:s}=Object.assign({},(0,d.ah)(),e.components);return s?(0,c.jsx)(s,{...e,children:(0,c.jsx)(A,{...e})}):A(e)}let w=k;k.__RSPRESS_PAGE_META={},k.__RSPRESS_PAGE_META["Node%20%2B%20React%20%E5%AE%9E%E6%88%98%EF%BC%9A%E4%BB%8E%200%20%E5%88%B0%201%20%E5%AE%9E%E7%8E%B0%E8%AE%B0%E8%B4%A6%E6%9C%AC%2F21.%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E4%B8%8A%E7%BA%BF.md"]={toc:[{text:"前言",id:"前言",depth:2},{text:"知识点",id:"知识点",depth:4},{text:"正文",id:"正文",depth:2},{text:"购买服务器",id:"购买服务器",depth:4},{text:"ssh 配置",id:"ssh-配置",depth:4},{text:"MySQL 服务器端安装",id:"mysql-服务器端安装",depth:4},{text:"部署服务端代码",id:"部署服务端代码",depth:4},{text:"前端 pm2 部署",id:"前端-pm2-部署",depth:4},{text:"总结",id:"总结",depth:2}],title:"21.项目部署上线",headingTitle:"21.项目部署上线",frontmatter:{}}}}]);