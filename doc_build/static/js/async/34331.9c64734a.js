"use strict";(self.webpackChunkjue_jin_book_press=self.webpackChunkjue_jin_book_press||[]).push([["34331"],{771829:function(e,n,s){s.r(n),s.d(n,{default:()=>G});var c=s(552676),a=s(740453);let l=s.p+"static/image/340a13d7da245be1b77674f33e297d0d.914e57ac.webp",i=s.p+"static/image/efc8ff075202ad984650d282b90d537c.73f4eaac.webp",d=s.p+"static/image/5a9019080143c7ccfdafc674c4ee821e.e83673c3.webp",r=s.p+"static/image/322a32bc8a6c383491b6b003df767ca6.be893ffe.webp",t=s.p+"static/image/457bbfc9992114982641286fe8dce026.ac088434.webp",p=s.p+"static/image/7e6d7f1c15faab745fc96d0fa234d6d1.f8aa61bf.webp",o=s.p+"static/image/35f30b18561c07ee91c116c5862142fa.4094199a.webp",x=s.p+"static/image/83bd466abd811c1274fc5890c1ef02ed.564c0a7a.webp",j=s.p+"static/image/e0fdedb6fdf4cd5c1180035b121837a6.db821596.webp",m=s.p+"static/image/60fbf033c8b17aa20315a9a847207a72.127f2963.webp",h=s.p+"static/image/751e83df0c7d6316d406c084620cca51.2d4afdf1.webp",g=s.p+"static/image/8420f48be780a84833d426852a9caa75.52458ac3.webp",b=s.p+"static/image/dadec1783e66307b382e8e7ee33faa11.ec923afb.webp",u=s.p+"static/image/c35e5266c7ee16eaad5f6bd43de0c071.eca2859c.webp",f=s.p+"static/image/b1b8f694ec56fc5e0a25b55b59d27301.7d97c0ef.webp",v=s.p+"static/image/dd6423039677138e298c4d86be0f19b7.36e7251c.webp",N=s.p+"static/image/e0b6812bcfdaf2fc1060a88237552d1a.70e34999.webp",w=s.p+"static/image/9ffe65b7d93cabf06b01c67c879ceac1.3f96c8de.webp",C=s.p+"static/image/0452702ddbac3dfb3e2f62e085900441.9a471b35.webp",S=s.p+"static/image/231902101fef8a96770e164fe1b05ee8.362aec46.webp",k=s.p+"static/image/9139733f674d07e8f2baf9258fcbd4ae.2a292818.webp",A=s.p+"static/image/748814ca7fa4ef15f9230b4040254dcb.146197f0.webp",B=s.p+"static/image/51a3263433482eef32083eedb4d25fd1.a73b6096.webp",F=s.p+"static/image/eebe3a03b6468140a94c09c86ec47827.e28b4234.webp",E=s.p+"static/image/4d960958e41ba2e6016d6e5a054e7456.807dd3f4.webp",L=s.p+"static/image/39b930f6e80417c9bb6e867fb0a72d1d.44ff7ca2.webp",K=s.p+"static/image/f57d347d1657e3a450b207025a0ae1b1.8df7169c.webp",M=s.p+"static/image/52b82a007dc0765258ec0b1d7554d3ae.f6c0a6ea.webp",y=s.p+"static/image/9ee096be31e3e1ce4dabd2be4be76ef5.bbbc4add.webp",P=s.p+"static/image/b715252ebcf0da7a9838b7cb7098c9f2.265c5751.webp",z=s.p+"static/image/57e1eede0db36933c913807ee310ab6e.8bf4983f.webp",D=s.p+"static/image/55ca3be6045910de26459b313f4baa06.437cd666.webp",T=s.p+"static/image/021a3dce34e6292dcf3468fe12263710.2dce5a78.webp",q=s.p+"static/image/4240dac8a40740a2951d77cd043de9cb.bddf765e.webp",I=s.p+"static/image/6e0543fc71371652a99c46dbae4f8117.b6cb9e69.webp",O=s.p+"static/image/c541c2e1529d37add494909598bd7d6a.d103e372.webp",Q=s.p+"static/image/99699941fc7fdc3a6a37b2ff36e74ca5.62623c15.webp",V=s.p+"static/image/6c6a083f83acdd8312dda40ca992fa2a.29a86377.webp",R=s.p+"static/image/904b8c56bced2ead3d6f680819965a7e.2ffd8cb7.webp",Y=s.p+"static/image/4db16a1ce086599db0f104e7eed3b006.7f951bb1.webp",W=s.p+"static/image/e56fd4b0950d7cab0b24324c19f902af.3c4a97ff.webp";function Z(e){let n=Object.assign({h1:"h1",a:"a",p:"p",ul:"ul",li:"li",pre:"pre",code:"code",img:"img",h2:"h2"},(0,a.ah)(),e.components);return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)(n.h1,{id:"第27章用cssmodules避免样式冲突",children:["第27章—用CSSModules避免样式冲突",(0,c.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#第27章用cssmodules避免样式冲突",children:"#"})]}),"\n",(0,c.jsx)(n.p,{children:"\uFEFF每个组件里有 js 逻辑和 css 样式。"}),"\n",(0,c.jsx)(n.p,{children:"js 逻辑是通过 es module 做了模块化的，但是 css 并没有。"}),"\n",(0,c.jsx)(n.p,{children:"所以不同组件样式都在全局，很容易冲突。"}),"\n",(0,c.jsx)(n.p,{children:"那 css 如何也实现像 js 类似的模块机制呢？"}),"\n",(0,c.jsx)(n.p,{children:"最容易想到的是通过命名空间来区分。"}),"\n",(0,c.jsx)(n.p,{children:"比如 aaa 下面的 bbb 下的 button，就可以加一个 aaa__bb__btn 的 class。"}),"\n",(0,c.jsx)(n.p,{children:"而 ccc 下的 button，就可以加一个 ccc__btn 的 class。"}),"\n",(0,c.jsx)(n.p,{children:"常用的 BEM 命名规范就是解决这个问题的。"}),"\n",(0,c.jsx)(n.p,{children:"BEM 是 block、element、modifier 这三部分："}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"块（Block）：块是一个独立的实体，代表一个可重用的组件或模块。"}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:"块的类名应该使用单词或短语，并使用连字符（-）作为分隔符。例如：.header、.left-menu。"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"元素（Element）：元素是块的组成部分，不能独立存在。"}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:"元素的类名应该使用双下划线（__）作为分隔符，连接到块的类名后面。例如：.left-menu__item、.header__logo。"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"修饰符（Modifier）：修饰符用于描述块或元素的不同状态或变体，用来更改外观或行为。"}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:"修饰符的类名应该使用双连字符（--）作为分隔符，连接到块或元素的类名后面。例如：.left-menu__item--active、.header__logo--small。"}),"\n",(0,c.jsx)(n.p,{children:"但是，BEM 规范毕竟要靠人为来约束，不能保证绝对不会冲突。"}),"\n",(0,c.jsx)(n.p,{children:"所以最好是通过工具来做模块化，比如 CSS Modules。"}),"\n",(0,c.jsx)(n.p,{children:"我们先用一下 css modules 再介绍。"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"npx create-vite\n"})}),"\n",(0,c.jsx)(n.p,{children:"用 vite 创建个 react 项目。"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:W,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"进入项目，安装依赖，把开发服务跑起来："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"npm install\nnpm run dev\n"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:Y,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"添加两个组件 Button1、Button2"}),"\n",(0,c.jsx)(n.p,{children:"Button1.tsx"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:"import './Button1.css';\n\nexport default function() {\n    return <div className='btn-wrapper'>\n        <button className=\"btn\">button1</button>\n    </div>\n}\n"})}),"\n",(0,c.jsx)(n.p,{children:"Button1.css"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-css",children:".btn-wrapper {\n    padding: 20px;\n}\n\n.btn {\n    background: blue;\n}\n"})}),"\n",(0,c.jsx)(n.p,{children:"Button2.tsx"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:"import './Button2.css';\n\nexport default function() {\n    return <div className='btn-wrapper'>\n        <button className=\"btn\">button2</button>\n    </div>\n}\n"})}),"\n",(0,c.jsx)(n.p,{children:"Button2.css"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-css",children:".btn-wrapper {\n    padding: 10px;\n}\n\n.btn {\n    background: green;\n}\n"})}),"\n",(0,c.jsx)(n.p,{children:"在 App.tsx 引入下："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:R,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"渲染出来是这样的："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:V,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"很明显，是样式冲突了："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:Q,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"这时候可以改下名字，把 Button1.css 该为 Button1.module.css"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:O,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"并且改下写 className 的方式。"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:"import styles from './Button1.module.css';\n\nexport default function() {\n    return <div className={styles['btn-wrapper']}>\n        <button className={styles.btn}>button1</button>\n    </div>\n}\n"})}),"\n",(0,c.jsx)(n.p,{children:"在浏览器看下："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:I,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"现在就不会样式冲突了。"}),"\n",(0,c.jsx)(n.p,{children:"为什么呢？"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:q,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"可以看到，button1 的 className 变成了带 hash 的形式，全局唯一的，自然就不会冲突了。"}),"\n",(0,c.jsx)(n.p,{children:"这就是 css modules。"}),"\n",(0,c.jsx)(n.p,{children:"那它是怎么实现的呢？"}),"\n",(0,c.jsx)(n.p,{children:"看下编译后的代码就明白了："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:T,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"它通过编译给 className 加上了 hash，然后导出了这个唯一的 className。"}),"\n",(0,c.jsx)(n.p,{children:"所以在对象里用的，就是编译后的 className："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:D,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"在 vscode 里安装 css modules 插件："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:z,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"就可以提示出 css 模块下的 className 了："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:P,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"其实 vue 里也有类似的机制，叫做 scoped css"}),"\n",(0,c.jsx)(n.p,{children:"比如："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-html",children:'<style scoped> \n.guang { \n    color: red; \n} \n</style>  \n<template>  \n    <div class="guang">hi</div>  \n</template>\n'})}),"\n",(0,c.jsx)(n.p,{children:"会被编译成："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-html",children:'<style> \n.guang[data-v-f3f3eg9] \n{ \n    color: red; \n} \n</style> \n<template> \n    <div class="guang" data-v-f3f3eg9>hi</div> \n</template>\n'})}),"\n",(0,c.jsx)(n.p,{children:"通过给 css 添加一个全局唯一的属性选择器来限制 css 只能在这个范围生效，也就是 scoped 的意思。"}),"\n",(0,c.jsx)(n.p,{children:"它和 css modules 还不大一样，css modules 是整个 clasName 都变了，所以要把 className 改成从 css modules 导入的方式："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:y,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"而 scoped css 这种并不需要修改 css 代码，只是编译后会加一个选择器"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:"data:image/webp;base64,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",alt:""})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:M,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"两者的使用体验有一些差别。"}),"\n",(0,c.jsx)(n.p,{children:"当然，在 vue 里可以选择 scoped css 或者 css modules，而在 react 里就只能用 css modules 了。"}),"\n",(0,c.jsxs)(n.p,{children:["css modules 是通过 ",(0,c.jsx)(n.a,{href:"https://github.com/madyankin/postcss-modules",target:"_blank",rel:"noopener noreferrer",children:"postcss-modules"})," 这个包实现的，vite 也对它做了集成。"]}),"\n",(0,c.jsx)(n.p,{children:"我们可以在 vite.config.ts 里修改下 css modules 的配置："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:"import { defineConfig } from 'vite'\nimport react from '@vitejs/plugin-react'\n\n// https://vitejs.dev/config/\nexport default defineConfig({\n  plugins: [react()],\n  css: {\n    modules: {\n      generateScopedName: \"guang_[name]__[local]___[hash:base64:5]\"\n    }\n  }\n})\n\n"})}),"\n",(0,c.jsx)(n.p,{children:"比如通过 generateScopedName 来修改生成的 className 的格式："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:K,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"generateScopedName 也可以是个函数，自己处理："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:"import { defineConfig } from 'vite'\nimport react from '@vitejs/plugin-react'\n\n// https://vitejs.dev/config/\nexport default defineConfig({\n  plugins: [react()],\n  css: {\n    modules: {\n      // generateScopedName: \"guang_[name]__[local]___[hash:base64:5]\"\n      generateScopedName: function (name, filename, css) {\n        console.log(name, filename, css)\n  \n        return \"xxx\"\n      },\n    }\n  }\n})\n\n"})}),"\n",(0,c.jsx)(n.p,{children:"传入了 className、filename 还有 css 文件的内容："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:L,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"你可以通过 getJSON 来拿到编译后的 className："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:"import { defineConfig } from 'vite'\nimport react from '@vitejs/plugin-react'\n\n// https://vitejs.dev/config/\nexport default defineConfig({\n  plugins: [react()],\n  css: {\n    modules: {\n      getJSON: function (cssFileName, json, outputFileName) {\n        console.log(cssFileName, json, outputFileName)\n      },\n    }\n  }\n})\n"})}),"\n",(0,c.jsx)(n.p,{children:"第二个参数就是 css 模块导出的对象："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:E,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"那如果在 Button1.module.css 里想把 .btn-wrapper 作为全局样式呢？"}),"\n",(0,c.jsx)(n.p,{children:"这样写："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:F,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"可以看到，现在编译后的 css 里就没有对 .btn-wrapper 做处理了："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:B,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"只不过，因为 global 的 className 默认不导出，而我们用 styles.xxx 引入的："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:A,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"所以 className 为空："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:k,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"这时候，或者把 className 改为这样："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:S,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"或者在配置里加一个 exportsGlobals:true"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:"import { defineConfig } from 'vite'\nimport react from '@vitejs/plugin-react'\n\n// https://vitejs.dev/config/\nexport default defineConfig({\n  plugins: [react()],\n  css: {\n    modules: {\n      getJSON: function (cssFileName, json, outputFileName) {\n        console.log(cssFileName, json, outputFileName)\n      },\n      exportGlobals: true\n    }\n  }\n})\n\n"})}),"\n",(0,c.jsx)(n.p,{children:"可以看到，现在 global 样式也导出了："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:C,alt:""})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:w,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"相对的，模块化的 className 就用 :local() 来声明："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:N,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"默认是 local。"}),"\n",(0,c.jsx)(n.p,{children:"如果你想默认 global，那也可以配置："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:v,alt:""})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:"import { defineConfig } from 'vite'\nimport react from '@vitejs/plugin-react'\n\n// https://vitejs.dev/config/\nexport default defineConfig({\n  plugins: [react()],\n  css: {\n    modules: {\n      getJSON: function (cssFileName, json, outputFileName) {\n        console.log(cssFileName, json, outputFileName)\n      },\n      exportGlobals: true,\n      scopeBehaviour: 'global'\n    }\n  }\n})\n\n"})}),"\n",(0,c.jsx)(n.p,{children:"可以看到，现在就正好反过来了："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:f,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"默认是 global，如果是 local 的要单独用 :local() 声明。"}),"\n",(0,c.jsx)(n.p,{children:"你还可以通过正则表达式来匹配哪些 css 文件是默认全局："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:"import { defineConfig } from 'vite'\nimport react from '@vitejs/plugin-react'\n\n// https://vitejs.dev/config/\nexport default defineConfig({\n  plugins: [react()],\n  css: {\n    modules: {\n      getJSON: function (cssFileName, json, outputFileName) {\n        console.log(cssFileName, json, outputFileName)\n      },\n      exportGlobals: true,\n      globalModulePaths: [/Button1/]\n    }\n  }\n})\n"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:u,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"还有一个配置比较常用，就是 localsConvention："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:b,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"当 localsConvention 改为 camelCase 的时候，导出对象的 key 会变成驼峰的："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:g,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"那在组件里就可以这样写："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:h,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"这些就是 css modules 相关的配置了。"}),"\n",(0,c.jsx)(n.p,{children:"此外，还有一个地方需要注意，就是多层的 className 的时候："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:".btn-wrapper {\n    padding: 20px;\n}\n\n.btn .xxx{\n    background: blue;\n}\n"})}),"\n",(0,c.jsx)(n.p,{children:"每一层的 className 都会编译："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:m,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"有时候只要最外层 className 变了就好了，内层不用变，就可以用 :global() 声明下："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-css",children:".btn-wrapper {\n    padding: 20px;\n}\n\n.btn :global(.xxx){\n    background: blue;\n}\n"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:j,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"用 scss 之类的预处理时也是一样。"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:x,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"用 :global 包裹一层，内层的 className 不会被编译："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-css",children:".btn {\n    :global {\n        .xxx {\n            background: blue;\n            .yyy {\n                color: #000;\n            }\n        }\n    }\n}\n\n"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:o,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"在 vite 里用 css modules 是这么用，在 cra 里也是一样。"}),"\n",(0,c.jsx)(n.p,{children:"创建个 cra 的项目："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"npx create-react-app --template=typescript css-modules-cra\n"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:p,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"把服务跑起来："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"npm run start\n"})}),"\n",(0,c.jsx)(n.p,{children:"把 App.css 改为 App.module.css"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:t,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"在 App.tsx 引入下："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:r,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"这样就开启了 css modules："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:d,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"用法是一样的。"}),"\n",(0,c.jsx)(n.p,{children:"实现 css modules 也是用的 postcss-modules 这个 postcss 插件。"}),"\n",(0,c.jsx)(n.p,{children:"只不过是用 webpack 的 css-loader 封装了一层。"}),"\n",(0,c.jsx)(n.p,{children:"我们把本地代码保存："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"git init \ngit add .\ngit commit -m 'init'\n"})}),"\n",(0,c.jsx)(n.p,{children:"然后把 webpack 配置放出来："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"npm run eject\n"})}),"\n",(0,c.jsx)(n.p,{children:"项目下会多一个 config 目录这下面就是 webpack 配置："}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)("img",{src:i,alt:""}),"\n改一下配置："]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:"modules: {\n  mode: 'local',\n  // getLocalIdent: getCSSModuleLocalIdent,\n  localIdentName: \"guang__[path][name]__[local]--[hash:base64:5]\"\n},\n"})}),"\n",(0,c.jsx)(n.p,{children:"重新跑开发服务："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"npm run start\n"})}),"\n",(0,c.jsx)(n.p,{children:"现在的 className 就变了："}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)("img",{src:l,alt:""}),"\n更多配置可以看 ",(0,c.jsx)(n.a,{href:"https://github.com/webpack-contrib/css-loader?tab=readme-ov-file#object-2",target:"_blank",rel:"noopener noreferrer",children:"css-loader 的文档"})]}),"\n",(0,c.jsx)(n.p,{children:"和 vite 的 css modules 配置都差不多，虽然配置项名字不一样。"}),"\n",(0,c.jsxs)(n.h2,{id:"总结",children:["总结",(0,c.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#总结",children:"#"})]}),"\n",(0,c.jsx)(n.p,{children:"不同组件的 className 可能会一样，导致样式冲突。"}),"\n",(0,c.jsx)(n.p,{children:"为此，我们希望 css 能实现像 js 的 es module 一样的模块化功能。"}),"\n",(0,c.jsx)(n.p,{children:"可以用 BEM 的命名规范来避免冲突，但是这需要人为保证，不够可靠。"}),"\n",(0,c.jsx)(n.p,{children:"一般都是用编译的方式，比如 CSS Modules 或者 vue 的 Scoped CSS。"}),"\n",(0,c.jsx)(n.p,{children:"它是通过 postcss-modules 实现的，可以把 css 的 className  编译成带 hash 的形式。"}),"\n",(0,c.jsx)(n.p,{children:"然后在组件里用 styles.xxx 的方式引入。"}),"\n",(0,c.jsx)(n.p,{children:"在 vite、cra 里都对 css modules 做了支持，只要用 xx.module.css、xxx.module.scss 等结尾，就默认开启了 css modules。"}),"\n",(0,c.jsx)(n.p,{children:"还可以通过各种配置来做更多定制："}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"scopeBehaviour： 默认 local 或者 global"}),"\n",(0,c.jsx)(n.li,{children:"getJSON：可以拿到 css 模块导出的对象"}),"\n",(0,c.jsx)(n.li,{children:"exportGlobals： 全局的 className 也导出到对象"}),"\n",(0,c.jsx)(n.li,{children:"globalModulePaths：哪些文件路径默认是全局 className"}),"\n",(0,c.jsx)(n.li,{children:"generateScopedName：定制 local className 的格式"}),"\n",(0,c.jsx)(n.li,{children:"localsConvention： 导出的对象的 key 的格式"}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:"在 webpack 的 css-loader 里也有类似的配置。"}),"\n",(0,c.jsx)(n.p,{children:"现在的组件开发基本都有模块化的要求，所以 CSS Modules 在日常开发中用的特别多。"})]})}function H(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,a.ah)(),e.components);return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(Z,{...e})}):Z(e)}let G=H;H.__RSPRESS_PAGE_META={},H.__RSPRESS_PAGE_META["React%20%E9%80%9A%E5%85%B3%E7%A7%98%E7%B1%8D%2F%E7%AC%AC27%E7%AB%A0%E2%80%94%E7%94%A8CSSModules%E9%81%BF%E5%85%8D%E6%A0%B7%E5%BC%8F%E5%86%B2%E7%AA%81.md"]={toc:[{text:"总结",id:"总结",depth:2}],title:"第27章—用CSSModules避免样式冲突",headingTitle:"第27章—用CSSModules避免样式冲突",frontmatter:{}}}}]);