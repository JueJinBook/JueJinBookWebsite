"use strict";(self.webpackChunkjue_jin_book_press=self.webpackChunkjue_jin_book_press||[]).push([["37298"],{591870:function(e,n,s){e.exports=s.p+"static/image/6b5421308cfaeecc10c00e68983f36ad.f92c11b7.gif"},566415:function(e,n,s){s.r(n),s.d(n,{default:()=>u});var a=s(552676),i=s(740453);let r=s.p+"static/image/6bef69051a2f54d18eb74a1a035c045c.976e2c04.gif",c=s.p+"static/image/66e88e95660e18ba7026d54cc9071ebb.4fe0727e.webp",t=s.p+"static/image/f7724ada58f71e96285812d8d28df183.01097576.webp",d=s.p+"static/image/9a2331e2a615d2b58c8823e71925d6f7.2ee44a09.gif",o=s.p+"static/image/d35465c03665b4ef3150e9a91ec7332a.0e834d06.webp",p=s.p+"static/image/b0c0432f93995fd39a32f02218fd9610.f6763b47.gif",l=s.p+"static/image/2f21e1119237e942dd73a952c5c25ba1.6bcfce81.webp",h=s.p+"static/image/d44f4c14eaacd79716fed9f0dc561a3e.875c9c2c.webp",x=s.p+"static/image/05497e5abde07498d634ba4d8a78c9e3.407cd314.webp";var j=s(591870);function m(e){let n=Object.assign({h1:"h1",a:"a",p:"p",img:"img",pre:"pre",code:"code",h2:"h2"},(0,i.ah)(),e.components);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(n.h1,{id:"165-考试系统试卷回显预览保存",children:["165. 考试系统：试卷回显、预览、保存",(0,a.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#165-考试系统试卷回显预览保存",children:"#"})]}),"\n",(0,a.jsx)(n.p,{children:"上节我们实现了试卷编辑器："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:j,alt:"2024-08-26 23.08.21.gif"})}),"\n",(0,a.jsx)(n.p,{children:"但没有和对应 id 的试卷关联。"}),"\n",(0,a.jsx)(n.p,{children:"这节来做下回显和关联。"}),"\n",(0,a.jsx)(n.p,{children:"回显就是根据 id 查询对应的试卷内容。"}),"\n",(0,a.jsx)(n.p,{children:"我们之前没开发这个接口，加一下："}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"@Get('find/:id')\n@RequireLogin()\nasync find(@Param('id') id: string) {\n    return this.examService.find(+id, userId);\n}\n"})}),"\n",(0,a.jsx)(n.p,{children:"在 ExamService 加一下实现："}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"async find(id: number) {\n    return this.prismaService.exam.findUnique({\n      where: {\n        id\n      }\n    })\n}\n"})}),"\n",(0,a.jsx)(n.p,{children:"试一下："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:x,alt:"image.png"})}),"\n",(0,a.jsx)(n.p,{children:"在 interfaces/index.tsx 加一下接口："}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"export async function examFind(id: number) {\n    return await examServiceInstance.get('/exam/find/' + id );\n}\n"})}),"\n",(0,a.jsx)(n.p,{children:"调用下："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:h,alt:"image.png"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"async function query() {\n    if(!id) {\n        return;\n    }\n    try {\n        const res = await examFind(+id);\n        if(res.status === 201 || res.status === 200) {\n            try{\n                setJson(JSON.parse(res.data.content))\n            } catch(e) {}\n        } \n    } catch(e: any){\n        message.error(e.response?.data?.message || '系统繁忙，请稍后再试');\n    }\n}\n\nuseEffect(() => {\n    query();        \n}, [])\n"})}),"\n",(0,a.jsx)(n.p,{children:"当 JSON.parse 失败 try catch 就行，不用处理。"}),"\n",(0,a.jsx)(n.p,{children:"调用 save 接口更新下内容："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:l,alt:"image.png"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:'{\n    "id": 2,\n    "content": "[{\\"id\\":1724715396822,\\"type\\":\\"checkbox\\",\\"question\\":\\"最高的山？\\",\\"options\\":[\\"选项1\\",\\"选项2\\"],\\"score\\":5,\\"answer\\":\\"选项1\\",\\"answerAnalyse\\":\\"答案解析\\"}]"\n}\n'})}),"\n",(0,a.jsx)(n.p,{children:"然后刷新页面："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:p,alt:"2024-08-27 07.46.37.gif"})}),"\n",(0,a.jsx)(n.p,{children:"这样，回显就完成了。"}),"\n",(0,a.jsx)(n.p,{children:"然后再做下保存："}),"\n",(0,a.jsx)(n.p,{children:"在 interfaces/index.tsx 加一下这个接口："}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"export async function examSave(data: { id: number, content: string}) {\n    return await examServiceInstance.post('/exam/save', data);\n}\n"})}),"\n",(0,a.jsx)(n.p,{children:"然后在页面加一个保存按钮，点击的时候调用 save："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:o,alt:"image.png"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:'<div>\n    <Space>\n        <Button type="default">预览</Button>\n        <Button type="primary" onClick={saveExam}>保存</Button>\n    </Space>\n</div>\n'})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"async function saveExam() {\n    if(!id) {\n        return;\n    }\n    try {\n        const res = await examSave({\n            id: +id,\n            content: JSON.stringify(json)\n        });\n        if(res.status === 201 || res.status === 200) {\n            message.success('保存成功')\n        } \n    } catch(e: any){\n        message.error(e.response?.data?.message || '系统繁忙，请稍后再试');\n    }\n}\n"})}),"\n",(0,a.jsx)(n.p,{children:"测试下："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:d,alt:"2024-08-27 07.56.35.gif"})}),"\n",(0,a.jsx)(n.p,{children:"保存成功。"}),"\n",(0,a.jsx)(n.p,{children:"最后我们做下预览，这个也是递归渲染 json，只不过内容不同："}),"\n",(0,a.jsx)(n.p,{children:"创建 Preview 组件："}),"\n",(0,a.jsx)(n.p,{children:"pages/Edit/PreviewModal.tsx"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:'import { Checkbox, Form, Input, Modal, Radio, message } from "antd";\nimport { Question } from ".";\n\ninterface PreviewModalProps {\n    isOpen: boolean;\n    handleClose: Function;\n    json: Question[]\n}\n\nexport function PreviewModal(props: PreviewModalProps) {\n\n    function renderPreviewComponents(arr: Array<Question>) {\n        return arr.map(item => {\n            let formComponent;\n            if(item.type === \'radio\') {\n                formComponent = <Radio.Group>\n                    {\n                        item.options?.map(option => <Radio value={option}>{option}</Radio>)\n                    }\n                </Radio.Group>\n            } else if(item.type === \'checkbox\') {\n                formComponent = <Checkbox.Group options={item.options} />\n            } else if(item.type === \'input\'){\n                formComponent =  <Input/>\n            }\n\n            return <div className="component-item" key={item.id}>\n                <p className="question">{item.question}</p>\n                <div className="options">\n                    {formComponent}\n                </div>\n            </div>\n        })\n    }\n\n    return <Modal \n        title="预览"\n        className="preview"\n        open={props.isOpen}\n        onOk={() => props.handleClose()}\n        onCancel={() => props.handleClose()}\n        okText={\'确认\'}\n        cancelText={\'取消\'}    \n    >\n        {renderPreviewComponents(props.json)}\n    </Modal>\n}\n'})}),"\n",(0,a.jsx)(n.p,{children:"递归渲染传过来的 json，在 Modal 里显示。"}),"\n",(0,a.jsx)(n.p,{children:"调用下："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:t,alt:"image.png"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"const [isPreviewModalOpen, setPreviewModalOpen] = useState(false);\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"<PreviewModal isOpen={isPreviewModalOpen} json={json} handleClose={() =>{\n    setPreviewModalOpen(false)\n}}/>\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:'<Button type="default" onClick={() => {\n    setPreviewModalOpen(true)\n}}>预览</Button>\n'})}),"\n",(0,a.jsx)(n.p,{children:"然后写下样式："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:c,alt:"image.png"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-scss",children:".preview {\n    .component-item {\n        margin: 20px;\n\n        line-height: 40px;\n        font-size: 20px;\n    }\n}\n"})}),"\n",(0,a.jsx)(n.p,{children:"看下效果："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:r,alt:"2024-08-27 08.13.16.gif"})}),"\n",(0,a.jsx)(n.p,{children:"没啥问题。"}),"\n",(0,a.jsx)(n.p,{children:"这样，试卷编辑器的回显、预览、保存就完成了。"}),"\n",(0,a.jsx)(n.p,{children:"案例代码在小册仓库："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.a,{href:"https://github.com/QuarkGluonPlasma/nestjs-course-code/tree/main/exam-system-frontend",target:"_blank",rel:"noopener noreferrer",children:"前端代码"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.a,{href:"https://github.com/QuarkGluonPlasma/nestjs-course-code/tree/main/exam-system",target:"_blank",rel:"noopener noreferrer",children:"后端代码"})}),"\n",(0,a.jsxs)(n.h2,{id:"总结",children:["总结",(0,a.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#总结",children:"#"})]}),"\n",(0,a.jsx)(n.p,{children:"这节我们实现了试卷的回显、预览、保存。"}),"\n",(0,a.jsx)(n.p,{children:"回显就是查询 id 对应的 content，parse 为 json 渲染。"}),"\n",(0,a.jsx)(n.p,{children:"保存就是把 content 保存到数据库。"}),"\n",(0,a.jsx)(n.p,{children:"预览则是递归渲染 json，但和编辑时渲染的内容不同。"}),"\n",(0,a.jsx)(n.p,{children:"至此，试卷编辑器就完成了。"})]})}function g(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,i.ah)(),e.components);return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(m,{...e})}):m(e)}let u=g;g.__RSPRESS_PAGE_META={},g.__RSPRESS_PAGE_META["Nest%20%E9%80%9A%E5%85%B3%E7%A7%98%E7%B1%8D%20%20%E6%9C%80%E6%96%B0200%E7%AB%A0%2F165.%20%E8%80%83%E8%AF%95%E7%B3%BB%E7%BB%9F%EF%BC%9A%E8%AF%95%E5%8D%B7%E5%9B%9E%E6%98%BE%E3%80%81%E9%A2%84%E8%A7%88%E3%80%81%E4%BF%9D%E5%AD%98.md"]={toc:[{text:"总结",id:"总结",depth:2}],title:"165. 考试系统：试卷回显、预览、保存",headingTitle:"165. 考试系统：试卷回显、预览、保存",frontmatter:{}}}}]);