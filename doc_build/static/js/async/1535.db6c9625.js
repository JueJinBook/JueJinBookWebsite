"use strict";(self.webpackChunkjue_jin_book_press=self.webpackChunkjue_jin_book_press||[]).push([["1535"],{195505:function(e,n,s){e.exports=s.p+"static/image/9e98b4261f621387888376d900b5efaa.1c211e1d.webp"},340305:function(e,n,s){s.r(n),s.d(n,{default:()=>$});var c=s(552676),r=s(740453),t=s(195505);let i=s.p+"static/image/b270c21c7f896b172c843bfe2b727a1a.5c871036.webp",a=s.p+"static/image/eb2395feb315a0766c4a693a0f30c5ea.a713d51c.webp",p=s.p+"static/image/1038e77a8c61eeec5bc927b97ea011bf.eccef79d.webp",l=s.p+"static/image/f7211c6f128aeba748bfa8aeb4be99d2.240d6b07.gif",o=s.p+"static/image/1a8bd3941b3c93d8058cc4cd8f32816b.1dec2c0a.webp",d=s.p+"static/image/5496ed023bd51df646a2ccc4f3e72d1e.815e450d.webp",f=s.p+"static/image/881157006f889f36f745665ff1495745.68bb5e37.gif",x=s.p+"static/image/f1377706315251f53ca1b65e550ff03e.1a254781.webp",g=s.p+"static/image/eca7141e9b26201fe3e03dbea80b8157.ee18bd99.gif",h=s.p+"static/image/0b2d8f6f6eaacb8579566f13f0d13bfa.68b747e9.webp",j=s.p+"static/image/3b0103696c1190819013517a2f3a7f77.9dcef3d4.webp",m=s.p+"static/image/4631fcd7a248b4912e548e34d861c08c.a47ca515.gif",b=s.p+"static/image/cdacfbe99c40f14d25633fdb83eb8514.3c902f7c.gif",u=s.p+"static/image/c060c8d74025a57f71e9c7992444456e.2d477848.webp",v=s.p+"static/image/f8832b34c1771f92feb087f43d0dfbe1.df1826bc.gif",A=s.p+"static/image/12fc90b9492b3a769a9442f8ec31f261.5141fa33.webp",w=s.p+"static/image/b1711e434a30cec9241a9575a9cfbb8c.95cda586.webp",O=s.p+"static/image/ce05f536f67af67a22bc3483e673bc27.3eb99816.gif",P=s.p+"static/image/fc97951529817d5637dfe9845bb157cb.0aee39af.webp",M=s.p+"static/image/ea0fcd4debaf04cb861a83045c2ca696.ad411a2f.webp",k=s.p+"static/image/1ac9707272ba7124e967f64ee0a6e944.b7bb39df.gif",E=s.p+"static/image/9f815eb4cf7d8d6420e2324a14e420eb.854353c0.webp",F=s.p+"static/image/d29737d6b83c77094acf4d26de376d10.ff6f0835.gif",N=s.p+"static/image/9620e4ad18fae544dbff620e21b5a943.2a16919d.gif",R=s.p+"static/image/f65075a84b490bca44e7110d59d3eb0c.b408e689.webp",S=s.p+"static/image/a9967bb842ef0d56f3dce372fc9d75a4.43474b67.webp",V=s.p+"static/image/f34fb4a4d540b4006218f3349465a9ac.ebb1c94b.gif",T=s.p+"static/image/3e3e9792ecd9834d6e541b88189ef1a0.8cea5c7e.webp",y=s.p+"static/image/c6c91a8d7cfbb27d4fe008e15afb31e4.310d540f.webp",B=s.p+"static/image/bf030d23ff4f138aabb4c8619ec8acce.8780d7ba.gif",C=s.p+"static/image/325feac158468a681ab9341068169a0e.393cef84.webp",W=s.p+"static/image/bfaa803c0c7e17ece2c4fcdf04ab2d54.ea680caa.webp",I=s.p+"static/image/c9da1c1114ff1ec986dc4403bfe39cb1.3b0edba0.webp",Q=s.p+"static/image/5ce670a26467077f72b20f14a15950c1.64a1ccd7.webp",D=s.p+"static/image/7885a5b84c162cbf52a816b00f35baa8.c2a93a00.webp",z=s.p+"static/image/9314b4c0d49816944f211869720c1a98.41849fe9.webp",H=s.p+"static/image/3a662cb5c80a2075d61e66caddfcbb24.39da59a4.webp",Z=s.p+"static/image/71e9c0914c1bc1e5e20bae4b8f3dfe99.023dcbbf.webp",U=s.p+"static/image/c9bc3b842d252fcab2eda8c9f57bf6eb.44360696.webp",X=s.p+"static/image/f2329d30f67ccaffe828a15fc136fdc9.244e4359.webp",G=s.p+"static/image/beecfb9a471356a15d505f9330986b4b.491caeaf.webp",K=s.p+"static/image/362181309ca02b0ec58e55a50bfd1d35.a06ab8c5.webp",q=s.p+"static/image/1e1ec31cb644e9c5895de1f719d38cba.2990319a.webp",J=s.p+"static/image/a4791ac6183fc112564e6657618460ce.e78138bb.webp",L=s.p+"static/image/f14239b10eddd9c0914c00bd541f5cdd.e52ffccb.webp";function Y(e){let n=Object.assign({h1:"h1",a:"a",p:"p",img:"img",pre:"pre",code:"code",strong:"strong",h2:"h2"},(0,r.ah)(),e.components);return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)(n.h1,{id:"第31章组件实战popover气泡卡片组件",children:["第31章—组件实战：Popover气泡卡片组件",(0,c.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#第31章组件实战popover气泡卡片组件",children:"#"})]}),"\n",(0,c.jsx)(n.p,{children:"\uFEFF组件库一般都有 Popover 和 Tooltip 这两个组件，它们非常相似。"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:L,alt:""})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:J,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"不过应用场景是有区别的："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:q,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"Tooltip（文字提示） 是用来代替 title 的，做一个文案解释。"}),"\n",(0,c.jsx)(n.p,{children:"而 Popover（气泡卡片）可以放更多的内容，可以交互："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:K,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"所以说，这俩虽然长得差不多，但确实要分为两个组件来写。"}),"\n",(0,c.jsx)(n.p,{children:"这个组件看起来比较简单，但实现起来很麻烦。"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:G,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"你可能会说，不就是写好样式，然后绝对定位到元素上面么？"}),"\n",(0,c.jsx)(n.p,{children:"不只是这样。"}),"\n",(0,c.jsx)(n.p,{children:"首先，placement 参数可以指定 12 个方向，top、topleft、topright、bottom 等："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:X,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"这些不同方向的位置计算都要实现。"}),"\n",(0,c.jsx)(n.p,{children:"而且，就算你指定了 left，当左边空间不够的时候，也得做下处理，展示在右边："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:U,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"而且当方向不同时，箭头的显示位置也不一样："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:Z,alt:""})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:H,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"所以要实现这样一个 Popover 组件，光计算浮层的显示位置就是不小的工作量。"}),"\n",(0,c.jsx)(n.p,{children:"不过好在这种场景有专门的库做了封装，完全没必要自己写。"}),"\n",(0,c.jsxs)(n.p,{children:["它就是 ",(0,c.jsx)(n.a,{href:"https://floating-ui.com/",target:"_blank",rel:"noopener noreferrer",children:"floating-ui"}),"。"]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:z,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"看介绍就可以知道，它是专门用来创建 tooltip、popover、dropdown 这类浮动的元素的。"}),"\n",(0,c.jsx)(n.p,{children:"它的 logo 也很形象："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:D,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"那它怎么用呢？"}),"\n",(0,c.jsx)(n.p,{children:"我们新建个项目试试看："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"npx create-vite\n"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:Q,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"用 create-vite 创建个 react 项目。"}),"\n",(0,c.jsx)(n.p,{children:"进入项目，安装依赖，然后把服务跑起来："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"npm install\nnpm run dev\n"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:I,alt:""})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:W,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"没啥问题。"}),"\n",(0,c.jsx)(n.p,{children:"改下 main.tsx，去掉 index.css，并且把 StrictMode 去掉，它会导致重复渲染："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:C,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"然后安装下 floating-ui 的包："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"npm install --save @floating-ui/react\n"})}),"\n",(0,c.jsx)(n.p,{children:"改下 App.tsx"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:"import {\n  useInteractions,\n  useFloating,\n  useHover,\n} from '@floating-ui/react';\nimport { useState } from 'react';\n \nexport default function App() {\n  const [isOpen, setIsOpen] = useState(false);\n \n  const {refs, floatingStyles, context} = useFloating({\n    open: isOpen,\n    onOpenChange: setIsOpen\n  });\n \n  const hover = useHover(context);\n\n  const { getReferenceProps, getFloatingProps } = useInteractions([\n    hover\n  ]);\n\n  return (\n    <>\n      <button ref={refs.setReference} {...getReferenceProps()}>\n        hello\n      </button>\n      {\n        isOpen && <div\n            ref={refs.setFloating}\n            style={floatingStyles}\n            {...getFloatingProps()}\n          >\n            光光光光光\n          </div>\n      }\n    </>\n  );\n}\n"})}),"\n",(0,c.jsx)(n.p,{children:"先看看效果："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:B,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"可以看到，hover 的时候浮层会在下面出现。"}),"\n",(0,c.jsx)(n.p,{children:"看下代码："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:y,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"首先，用到了 useFloating 这个 hook，它的作用就是计算浮层位置的。"}),"\n",(0,c.jsx)(n.p,{children:"给它相对的元素、浮层元素的 ref，它就会计算出浮层的 style 来。"}),"\n",(0,c.jsx)(n.p,{children:"它可以指定浮层出现的方向："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:T,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"比如当 placement 指定为 right 时，效果就是这样的："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:V,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"再就是 useInteractions 这个 hook："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:S,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"你可以传入 click、hover 等交互方式，然后把它返回的 props 设置到元素上，就可以绑定对应的交互事件。"}),"\n",(0,c.jsx)(n.p,{children:"比如把交互事件换成 click："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:R,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"现在就是点击的时候浮层出现和消失了："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:N,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"不过现在有个问题："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:F,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"只有点击按钮，浮层才会消失，点击其他位置不会。"}),"\n",(0,c.jsx)(n.p,{children:"这时候可以加上 dismiss 的处理："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:E,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"现在点击其它位置，浮层就会消失，并且按 ESC 键也会消失："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:k,alt:""})}),"\n",(0,c.jsxs)(n.p,{children:["也就是说 ",(0,c.jsx)(n.strong,{children:"useFloating 是用来给浮层确定位置的，useInteractions 是用来绑定交互事件的"}),"。"]}),"\n",(0,c.jsx)(n.p,{children:"有的同学会说，这也不好看啊。"}),"\n",(0,c.jsx)(n.p,{children:"我们加一下样式就好了："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:M,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"加上 className，然后在 App.css 里写下样式："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-css",children:".popover-floating {\n  padding: 4px 8px;\n  border: 1px solid #000;\n  border-radius: 4px;\n}\n"})}),"\n",(0,c.jsx)(n.p,{children:"引入看下："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:P,alt:""})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:O,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"但是现在的定位有点问题，离着太近了，能不能修改下定位呢？"}),"\n",(0,c.jsx)(n.p,{children:"可以。"}),"\n",(0,c.jsx)(n.p,{children:"加一个 offset 的 middleware 就好了："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:w,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"它的效果就是修改两者距离的："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:A,alt:""})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:v,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"箭头也不用自己写，有对应的中间件："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:u,alt:""})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:"import {\n  useInteractions,\n  useFloating,\n  useHover,\n  useClick,\n  useDismiss,\n  offset,\n  arrow,\n  FloatingArrow,\n} from '@floating-ui/react';\nimport { useRef, useState } from 'react';\n\nimport './App.css';\n \nexport default function App() {\n  const arrowRef = useRef(null);\n\n  const [isOpen, setIsOpen] = useState(false);\n \n  const {refs, floatingStyles, context} = useFloating({\n    open: isOpen,\n    onOpenChange: setIsOpen,\n    placement: 'right',\n    middleware: [\n      offset(10),\n      arrow({\n        element: arrowRef,\n      }),\n    ]\n  });\n \n  const click = useClick(context);\n  const dismiss = useDismiss(context);\n\n  const { getReferenceProps, getFloatingProps } = useInteractions([\n    click,\n    dismiss\n  ]);\n\n  return (\n    <>\n      <button ref={refs.setReference} {...getReferenceProps()}>\n        hello\n      </button>\n      {\n        isOpen && <div\n            className='popover-floating'\n            ref={refs.setFloating}\n            style={floatingStyles}\n            {...getFloatingProps()}\n          >\n            光光光\n            <FloatingArrow ref={arrowRef} context={context}/>\n          </div>\n      }\n    </>\n  );\n}\n"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:b,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"这样箭头就有了。"}),"\n",(0,c.jsx)(n.p,{children:"只不过样式不大对，我们修改下："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:'<FloatingArrow ref={arrowRef} context={context} fill="#fff" stroke="#000" strokeWidth={1}/>\n'})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:m,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"这样，箭头位置就有了。"}),"\n",(0,c.jsx)(n.p,{children:"给 button 加一些 margin，我们试试其它位置的 popover 对不对："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:j,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"分别设置不同 placement："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:h,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"top-end"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:"data:image/webp;base64,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",alt:""})}),"\n",(0,c.jsx)(n.p,{children:"left-start"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:"data:image/webp;base64,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",alt:""})}),"\n",(0,c.jsx)(n.p,{children:"left"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:"data:image/webp;base64,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",alt:""})}),"\n",(0,c.jsx)(n.p,{children:"都没问题。"}),"\n",(0,c.jsx)(n.p,{children:"不过现在并没有做边界的处理："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:g,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"设置 top 的时候，浮层超出可视区域，这时候应该显示在下面。"}),"\n",(0,c.jsx)(n.p,{children:"加上 flip 中间件就好了："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:x,alt:""})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:f,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"这样，popover 的功能就完成了。"}),"\n",(0,c.jsx)(n.p,{children:"我们封装下 Popover 组件。"}),"\n",(0,c.jsx)(n.p,{children:"新建 Popover/index.tsx"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:"import { CSSProperties, PropsWithChildren, ReactNode } from \"react\";\nimport {\n    useInteractions,\n    useFloating,\n    useClick,\n    useDismiss,\n    offset,\n    arrow,\n    FloatingArrow,\n    flip,\n    useHover,\n} from '@floating-ui/react';\nimport { useRef, useState } from 'react';\nimport './index.css';\n  \ntype Alignment = 'start' | 'end';\ntype Side = 'top' | 'right' | 'bottom' | 'left';\ntype AlignedPlacement = `${Side}-${Alignment}`;\n\ninterface PopoverProps extends PropsWithChildren {\n    content: ReactNode,\n    trigger?: 'hover' | 'click'\n    placement?: Side | AlignedPlacement,\n    open?: boolean,\n    onOpenChange?: (open: boolean) => void,\n    className?: string;\n    style?: CSSProperties\n}\n\nexport default function Popover(props: PopoverProps) {\n\n    const {\n        open,\n        onOpenChange,\n        content,\n        children,\n        trigger = 'hover',\n        placement = 'bottom',\n        className,\n        style\n    } = props;\n\n    const arrowRef = useRef(null);\n\n    const [isOpen, setIsOpen] = useState(open);\n     \n    const {refs, floatingStyles, context} = useFloating({\n      open: isOpen,\n      onOpenChange: (open) => {\n        setIsOpen(open);\n        onOpenChange?.(open);\n      },\n      placement,\n      middleware: [\n        offset(10),\n        arrow({\n          element: arrowRef,\n        }),\n        flip()\n      ]\n    });\n   \n    const interaction = trigger === 'hover' ? useHover(context) : useClick(context);\n\n    const dismiss = useDismiss(context);\n  \n    const { getReferenceProps, getFloatingProps } = useInteractions([\n        interaction,\n        dismiss\n    ]);\n  \n    return (\n      <>\n        <span ref={refs.setReference} {...getReferenceProps()} className={className} style={style}>\n          {children}\n        </span>\n        {\n          isOpen && <div\n              className='popover-floating'\n              ref={refs.setFloating}\n              style={floatingStyles}\n              {...getFloatingProps()}\n            >\n              {content}\n              <FloatingArrow ref={arrowRef} context={context} fill=\"#fff\" stroke=\"#000\" strokeWidth={1}/>\n            </div>\n        }\n      </>\n    );\n}\n\n"})}),"\n",(0,c.jsx)(n.p,{children:"Popover/index.css"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-css",children:".popover-floating {\n    padding: 4px 8px;\n    border: 1px solid #000;\n    border-radius: 4px;\n}\n"})}),"\n",(0,c.jsx)(n.p,{children:"整体代码和之前差不多，有几处不同："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:d,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"参数继承 PropsWithChildren，可以传入 children 参数。"}),"\n",(0,c.jsx)(n.p,{children:"可以传入 content，也就是浮层的内容。"}),"\n",(0,c.jsx)(n.p,{children:"trigger 参数是触发浮层的方式，可以是 click 或者 hover。"}),"\n",(0,c.jsx)(n.p,{children:"placement 就是 12 个方向。"}),"\n",(0,c.jsx)(n.p,{children:"而 open、onOpenChange 则是可以在组件外控制 popover 的显示隐藏。"}),"\n",(0,c.jsx)(n.p,{children:"className 和 style 设置到内层的 span 元素上："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:o,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"在 App.tsx 里引入下："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:"import Popover from './Popover';\n\nexport default function App() {\n\n  const popoverContent = <div>\n    光光光\n    <button onClick={() => {alert(1)}}>111</button>\n  </div>;\n\n  return <Popover\n    content={popoverContent}\n    placement='bottom'\n    trigger='click'\n    style={{margin: '200px'}}\n  >\n    <button>点我点我</button>\n  </Popover>\n}\n"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:l,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"这样，Popover 组件的基本功能就完成了。"}),"\n",(0,c.jsx)(n.p,{children:"但现在 Popover 组件还有个问题："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:p,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"浮层使用 position：absolute 定位的，应该是相对于 body 定位，但如果中间有个元素也设置了 position: relative 或者 absolute，那样定位就是相对于那个元素了。"}),"\n",(0,c.jsx)(n.p,{children:"所以，要把浮层用 createPortal 渲染到 body 之下。"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:a,alt:""})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:"const el = useMemo(() => {\n    const el = document.createElement('div');\n    el.className = `wrapper`;\n\n    document.body.appendChild(el);\n    return el;\n}, []);\n\nconst floating = isOpen && <div\n    className='popover-floating'\n    ref={refs.setFloating}\n    style={floatingStyles}\n    {...getFloatingProps()}\n>\n    {content}\n    <FloatingArrow ref={arrowRef} context={context} fill=\"#fff\" stroke=\"#000\" strokeWidth={1}/>\n</div>\n\nreturn (\n  <>\n    <span ref={refs.setReference} {...getReferenceProps()} className={className} style={style}>\n      {children}\n    </span>\n    {\n      createPortal(floating, el)\n    }\n  </>\n);\n"})}),"\n",(0,c.jsx)(n.p,{children:"这样，Popover 浮层就渲染到了 body 下："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:i,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"至此，Popover 组件就封装完了。"}),"\n",(0,c.jsx)(n.p,{children:"其实 floating-ui 用的非常多，比如下一节会讲的 click-to-react-component，它就用到了 floating-ui 来实现的："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:t,alt:""})}),"\n",(0,c.jsxs)(n.p,{children:["案例代码上传了",(0,c.jsx)(n.a,{href:"https://github.com/QuarkGluonPlasma/react-course-code/tree/main/popover-component",target:"_blank",rel:"noopener noreferrer",children:"小册仓库"})]}),"\n",(0,c.jsxs)(n.h2,{id:"总结",children:["总结",(0,c.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#总结",children:"#"})]}),"\n",(0,c.jsx)(n.p,{children:"今天我们封装了 Popover 组件。"}),"\n",(0,c.jsx)(n.p,{children:"如果完全自己实现，计算位置还是挺麻烦的，有 top、right、left 等不同位置，而且到达边界的时候也要做特殊处理。"}),"\n",(0,c.jsx)(n.p,{children:"所以我们直接基于 floating-ui 来做，它是专门用于 tooltip、popover、dropdown 等浮动组件的。"}),"\n",(0,c.jsx)(n.p,{children:"用 useFloating 的 hook 来计算位置，用 useIntersections 的 hook 来处理交互。"}),"\n",(0,c.jsx)(n.p,{children:"它支持很多中间件，比如 offset 来设置偏移、arrow 来处理箭头位置，可以完成各种复杂的定位功能。"}),"\n",(0,c.jsx)(n.p,{children:"我们封装了一层，加了一些参数，然后把浮层用 createPortal 渲染到了 body 下。"}),"\n",(0,c.jsx)(n.p,{children:"这样就是一个功能完整的 Popover 组件了。"}),"\n",(0,c.jsx)(n.p,{children:"如果完全自己实现 Popover 组件，还是挺麻烦的，但是基于 floating-ui 封装，就很简单。"})]})}function _(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,r.ah)(),e.components);return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(Y,{...e})}):Y(e)}let $=_;_.__RSPRESS_PAGE_META={},_.__RSPRESS_PAGE_META["React%20%E9%80%9A%E5%85%B3%E7%A7%98%E7%B1%8D%2F%E7%AC%AC31%E7%AB%A0%E2%80%94%E7%BB%84%E4%BB%B6%E5%AE%9E%E6%88%98%EF%BC%9APopover%E6%B0%94%E6%B3%A1%E5%8D%A1%E7%89%87%E7%BB%84%E4%BB%B6.md"]={toc:[{text:"总结",id:"总结",depth:2}],title:"第31章—组件实战：Popover气泡卡片组件",headingTitle:"第31章—组件实战：Popover气泡卡片组件",frontmatter:{}}}}]);