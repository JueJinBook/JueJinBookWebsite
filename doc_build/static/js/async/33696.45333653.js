"use strict";(self.webpackChunkjue_jin_book_press=self.webpackChunkjue_jin_book_press||[]).push([["33696"],{134548:function(e,n,s){s.r(n),s.d(n,{default:()=>h});var a=s(552676),t=s(740453);let c=s.p+"static/image/b1f5e703a786e2efd5a84095cef84058.e740d5e8.webp",i=s.p+"static/image/bd8d466c216c58489c6bf51ea1fb038a.43108c72.webp",d=s.p+"static/image/954fe5d442f77ba46c6dcee14d9a5869.dadb02aa.webp",r=s.p+"static/image/e76dce1fef4e42d6aa8dbc0f1275ef2b.f9f8836c.webp",l=s.p+"static/image/fb1a6914041ab6a262b20db18ced36a0.50ca6c97.webp";function o(e){let n=Object.assign({h1:"h1",a:"a",h2:"h2",p:"p",code:"code",img:"img",h4:"h4",ul:"ul",li:"li",pre:"pre",blockquote:"blockquote"},(0,t.ah)(),e.components);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(n.h1,{id:"19前端实战账单数据统计页",children:["19.前端实战：账单数据统计页",(0,a.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#19前端实战账单数据统计页",children:"#"})]}),"\n",(0,a.jsxs)(n.h2,{id:"前言",children:["前言",(0,a.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#前言",children:"#"})]}),"\n",(0,a.jsxs)(n.p,{children:["账单的操作部分在之前的章节已经结束了，本章节我们学习如何将账单列表，以可视化数据的新形势展示，本章节我们会通过 ",(0,a.jsx)(n.code,{children:"Echart"})," 插件，对数据进行可视化展示。"]}),"\n",(0,a.jsx)(n.p,{children:"页面布局和分析如下所示："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:l,alt:""})}),"\n",(0,a.jsxs)(n.h4,{id:"知识点",children:["知识点",(0,a.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#知识点",children:"#"})]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Echart 引入和使用。"}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:["进度条组件 ",(0,a.jsx)(n.code,{children:"Progress"})," 的使用。"]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.h2,{id:"正文",children:["正文",(0,a.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#正文",children:"#"})]}),"\n",(0,a.jsxs)(n.h4,{id:"头部筛选和数据实现",children:["头部筛选和数据实现",(0,a.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#头部筛选和数据实现",children:"#"})]}),"\n",(0,a.jsxs)(n.p,{children:["当你看到顶部的时间筛选项的时候，你会再一次体会到当初把时间筛选功能封装成公用组件的好处，于是我们打开 ",(0,a.jsx)(n.code,{children:"Data/index.jsx"}),"，添加如下代码："]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:"import React, { useEffect, useRef, useState } from 'react';\nimport { Icon, Progress } from 'zarm';\nimport cx from 'classnames';\nimport dayjs from 'dayjs';\nimport { get, typeMap } from '@/utils'\nimport CustomIcon from '@/components/CustomIcon'\nimport PopupDate from '@/components/PopupDate'\nimport s from './style.module.less';\n\nconst Data = () => {\n  return <div className={s.data}>\n    <div className={s.total}>\n      <div className={s.time}>\n        <span>2021-06</span>\n        <Icon className={s.date} type=\"date\" />\n      </div>\n      <div className={s.title}>共支出</div>\n      <div className={s.expense}>\xa51000</div>\n      <div className={s.income}>共收入\xa5200</div>\n    </div>\n  </div>\n}\n\nexport default Data\n"})}),"\n",(0,a.jsx)(n.p,{children:"头部的一些引入是为后面的代码所用，在这里事先引入，避免后面重复出现。"}),"\n",(0,a.jsxs)(n.p,{children:["上述代码为头部统计的页面布局，同样采用的 ",(0,a.jsx)(n.code,{children:"flex"})," 布局，样式部分如下："]}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:"文末已为同学们提供下本章节 demo 代码，样式部分不再详细说明。"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"样式部分有一个小技巧需要注意，日期后面的小竖线，如下所示："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:"data:image/webp;base64,UklGRrgPAABXRUJQVlA4IKwPAACwcACdASq6AjQBPp1Ook2lpCMmIRhIWMATiWdu4Xcwn/n/auZa1/u/in9Eac93bzMa//hvFRzzc+eUX4/+rf7fz4+or89f673AP7b/QekN5gP2e/XD3Rf8r+w3ub9AD+uf1jrBPQT/dT00v3R+Dv+1f839wfax9QD//+3/0q/VD+29rv+B8QfIn8Sk/nHfyX7i/sP7F6H95vAC/Gf6Z/l96pAF+b/1j/jf23x6NRHIA4CmgB+o/Vi/yPpm9zf2B7B36/74ADvJpe17RePzktXOGR1bL9r2i8fnJatJMvWw8ck9EAFaOU8ENGzx3Bxm4AK0cp4IaNnSA2Zkup5l4vTS6nmXi9NLqeZeL5EBXLTzLxemlN2l37Xs+ExCbfU8y8XpuyUp5uml1PMvKNCV9tsAQPrmKBOOr1gKIaLrKUm8PS44/PIHDn9w+fESKWCRZOtP7I+NJl7Uup5mBTuvJOqXU8y8o4EBCSi4RJq0nsA9P0TZTfRXa41MYFMK48kmAVtaWF1ZryFzFKIqTzb4bQSrM6CnSZe1Lqed+hm514vTS6mzc7d7hfSnFSETPj+53s1KYquz/07qvgUnGFxJ2l1PMvF9PLEsJpdTzLxelF7dUiSt/rxHKsy9qXU8y8Xpu2k+El1PMvF6aUaAQ1lPMcFJ1HECnpuEYZ1wDmZMy9qXU8y8ZszJ5uml1PMvF5WPEJd2wMlx3ZZzhC2YpGDO9NgMa/ndBjS6nmXi+nliWE0up5l4vTSpcfTe+lgzMval1T/9WcFEAoxpdOaQVD+US9Nj8wcpv6bYhIq5y/Z5h3IhSuZHbhRh4Mk70OX3BKsiG6pqeCb6UcxJqsU6GKk5XU8y8Xpp7MMannGZl7UuKm8A3hJ5Qzsg3UXyx3pfglDqNDLglcKMV4eTeIUoIyj5C5hFxT3a+AMqdFUb9leml1PMvGbMyebppdTzLxfCmj/2onbLxeml1PO/Qzc68XppdTzLxeml1PMvF6aXVP/1ZwUQCjGl1NZL+WB+VDZCNRkUjoPO/6wIbqSWvhYtdvvhts8hJTSZeinSuhTYK9aZgFyADpZ5z9VNNLqeZeL03bSfCS6nmXi9M7TwGtDNeF2Zfs8U0up5l4vTdtJ8JLqeZeL00wru8Jl7Uup5l4vp5YVBwSuiHDI6tl+17RePzktXOGR1bL9r2i8fVTsKtPMvF6aXU8y8XppdTzLxelUEu/xgAP7/t3Dd7q1OiJsXS+61m5wI9Ap9V+RIzUAqpFZuZ4Sxx85cKcwW4F4oAAAAABMdwl2Ok6A8xXHpMv21ZQx9LmfHpb94G5o9kTJuU/hsNPaNYfV8i1csHPGN6aTw0I+KvY911NMbJeHTg4UUp7een6XwNu4DD/xRQqk623p7r8jxbIkAfL/ect/BghJ7+Yp4ubufy0t8CaqTTOBcIcK0vjGxhox/iOkYiQ4+17ktwBNZSpwy/Jb+NDBRaDzhmYnCZCaZqt/8uIYyXlKdX8nH2nLkfbG+08XdHHRmduCsdXO5v9GLWrXbtsdPzSMAjs6UyGYX/8GP4BI1o5iVz/COXDIKc3JtgwoNrBse4N6eb5ISLQgGVTdSAjvSMnvnILyhRCcK+ZGnLbU2uZvFe1J7a7A45ublHcWVjey68voWL6TJTKyGouLjJfPt+zxScBvby3UPQs9FcRE1r6qDsCR7+c4uI6TEjOFb3KoNOM96jonboZ/m6f1EzuAl2BWVCYrUIMxX7/Jl5IVyLjgctmefx2DdBOnEoblEvx0iGBbJ0iyS5aNpvRR0FREozn6D+dp8YTVrv/0lMjy4QD64hRV93ohja1topzNGS2ufkyMYcqw1Rkycmy2vZAiSh4DJQux+3b4gbV7g8sKb7g97Oy2GYWzhSETprufTRZQQJ/3ShciOkMq23FHhYMS6sUe+P764hw53/6SmR5cFmGNWHZCded2eS4NeUMr0ZxQYqmAo8B4/xM8rxBe9QzHYpf09ibf0zY61nIe1uUBqNNF3LKRpZcOe0WhHIqUE6W9B/MPTsX3WYMr1NCSdph3l82Q+7LhwoJt4Oyr59OEMcl94Tm2d7fBmUo2KuDLZy1WvbzKt4osP42Ovv1zSfhLLcHIpxVvYOtswMAYR+AQfvicIunoRKsn7CzG1MrBN5CRDO1EeuHYpWIdhFRxbqwkK7+kx6Vmb5IQ4HdJgG282AC58N229rCSqwCfpxxF/xTAeIi3cB4rCNI+j/0GRn+ZtzscAt5ZzOUWP3GZih2x3C+0L7jBRrG5UscC71vv2n+j6NiaSIHHN85mzhUS+y6XLTFS+aEP/ZLrn76LbEMPFe7feSBfXSkJRusJ/u1n8d/Ne5S1UfsKxz9ip2fxF51LJR42pDG+Tn2ZmfUO/EDHoCmK/C52o4WPGh34+ukxFAa5ruvhQN91CyIWfBZXrbau37m9Gn6jsXY4Ukb7TclC1+7H7d0L3WGugWYRGSpZg5kATLlqILYLp8HTF/qkei/8sgAaw0kg96rHgJEoZYwIFbbuBF7q35ws208tTN3E90Z2NEHvZWUlGBB2h4QV9iM7B1rZ/XcMq2WxDQ8FF6YJ5RKBQoEmnG3OZnsJnjo2czn6Uv+59hRrY5G1p6tN1FF+zKSr+9KkGt9/87hWwJqCp8v5e6t6Xp/ye8QKGqkWwrhuNGGfl86Q2FOJRKgBxwcC3nD1yyRZVFAJ9ynGZC9Y7Q5x7ML9F2avvbjRJ6W38ful9ZWb276AzdLwhwx0pZ+iylQ6dzvTctrY514RLtaUrDekmokwOZ84/aFlSG8jUUoBx4TFBI3PswdU1iaDJOWatornN78EqJsePhrdsInt2EIG1xZBY6MNtX99zz5LSPuYhfuodkoxexbKKmeYdUidjdU1FJaXjOrs+0GUNdnJrI50OqeM2/XNNp2isieGsPZcU8wCo5PeZLfRUnmt8S/NUtKtMcruoZ9muTW0jBSUNzdwb8AkkiFgQYf/mTuDLJvPp5ccVTwPAyD1v08MpcoyddE4ElI2TQx2qjypbNcXVVJI/oxbnWKK8gQU1dw3T6uMqkoi5PRW3SUpsrFgd8C642i4okxFY8ec13lV6Y2C0PGHKUWYOWfVJY1x9f3K6gUqeN8Knw3O8YJloZGF4zH94bdrM2ty/gEWApN+9/8mD5o021/iFfzaO6e4laQaqhuhQkm0OTGQi/KYYQaw9CIjQy5WPdxu46/4r/HczKZpAqtpemXrnIqs9wxShIvrUOE2quwZJlWboEBAX3DBE2Fmi7TmOElifM8qLUa0Tw5b4F6C6t5yP/2ouEGOhILwrmH6kU7Y7VgCxNMhT8B5giStSm0ltVIAXnxMJqp93Co8FUpKhSIRx0ZoljYuUVX2QDwvyoJ94GLo4ZeIlXVbPXxwXI+KGaBJBKIsMTfUGNnnGU3JJt//m63YVseyuBfkT9ErK2w7QVE0SIBayk6ccUEkmcp2Pyt3BTS0O4uT4Ut+3C4b9jVcnWHZZ/IgGzmA4BkbyAfV2PUcdM5wtiOhxP9GpBoFiEXjs7vQhw0UHf8Ghcw6ZV1EmJmpd21d3tBeIQejuq1sTRkTWEwrQulp0efPrBZlYTnbQ7qTS2OAlQTNVn4aKDcPmeQyaPbkB8BWLDlQJk6VuVKRDATLmUeXwsYWChWr0W6WPx/rtMyl3WEJleFcXvRFI3yRiro9+Ob7bSZ7qeFBJaU8EPWWIu/AWAbxgCG5p3vp+QMnp8dqgAoZZc+shZsqh9yZmYFzTKt4VwJClLuG2wRgOcdz0MKXosoAHrzODp5h6r9GMBYIjgYUa0BakYIlNnv90QQDhvscEmWEtQEfSjdHpa2w4i/YgPK+aAvUhzdfBdGjIiXsHME14w14HR95IUDCYwUtvwstm+sf/IXnsoFYZeoI9GkiZF1j9QDgg4trJ/IbrLhBA9Q+Qtoouvp346DJhAD1MZOxN47pX/BcdRHVcG6AzJ68eUNfeV2FMGHar6U78+SfFT7ZjY1OAP+lSPedhMFb9/XXO4uZOULeXqa5jUgh3lLmFGoXjWDuZ50sYZgSJ2/AaYNT9jrUMBo9FnMU6TS8hCMX0dOBsDUVcvNS5hGyKI0mXx4RPwxmhRGIfTyemoE0NgRNpGCRdGL8+wPU7EnRecZvxLoto3sLgq2dfwvA/liZmq+zTK6Ptt/v1h5RV5dznDRu4CUgghuqjXtn8oCLjZcv6UC7/ZQ2cJe8fpedxovwZsz5ZsNIOB29ps/JU6ZTkaaDonF0RVubjB8GyzHxVr/a9iBSDW5QbD2KCEqqUaWUjM8tSLKWaW7JLyBWnHX0l8I4mRgVvuuKsNcrnAuShUxGejJX2ULaexKA/QMb9vXwjSQQKySNvTtBnDj6LetOG+HHDrPpBF0YG6i7WnMIifmN1pWTt7ibWHjTpLHXmFb/ObnZIlFIBF8p5QtkDg7/iOA+aEMq83V1Vq0aj93tSbvkpWu9iXRrIW4NmBhKtK4Vo9qqNq0DEziOSU2MhB8eNAum0YcuexN7SK9VkKiOhGW7IejYhLASB4PEAh4Jlia/VTI9KAFvYGsrxFL8xNYkNeDkSk586Az/BlwfhdCEQEhLqCys2kwkym7AQFIYKEFwAAkW8vHrStFf9qvLPkLk2UVqxCA24CrBvw0ZCJ+8zHlMlDTsVFfFucmnqUmMnvK4NAgkW2ImANK4Cy2I8OwafhdA0LkV+Bc3M1tfAO9tYNDgmHt2cYwtiH4y+eyEMWxgrAAAAOTg5gdrKMrkZr9Bibj9PXlUJXvRZxJILGu077JWaohkt5D4kNnKHXIq/GLjt6ExX6FJcMfCgzuKyNVUO04nOhJnXxbiUcgzywIxve+1xdNjaVcUwfAy+KkVlEzzoWPcrTvK/ZYGy/q/TO+uY6CECD4eyKqW7VrE5wD4bfLAyvR5h/M2Ne8anTX2OiuoqpgMY9SfE///kgnonoGHy1hlS33ZE9W7NpX+rVhwynDF/V88S+Kf6Pyl8zdmhIg5aNQegiGxrrElkOD8We7JbuHaeDX6NB1K2R05+nBHcDkS0/FFaNj1xjASjOmCNVMiux8UUz70W9o7B2XHh8xiqYzt2PJiESgF/YrK52fikncmSs1dx59nwLkbm9criWxbUL5KSgdaFblHTU0TKjumWONYEKuov0Q3l5LlvMQ6h7jJF+RaYPW5wBRzBa+hipOG9ILtRCm0NydcG057LrmbY4usXkBE+mmacioI1fnYp5ncmBQHFbTa2ZhiGJlLYYOjiEuUsEqeWwuhxBsB7v8Rm5qpx1KlppjCtefl/p3rifFX7XWM0ziwEB4LkIBBk+lLe2J1KifhPyQWZm3iTb3ThThG1QFPPM8MYAaHBq9CkGCV0goKkAAAA",alt:""})}),"\n",(0,a.jsxs)(n.p,{children:["在业务中，类似这样的需求非常多，这里我们可以使用伪类 ",(0,a.jsx)(n.code,{children:"::before"})," 或 ",(0,a.jsx)(n.code,{children:"::after"})," 去实现，减少在页面中再添加一些多余的标签。上述代码实现的逻辑是在日期的 ",(0,a.jsx)(n.code,{children:"span"})," 上加上 ",(0,a.jsx)(n.code,{children:"::after"}),"，如下所示："]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-css",children:"span:nth-of-type(1)::after {\n  content: '';\n  position: absolute;\n  top: 9px;\n  bottom: 8px;\n  right: 28px;\n  width: 1px;\n  background-color: rgba(0, 0, 0, .5);\n}\n"})}),"\n",(0,a.jsxs)(n.p,{children:["给一个空的 ",(0,a.jsx)(n.code,{children:"content"}),"，再给上 ",(0,a.jsx)(n.code,{children:"1px"})," 的宽度，颜色和上下距离可以根据需求调整。"]}),"\n",(0,a.jsxs)(n.p,{children:["苦口婆心的我再次强调，",(0,a.jsx)(n.code,{children:"flex"})," 布局的重要性，一定要把它吃透，至少在布局的时候，你可以灵活的运用横竖布局。"]}),"\n",(0,a.jsxs)(n.p,{children:["点击如期按钮，弹出底部弹窗，这里使用到了之前写好的 ",(0,a.jsx)(n.code,{children:"PopupDate"})," 组件，代码如下："]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:'const Data = () => {\n  const monthRef = useRef();\n  const [currentMonth, setCurrentMonth] = useState(dayjs().format(\'YYYY-MM\'));\n\n  // 月份弹窗开关\n  const monthShow = () => {\n    monthRef.current && monthRef.current.show();\n  };\n\n  const selectMonth = (item) => {\n    setCurrentMonth(item);\n  };\n\n  return <div className={s.data}>\n    <div className={s.total}>\n      <div className={s.time} onClick={monthShow}>\n        <span>{currentMonth}</span>\n        <Icon className={s.date} type="date" />\n      </div>\n      <div className={s.title}>共支出</div>\n      <div className={s.expense}>\xa51000</div>\n      <div className={s.income}>共收入\xa5200</div>\n    </div>\n    <PopupDate ref={monthRef} mode="month" onSelect={selectMonth} />\n  </div>\n}\n'})}),"\n",(0,a.jsxs)(n.p,{children:["给日期按钮添加 ",(0,a.jsx)(n.code,{children:"monthShow"})," 点击事件，调出 ",(0,a.jsx)(n.code,{children:"PopupDate"})," 弹窗。并且，通过 ",(0,a.jsx)(n.code,{children:"selectMonth"})," 方法，设置好选择的月份，展示于页面之上。效果如下所示："]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:r,alt:""})}),"\n",(0,a.jsxs)(n.h4,{id:"账单单项排名制作",children:["账单单项排名制作",(0,a.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#账单单项排名制作",children:"#"})]}),"\n",(0,a.jsx)(n.p,{children:"我们将账单排名部分的结构搭建出来，通过请求数据接口，将数据展示在页面上，代码如下："}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:"const Data = () => {\n  ... \n  const [totalType, setTotalType] = useState('expense'); // 收入或支出类型\n  const [totalExpense, setTotalExpense] = useState(0); // 总支出\n  const [totalIncome, setTotalIncome] = useState(0); // 总收入\n  const [expenseData, setExpenseData] = useState([]); // 支出数据\n  const [incomeData, setIncomeData] = useState([]); // 收入数据\n\n  useEffect(() => {\n    getData()\n  }, [currentMonth]);\n\n  // 获取数据详情\n  const getData = async () => {\n    const { data } = await get(`/api/bill/data?date=${currentMonth}`);\n\n    // 总收支\n    setTotalExpense(data.total_expense);\n    setTotalIncome(data.total_income);\n\n    // 过滤支出和收入\n    const expense_data = data.total_data.filter(item => item.pay_type == 1).sort((a, b) => b.number - a.number); // 过滤出账单类型为支出的项\n    const income_data = data.total_data.filter(item => item.pay_type == 2).sort((a, b) => b.number - a.number); // 过滤出账单类型为收入的项\n    setExpenseData(expense_data);\n    setIncomeData(income_data);\n  };\n\n  return <div className={s.data}>\n    ...\n    <div className={s.structure}>\n      <div className={s.head}>\n        <span className={s.title}>收支构成</span>\n        <div className={s.tab}>\n          <span onClick={() => changeTotalType('expense')} className={cx({ [s.expense]: true, [s.active]: totalType == 'expense' })}>支出</span>\n          <span onClick={() => changeTotalType('income')} className={cx({ [s.income]: true, [s.active]: totalType == 'income' })}>收入</span>\n        </div>\n      </div>\n      <div className={s.content}>\n        {\n          (totalType == 'expense' ? expenseData : incomeData).map(item => <div key={item.type_id} className={s.item}>\n            <div className={s.left}>\n              <div className={s.type}>\n                <span className={cx({ [s.expense]: totalType == 'expense', [s.income]: totalType == 'income' })}>\n                  <CustomIcon\n                    type={item.type_id ? typeMap[item.type_id].icon : 1}\n                  />\n                </span>\n                <span className={s.name}>{ item.type_name }</span>\n              </div>\n              <div className={s.progress}>\xa5{ Number(item.number).toFixed(2) || 0 }</div>\n            </div>\n            <div className={s.right}>\n              <div className={s.percent}>\n                <Progress\n                  shape=\"line\"\n                  percent={Number((item.number / Number(totalType == 'expense' ? totalExpense : totalIncome)) * 100).toFixed(2)}\n                  theme='primary'\n                />\n              </div>\n            </div>\n          </div>)\n        }\n      </div>\n    </div>\n    ...\n  </div>\n}\n"})}),"\n",(0,a.jsxs)(n.p,{children:["上述是账单排名部分的代码部分，通过 ",(0,a.jsx)(n.code,{children:"getData"})," 方法获取账单数据，接口字段分析："]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:d,alt:""})}),"\n",(0,a.jsxs)(n.p,{children:["首先我们需要传递日期参数 ",(0,a.jsx)(n.code,{children:"date"}),"，才能正常获取该月份的数据。"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"number: 账单金额。"}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"pay_type：账单类型，1 为支出，2为收入。"}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"type_id：账单种类 id。"}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"type_name：账单种类名称，如购物、交通、医疗等。"}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"并将数据进行二次处理，将「收入」和「支出」分成两个数组保存。"}),"\n",(0,a.jsxs)(n.p,{children:["通过 ",(0,a.jsx)(n.code,{children:"changeTotalType"})," 方法，切换展示「收入」或「支出」。"]}),"\n",(0,a.jsxs)(n.p,{children:["通过对 ",(0,a.jsx)(n.code,{children:"Progress"})," 组件的样式二次修改，样式代码如下："]}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:"文末已为同学们提供下本章节 demo 代码，样式部分不再详细说明。"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"将组件展示效果改成如下所示："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:i,alt:""})}),"\n",(0,a.jsxs)(n.h4,{id:"饼图制作",children:["饼图制作",(0,a.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#饼图制作",children:"#"})]}),"\n",(0,a.jsxs)(n.p,{children:["接下来我们尝试引入 ",(0,a.jsx)(n.code,{children:"Echart"}),"，我们不通过 ",(0,a.jsx)(n.code,{children:"npm"})," 引入它，我们尝试引入它的静态资源，找到根目录下的 ",(0,a.jsx)(n.code,{children:"index.html"}),"，添加如下代码："]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:'<!DOCTYPE html>\n<html lang="en">\n  <head>\n    <meta charset="UTF-8" />\n    <link rel="icon" sizes="32x32" href="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/favicons/v2/favicon-32x32.png~tplv-t2oaga2asx-image.image">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0" />\n    <title>掘掘手札</title>\n  </head>\n  <body>\n    <div id="root"></div>\n    <script src="//s.yezgea02.com/1609305532675/echarts.js"><\/script>\n    <script type="module" src="/src/main.jsx"><\/script>\n  </body>\n</html>\n'})}),"\n",(0,a.jsxs)(n.p,{children:["这种引入方式，不会将 ",(0,a.jsx)(n.code,{children:"echart"})," 打包到最终的入口脚本里。有同学会说可以按需引入，但是就算是按需引入，脚本也会变得很大，本身 ",(0,a.jsx)(n.code,{children:"echart"})," 这类可视化工具库就非常大，因为内部使用了大量绘制图形的代码。"]}),"\n",(0,a.jsxs)(n.p,{children:["完成上述操作之后，我们尝试在 ",(0,a.jsx)(n.code,{children:"/Data/index.jsx"})," 添加如下代码："]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:"let proportionChart = null; // 用于存放 echart 初始化返回的实例\n\nconst Data = () => {\n  ... \n  const [pieType, setPieType] = useState('expense'); // 饼图的「收入」和「支出」控制\n  \n  useEffect(() => {\n    getData();\n    return () => {\n      // 每次组件卸载的时候，需要释放图表实例。clear 只是将其清空不会释放。\n      proportionChart.dispose();\n    };\n  }, [currentMonth]);\n\n  // 绘制饼图方法\n  const setPieChart = (data) => {\n    if (window.echarts) {\n      // 初始化饼图，返回实例。\n      proportionChart = echarts.init(document.getElementById('proportion'));\n      proportionChart.setOption({\n          tooltip: {\n            trigger: 'item',\n            formatter: '{a} <br/>{b} : {c} ({d}%)'\n          },\n          // 图例\n          legend: {\n              data: data.map(item => item.type_name)\n          },\n          series: [\n            {\n              name: '支出',\n              type: 'pie',\n              radius: '55%',\n              data: data.map(item => {\n                return {\n                  value: item.number,\n                  name: item.type_name\n                }\n              }),\n              emphasis: {\n                itemStyle: {\n                  shadowBlur: 10,\n                  shadowOffsetX: 0,\n                  shadowColor: 'rgba(0, 0, 0, 0.5)'\n                }\n              }\n            }\n          ]\n      })\n    };\n  };\n\n  // 获取数据详情\n  const getData = async () => {\n    // ...\n    // 绘制饼图\n    setPieChart(pieType == 'expense' ? expense_data : income_data);\n  };\n\n  // 切换饼图收支类型\n  const changePieType = (type) => {\n    setPieType(type);\n    // 重绘饼图\n    setPieChart(type == 'expense' ? expenseData : incomeData);\n  }\n\n  return <div className={s.data}>\n    ... \n    <div className={s.structure}>\n      <div className={s.proportion}>\n        <div className={s.head}>\n          <span className={s.title}>收支构成</span>\n          <div className={s.tab}>\n            <span onClick={() => changePieType('expense')} className={cx({ [s.expense]: true, [s.active]: pieType == 'expense'  })}>支出</span>\n            <span onClick={() => changePieType('income')} className={cx({ [s.income]: true, [s.active]: pieType == 'income'  })}>收入</span>\n          </div>\n        </div>\n        {/* 这是用于放置饼图的 DOM 节点 */}\n        <div id=\"proportion\"></div>\n      </div>\n    </div>\n  </div>\n}\n"})}),"\n",(0,a.jsxs)(n.p,{children:["切换饼图「收入」和「支出」这里，我使用了一个小技巧，每次调用 ",(0,a.jsx)(n.code,{children:"setPieChart"})," 的时候，会将数据重新传入，此时的数据是经过 ",(0,a.jsx)(n.code,{children:"changePieType"})," 接收的参数进行筛选的，如果形参 ",(0,a.jsx)(n.code,{children:"type"})," 的值为 ",(0,a.jsx)(n.code,{children:"expense"}),"，那么给 ",(0,a.jsx)(n.code,{children:"setPieChart"})," 传的参数为 ",(0,a.jsx)(n.code,{children:"expenseData"}),"，反之则为 ",(0,a.jsx)(n.code,{children:"incomeData"}),"。"]}),"\n",(0,a.jsxs)(n.p,{children:["注意，在页面销毁前，需要将实例清除。在 ",(0,a.jsx)(n.code,{children:"useEffect"})," 内 ",(0,a.jsx)(n.code,{children:"return"})," 一个函数，该函数就是在组件销毁时执行，在函数内部执行 ",(0,a.jsx)(n.code,{children:"proportionChart.dispose();"})," 对实例进行销毁操作。"]}),"\n",(0,a.jsx)(n.p,{children:"最后，我们将头部的数据补上，如下所示："}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-html",children:"<div className={s.expense}>\xa5{ totalExpense }</div>\n<div className={s.income}>共收入\xa5{ totalIncome }</div>\n"})}),"\n",(0,a.jsx)(n.p,{children:"浏览器展示如下："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:c,alt:""})}),"\n",(0,a.jsxs)(n.h2,{id:"总结",children:["总结",(0,a.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#总结",children:"#"})]}),"\n",(0,a.jsxs)(n.p,{children:["可视化的形式还有很多，相关的可视化库有 three.js、d3.js、highchart.js等等，这些内容都值得你去深入，但是在此之前，希望同学们能明确自己希望深入那一方面的知识，进行深度学习。比如张鑫旭大神，对 ",(0,a.jsx)(n.code,{children:"CSS"})," 的研究，入骨三分，我相信业务无人出其右。所以找准方向，往前冲。"]})]})}function p(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,t.ah)(),e.components);return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(o,{...e})}):o(e)}let h=p;p.__RSPRESS_PAGE_META={},p.__RSPRESS_PAGE_META["Node%20%2B%20React%20%E5%AE%9E%E6%88%98%EF%BC%9A%E4%BB%8E%200%20%E5%88%B0%201%20%E5%AE%9E%E7%8E%B0%E8%AE%B0%E8%B4%A6%E6%9C%AC%2F19.%E5%89%8D%E7%AB%AF%E5%AE%9E%E6%88%98%EF%BC%9A%E8%B4%A6%E5%8D%95%E6%95%B0%E6%8D%AE%E7%BB%9F%E8%AE%A1%E9%A1%B5.md"]={toc:[{text:"前言",id:"前言",depth:2},{text:"知识点",id:"知识点",depth:4},{text:"正文",id:"正文",depth:2},{text:"头部筛选和数据实现",id:"头部筛选和数据实现",depth:4},{text:"账单单项排名制作",id:"账单单项排名制作",depth:4},{text:"饼图制作",id:"饼图制作",depth:4},{text:"总结",id:"总结",depth:2}],title:"19.前端实战：账单数据统计页",headingTitle:"19.前端实战：账单数据统计页",frontmatter:{}}}}]);