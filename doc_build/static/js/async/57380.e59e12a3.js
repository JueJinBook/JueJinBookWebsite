"use strict";(self.webpackChunkjue_jin_book_press=self.webpackChunkjue_jin_book_press||[]).push([["57380"],{787291:function(e,n,c){c.r(n),c.d(n,{default:()=>w});var t=c(552676),i=c(740453);let r=c.p+"static/image/51682a5d3c5cb5b36cf86660e50e2789.4b398095.webp",s=c.p+"static/image/f306a5d17bdd84e5f41708929dc00794.752b8042.webp",a=c.p+"static/image/368b5f35e665cfcd9c00fd1c774a894c.0cee3d1b.webp",d=c.p+"static/image/fe006b10880114ba4d01ae43f3fe10b0.66c241e8.webp",o=c.p+"static/image/86b190657d0aff39d3a4f2a405cc8fe6.38389c44.webp",l=c.p+"static/image/3ea5c4dde7435f730f873ecf72e01ba3.e229e37b.webp",p=c.p+"static/image/94cc434046976dd8822ef97cab1261c8.b3f2fa29.webp",x=c.p+"static/image/baab66c73ffbc5b4476ca3804714239c.85434cc0.webp",j=c.p+"static/image/13123b8079d3d91c2d3b4bc57a682bfe.0c90463b.webp",A=c.p+"static/image/1ff5b9eef67a8e68ac182c244c98c57b.c3e8ba06.webp",h=c.p+"static/image/b2249875aa4665ac6327cf86d3495dbc.d38bc481.webp",b=c.p+"static/image/0be4506e9e05fee808ecfbdbaf742897.ddd4b250.webp",m=c.p+"static/image/2ecee9450945ef9502b36ec0db220a51.53e2a21b.webp",u=c.p+"static/image/dbcf01ff00ae203b7d77b0afc78888ce.36bf3629.webp",f=c.p+"static/image/810f260b1c8bcb31318fb62aeea0c4a1.18be7840.webp",g=c.p+"static/image/f36316c95386b6bf852f9e95c007b0e7.dde800e8.webp",v=c.p+"static/image/ac0b1cb8bb458642d851b4b0f847505d.86707e92.webp",E=c.p+"static/image/fc18d5df54d367cffa0622646b3056c1.403b0d31.webp",O=c.p+"static/image/3615e4ffea767b672a21536f338b334e.dec7ce3c.webp";function S(e){let n=Object.assign({h1:"h1",a:"a",p:"p",img:"img",pre:"pre",code:"code",h2:"h2"},(0,i.ah)(),e.components);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.h1,{id:"143-nest-集成-etcd-做注册中心配置中心",children:["143. Nest 集成 Etcd 做注册中心、配置中心",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#143-nest-集成-etcd-做注册中心配置中心",children:"#"})]}),"\n",(0,t.jsx)(n.p,{children:"我们学了 etcd 来做配置中心和注册中心，它比较简单，就是 key 的 put、get、del、watch 这些。"}),"\n",(0,t.jsx)(n.p,{children:"虽然简单，它却是微服务体系必不可少的组件："}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)("img",{src:O,alt:""})}),"\n",(0,t.jsx)(n.p,{children:"服务注册、发现、配置集中管理，都是用它来做。"}),"\n",(0,t.jsx)(n.p,{children:"那 Nest 里怎么集成它呢？"}),"\n",(0,t.jsx)(n.p,{children:"其实和 Redis 差不多。"}),"\n",(0,t.jsx)(n.p,{children:"集成 Redis 的时候我们就是写了一个 provider 创建连接，然后注入到 service 里调用它的方法。"}),"\n",(0,t.jsx)(n.p,{children:"还可以像 TypeOrmModule、JwtModule 等这些，封装一个动态模块："}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)("img",{src:E,alt:""})}),"\n",(0,t.jsx)(n.p,{children:"下面我们就来写一下："}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"nest new nest-etcd\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)("img",{src:v,alt:""})}),"\n",(0,t.jsx)(n.p,{children:"进入项目，把服务跑起来："}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"npm run start:dev\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)("img",{src:g,alt:""})}),"\n",(0,t.jsx)(n.p,{children:"浏览器访问下："}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)("img",{src:"data:image/webp;base64,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",alt:""})}),"\n",(0,t.jsx)(n.p,{children:"nest 服务跑起来了。"}),"\n",(0,t.jsx)(n.p,{children:"按照上节的步骤把 etcd 服务跑起来："}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)("img",{src:f,alt:""})}),"\n",(0,t.jsx)(n.p,{children:"然后我们加一个 etcd 的 provider："}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)("img",{src:u,alt:""})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"import { Module } from '@nestjs/common';\nimport { AppController } from './app.controller';\nimport { AppService } from './app.service';\nimport { Etcd3 } from 'etcd3';\n\n@Module({\n  imports: [],\n  controllers: [AppController],\n  providers: [\n    AppService,\n    {\n      provide: 'ETCD_CLIENT',\n      useFactory() {\n        const client = new Etcd3({\n            hosts: 'http://localhost:2379',\n            auth: {\n                username: 'root',\n                password: 'guang'\n            }\n        });\n        return client;\n      }\n    }\n  ],\n})\nexport class AppModule {}\n\n"})}),"\n",(0,t.jsx)(n.p,{children:"在 AppController 里注入下："}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)("img",{src:m,alt:""})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"import { Controller, Get, Inject, Query } from '@nestjs/common';\nimport { AppService } from './app.service';\nimport { Etcd3 } from 'etcd3';\n\n@Controller()\nexport class AppController {\n  constructor(private readonly appService: AppService) {}\n\n  @Get()\n  getHello(): string {\n    return this.appService.getHello();\n  }\n\n  @Inject('ETCD_CLIENT')\n  private etcdClient: Etcd3;\n\n  @Get('put')\n  async put(@Query('value') value: string) {\n    await this.etcdClient.put('aaa').value(value);\n    return 'done';\n  }\n\n  @Get('get')\n  async get() {\n    return await this.etcdClient.get('aaa').string();\n  }\n\n  @Get('del')\n  async del() {\n    await this.etcdClient.delete().key('aaa');\n    return 'done';\n  }\n}\n"})}),"\n",(0,t.jsx)(n.p,{children:"测试下："}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)("img",{src:b,alt:""})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)("img",{src:"data:image/webp;base64,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",alt:""})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)("img",{src:"data:image/webp;base64,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",alt:""})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)("img",{src:"data:image/webp;base64,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",alt:""})}),"\n",(0,t.jsx)(n.p,{children:"这样 etcd 就集成好了，很简单。"}),"\n",(0,t.jsx)(n.p,{children:"然后我们封装一个动态模块。"}),"\n",(0,t.jsx)(n.p,{children:"创建一个 module 和 service："}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"nest g module etcd\nnest g service etcd\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)("img",{src:h,alt:""})}),"\n",(0,t.jsx)(n.p,{children:"在 EtcdModule 添加 etcd 的 provider："}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"import { Module } from '@nestjs/common';\nimport { EtcdService } from './etcd.service';\nimport { Etcd3 } from 'etcd3';\n\n@Module({\n  providers: [\n    EtcdService,\n    {\n      provide: 'ETCD_CLIENT',\n      useFactory() {\n        const client = new Etcd3({\n            hosts: 'http://localhost:2379',\n            auth: {\n                username: 'root',\n                password: 'guang'\n            }\n        });\n        return client;\n      }\n    }\n  ],\n  exports: [\n    EtcdService\n  ]\n})\nexport class EtcdModule {}\n"})}),"\n",(0,t.jsx)(n.p,{children:"然后在 EtcdService 添加一些方法："}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"import { Inject, Injectable } from '@nestjs/common';\nimport { Etcd3 } from 'etcd3';\n\n@Injectable()\nexport class EtcdService {\n\n    @Inject('ETCD_CLIENT')\n    private client: Etcd3;\n\n    // 保存配置\n    async saveConfig(key, value) {\n        await this.client.put(key).value(value);\n    }\n\n    // 读取配置\n    async getConfig(key) {\n        return await this.client.get(key).string();\n    }\n\n    // 删除配置\n    async deleteConfig(key) {\n        await this.client.delete().key(key);\n    }\n   \n    // 服务注册\n    async registerService(serviceName, instanceId, metadata) {\n        const key = `/services/${serviceName}/${instanceId}`;\n        const lease = this.client.lease(10);\n        await lease.put(key).value(JSON.stringify(metadata));\n        lease.on('lost', async () => {\n            console.log('租约过期，重新注册...');\n            await this.registerService(serviceName, instanceId, metadata);\n        });\n    }\n\n    // 服务发现\n    async discoverService(serviceName) {\n        const instances = await this.client.getAll().prefix(`/services/${serviceName}`).strings();\n        return Object.entries(instances).map(([key, value]) => JSON.parse(value));\n    }\n\n    // 监听服务变更\n    async watchService(serviceName, callback) {\n        const watcher = await this.client.watch().prefix(`/services/${serviceName}`).create();\n        watcher.on('put', async event => {\n            console.log('新的服务节点添加:', event.key.toString());\n            callback(await this.discoverService(serviceName));\n        }).on('delete', async event => {\n            console.log('服务节点删除:', event.key.toString());\n            callback(await this.discoverService(serviceName));\n        });\n    }\n\n}\n"})}),"\n",(0,t.jsx)(n.p,{children:"配置的管理、服务注册、服务发现、服务变更的监听，这些我们都写过一遍，就不细讲了。"}),"\n",(0,t.jsx)(n.p,{children:"然后再创建个模块，引入它试一下："}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"nest g resource aaa\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)("img",{src:A,alt:""})}),"\n",(0,t.jsx)(n.p,{children:"引入 EtcdModule："}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)("img",{src:j,alt:""})}),"\n",(0,t.jsx)(n.p,{children:"然后在 AaaController 注入 EtcdService，添加两个 handler："}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)("img",{src:x,alt:""})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"@Inject(EtcdService)\nprivate etcdService: EtcdService;\n\n@Get('save')\nasync saveConfig(@Query('value') value: string) {\n    await this.etcdService.saveConfig('aaa', value);\n    return 'done';\n}\n\n@Get('get')\nasync getConfig() {\n    return await this.etcdService.getConfig('aaa');\n}\n"})}),"\n",(0,t.jsx)(n.p,{children:"测试下："}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)("img",{src:p,alt:""})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)("img",{src:"data:image/webp;base64,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",alt:""})}),"\n",(0,t.jsx)(n.p,{children:"没啥问题。"}),"\n",(0,t.jsx)(n.p,{children:"不过现在 EtcdModule 是普通的模块，我们改成动态模块："}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"import { DynamicModule, Module, ModuleMetadata, Type } from '@nestjs/common';\nimport { EtcdService } from './etcd.service';\nimport { Etcd3, IOptions } from 'etcd3';\n\nexport const ETCD_CLIENT_TOKEN = 'ETCD_CLIENT';\n\nexport const ETCD_CLIENT_OPTIONS_TOKEN = 'ETCD_CLIENT_OPTIONS';\n\n@Module({})\nexport class EtcdModule {\n\n  static forRoot(options?: IOptions): DynamicModule {\n    return {\n      module: EtcdModule,\n      providers: [\n        EtcdService,\n        {\n          provide: ETCD_CLIENT_TOKEN,\n          useFactory(options: IOptions) {\n            const client = new Etcd3(options);\n            return client;\n          },\n          inject: [ETCD_CLIENT_OPTIONS_TOKEN]\n        },\n        {\n          provide: ETCD_CLIENT_OPTIONS_TOKEN,\n          useValue: options\n        }\n      ],\n      exports: [\n        EtcdService\n      ]\n    };\n  }\n}\n"})}),"\n",(0,t.jsx)(n.p,{children:"把 EtcdModule 改成动态模块的方式，加一个 forRoot 方法。"}),"\n",(0,t.jsx)(n.p,{children:"把传入的 options 作为一个 provider，然后再创建 etcd client 作为一个 provider。"}),"\n",(0,t.jsx)(n.p,{children:"然后 AaaModule 引入 EtcdModule 的方式也改下："}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)("img",{src:l,alt:""})}),"\n",(0,t.jsx)(n.p,{children:"用起来是一样的："}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)("img",{src:"data:image/webp;base64,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",alt:""})}),"\n",(0,t.jsx)(n.p,{children:"但是现在 etcd 的参数是动态传入的了，这就是动态模块的好处。"}),"\n",(0,t.jsx)(n.p,{children:"当然，一般动态模块都有 forRootAsync，我们也加一下："}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)("img",{src:o,alt:""})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)("img",{src:d,alt:""})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"export interface EtcdModuleAsyncOptions  {\n  useFactory?: (...args: any[]) => Promise<IOptions> | IOptions;\n  inject?: any[];\n}\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"static forRootAsync(options: EtcdModuleAsyncOptions): DynamicModule {\n    return {\n      module: EtcdModule,\n      providers: [\n        EtcdService,\n        {\n          provide: ETCD_CLIENT_TOKEN,\n          useFactory(options: IOptions) {\n            const client = new Etcd3(options);\n            return client;\n          },\n          inject: [ETCD_CLIENT_OPTIONS_TOKEN]\n        },\n        {\n          provide: ETCD_CLIENT_OPTIONS_TOKEN,\n          useFactory: options.useFactory,\n          inject: options.inject || []\n        }\n      ],\n      exports: [\n        EtcdService\n      ]\n    };\n}\n"})}),"\n",(0,t.jsx)(n.p,{children:"和 forRoot 的区别就是现在的 options 的 provider 是通过 useFactory 的方式创建的，之前是直接传入。"}),"\n",(0,t.jsx)(n.p,{children:"现在就可以这样传入 options 了："}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)("img",{src:a,alt:""})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"EtcdModule.forRootAsync({\n  async useFactory() {\n      await 111;\n      return {\n          hosts: 'http://localhost:2379',\n          auth: {\n              username: 'root',\n              password: 'guang'\n          }\n      }\n  }\n})\n"})}),"\n",(0,t.jsx)(n.p,{children:"我们安装下 config 的包"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"npm install @nestjs/config\n"})}),"\n",(0,t.jsx)(n.p,{children:"在 AppModule 引入 ConfigModule："}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)("img",{src:s,alt:""})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"ConfigModule.forRoot({\n  isGlobal: true,\n  envFilePath: 'src/.env'\n})\n"})}),"\n",(0,t.jsx)(n.p,{children:"添加对应的 src/.env"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-env",children:"etcd_hosts=http://localhost:2379\netcd_auth_username=root\netcd_auth_password=guang\n"})}),"\n",(0,t.jsx)(n.p,{children:"然后在引入 EtcdModule 的时候，从 ConfigService 拿配置："}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)("img",{src:r,alt:""})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"EtcdModule.forRootAsync({\n  async useFactory(configService: ConfigService) {\n      await 111;\n      return {\n          hosts: configService.get('etcd_hosts'),\n          auth: {\n              username: configService.get('etcd_auth_username'),\n              password: configService.get('etcd_auth_password')\n          }\n      }\n  },\n  inject: [ConfigService]\n})\n"})}),"\n",(0,t.jsx)(n.p,{children:"测试下："}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)("img",{src:"data:image/webp;base64,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",alt:""})}),"\n",(0,t.jsx)(n.p,{children:"功能正常。"}),"\n",(0,t.jsx)(n.p,{children:"这样，EtcdModule.forRootAsync 就成功实现了。"}),"\n",(0,t.jsxs)(n.p,{children:["案例代码上传了",(0,t.jsx)(n.a,{href:"https://github.com/QuarkGluonPlasma/nestjs-course-code/tree/main/nest-etcd",target:"_blank",rel:"noopener noreferrer",children:"小册仓库"}),"。"]}),"\n",(0,t.jsxs)(n.h2,{id:"总结",children:["总结",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#总结",children:"#"})]}),"\n",(0,t.jsx)(n.p,{children:"这节我们做了 Nest 和 etcd 的集成。"}),"\n",(0,t.jsx)(n.p,{children:"或者加一个 provider 创建连接，然后直接注入 etcdClient 来 put、get、del、watch。"}),"\n",(0,t.jsx)(n.p,{children:"或者再做一步，封装一个动态模块来用，用的时候再传入连接配置"}),"\n",(0,t.jsx)(n.p,{children:"和集成 Redis 的时候差不多。"}),"\n",(0,t.jsx)(n.p,{children:"注册中心和配置中心是微服务体系必不可少的组件，后面会大量用到。"})]})}function T(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,i.ah)(),e.components);return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(S,{...e})}):S(e)}let w=T;T.__RSPRESS_PAGE_META={},T.__RSPRESS_PAGE_META["Nest%20%E9%80%9A%E5%85%B3%E7%A7%98%E7%B1%8D%20%20%E6%9C%80%E6%96%B0200%E7%AB%A0%2F143.%20Nest%20%E9%9B%86%E6%88%90%20Etcd%20%E5%81%9A%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E3%80%81%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83.md"]={toc:[{text:"总结",id:"总结",depth:2}],title:"143. Nest 集成 Etcd 做注册中心、配置中心",headingTitle:"143. Nest 集成 Etcd 做注册中心、配置中心",frontmatter:{}}}}]);