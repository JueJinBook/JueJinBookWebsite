"use strict";(self.webpackChunkjue_jin_book_press=self.webpackChunkjue_jin_book_press||[]).push([["22366"],{576989:function(n,e,d){d.r(e),d.d(e,{default:()=>A});var s=d(552676),a=d(740453);let r=d.p+"static/image/45275444bb9e880dd57e9b45a0e78f0f.819e704c.webp",i=d.p+"static/image/7babdc0c52d3474015f46faf29d56096.1ba30046.webp",p=d.p+"static/image/fba4421e6f110c38d98bd5b8ca2d62d1.7d56efc9.webp",t=d.p+"static/image/ddffe05d549e8ab07e1f4fee39da26b2.2200bf91.webp";function l(n){let e=Object.assign({h1:"h1",a:"a",p:"p",code:"code",h2:"h2",blockquote:"blockquote",h3:"h3",h4:"h4",pre:"pre",img:"img",ul:"ul",li:"li"},(0,a.ah)(),n.components);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(e.h1,{id:"28深入研究-----使用立方体纹理绘制天空盒",children:["28.深入研究 --- 使用立方体纹理绘制天空盒",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#28深入研究-----使用立方体纹理绘制天空盒",children:"#"})]}),"\n",(0,s.jsxs)(e.p,{children:["在初级进阶课程，我们学习了纹理的绘制方法，不过那节我们只学习了如何使用",(0,s.jsx)(e.code,{children:"2D纹理"}),"进行贴图。事实上，WebGL 还支持将多个 2D 纹理组合成一个单一纹理，然后采用该单一纹理进行贴图，这种纹理称为立方体纹理",(0,s.jsx)(e.code,{children:"CubeMap"}),"，本节我们学习如何使用立方体纹理进行贴图。"]}),"\n",(0,s.jsxs)(e.h2,{id:"采样原理",children:["采样原理",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#采样原理",children:"#"})]}),"\n",(0,s.jsx)(e.p,{children:"在讲解贴图方法之前，我们简单了解一下立方体纹理的采样原理。立方体纹理实质上由 6 个 2D 纹理组成，这 6 个2D 纹理对应立方体的每个面，立方体纹理可以理解为 6 个面都是图像的立方体。"}),"\n",(0,s.jsx)(e.p,{children:"那如何对立方体纹理进行采样呢？首先，立方体纹理对应的 6 个图像资源宽度和高度要相等。其次，使用一束从立方体中心位置发出的方向向量进行采样，方向向量就是我们传递给 GPU 的纹理坐标，该向量和立方体交点处的图像像素就是我们需要的采样值。"}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsx)(e.p,{children:"当模型是单位为 1 的立方体时，模型的顶点坐标即立方体纹理坐标。"}),"\n"]}),"\n",(0,s.jsxs)(e.h2,{id:"贴图过程",children:["贴图过程",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#贴图过程",children:"#"})]}),"\n",(0,s.jsx)(e.p,{children:"立方体纹理的贴图过程和之前的 2D 纹理贴图有所区别，接下来我们演示一下。"}),"\n",(0,s.jsxs)(e.h3,{id:"着色器",children:["着色器",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#着色器",children:"#"})]}),"\n",(0,s.jsx)(e.p,{children:"因为是纹理操作，所以着色器部分需要增加纹理坐标和纹理资源。"}),"\n",(0,s.jsxs)(e.h4,{id:"顶点着色器",children:["顶点着色器",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#顶点着色器",children:"#"})]}),"\n",(0,s.jsx)(e.p,{children:"顶点着色器需要增加纹理坐标，立方体纹理的一个优点就是纹理坐标采用原始坐标值就可以。"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-glsl",children:"precision mediump float;\n// 接收顶点坐标 (x, y, z)\nattribute vec3 a_Position;\nuniform mat4 u_Matrix;\nvarying vec3 textCoord;\nvoid main(){\n    gl_Position = u_Matrix * vec4(a_Position,1);\n    // 将顶点原始坐标赋值给纹理坐标。\n    textCoord = a_Position;\n}\n"})}),"\n",(0,s.jsxs)(e.h4,{id:"片元着色器",children:["片元着色器",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#片元着色器",children:"#"})]}),"\n",(0,s.jsx)(e.p,{children:"片元着色器部分也比较简单，将立方体纹理上纹理坐标对应的颜色信息赋值给 gl_FragColor 作为像素颜色。"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-glsl",children:"precision mediump float;\n//接收纹理坐标坐标 (x, y, z)\nvarying vec3 textCoord;\n//samplerCube变量，用来接收立方体纹理。\nuniform samplerCube u_Skybox;\n\nvoid main()\n{\n    gl_FragColor = textureCube(u_Skybox, textCoord);\n}\n"})}),"\n",(0,s.jsxs)(e.h3,{id:"加载资源",children:["加载资源",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#加载资源",children:"#"})]}),"\n",(0,s.jsx)(e.p,{children:"和 2D 纹理一样，在使用纹理之前，我们还是要先把资源加载到内存中，由于立方体纹理需要 6 个图像，所以我们需要定义一个图像资源加载器，它包含一个资源列表和加载完成后的回调事件。"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-javascript",children:"function loadImages(imgList, callback){\n    let i = 0;\n    function ready (){\n        if(i >= resourceList.length){\n            callback();\n            return;\n        }\n        i++;\n    }\n    for(let i =0;i<resourceList.length;i++){\n        let img = new Image();\n        img.onload = ready;\n        img.src= resourceList[i];\n    }\n    \n}\n"})}),"\n",(0,s.jsx)(e.p,{children:"有了加载器，我们将需要的六张图片加载到内存中。"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-javascript",children:"loadImages(['right.png','left.png','top.png','down.png','back.png','front.png'], renderSkyBox);\n"})}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsx)(e.p,{children:"renderSkyBox是图片加载完成后执行的回调，也就是下面的绘制过程。"}),"\n"]}),"\n",(0,s.jsxs)(e.h3,{id:"纹理操作",children:["纹理操作",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#纹理操作",children:"#"})]}),"\n",(0,s.jsx)(e.p,{children:"图片资源加载到内存之后，我们就可以对纹理进行操作了。"}),"\n",(0,s.jsx)(e.p,{children:"1、创建纹理对象，并激活 0 号纹理单元。"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-javascript",children:"//1、创建纹理对象\nlet texture = gl.createTexture();\n//2、激活0号纹理单元\ngl.activeTexture(gl.TEXTURE0);\n//3、将 0 号纹理单元传入 GPU。\ngl.uniform1i(u_Skybox, 0);\n//4、当创建的纹理对象texture绑定到立方体纹理上\ngl.bindTexture(gl.TEXTURE_CUBE_MAP, texture);\n"})}),"\n",(0,s.jsx)(e.p,{children:"2、将 6 个面对应的纹理图像传到 GPU"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-javascript",children:"gl.texImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X, 0, gl.RGB, gl.RGB, gl.UNSIGNED_BYTE, document.getElementById('sky0'));\ngl.texImage2D(gl.TEXTURE_CUBE_MAP_NEGATIVE_X, 0, gl.RGB, gl.RGB, gl.UNSIGNED_BYTE, document.getElementById('sky1'));\ngl.texImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_Y, 0, gl.RGB, gl.RGB, gl.UNSIGNED_BYTE, document.getElementById('sky2'));\ngl.texImage2D(gl.TEXTURE_CUBE_MAP_NEGATIVE_Y, 0, gl.RGB, gl.RGB, gl.UNSIGNED_BYTE, document.getElementById('sky3'));\ngl.texImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_Z, 0, gl.RGB, gl.RGB, gl.UNSIGNED_BYTE, document.getElementById('sky4'));\ngl.texImage2D(gl.TEXTURE_CUBE_MAP_NEGATIVE_Z, 0, gl.RGB, gl.RGB, gl.UNSIGNED_BYTE, document.getElementById('sky5')); \n"})}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsxs)(e.p,{children:["这里要注意一点，sky4是背面图像，sky 5 是正面图像，我们需要将背面图像传递给正面纹理 ",(0,s.jsx)(e.code,{children:"TEXTURE_CUBE_MAP_POSITIVE_Z"})," ，将正面图像传递给背面纹理",(0,s.jsx)(e.code,{children:"TEXTURE_CUBE_MAP_NEGATIVE_Z"}),"。"]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"3、设置图片放大缩小时的过滤参数，此处我们设置为就近取值。"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-javascript",children:"gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\ngl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n"})}),"\n",(0,s.jsx)(e.p,{children:"4、设置当纹理坐标没有落在任何一个面上，而是落在两个面之间时的纹理采样，使用gl.CLAMP_TO_EDGE 表示采用边缘的纹理像素。"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-javascript",children:"gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\ngl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n"})}),"\n",(0,s.jsx)(e.p,{children:"至此，纹理部分的操作就完成了，接下来我们要创建一个立方体代表天空盒，将图像贴在立方体的各个面上。"}),"\n",(0,s.jsxs)(e.h3,{id:"创建天空盒",children:["创建天空盒",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#创建天空盒",children:"#"})]}),"\n",(0,s.jsx)(e.p,{children:"我们先从立方体外部看一下立方体纹理的渲染效果，然后将摄像机放到立方体内部，讲解天空盒的实现方式。"}),"\n",(0,s.jsxs)(e.h4,{id:"在外部观察天空盒",children:["在外部观察天空盒",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#在外部观察天空盒",children:"#"})]}),"\n",(0,s.jsx)(e.p,{children:"1、创建一个边长为 500 的立方体，并将立方体转化成无索引形式。"}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsx)(e.p,{children:"边长长度没有限制，只要保证摄像机位置在立方体内部即可。"}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-javascript",children:"//索引立方体\nlet cube = createCube(500, 500, 500);\n//无索引立方体\ncube = transformIndicesToUnIndices(cube);\n// 创建顶点缓冲对象。\nlet bufferInfo = createBufferInfoFromObject(gl, cube);\n\n// 创建渲染对象\nlet object = new Model('sky');\nobject.setBufferInfo(bufferInfo);\nobjectList.add(object);\nrenderList.add({\n    programInfo: program,\n    model: object,\n    primitive: 'TRIANGLES',\n    renderType: 'drawArrays'\n});\n\n"})}),"\n",(0,s.jsx)(e.p,{children:"2、创建摄像机"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-javascript",children:"let cameraPosition = new Vector3(0, 0, 600);\nlet target = new Vector3(0, 0, -1);\nlet up = new Vector3(0, 1, 0);\nlet cameraMatrix = matrix.lookAt(cameraPosition, target, up);\n// 从相机矩阵取逆获取视图矩阵。\nlet viewMatrix = matrix.inverse(cameraMatrix);\n"})}),"\n",(0,s.jsx)(e.p,{children:"3、创建视图投影矩阵，近平面20，远平面 900。"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-javascript",children:"let projectionMatrix = matrix.perspective(\n    fieldOfViewRadians,\n    window.innerWidth / window.innerHeight,\n    20,\n    900\n);\n"})}),"\n",(0,s.jsx)(e.p,{children:"4、设置 MVP 矩阵，执行渲染操作。"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-javascript",children:"object.uniforms.u_Matrix = matrix.multiply(projectionMatrix, viewMatrix);\n\nrenderList.forEach(function(object){\n    ...略\n})\n"})}),"\n",(0,s.jsx)(e.p,{children:"以上就是主要代码，我们看下贴图效果："}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)("img",{src:"data:image/webp;base64,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",alt:""})}),"\n",(0,s.jsx)(e.p,{children:"可以看到， 6 张图像都能正确的贴到对应的面上。接下来，我们将摄像机位置逐步放到立方体内部，看看呈现给我们的是什么。"}),"\n",(0,s.jsxs)(e.h4,{id:"在立方体内部观察",children:["在立方体内部观察。",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#在立方体内部观察",children:"#"})]}),"\n",(0,s.jsxs)(e.p,{children:["在立方体内部观察时，呈现在我们面前的是天空盒的背面，但是由于背面剔除机制，我们是看不到背面的，所以这时候，我们要将背面剔除方式改成",(0,s.jsx)(e.code,{children:"正面剔除"}),"："]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"gl.cullFace(gl.FRONT);\n"})}),"\n",(0,s.jsx)(e.p,{children:"上面的摄像机坐标是在Z轴正向 600 单位距离处，接下来我们将摄像机慢慢靠近立方体，当到达立方体中心后停止，我们看下这个过程。"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)("img",{src:"data:image/webp;base64,UklGRpgCAABXRUJQVlA4IIwCAABQSwCdASqZA2EBPp1OpE4lpCOiIAgAsBOJaW7hd2EbQAeiAV3LxcnIe+2TkPfbJyHvtk5D32ych77ZOQ99snIe+2TkPfbJyHvtk5D32ych77ZOQ99snIe+2TkPfbJyHvtk5D32ych77ZOQ99snIe+2TkPfbJyHvtk5D32ych77ZOQ99snIe+2TkPfbJyHvtk5D32ych77ZOQ99snIe+2TkPfbJyHvtk5D32ych77ZOQ99snIe+2TkPfbJyHvtk5D32ych77ZOQ99snIe+2TkPfbJyHvtk5D32ych77ZOQ99snIe+2TkPfbJyHvtk5D32ych77ZOQ99snIe+2TkPfbJyHvtk5D32ych77ZOQ99snIe+2TkPfbJyHvtk5D32ych77ZOQ99snIe+2TkPfbJyHvtk5D32ych77ZOQ99snIe+2TkPfbJyHvtk5D32ych77ZOQ99snIe+2TkPfbJyHvtk5D32ych77ZOQ99snIe+2TkPfbJyHvtk5D32ych77ZOQ99snIe+2TkPfbJyHvtk5D32ych77ZOQ99snIe+2TkPfbJyHvtk5D32ych77ZOQ99snIe+2TkPfbJyHvtk5D32ych77ZOQ99snIe+2TkPfbJyHvtk5D32ych77ZOQ99snIe+2TkPfbJyHvtk5D32ych77ZOQ99snIe+2TkPfbJyHvtk5D32ych77ZOQ99snIe+2TkPfbJyHvtk5D32ych77ZOQ99snIe+2TkPfbJyHvtk5D32ych77ZOQ99snIe+2TkPfbJyHvtk5D32ych77ZOQ99snIe+2TkPfbJyHvtk4/gAD++2UAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",alt:""})}),"\n",(0,s.jsx)(e.p,{children:"可以看到，在内部观察时，会发现图像渲染是左右相反的，我们要修改一下顶点着色器，将纹理坐标的X值取反。"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-javascript",children:"textCoord = vec3(-a_Position.x, a_Postion.y, a_Position.z);\n"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)("img",{src:"data:image/webp;base64,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",alt:""})}),"\n",(0,s.jsx)(e.p,{children:"这次大家会发现，在外面观察立方体时图像左右相反了，内部观察时正常了。我们这次做天空盒，就要在立方体内部观察，只要内部观察正常就可以。"}),"\n",(0,s.jsx)(e.p,{children:"我们将视线水平旋转进行观察。"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-javascript",children:"target.x = Math.cos(deg2radians(uniforms.xRotation)) * Math.cos(deg2radians(uniforms.yRotation));\ntarget.y = Math.sin(deg2radians(uniforms.xRotation));\ntarget.z = Math.cos(deg2radians(uniforms.xRotation)) * Math.sin(deg2radians(uniforms.yRotation));\ntarget.normalize();\n// 重新计算视图矩阵\n\ncameraMatrix = matrix.lookAt(cameraPosition, target, up);\nviewMatrix = matrix.inverse(cameraMatrix);\n"})}),"\n",(0,s.jsx)(e.p,{children:"效果如下："}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)("img",{src:"data:image/webp;base64,UklGRnYPAABXRUJQVlA4IGoPAADwwwCdASraBAoCPp1Ook4lpSMiIDqoQLATiWlu4XdhG/Ol8YdcP9a/KPzf/CfmP7t+XvJO5r8yP4/9m/uv9h/cv1P/2Hgv7+NQL8h/mf+D8O/ZHZR/ZP1C9gL1r+hf77wnf5n0K+oP+p9wD+Sf0L/R+sf+L/uni7eAewB/IP6z/s/8B+RH0x/xv/r/xvnl/MP7x/zP818BX8z/q//R/xHab9LECaIBXdr6e41Eq801nTp06dOnTp06dOnTp06dN91tOfmFF5Xsq6125jMHRxfn5vGRYYZexuQqRgURtSN2QKrtx4tMrxo4/6xv8tsFKSm+QbRpNfP7Jq1a8Q0BlhSH+lsNJ7ogmq/YMloDLCnaek93fzerBqJV5prOnTp06dOnTp06dOnTp06dOnTp06OL0tQWO2mKoK9PAsRIf7G8gXdFxsJQGWFGDEWhxoDzXG00BlhRSRHtTI1nTp06dOnTp06dOnTp06dOnTp06dOnTpvsE/Y30Fj3H275y8oD9eZhFWNfCv5Iux5lMRO5DS2UEovi0Pehj1Og4Iz2vT0TppfVmL3ELcQ24hf7LCji3pyboPsl0oYDaX+ywo2UMxjOOae41Eq801nTp06dOnTp06dOnTp06dOnTpvl7L8LKCjHHsZY4WSJD/YrkC7ouNhH+ywowXklnlkQxCFO1oDKYCAi0oec09xqJV5prOnTp06dOnTp06dOnTp06dN9ec11AAuvJ3qai24SkJetCQ7/hU4uxQWSAiCo7OErDXzhhzgdMv1iCfo6KDjRn6dC25ITQPkqFO0oL7QJ72XP2W6iFbX+ywp2lLD1UBw85p7jUSrzTWdOnTp06dOnTp06dOnTp06dSbNRQbnuPjFXmms6dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dOnTp06dHAAP77vgAF0/OYkSwZCG99+Ss9ZuNzfYc9res3acqTbF08a3d2VN/dAEgUUVo0w5Pqr1dPQnZj97x46SRajbb3zLCa0qP80haoz3hDzVG9DFR85q3j52dBJTV6kY9TioNPmfNZJHvMoj1VHK4KPJ+OraqFzyiAks15Vjj/k9nvlTVCBE42BYXtkX7WKCmwoVEOjypa8LP6zWzLnvHdv/tN3MwhIi+5OwnMec9WP7YQBXm2z+fYPkWEU+fyZjK49dEvM9MVl2N+ou3LiFea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",alt:""})}),"\n",(0,s.jsx)(e.p,{children:"以上天空盒的实现方式，我们用稍微真实一些的图片演示一下："}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)("img",{src:t,alt:""})}),"\n",(0,s.jsxs)(e.h2,{id:"渲染时机",children:["渲染时机",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#渲染时机",children:"#"})]}),"\n",(0,s.jsx)(e.p,{children:"上面的例子中，我们只绘制了天空盒，没有绘制其他物体，实际应用中往往还有其他物体存在。当然，我们不能够让物体阻挡天空盒的渲染。"}),"\n",(0,s.jsx)(e.p,{children:"在上面的例子里，我们增加一个箱子，该箱子是长宽高均为 20 的立方体，上面的天空盒是长宽高为 500 的立方体，很明显，箱子在天空盒内部。"}),"\n",(0,s.jsx)(e.p,{children:"同时，我们的摄像机在坐标系原点位置，所以为了能够看到箱子，我们需要将箱子往后移至少 10 个单位长度，这里我们将它往后移动 100 个单位"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-javascript",children:"let boxCube = createCube(20, 20, 20);\nlet boxBuffer = createBufferInfoFromObject(gl, boxCube);\n...略\n\nlet box = new Model('box');\nbox.setBufferInfo(boxBuffer);\nbox.translateZ(-100);\n"})}),"\n",(0,s.jsx)(e.p,{children:"此时包围盒和箱子的状态应该是这样的："}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)("img",{src:p,alt:""})}),"\n",(0,s.jsx)(e.p,{children:"我们看下效果："}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)("img",{src:i,alt:""})}),"\n",(0,s.jsx)(e.p,{children:"盒子显示在了天空盒前面，但是有一点不正常，就是我们看不到盒子的正面了。原因是什么呢？"}),"\n",(0,s.jsx)(e.p,{children:"在绘制天空盒的时候，摄像机在盒子内部，所以需要看到盒子背面，而箱子在摄像机外部，正常情况要能够看到盒子正面，所以在绘制箱子时，我们要把背面剔除方式改回背面剔除："}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-javascript",children:"gl.cullFace(gl.BACK);\n"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)("img",{src:r,alt:""})}),"\n",(0,s.jsx)(e.p,{children:"这回正常了。"}),"\n",(0,s.jsx)(e.p,{children:"有时候，天空盒经过视图投影矩阵作用之后，不一定在场景的最后面（也就是 Z 值坐标不是 1.0），所以，在天空盒后面的物体我们就看不到了。针对这个问题，一般采取的做法是修改顶点着色器，将天空盒的 Z 值强制改为 1.0，即在裁剪坐标系的最后面。"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-glsl",children:"gl_Position = (u_Matrix * a_Position).xyww;\n"})}),"\n",(0,s.jsx)(e.p,{children:"w/w = 1.0。所以经过裁剪变换后，gl_Position 的Z 值坐标始终会是 1.0。"}),"\n",(0,s.jsx)(e.p,{children:"那么，即便如此，也会有一些物体的 Z 值也是 1.0，同样是 1.0 的物体，哪个物体显示是根据绘制顺序决定的，因为深度测试函数默认是 gl.LESS，即当前片元的深度值要小于之前的深度值，才算测试通过，也就是能被渲染。所以，深度值是 1.0 的多个物体，哪个物体最先绘制，就渲染哪个物体。当然，我们可以改变深度测试函数。"}),"\n",(0,s.jsx)(e.p,{children:"针对种种规则，我们约定一个绘制顺序。"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"首先绘制物体（不包括天空盒）。"}),"\n",(0,s.jsxs)(e.li,{children:["最后绘制天空盒，将天空盒的深度值和当前物体的深度值进行比较，如果通过深度测试就绘制天空盒。默认情况下，深度缓存为 1.0 表示深度最大，即在场景最后面。为了让天空盒能够通过深度测试，我们改变默认的深度测试函数，将",(0,s.jsx)(e.code,{children:"gl.LESS"}),"改为",(0,s.jsx)(e.code,{children:"gl.LEQUAL"}),"，如下："]}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-javascript",children:"gl.depthFunc(gl.LEQUAL)\n"})}),"\n",(0,s.jsxs)(e.h2,{id:"天空盒的应用",children:["天空盒的应用",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#天空盒的应用",children:"#"})]}),"\n",(0,s.jsx)(e.p,{children:"在实时场景渲染中，如果我们想要绘制非常远的物体，比如远山、天空等，当观察者往前或者往后移动时，远山、天空的大小是几乎没什么变化的。假如很远的地方有一座山，即使我们往前走进十米、百米，这座山在视野中的大小也是几乎没什么变化的，这个时候我们可以采用天空盒技术来实现。"}),"\n",(0,s.jsx)(e.p,{children:"又或者一些房屋装修、汽车内饰等只是为了展示环境的场景，这时也可以考虑采用天空盒技术。"}),"\n",(0,s.jsxs)(e.h2,{id:"回顾",children:["回顾",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#回顾",children:"#"})]}),"\n",(0,s.jsxs)(e.p,{children:["本节讲述了立方体纹理的贴图过程以及天空盒的开发方式，涉及了前面的一些知识点，诸如",(0,s.jsx)(e.code,{children:"背面剔除"}),"、",(0,s.jsx)(e.code,{children:"深度测试原理"}),"等，如果我们对每一个知识点都能灵活运用的话，就能够实现很多强大的效果。"]})]})}function c(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}=Object.assign({},(0,a.ah)(),n.components);return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(l,{...n})}):l(n)}let A=c;c.__RSPRESS_PAGE_META={},c.__RSPRESS_PAGE_META["WebGL%20%E5%85%A5%E9%97%A8%E4%B8%8E%E5%AE%9E%E8%B7%B5%2F28.%E6%B7%B1%E5%85%A5%E7%A0%94%E7%A9%B6%20---%20%E4%BD%BF%E7%94%A8%E7%AB%8B%E6%96%B9%E4%BD%93%E7%BA%B9%E7%90%86%E7%BB%98%E5%88%B6%E5%A4%A9%E7%A9%BA%E7%9B%92.md"]={toc:[{text:"采样原理",id:"采样原理",depth:2},{text:"贴图过程",id:"贴图过程",depth:2},{text:"着色器",id:"着色器",depth:3},{text:"顶点着色器",id:"顶点着色器",depth:4},{text:"片元着色器",id:"片元着色器",depth:4},{text:"加载资源",id:"加载资源",depth:3},{text:"纹理操作",id:"纹理操作",depth:3},{text:"创建天空盒",id:"创建天空盒",depth:3},{text:"在外部观察天空盒",id:"在外部观察天空盒",depth:4},{text:"在立方体内部观察。",id:"在立方体内部观察",depth:4},{text:"渲染时机",id:"渲染时机",depth:2},{text:"天空盒的应用",id:"天空盒的应用",depth:2},{text:"回顾",id:"回顾",depth:2}],title:"28.深入研究 --- 使用立方体纹理绘制天空盒",headingTitle:"28.深入研究 --- 使用立方体纹理绘制天空盒",frontmatter:{}}}}]);