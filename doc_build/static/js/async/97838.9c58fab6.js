"use strict";(self.webpackChunkjue_jin_book_press=self.webpackChunkjue_jin_book_press||[]).push([["97838"],{278627:function(e,n,c){c.r(n),c.d(n,{default:()=>q});var r=c(552676),s=c(740453);let i=c.p+"static/image/87a1688089590bf0d83c5f00c81a76d9.bb4c21ed.webp",d=c.p+"static/image/fd150356e2aee5a9684952c595e370ee.10847cf4.webp",a=c.p+"static/image/9cbb6836f2693e28764c4743be53bf3d.f6548761.webp",l=c.p+"static/image/5d9cc6b41a9149e513d983288bb05c9a.4e18584a.webp",p=c.p+"static/image/f223dc192d450f6a25bf9713d610a39a.e72fcc51.webp",t=c.p+"static/image/4efa8d3b2d6f97dc89f7e70197ff00ef.5d4c67d6.webp",o=c.p+"static/image/363b05921c89193ab54d05b9dec10b7f.0cbede98.webp",j=c.p+"static/image/52f725605db6efe4c87d7d9fb541f023.3217b8da.webp",m=c.p+"static/image/d2d32ac832c026752c7e939fcc80b866.2edaac6a.webp",x=c.p+"static/image/964176a5d3ddf810c6ad18a2e6b2794d.cfd8c711.webp",h=c.p+"static/image/a45c071537332af27d9562ba12cef6fd.829ba81d.webp",f=c.p+"static/image/92d8bbf711ac8be0717a1c4bda15aa64.20b463e5.webp",k=c.p+"static/image/e75a65bcde38a21b6876d6bcd1ebe625.cf51b739.webp",b=c.p+"static/image/9895def8be254963a2b56a8bb12c5cfa.dbc3be2e.webp",g=c.p+"static/image/951b1045d06710ee6d6768f851a69f0b.cf85df83.webp",u=c.p+"static/image/57786e730237860ae4dcd34c9b16be20.bdc8f5d4.webp",A=c.p+"static/image/266cd20cddb9e114b72ab3feeb7d34d0.aa606cd8.webp",w=c.p+"static/image/92bcf411155d9ea7e61b9db23c658a76.78afbe0c.webp",N=c.p+"static/image/5e8f8af164b79e0e0fb74e8ea61ca387.adf52939.webp",E=c.p+"static/image/e3be46611f57f40525570895f405ea36.9b1a1548.webp",B=c.p+"static/image/9eb59931f23bf2650ef5502c46400efe.2c7a1262.webp",L=c.p+"static/image/9649fed49de0552c18beb0382070881a.7dd5639e.webp",S=c.p+"static/image/402c4dd3490e5769672481887dcf0fbd.92f336e6.webp",v=c.p+"static/image/c6b36bff321f4873f75e974e653b7dea.dbc3be2e.webp";function y(e){let n=Object.assign({h1:"h1",a:"a",p:"p",img:"img",pre:"pre",code:"code",h2:"h2"},(0,s.ah)(),e.components);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.h1,{id:"77-docker-容器通信的最简单方式桥接网络",children:["77. Docker 容器通信的最简单方式：桥接网络",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#77-docker-容器通信的最简单方式桥接网络",children:"#"})]}),"\n",(0,r.jsx)(n.p,{children:"上节我们讲 Docker Compose 的时候，涉及到多个 docker 容器的通信，我们是通过指定宿主机 ip 和端口的方式。"}),"\n",(0,r.jsx)(n.p,{children:"因为 mysql、redis 的 Docker 容器都映射到了宿主机的端口，那 nest 的容器就可以通过宿主机来实现和其他容器的通信。"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:v,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"Docker 的实现原理那节我们讲过，Docker 通过 Namespace 的机制实现了容器的隔离，其中就包括 Network Namespace。"}),"\n",(0,r.jsx)(n.p,{children:"因为每个容器都有独立的 Network Namespace，所以不能直接通过端口访问其他容器的服务。"}),"\n",(0,r.jsx)(n.p,{children:"那如果这个 Network Namespace 不只包括一个 Docker 容器呢？？"}),"\n",(0,r.jsx)(n.p,{children:"可以创建一个 Network Namespace，然后设置到多个 Docker 容器，这样这些容器就在一个 Namespace 下了，不就可以直接访问对应端口了？"}),"\n",(0,r.jsx)(n.p,{children:"Docker 确实支持这种方式，叫做桥接网络。"}),"\n",(0,r.jsx)(n.p,{children:"通过 docker network 来创建："}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"docker network create common-network\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:S,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"然后把之前的 3 个容器停掉、删除，我们重新跑："}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"docker stop mysql-container redis-container nest-container\ndocker rm mysql-container redis-container nest-container\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:L,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"这次跑的时候要指定 --network："}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"docker run -d --network common-network -v /Users/guang/mysql-data:/var/lib/mysql --name mysql-container mysql\n"})}),"\n",(0,r.jsx)(n.p,{children:"通过 --network 指定桥接网络为我们刚创建的 common-network。"}),"\n",(0,r.jsx)(n.p,{children:"不需要指定和宿主机的端口映射。"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:B,alt:"image.png"})}),"\n",(0,r.jsx)(n.p,{children:"然后跑 redis 容器："}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"docker run -d --network common-network -v /Users/guang/aaa:/data --name redis-container redis\n"})}),"\n",(0,r.jsx)(n.p,{children:"同样也不需要指定和宿主机的端口映射，只需要指定挂载的数据卷就行："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:E,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"然后 nest 的部分我们要改下代码："}),"\n",(0,r.jsx)(n.p,{children:"修改 AppModule 的代码，改成用容器名来访问："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:N,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"然后 docker build："}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"docker build -t mmm .\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:w,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"之后 docker run："}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"docker run -d --network common-network -p 3000:3000 --name nest-container mmm\n"})}),"\n",(0,r.jsx)(n.p,{children:"nest 容器是要指定和宿主机的端口映射的，因为宿主机要访问这个端口的网页。"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:A,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"然后 docker logs 看下日志："}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"docker logs nest-container\n"})}),"\n",(0,r.jsx)(n.p,{children:"可以看到打印了 sql 语句，说明 mysql 连接成功了："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:u,alt:""})}),"\n",(0,r.jsxs)(n.p,{children:["浏览器访问 ",(0,r.jsx)(n.a,{href:"http://localhost:3000",target:"_blank",rel:"noopener noreferrer",children:"http://localhost:3000"})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:"data:image/webp;base64,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",alt:""})}),"\n",(0,r.jsx)(n.p,{children:"然后再看下日志："}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"docker logs nest-container\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:g,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"打印了 redis 的 key 说明 redis 服务也连接成功了。"}),"\n",(0,r.jsx)(n.p,{children:"这就是桥接网络。"}),"\n",(0,r.jsx)(n.p,{children:"之前我们是通过宿主机 ip 来互相访问的："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:b,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"现在可以通过容器名直接互相访问了："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:k,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"原理前面讲过，就是 Namespace。"}),"\n",(0,r.jsx)(n.p,{children:"本来是 3 个独立的 Network Namespace："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:f,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"桥接之后就这样了："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:h,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"Namespace 下包含多个子 Namespace，互相能通过容器名访问。"}),"\n",(0,r.jsx)(n.p,{children:"比起端口映射到宿主机，再访问宿主机 ip 的方式，简便太多了。"}),"\n",(0,r.jsx)(n.p,{children:"那在 Docker Compose 里怎么使用这种方式呢？"}),"\n",(0,r.jsx)(n.p,{children:"之前我们是这样写的："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:x,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"现在改成这样："}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yml",children:"version: '3.8'\nservices:\n  nest-app:\n    build:\n      context: ./\n      dockerfile: ./Dockerfile\n    depends_on:\n      - mysql-container\n      - redis-container\n    ports:\n      - '3000:3000'\n    networks:\n      - common-network\n  mysql-container:\n    image: mysql\n    volumes:\n      - /Users/guang/mysql-data:/var/lib/mysql\n    environment:\n      MYSQL_DATABASE: aaa\n      MYSQL_ROOT_PASSWORD: guang\n    networks:\n      - common-network\n  redis-container:\n    image: redis\n    volumes:\n      - /Users/guang/aaa:/data\n    networks:\n      - common-network\nnetworks:\n  common-network:\n    driver: bridge\n"})}),"\n",(0,r.jsx)(n.p,{children:"version 是指定 docker-compose.yml 的版本，因为不同版本配置不同。"}),"\n",(0,r.jsx)(n.p,{children:"把 mysql-container、redis-container 的 ports 映射去掉，指定桥接网络为 common-network。"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:m,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"然后下面通过 networks 指定创建的 common-network 桥接网络，网络驱动程序指定为 bridge。"}),"\n",(0,r.jsx)(n.p,{children:"其实我们一直用的网络驱动程序都是 bridge，它的含义是容器的网络和宿主机网络是隔离开的，但是可以做端口映射。比如 -p 3000:3000、-p 3306:3306 这样。"}),"\n",(0,r.jsx)(n.p,{children:"然后执行："}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"docker-compose down --rmi all\n"})}),"\n",(0,r.jsx)(n.p,{children:"就会删除 3 个容器和它们的镜像："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:j,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"之后再"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"docker-compose up\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:o,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"可以看到，会先 build dockerfile 产生镜像，然后把 3 个镜像跑起来。"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:t,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"看到打印的 sql 说明 mysql 服务连接成功了。"}),"\n",(0,r.jsx)(n.p,{children:"（这个过程可能因为 mysql 容器没跑起来而连接失败几次，等一会就好了）"}),"\n",(0,r.jsx)(n.p,{children:"浏览器访问下："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:"data:image/webp;base64,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",alt:""})}),"\n",(0,r.jsx)(n.p,{children:"也拿到了 redis 的 key，说明 redis 服务跑成功了："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:p,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"这就是在 docker-compose 里使用桥接网络的方式。"}),"\n",(0,r.jsx)(n.p,{children:"不过，其实不指定 networks 也可以，docker-compose 会创建个默认的。"}),"\n",(0,r.jsx)(n.p,{children:"先把容器、镜像删掉："}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"docker-compose down --rmi all\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:l,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"把 networks 部分注释掉，重新跑："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:a,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"你会发现它创建了一个默认的 network："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:d,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"mysql 和 redis 的访问都是正常的："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:i,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"所以，不手动指定 networks，也是可以用桥接网络的。"}),"\n",(0,r.jsxs)(n.p,{children:["案例代码在",(0,r.jsx)(n.a,{href:"https://github.com/QuarkGluonPlasma/nestjs-course-code/tree/main/docker-compose-test",target:"_blank",rel:"noopener noreferrer",children:"小册仓库"}),"。"]}),"\n",(0,r.jsxs)(n.h2,{id:"总结",children:["总结",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#总结",children:"#"})]}),"\n",(0,r.jsx)(n.p,{children:"上节我们是把 mysql、redis 的端口映射到宿主机，然后 nest 的容器里通过宿主机 ip 访问这两个服务的。"}),"\n",(0,r.jsx)(n.p,{children:"但其实有更方便的方式，就是桥接网络。"}),"\n",(0,r.jsx)(n.p,{children:"通过 docker network create 创建一个桥接网络，然后 docker run 的时候指定 --network，这样 3 个容器就可以通过容器名互相访问了。"}),"\n",(0,r.jsx)(n.p,{children:"在 docker-compose.yml 配置下 networks 创建桥接网络，然后添加到不同的 service 上即可。"}),"\n",(0,r.jsx)(n.p,{children:"或者不配置 networks，docker-compose 会生成一个默认的。"}),"\n",(0,r.jsx)(n.p,{children:"实现原理就是对 Network Namespace 的处理，本来是 3个独立的 Namespace，当指定了 network 桥接网络，就可以在 Namespace 下访问别的 Namespace 了。"}),"\n",(0,r.jsx)(n.p,{children:"多个容器之间的通信方式，用桥接网络是最简便的。"})]})}function D(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,s.ah)(),e.components);return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(y,{...e})}):y(e)}let q=D;D.__RSPRESS_PAGE_META={},D.__RSPRESS_PAGE_META["Nest%20%E9%80%9A%E5%85%B3%E7%A7%98%E7%B1%8D%20%20%E6%9C%80%E6%96%B0200%E7%AB%A0%2F77.%20Docker%20%E5%AE%B9%E5%99%A8%E9%80%9A%E4%BF%A1%E7%9A%84%E6%9C%80%E7%AE%80%E5%8D%95%E6%96%B9%E5%BC%8F%EF%BC%9A%E6%A1%A5%E6%8E%A5%E7%BD%91%E7%BB%9C.md"]={toc:[{text:"总结",id:"总结",depth:2}],title:"77. Docker 容器通信的最简单方式：桥接网络",headingTitle:"77. Docker 容器通信的最简单方式：桥接网络",frontmatter:{}}}}]);