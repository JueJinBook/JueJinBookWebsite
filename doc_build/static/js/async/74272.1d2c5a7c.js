"use strict";(self.webpackChunkjue_jin_book_press=self.webpackChunkjue_jin_book_press||[]).push([["74272"],{766884:function(e,n,t){t.r(n),t.d(n,{default:()=>y});var s=t(552676),r=t(740453);let c=t.p+"static/image/2adc84e0af46f36018881a513f627f06.a498c476.webp",l=t.p+"static/image/e3f08e5a79d6e108127230da4cde5c5c.ba3d086b.webp",i=t.p+"static/image/beb1b85c48197f1019a395870bfb2099.3020e54a.webp",a=t.p+"static/image/24a65193150bb081b54fa04aa16fd33b.45f01c6f.webp",d=t.p+"static/image/2ed5367608a389f397282f6923e69ec7.4121b5aa.webp",p=t.p+"static/image/aef07ea7cd3a712bf381344ca007b3ce.a111c632.webp",o=t.p+"static/image/023366a3877bdc372b7435fc393e7bd4.48c95b34.webp",h=t.p+"static/image/92e1cc5cecd19af1930e8119b9e0538b.bfc14730.webp",A=t.p+"static/image/a1e5f76905bfbc99b33df89f39411ef9.6bed13e5.webp",x=t.p+"static/image/95627b8ab8c5f721c225b41323da74ff.540494d6.webp",u=t.p+"static/image/0fd1ef33e561dc63766c686d7dc4dbb5.91f02b69.webp",j=t.p+"static/image/207bb3720de9a1327c90d521ba71bef0.61e0a522.webp",f=t.p+"static/image/f630b6bf305184903b5c6f221740ee75.26a1c92f.webp",b=t.p+"static/image/403fd2631beeb444d1e9f6631dbba8aa.b782555d.webp",v=t.p+"static/image/5cbd80c59be58d1afef3968b7d5446d6.2b02e3a0.webp",m=t.p+"static/image/73b40542bb05222390403b612d58e07f.fdd65118.webp",g=t.p+"static/image/3a240cf7289e9cb4b200f9e84aeee246.56c1e842.webp",k=t.p+"static/image/9a295ccb01080975447c0c1eb626a7e2.ddedf79f.webp",w=t.p+"static/image/2e3acac69d826e0bcc3c895bc11ae3a9.f7f42f06.webp",I=t.p+"static/image/97c97904c06b5474d3a85b77afdf2933.d3c011c5.webp",H=t.p+"static/image/0bf30ed5470533e07e138d4379cb0f29.2f73fdd5.webp",E=t.p+"static/image/f3a6dc6f6264df745d31e36d2782c220.39a654ab.webp";function B(e){let n=Object.assign({h1:"h1",a:"a",blockquote:"blockquote",p:"p",h2:"h2",code:"code",strong:"strong",pre:"pre",img:"img",ol:"ol",li:"li"},(0,r.ah)(),e.components);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.h1,{id:"4-语法篇--符文全图鉴",children:["4-语法篇 ❘ 符文全图鉴",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#4-语法篇--符文全图鉴",children:"#"})]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"推荐学习指数：⭐️⭐⭐"}),"\n"]}),"\n",(0,s.jsxs)(n.h2,{id:"1-前言",children:["1. 前言",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#1-前言",children:"#"})]}),"\n",(0,s.jsx)(n.p,{children:"本篇我们介绍 Svelte 5 所有的符文以及具体用法。"}),"\n",(0,s.jsxs)(n.h2,{id:"2-state",children:["2. $state",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#2-state",children:"#"})]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"$state"})," 符文用于声明",(0,s.jsx)(n.strong,{children:"响应式状态（Reactive state）"}),"："]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:"<script>\n  let count = $state(0);\n<\/script>\n\n<button onclick={() => count++}>\n  clicks: {count}\n</button>\n"})}),"\n",(0,s.jsx)(n.p,{children:"使用响应式状态，对应的 UI 会在状态更改时发生变化。"}),"\n",(0,s.jsxs)(n.p,{children:["使用 ",(0,s.jsx)(n.code,{children:"$state"})," 符文可替代传统的 ",(0,s.jsx)(n.code,{children:"let"})," 声明。使用 ",(0,s.jsx)(n.code,{children:"$state"}),"的好处之一在于原本的 ",(0,s.jsx)(n.code,{children:"let"}),"声明仅用在组件顶层时才会被视为响应式，",(0,s.jsx)(n.code,{children:"$state"}),"符文却可用于应用程序的任意位置。"]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["注：虽说是任意位置，但原生 JavaScript 并不能识别 ",(0,s.jsx)(n.code,{children:"$state"})," 符文，需要借助 Svelte 编译器，所以只能在 ",(0,s.jsx)(n.code,{children:".svelte"}),"、",(0,s.jsx)(n.code,{children:".svelte.js"}),"、",(0,s.jsx)(n.code,{children:".svelte.ts"}),"等文件中使用符文，Svelte 会识别这些文件并进行编译。"]}),"\n",(0,s.jsxs)(n.p,{children:["当在 ",(0,s.jsx)(n.code,{children:".svelte.js"}),"、",(0,s.jsx)(n.code,{children:".svelte.ts"}),"编写代码时，与原本的 ",(0,s.jsx)(n.code,{children:"js"}),"、",(0,s.jsx)(n.code,{children:"ts"}),"代码无异，只是能多用个符文。"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:"\x3c!-- App.svelte --\x3e\n<script>\n  import { createCounter } from './counter.svelte.js'\n\n  let counter = createCounter()\n<\/script>\n\n<button onclick={() => {\n  counter.count += 1\n}}>\n  clicks: {counter.count}\n</button>\n\n\x3c!-- counter.svelte.js --\x3e\nexport function createCounter() {\n  let count = $state(0);\n  return {\n    get count() {\n      return count\n    },\n    set count(value) {\n      count = value\n    }\n  }\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["当 ",(0,s.jsx)(n.code,{children:"$state"})," 符文用于数组和普通的对象（意思是 Set、Map 这种不行）时，Svelte 会使用 ",(0,s.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy",title:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy",target:"_blank",rel:"noopener noreferrer",children:"Proxy"})," 包装使其具有",(0,s.jsx)(n.strong,{children:"深层次响应式（deeply reactive）"}),"："]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:"<script>\n  let numbers = $state([1, 2, 3]);\n<\/script>\n\n<button onclick={() => numbers.push(numbers.length + 1)}>\n  push\n</button>\n\n<button onclick={() => numbers.pop()}> pop </button>\n\n<p>\n  {numbers.join(' + ') || 0}\n  =\n  {numbers.reduce((a, b) => a + b, 0)}\n</p>\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://svelte-5-preview.vercel.app/#H4sIAAAAAAAAE42OzWrDMBCEX2VZCpGwaJL25tqGPEecg382jVpZEtaqUBy9e5GLKbn1ODuz38yCV20oYHle0HYTYYkn71Ehf_sswhcZJlQYXJyHfKnCMGvPTWtbNsRg49TTHKCGp8AdkzgfFbwoeL3It9ZW-7-4rfrI7Cw4Oxg9fNaLkFA3G-HZx3ATmzBk3_kGBRxlWruym3m_jH_xnBcyNeCdh8c_vxKXLfjhtBU7KGAn4X6HQ8pu_RCZaYwDCdEp6NeSDgroFRxkyqN8gwonN-qrphFLniOlS_oB4o0EFl0BAAA=",title:"https://svelte-5-preview.vercel.app/#H4sIAAAAAAAAE42OzWrDMBCEX2VZCpGwaJL25tqGPEecg382jVpZEtaqUBy9e5GLKbn1ODuz38yCV20oYHle0HYTYYkn71Ehf_sswhcZJlQYXJyHfKnCMGvPTWtbNsRg49TTHKCGp8AdkzgfFbwoeL3It9ZW-7-4rfrI7Cw4Oxg9fNaLkFA3G-HZx3ATmzBk3_kGBRxlWruym3m_jH_xnBcyNeCdh8c_vxKXLfjhtBU7KGAn4X6HQ8pu_RCZaYwDCdEp6NeSDgroFRxkyqN8gwonN-qrphFLniOlS_oB4o0EFl0BAAA=",target:"_blank",rel:"noopener noreferrer",children:"浏览器效果如下："})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:E,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"所谓深层次响应式，简单来说，当你修改了对象深层次的值也会触发响应式。所以原本 Svelte 4 中不能用 push、splice 等方法更新数组，现在也都可以了。"}),"\n",(0,s.jsx)(n.p,{children:"用于对象或数组其实很常用，比如刚才的例子："}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:"<script>\n  function createCounter() {\n    let count = $state(0);\n    return {\n      get count() {\n        return count\n      },\n      set count(value) {\n        count = value\n      }\n    }\n  }\n\n  let counter = createCounter()\n<\/script>\n\n<button onclick={() => {\n  counter.count += 1\n}}>\n  clicks: {counter.count}\n</button>\n"})}),"\n",(0,s.jsx)(n.p,{children:"其实写成这样是一样的："}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:"<script>\n  function createCounter() {\n    let counter = $state({ count: 0 });\n    return counter\n  }\n\n  let counter = createCounter()\n<\/script>\n\n<button onclick={() => {\n  counter.count += 1\n}}>\n  clicks: {counter.count}\n</button>\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://svelte-5-preview.vercel.app/#H4sIAAAAAAAAE12P0WrDMAxFf0WIPSQsrNurlwRGP6PeQ-YqYJbKwZYLxfjfi-ONkj5ddHS5uko424UCqlNCni6ECr_WFTuU21qGcKVFCDsMLnpTSB-Mt6uMmrXMkY1Yx2A8TUJHF1nINy2kstWykICpEAZ4CTIJNakiBe-Q289q9CTR87-3sKy5yD7h6Yzm_vBow_1PFHEMjs1ize-QmhaGsXb5y3jbFF4H-NCc8_bEZg4K0s6TS3gNHLHDizvb2dIZlfhI-TvfAXv2PMo5AQAA",title:"https://svelte-5-preview.vercel.app/#H4sIAAAAAAAAE12P0WrDMAxFf0WIPSQsrNurlwRGP6PeQ-YqYJbKwZYLxfjfi-ONkj5ddHS5uko424UCqlNCni6ECr_WFTuU21qGcKVFCDsMLnpTSB-Mt6uMmrXMkY1Yx2A8TUJHF1nINy2kstWykICpEAZ4CTIJNakiBe-Q289q9CTR87-3sKy5yD7h6Yzm_vBow_1PFHEMjs1ize-QmhaGsXb5y3jbFF4H-NCc8_bEZg4K0s6TS3gNHLHDizvb2dIZlfhI-TvfAXv2PMo5AQAA",target:"_blank",rel:"noopener noreferrer",children:"浏览器效果如下："})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:H,alt:""})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"$state"})," 符文也可用于类字段："]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:"<script>\n  class Todo {\n    done = $state(false);\n    text = $state();\n\n    constructor(text) {\n      this.text = text;\n    }\n  }\n\n  const todo = new Todo('')\n<\/script>\n\n<input type=\"checkbox\" bind:checked={todo.done}>\n<input bind:value={todo.text} />\n\n<hr />\n{todo.done} {todo.text}\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://svelte-5-preview.vercel.app/#H4sIAAAAAAAAE01Py2rDMBD8FbEUYoNJ7q4d6D_0VvWgSGssqkhCWqcJxv8eVlGbXLSanQezK0zWYYb-awWvzgg9fMQIHdAtMsgXdITQQQ5L0rwZsk420lF6SdqpnMVnMEGsjCWZ4FGM4i2TImwm5TK27w-K8EpPqm4Lo4PPlBZNITWsav_SJNFs8746edSsjQc_vroFcYlRePwtfZrdrpV-ODzL-sH6uJDgw0YJekb9cwpXCeJkvekLRjOuHLTnM7bjv6coLsotWHmusonDI3dO5ffiFC8q6OAcjJ0sGugpLbh9b3f6zp5HdgEAAA==",title:"https://svelte-5-preview.vercel.app/#H4sIAAAAAAAAE01Py2rDMBD8FbEUYoNJ7q4d6D_0VvWgSGssqkhCWqcJxv8eVlGbXLSanQezK0zWYYb-awWvzgg9fMQIHdAtMsgXdITQQQ5L0rwZsk420lF6SdqpnMVnMEGsjCWZ4FGM4i2TImwm5TK27w-K8EpPqm4Lo4PPlBZNITWsav_SJNFs8746edSsjQc_vroFcYlRePwtfZrdrpV-ODzL-sH6uJDgw0YJekb9cwpXCeJkvekLRjOuHLTnM7bjv6coLsotWHmusonDI3dO5ffiFC8q6OAcjJ0sGugpLbh9b3f6zp5HdgEAAA==",target:"_blank",rel:"noopener noreferrer",children:"浏览器效果如下："})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:I,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"Svelte 编译器其实是将这些属性转为了 getter 和 setter 方法："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:w,alt:""})}),"\n",(0,s.jsxs)(n.h2,{id:"3-stateraw",children:["3. $state.raw",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#3-stateraw",children:"#"})]}),"\n",(0,s.jsxs)(n.p,{children:["如果你不希望对象和数组具有深度响应式，则可以使用 ",(0,s.jsx)(n.code,{children:"$state.raw"}),"。使用 ",(0,s.jsx)(n.code,{children:"$state.raw"}),"声明的状态不能被改变，只能被重新赋值。换句话说，如果你想更新对象或数组，不能直接修改对象的属性或者使用 ",(0,s.jsx)(n.code,{children:"push"}),"这样的数组方法，而是需要完全替换它："]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:"<script>\n  let numbers = $state.raw([1, 2, 3]);\n<\/script>\n\n<button onclick={() => numbers = [...numbers, numbers.length + 1]}>\n  update will success\n</button>\n\n<button onclick={() => numbers.push(numbers.length + 1)}>\n  update will fail\n</button>\n\n<p>\n  {numbers.join(' + ') || 0}\n  =\n  {numbers.reduce((a, b) => a + b, 0)}\n</p>\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://svelte-5-preview.vercel.app/#H4sIAAAAAAAAE42OzW6DMBCEX2VlVYoRFk3aGwWkPgdwMGZpnBpj2etGFeHdK2ij_uTS48zOfLMzG7TBwPJ6ZlaOyHL27BwTjN7dKsIbGkImWJiiV6tTBOW1o6qxDRkksHHs0Aco4S6QJMy8PPP6IOBBwGObPDW2uP-u2KKLRJOFySqj1Ws58wTK6gelzrLsS4mrnRm0L3SEFA7tsi1H10tCOGtjIESlMIR16BP-j6HMxXDkt_jkFj9Ibf6y3Zaar_3TpC3fQQq7BC4X2C_rtfwV8dhHhZxLAd32iIQUOgH7ZFnhrmKCjVOvB409y8lHXNrlAz2IX4GeAQAA",title:"https://svelte-5-preview.vercel.app/#H4sIAAAAAAAAE42OzW6DMBCEX2VlVYoRFk3aGwWkPgdwMGZpnBpj2etGFeHdK2ij_uTS48zOfLMzG7TBwPJ6ZlaOyHL27BwTjN7dKsIbGkImWJiiV6tTBOW1o6qxDRkksHHs0Aco4S6QJMy8PPP6IOBBwGObPDW2uP-u2KKLRJOFySqj1Ws58wTK6gelzrLsS4mrnRm0L3SEFA7tsi1H10tCOGtjIESlMIR16BP-j6HMxXDkt_jkFj9Ibf6y3Zaar_3TpC3fQQq7BC4X2C_rtfwV8dhHhZxLAd32iIQUOgH7ZFnhrmKCjVOvB409y8lHXNrlAz2IX4GeAQAA",target:"_blank",rel:"noopener noreferrer",children:"浏览器效果如下："})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:k,alt:""})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"$state.raw"}),"用于一些大型的不需要更改的对象或者数组，既可以避免误操作，又可以降低将其变为响应式的成本，提升性能。"]}),"\n",(0,s.jsxs)(n.p,{children:["其实",(0,s.jsx)(n.code,{children:"$state.raw"}),"之前叫 ",(0,s.jsx)(n.code,{children:"$state.frozen"}),"，从之前的名字可以窥探出一点 ",(0,s.jsx)(n.code,{children:"$state.raw"})," 的实现，本质是使用 ",(0,s.jsx)(n.code,{children:"Object.freeze()"})," 进行了",(0,s.jsx)(n.a,{href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/freeze#%E5%86%BB%E7%BB%93%E6%95%B0%E7%BB%84",title:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/freeze#%E5%86%BB%E7%BB%93%E6%95%B0%E7%BB%84",target:"_blank",rel:"noopener noreferrer",children:"浅冻结"}),"。这意味着其实你还可以在冻结后更改深层次的值："]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:"<script>\n  let list = $state.raw([{ name: 'Abbott', age: 18 }]);\n  list[0].name = 'Benjamin'\n<\/script>\n\n{#each list as item (item.age)}\n  {item.name} {item.age}\n{/each}\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://svelte-5-preview.vercel.app/#H4sIAAAAAAAAEz2N3QqCQBCFX2WYAgtE6y62H7DXUC8mHW1DV3HHIpZ991iLbg7nDHO-47DRHVtUuUNDPaPCbBwxRnmPIdgnd8IYox3mqQqXk60mPcqlMAAdC3TaCpxhbYWEk4lem9xBQCmIstttEIlioJYV7A_gy-1xKWor-a5Mwh-cIbqyeVCvTVSYU_ofKIxbMVX37wZZ0MI9bIIm1PLWB5RbYgD5n6eWfWFcGqoeY-yHWjeaa1QyzexL_wFe2OwU9QAAAA==",title:"https://svelte-5-preview.vercel.app/#H4sIAAAAAAAAEz2N3QqCQBCFX2WYAgtE6y62H7DXUC8mHW1DV3HHIpZ991iLbg7nDHO-47DRHVtUuUNDPaPCbBwxRnmPIdgnd8IYox3mqQqXk60mPcqlMAAdC3TaCpxhbYWEk4lem9xBQCmIstttEIlioJYV7A_gy-1xKWor-a5Mwh-cIbqyeVCvTVSYU_ofKIxbMVX37wZZ0MI9bIIm1PLWB5RbYgD5n6eWfWFcGqoeY-yHWjeaa1QyzexL_wFe2OwU9QAAAA==",target:"_blank",rel:"noopener noreferrer",children:"浏览器效果如下："})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:g,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"但是这样是没有效果的："}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:"<button onclick={() => {\n    list[0].name = 'Benjamin'\n}}>update</button>\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.a,{href:"https://svelte-5-preview.vercel.app/#H4sIAAAAAAAAEz3N0WqFMAwG4FcJ2UAFOW53w6lw9hrWi1pzXLfaFhs3Rum7j3rGbkL-wP8l4k0bCtiOEa3cCFu8eo818o_PIXyRYcIagzt2lS9dULv2PAgLYIjB6MDQw2NgyXTZ5Xc5RshUC8V1nh1zUYNcqYXnF0hT9Sps1_wbwsYHkur9zsgAmmmDMs-LXKlK-U08YzbT3y5XSsLGJldTVrr5YHYWnFVGq88-lhX0A8RchxMfn6aTgB6KN7IfctO2EDal4fCLZOqaOzFgjZtb9E3Tgi3vB6Up_QK4Fz_pJwEAAA==",title:"https://svelte-5-preview.vercel.app/#H4sIAAAAAAAAEz3N0WqFMAwG4FcJ2UAFOW53w6lw9hrWi1pzXLfaFhs3Rum7j3rGbkL-wP8l4k0bCtiOEa3cCFu8eo818o_PIXyRYcIagzt2lS9dULv2PAgLYIjB6MDQw2NgyXTZ5Xc5RshUC8V1nh1zUYNcqYXnF0hT9Sps1_wbwsYHkur9zsgAmmmDMs-LXKlK-U08YzbT3y5XSsLGJldTVrr5YHYWnFVGq88-lhX0A8RchxMfn6aTgB6KN7IfctO2EDal4fCLZOqaOzFgjZtb9E3Tgi3vB6Up_QK4Fz_pJwEAAA==",target:"_blank",rel:"noopener noreferrer",children:"点击查看浏览器效果"}),"。"]}),"\n",(0,s.jsxs)(n.p,{children:["因为 ",(0,s.jsx)(n.code,{children:"$state.frozen"}),"的目的就是为了节约成为响应式的成本，所以冻结的对象并不具备深度响应式。要想修改，只能直接赋值修改："]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:"<button onclick={() => {\n  list = [{ name: 'Benjamin', age: 18 }]\n}}>update</button>\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.a,{href:"https://svelte-5-preview.vercel.app/#H4sIAAAAAAAAE1WO0WrDMAxFf0VogyYQGvY2vCTQ_UbdB8dRM3eObWJlYxj_-3AzNvYidC_o6CS8GksRxTmhUwuhwFMI2CB_hRLiB1kmbDD6bdWl6aJeTeBBOgBLDNZEhh4eIyum46o-q3OCghJwOI2jZz40oGYS8PQM-VK_SNe1vwzp0gMp_bZjVATDtEBV5lHNVOfyJt1jYeafXc2UpUttOc2F0o0bs3fgnbZGv_epqqEfIN0td8M_rVdyN7UY909MupyHLUyKqWt32oANLn4yV0MTCl43ypf8DV_SXpsyAQAA",title:"https://svelte-5-preview.vercel.app/#H4sIAAAAAAAAE1WO0WrDMAxFf0VogyYQGvY2vCTQ_UbdB8dRM3eObWJlYxj_-3AzNvYidC_o6CS8GksRxTmhUwuhwFMI2CB_hRLiB1kmbDD6bdWl6aJeTeBBOgBLDNZEhh4eIyum46o-q3OCghJwOI2jZz40oGYS8PQM-VK_SNe1vwzp0gMp_bZjVATDtEBV5lHNVOfyJt1jYeafXc2UpUttOc2F0o0bs3fgnbZGv_epqqEfIN0td8M_rVdyN7UY909MupyHLUyKqWt32oANLn4yV0MTCl43ypf8DV_SXpsyAQAA",target:"_blank",rel:"noopener noreferrer",children:"点击查看浏览器效果"}),"。"]}),"\n",(0,s.jsxs)(n.h2,{id:"4-statesnapshot",children:["4. $state.snapshot",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#4-statesnapshot",children:"#"})]}),"\n",(0,s.jsxs)(n.p,{children:["前面我们讲到当 ",(0,s.jsx)(n.code,{children:"$state"}),"用于数组或普通对象的时候，会使用 Proxy 进行包装，所以如果你直接打印，会是一个 Proxy 类型的值，",(0,s.jsx)(n.code,{children:"$state.snapshot"}),"（静态快照）用于获取 ",(0,s.jsx)(n.code,{children:"$state"})," 实际的值。让我们看个例子就明白了："]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:"<script>\n  let counter = $state({ count: 0 });\n\n  function onclick() {\n    console.log(counter)\n    console.log(counter.count)\n    console.log($state.snapshot(counter));\n  }\n<\/script>\n\n\n<button onclick={onclick}>click</button>\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://svelte-5-preview.vercel.app/#H4sIAAAAAAAAE3VOQQrCMBD8Slg8tFCq51oLvsN4qHGrwbgbmo0gIX-XtqIXPc3szDIzCQbrMEBzSED9HaGBvfdQgTz9dIQHOkGoIHAczaS0wYzWS6dJi0NRhiMJjmqnVkF6wSItUqM2KpdbTdPjEMmIZVJMxllzK0qVJl2LYQrssHZ8Kd5R5V-nnvGHv1TXgXofriyfpLlfsqZ2_Z1NmtpTFPnO2aU3yd0M7XrxO01QwZ3PdrB4hkbGiPmYXxB2ikw1AQAA",title:"https://svelte-5-preview.vercel.app/#H4sIAAAAAAAAE3VOQQrCMBD8Slg8tFCq51oLvsN4qHGrwbgbmo0gIX-XtqIXPc3szDIzCQbrMEBzSED9HaGBvfdQgTz9dIQHOkGoIHAczaS0wYzWS6dJi0NRhiMJjmqnVkF6wSItUqM2KpdbTdPjEMmIZVJMxllzK0qVJl2LYQrssHZ8Kd5R5V-nnvGHv1TXgXofriyfpLlfsqZ2_Z1NmtpTFPnO2aU3yd0M7XrxO01QwZ3PdrB4hkbGiPmYXxB2ikw1AQAA",target:"_blank",rel:"noopener noreferrer",children:"浏览器效果如下："})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:m,alt:""})}),"\n",(0,s.jsxs)(n.p,{children:["如果直接打印 counter，返回的是 ",(0,s.jsx)(n.code,{children:"Proxy { ... }"}),"，使用 ",(0,s.jsx)(n.code,{children:"$state.snapshot"}),"，获取的则是 ",(0,s.jsx)(n.code,{children:"{ count: ... }"})]}),"\n",(0,s.jsxs)(n.h2,{id:"5-derived",children:["5. $derived",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#5-derived",children:"#"})]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"$derived"})," 符文用于声明派生状态："]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:"<script>\n  let count = $state(0);\n  let doubled = $derived(count * 2);\n<\/script>\n\n<button onclick={() => count++}>\n  {doubled}\n</button>\n\n<p>{count} doubled is {doubled}</p>\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.a,{href:"https://svelte-5-preview.vercel.app/#H4sIAAAAAAAAE0WNQQqDMBBFrxKGLrQKli6tCj1H7UKTEUJjEsxEKCF3L9HWLmf---8HmKRCB_UjgB5mhBru1kIJ9LbpcCsqQijBGb_w9GkcX6SlrteMKSTGjdfEWnZyNBBml_z2S4Txo0KRMoGLXFFkO3xm10Q11aHqdTN6IqOZ0VxJ_mpDlrO22-1FEbe58DXG1N35vWu7sIHx2JTuTzeV7aCE2Qg5SRRQ0-IxPuMHCnabwvwAAAA=",title:"https://svelte-5-preview.vercel.app/#H4sIAAAAAAAAE0WNQQqDMBBFrxKGLrQKli6tCj1H7UKTEUJjEsxEKCF3L9HWLmf---8HmKRCB_UjgB5mhBru1kIJ9LbpcCsqQijBGb_w9GkcX6SlrteMKSTGjdfEWnZyNBBml_z2S4Txo0KRMoGLXFFkO3xm10Q11aHqdTN6IqOZ0VxJ_mpDlrO22-1FEbe58DXG1N35vWu7sIHx2JTuTzeV7aCE2Qg5SRRQ0-IxPuMHCnabwvwAAAA=",target:"_blank",rel:"noopener noreferrer",children:"浏览器效果如下："}),"。"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:v,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"声明派生状态时要注意："}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"表达式中不应该有副作用"}),"\n",(0,s.jsx)(n.li,{children:"不能在表达式中改变状态"}),"\n",(0,s.jsx)(n.li,{children:"也可用于类字段"}),"\n"]}),"\n",(0,s.jsxs)(n.h2,{id:"6-derivedby",children:["6. $derived.by",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#6-derivedby",children:"#"})]}),"\n",(0,s.jsxs)(n.p,{children:["有的时候，表达式比较复杂，此时可是使用 ",(0,s.jsx)(n.code,{children:"$derived.by"}),"："]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:"<script>\n  let numbers = $state([1, 2, 3]);\n  let total = $derived.by(() => {\n    let total = 0;\n    for (const n of numbers) {\n      total += n;\n    }\n    return total;\n  });\n<\/script>\n\n<button onclick={() => numbers.push(numbers.length + 1)}>\n  {numbers.join(' + ')} = {total}\n</button>\n"})}),"\n",(0,s.jsxs)(n.p,{children:["其实 ",(0,s.jsx)(n.code,{children:"$derived(expression)"})," 相当于 ",(0,s.jsx)(n.code,{children:"$derived.by(() => expression)"})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://svelte-5-preview.vercel.app/#H4sIAAAAAAAAE1VPy2rDMBD8lUUUImOTNu3NsQ39jiQHP9aNWnllpFUgCP17kR-FnpbZmdmZDWJUGp0oL0FQO6Eoxec8i0Lwc07APVAzikI4422fNpXrrZq5uRKARgbyU4fWQQ0vjltGeTkV8F7Axy077xo23OqkGNCqBw7H7illBnUDIUn-i97O6240FmRvyDEQmHEPynYPbI68BtoscR0W2Vta6YWJqUr1-tf8SlXnmQ2BoV6r_qcOa50t4zh7d5c70EhffIccTllc3g47820UyQPkcMgi1BCWxJii1vONKMRkBjUqHETJ1mO8xV8tdJx5cwEAAA==",title:"https://svelte-5-preview.vercel.app/#H4sIAAAAAAAAE1VPy2rDMBD8lUUUImOTNu3NsQ39jiQHP9aNWnllpFUgCP17kR-FnpbZmdmZDWJUGp0oL0FQO6Eoxec8i0Lwc07APVAzikI4422fNpXrrZq5uRKARgbyU4fWQQ0vjltGeTkV8F7Axy077xo23OqkGNCqBw7H7illBnUDIUn-i97O6240FmRvyDEQmHEPynYPbI68BtoscR0W2Vta6YWJqUr1-tf8SlXnmQ2BoV6r_qcOa50t4zh7d5c70EhffIccTllc3g47820UyQPkcMgi1BCWxJii1vONKMRkBjUqHETJ1mO8xV8tdJx5cwEAAA==",target:"_blank",rel:"noopener noreferrer",children:"浏览器效果如下："})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:b,alt:""})}),"\n",(0,s.jsxs)(n.h2,{id:"7-effect",children:["7. $effect",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#7-effect",children:"#"})]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"$effect"})," 符文，用于在组件挂载到 DOM 时以及状态值发生更改时运行副作用："]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:"<script>\n  let value = $state('a');\n\n  $effect(() => {\n    console.log(value);\n  });\n<\/script>\n\n<input type=\"text\" bind:value />\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://svelte-5-preview.vercel.app/#H4sIAAAAAAAAEz1OSwqDMBC9yjAIRpBKt6kKPUfThY2TEohJMBNpEe9e0kJXj_ebeTsa6yihvO3op4VQ4jVGbJHfsZC0kWPCFlPIqy5Kn_RqI4_KAzhi2CaXCQaoEk9Moj7XzUX54lZkDGkWooFhhL1IADr4FBydXHiKb7WkAY4Cffe_rXxvfcwMZcegkOnFCuFh_Sx_H7sRW1zCbI2lGSWvmY778QF4s1Ls0AAAAA==",title:"https://svelte-5-preview.vercel.app/#H4sIAAAAAAAAEz1OSwqDMBC9yjAIRpBKt6kKPUfThY2TEohJMBNpEe9e0kJXj_ebeTsa6yihvO3op4VQ4jVGbJHfsZC0kWPCFlPIqy5Kn_RqI4_KAzhi2CaXCQaoEk9Moj7XzUX54lZkDGkWooFhhL1IADr4FBydXHiKb7WkAY4Cffe_rXxvfcwMZcegkOnFCuFh_Sx_H7sRW1zCbI2lGSWvmY778QF4s1Ls0AAAAA==",target:"_blank",rel:"noopener noreferrer",children:"浏览器效果如下："})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:f,alt:""})}),"\n",(0,s.jsxs)(n.p,{children:["作用类似于 Svelte 4 的 ",(0,s.jsx)(n.code,{children:"$:{}"}),"、onMount 和 afterUpdate。",(0,s.jsx)(n.code,{children:"$effect"}),"会自动追踪函数中依赖的状态和派生状态，并在状态值发生改变时重新运行。"]}),"\n",(0,s.jsx)(n.p,{children:"所以这样写是没有效果的："}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:'<script>\n  let value = $state(\'1\');\n\n  $effect(() => {\n    console.log(1)\n  });\n<\/script>\n\n<input id="name" type="text" bind:value />\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://svelte-5-preview.vercel.app/#H4sIAAAAAAAAEz2OwQqDMBBEf2VZBBWk4tUaod_R7cGatQTSJJiNtIj_XtJCjzPzmJkdF2M5Yn_d0U1Pxh4vIWCD8g5ZxI2tMDYYfVrn7AxxXk2QkRyAZYFtsolBQRFlEq7KrqzP5HJa8LLwLFVVgxphJ0dCMnsXveWT9Y-qqzN2ZH5o_7XkBuNCEjBa0fcUIeQ7ilD4JYRwN073v-F2xAafXpvFsMZe1sTH7fgAD5Eua9cAAAA=",title:"https://svelte-5-preview.vercel.app/#H4sIAAAAAAAAEz2OwQqDMBBEf2VZBBWk4tUaod_R7cGatQTSJJiNtIj_XtJCjzPzmJkdF2M5Yn_d0U1Pxh4vIWCD8g5ZxI2tMDYYfVrn7AxxXk2QkRyAZYFtsolBQRFlEq7KrqzP5HJa8LLwLFVVgxphJ0dCMnsXveWT9Y-qqzN2ZH5o_7XkBuNCEjBa0fcUIeQ7ilD4JYRwN073v-F2xAafXpvFsMZe1sTH7fgAD5Eua9cAAAA=",target:"_blank",rel:"noopener noreferrer",children:"浏览器效果如下："})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:j,alt:""})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"$effect"})," 中的函数只会在组件挂载时运行一次，在 ",(0,s.jsx)(n.code,{children:"value"})," 值更改的时候并不会重新运行。这是因为 Svelte 并未收集到 ",(0,s.jsx)(n.code,{children:"$effect"})," 函数依赖的值。所以你至少需要这样写："]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:'<script>\n  let value = $state(\'1\');\n\n  $effect(() => {\n    value\n    console.log(1)\n  });\n<\/script>\n\n<input id="name" type="text" bind:value />\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://svelte-5-preview.vercel.app/#H4sIAAAAAAAAEz2O0QqDMAxFfyUEQQWZ-NqpsO9Y9uBqHIWuLTbKhvjvowp7S3LvIWfDyViOqO4buuHNqPAWAlYo35CWuLIVxgqjX2adLm3UswnSkwOwLLAOdmHoIIsyCBd5k5dXcinNeJpYS1GU0PWwkSMhOernqL2L3vLF-lfRlInYE9rW_w_kWuPCImDGjg4_QkhmHaHwRwjhadyoToe6xwrffjST4RGVzAvvj_0HtU_CVuIAAAA=",title:"https://svelte-5-preview.vercel.app/#H4sIAAAAAAAAEz2O0QqDMAxFfyUEQQWZ-NqpsO9Y9uBqHIWuLTbKhvjvowp7S3LvIWfDyViOqO4buuHNqPAWAlYo35CWuLIVxgqjX2adLm3UswnSkwOwLLAOdmHoIIsyCBd5k5dXcinNeJpYS1GU0PWwkSMhOernqL2L3vLF-lfRlInYE9rW_w_kWuPCImDGjg4_QkhmHaHwRwjhadyoToe6xwrffjST4RGVzAvvj_0HtU_CVuIAAAA=",target:"_blank",rel:"noopener noreferrer",children:"浏览器效果如下："})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:u,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"这样写也是没有效果的："}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:'<script>\n  let input = $state({value: \'1\'});\n\n  $effect(() => {\n    console.log(input)\n  });\n<\/script>\n\n<input id="name" type="text" bind:value={input.value} />\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.a,{href:"https://svelte-5-preview.vercel.app/#H4sIAAAAAAAAEz2OQQqDMBBFrzIMggqidJsaoedourA6lkBMghmlJXj3khS6_I8_837ERRsKKO4R7bgSCrx5jw3yx6cQDjJM2GBw-zYl0odp054HZQEMMWjrdwYJReCRqYrHaHYSUF7Ks74qm2oFLQtNXFU1yAFiQgCTs8EZao17VflHnXi-6bu_Q9n-J9CzVHmhQkjbpEKmNyuEp7azyFYZc7fN4YRuwAZXN-tF04yCt53Ox_kFAKWr3_IAAAA=",title:"https://svelte-5-preview.vercel.app/#H4sIAAAAAAAAEz2OQQqDMBBFrzIMggqidJsaoedourA6lkBMghmlJXj3khS6_I8_837ERRsKKO4R7bgSCrx5jw3yx6cQDjJM2GBw-zYl0odp054HZQEMMWjrdwYJReCRqYrHaHYSUF7Ks74qm2oFLQtNXFU1yAFiQgCTs8EZao17VflHnXi-6bu_Q9n-J9CzVHmhQkjbpEKmNyuEp7azyFYZc7fN4YRuwAZXN-tF04yCt53Ox_kFAKWr3_IAAAA=",target:"_blank",rel:"noopener noreferrer",children:"点击查看浏览器效果"}),"。在这个例子中，effect 追踪的是 input，但只有 input.value 发生了改变，只有重新赋值 input 才可以触发 effect 函数。"]}),"\n",(0,s.jsx)(n.p,{children:"这样写是可以的："}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:'<script>\n  let input = $state({value: \'1\'});\n\n  $effect(() => {\n    console.log(input.value)\n  });\n<\/script>\n\n<input id="name" type="text" bind:value={input.value} />\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.a,{href:"https://svelte-5-preview.vercel.app/#H4sIAAAAAAAAE02OwQqDMBBEf2VZBBVE6TU1Qr-j6cHqWgJpEswqLcF_L0mh9LizM28m4qINBRTXiHZ8Egq8eI8N8tunI-xkmLDB4LZ1SkofplV7HpQFMMSgrd8YJBSBR6Yq7qPZSEB5Ko_6rGyyFbQsNHFV1SAHiEkCmJwNzlBr3KPKjDYn6_TNyb77NSnbf2v0LFXeqRDSQqmQ6cUK4a7tLDJBxj_cAd2ADT7drBdNMwpeNzpuxwexJtL--AAAAA==",title:"https://svelte-5-preview.vercel.app/#H4sIAAAAAAAAE02OwQqDMBBEf2VZBBVE6TU1Qr-j6cHqWgJpEswqLcF_L0mh9LizM28m4qINBRTXiHZ8Egq8eI8N8tunI-xkmLDB4LZ1SkofplV7HpQFMMSgrd8YJBSBR6Yq7qPZSEB5Ko_6rGyyFbQsNHFV1SAHiEkCmJwNzlBr3KPKjDYn6_TNyb77NSnbf2v0LFXeqRDSQqmQ6cUK4a7tLDJBxj_cAd2ADT7drBdNMwpeNzpuxwexJtL--AAAAA==",target:"_blank",rel:"noopener noreferrer",children:"点击查看浏览器效果"}),"。此时在 ",(0,s.jsx)(n.code,{children:"value"})," 值发生更改的时候，",(0,s.jsx)(n.code,{children:"$effect"})," 中的函数也会重新运行。"]}),"\n",(0,s.jsx)(n.p,{children:"注意：异步读取的值（在 await 之后或 setTimeout 内部）不会被追踪，所以这样写也是不行的："}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:"<script>\n  let value = $state('1');\n\n  $effect(() => {\n    setTimeout(() => {\n      console.log(value)\n    })\n    console.log('run')\n  });\n<\/script>\n\n<input id=\"name\" type=\"text\" bind:value />\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.a,{href:"https://svelte-5-preview.vercel.app/#H4sIAAAAAAAAE12P0QqDMAxFfyUEQQWZ7NWpsH_Y27oHp3EUalvaVDbEfx_VMcaeQs6B5N4FR6nIY3VdUHcTYYVna7FAftm4-JkUExboTXB9JLXvnbTcCg2giGHuVCBoIPHcMWXpMc1PQkeb0DhSz1mWQ9PCEhGAJ77IiUz44wC90d4oOijzyLaj-W7Wz_z1qQs63fgav9XlN5TQtdQ2MMihEVslgRDLNAKZniwQ7lIP1R67bLHAyQxylDRgxS7Qelvf0KOVlBUBAAA=",title:"https://svelte-5-preview.vercel.app/#H4sIAAAAAAAAE12P0QqDMAxFfyUEQQWZ7NWpsH_Y27oHp3EUalvaVDbEfx_VMcaeQs6B5N4FR6nIY3VdUHcTYYVna7FAftm4-JkUExboTXB9JLXvnbTcCg2giGHuVCBoIPHcMWXpMc1PQkeb0DhSz1mWQ9PCEhGAJ77IiUz44wC90d4oOijzyLaj-W7Wz_z1qQs63fgav9XlN5TQtdQ2MMihEVslgRDLNAKZniwQ7lIP1R67bLHAyQxylDRgxS7Qelvf0KOVlBUBAAA=",target:"_blank",rel:"noopener noreferrer",children:"点击查看浏览器效果"}),"。",(0,s.jsx)(n.code,{children:"$effect"})," 中的函数只会在组件挂载时运行一次，在 ",(0,s.jsx)(n.code,{children:"value"})," 更改的时候并不会重新运行。"]}),"\n",(0,s.jsxs)(n.p,{children:["总结一下，",(0,s.jsx)(n.code,{children:"$effect"}),"用法类似于 React 的 ",(0,s.jsx)(n.code,{children:"useEffect"}),"，但不需要像 ",(0,s.jsx)(n.code,{children:"useEffect"})," 一样声明依赖的值，是因为 Svelte 会自动收集依赖的值，但不会追踪异步读取的值。"]}),"\n",(0,s.jsxs)(n.p,{children:["Svelte 是怎么收集依赖的值的呢？简单来说，",(0,s.jsx)(n.code,{children:"$effect"})," 函数会运行一次，然后收集函数运行时用到的状态和派生状态，然后建立 ",(0,s.jsx)(n.code,{children:"$effect"})," 和 ",(0,s.jsx)(n.code,{children:"$state"})," 的映射关系，当 ",(0,s.jsx)(n.code,{children:"$state"})," 的值更改的时候，就会调用对应的 ",(0,s.jsx)(n.code,{children:"$effect"}),"。"]}),"\n",(0,s.jsx)(n.p,{children:"所以 effect 取决于上次运行时读取到的值，让我们看个例子："}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"$effect(() => {\n  console.log('running');\n\n  if (a || b) {\n    console.log('inside if block');\n  }\n});\n"})}),"\n",(0,s.jsxs)(n.p,{children:["如果上次运行时 ",(0,s.jsx)(n.code,{children:"a"}),"为 true，因为执行不到 ",(0,s.jsx)(n.code,{children:"b"}),"，effect 无法建立和 b 的依赖关系，所以对 b 的更新不会导致此 effect 重新运行。"]}),"\n",(0,s.jsxs)(n.p,{children:["此外，",(0,s.jsx)(n.code,{children:"$effect"})," 函数的重新运行是分批的，这就意味着如果同一时刻更改多个值并不会导致重复运行。它们会在 DOM 更新后运行。"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"$effect"})," 可以返回一个函数，该函数会在 DOM 卸载时以及 effect 重新运行时执行："]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:"<script>\n  let count = $state(0);\n  let milliseconds = $state(1000);\n\n  $effect(() => {\n    // 当 `milliseconds` 改变的时候，会被重新创建\n    const interval = setInterval(() => {\n      count += 1;\n    }, milliseconds);\n\n    // 如果提供了回调，它会在 effect 重新运行的时候立刻运行以及当组件卸载的时候运行\n    return () => {\n      clearInterval(interval);\n    };\n  });\n<\/script>\n\n<h1>{count}</h1>\n\n<button onclick={() => (milliseconds *= 2)}>slower</button>\n\n<button onclick={() => (milliseconds /= 2)}>faster</button>\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.a,{href:"https://svelte-5-preview.vercel.app/#H4sIAAAAAAAAE42RzUrDQBSFX-UyuGi1kNZlTQIufQYVGtMJBqeTkpkoEgKioqItFRR_WhEUFEEQV0WbVl8mk8ZVX0HSsbV15Wq4Z87hfofrI8smmKHiso-oUcGoiBarVZRDfLuaDmwTE45RDjHHc81UUZnp2lWur1AAgjmYjkc5aDDDuMFxJp9dGP1UbEJshk2HltmvoZDPDz2pawZbFjZ5JpMFTQc_lQAUBUTvDEqT8RLE5--icdVv7seXbbFzPejWom4zuX_-OqzHF6_iqCXCjsybDmUcbMqxu2kQ0IBhvvQzTW-CH_g5DQoLUgpyU9gjUEn1uBvf3sSN0-ijFXUOROs2ed0bdGviZS_qNsXNE8g6IJmSz9PkrjYm7j-fiKNQilH4IBrHonfWD_ejsC3qb0mvN3ZKj1zrYu65FP5iE2y4406jqtlRh-EbpKOqjK-1QtX1gu4PGweqsl6Q2prHuUPBoSaxzQ3Nl5syU7eb1WA-G-iMOFvYVRUZ0f8ZVmTYMhifCKMcqjhl27JxGRW56-FgNfgGF_WUY4wCAAA=",title:"https://svelte-5-preview.vercel.app/#H4sIAAAAAAAAE42RzUrDQBSFX-UyuGi1kNZlTQIufQYVGtMJBqeTkpkoEgKioqItFRR_WhEUFEEQV0WbVl8mk8ZVX0HSsbV15Wq4Z87hfofrI8smmKHiso-oUcGoiBarVZRDfLuaDmwTE45RDjHHc81UUZnp2lWur1AAgjmYjkc5aDDDuMFxJp9dGP1UbEJshk2HltmvoZDPDz2pawZbFjZ5JpMFTQc_lQAUBUTvDEqT8RLE5--icdVv7seXbbFzPejWom4zuX_-OqzHF6_iqCXCjsybDmUcbMqxu2kQ0IBhvvQzTW-CH_g5DQoLUgpyU9gjUEn1uBvf3sSN0-ijFXUOROs2ed0bdGviZS_qNsXNE8g6IJmSz9PkrjYm7j-fiKNQilH4IBrHonfWD_ejsC3qb0mvN3ZKj1zrYu65FP5iE2y4406jqtlRh-EbpKOqjK-1QtX1gu4PGweqsl6Q2prHuUPBoSaxzQ3Nl5syU7eb1WA-G-iMOFvYVRUZ0f8ZVmTYMhifCKMcqjhl27JxGRW56-FgNfgGF_WUY4wCAAA=",target:"_blank",rel:"noopener noreferrer",children:"点击查看浏览器效果"}),"。"]}),"\n",(0,s.jsxs)(n.p,{children:["此外，因为是自动收集，Svelte 提供了 ",(0,s.jsx)(n.a,{href:"https://svelte.dev/docs/svelte/svelte#untrack",title:"https://svelte.dev/docs/svelte/svelte#untrack",target:"_blank",rel:"noopener noreferrer",children:"untrack"})," 方法用于避免成为依赖项："]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:"<script>\n  import { untrack } from 'svelte';\n\n  let { a, b } = $props();\n\n  $effect(() => {\n    // `a` 改变的时候会运行\n    // `b` 改变的时候不会运行\n    console.log(a);\n    console.log(untrack(() => b));\n  });\n<\/script>\n"})}),"\n",(0,s.jsxs)(n.h2,{id:"8-effectpre",children:["8. $effect.pre",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#8-effectpre",children:"#"})]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"$effect"})," 运行在 DOM 更新之后，如果你需要运行在 DOM 更新之前，使用 ",(0,s.jsx)(n.code,{children:"$effect.pre"}),"符文："]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:"<script>\n  import { tick } from 'svelte';\n\n  let div = $state();\n  let messages = $state([1, 2, 3, 4]);\n\n  $effect.pre(() => {\n    // 首次还未挂载\n    if (!div) return;\n\n    // 追踪 messages 数组的长度，这样当它改变的时候，代码就会重新运行\n    messages.length;\n\n    // 当添加新 message 的时候自动滚动\n    if (div.offsetHeight + div.scrollTop > div.scrollHeight - 20) {\n      tick().then(() => {\n        div.scrollTo(0, div.scrollHeight);\n      });\n    }\n  });\n<\/script>\n<button onclick={() => messages.push(messages.length + 1)}>\n  Add\n</button>\n\n<div bind:this={div} style=\"height: 200px;overflow: auto;background-color: #111\">\n  {#each messages as message}\n    <p>{message}</p>\n  {/each}\n</div>\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://svelte-5-preview.vercel.app/#H4sIAAAAAAAAE11RzWrbQBB-lekmEJmqtpP2JMuG3PoAvUU5KNLKWixrxe5KbRCC_hgCxiWFNG5ienAohGBKcS9NW9v4ZSJZPuUViqTYbntYdmdmv5-ZCZFFHMyRchAiV29jpKB9z0MyEsdeFvAAOwIjGXHqMyPLqNxgxBMNzdUEaXuUCQhBEKMFEViMtmGnwOzUNDf742ABJgmgDttc6AJLpdoq3cac603MN7WDXRn2ZHgqw7PD4l92trFlYUOUPYYlqQT1BoR5SVQqsLzuJ1-v0vlF8nmU9N6ms1lRIhZIj0wSlIBh4TP3wU2OSeez9OdoI5-cjxeTzmLQWZ7P49_X99NeOr9Mhrfx7Cz-9i75-Cs-vVgMOsmnH_Hry_tp727yZTF8E4-_300Hy5P3SX-czj-kV71CYEVbdrDbFPbfwvHsLLmdxN1h0h-v5GHNnJ6M4u5NMhnE3ZsCko1VKpWFjd1_G9eESYIyNxh1nBdUqsqwiZ9j0rTFw_REVDzyS62sd6ce-UJQF6hrOMRo1cOCfu3d87kt_dcJPIbdUpQvft80M7qCJMu4arbjI-KairAJr4cmCSLg4tjBdQ3ZuSUF9qpV71WNBphZDn2pgO4LWjvSjVaTUd81nxjUoUyBLYxxTUO5UriFdcPe7Ernq3dUNKh6jXCVUSteAapkoCizaJIg96e5SEZtahKLYBMpgvk4Ooz-AMeWaXT_AgAA",title:"https://svelte-5-preview.vercel.app/#H4sIAAAAAAAAE11RzWrbQBB-lekmEJmqtpP2JMuG3PoAvUU5KNLKWixrxe5KbRCC_hgCxiWFNG5ienAohGBKcS9NW9v4ZSJZPuUViqTYbntYdmdmv5-ZCZFFHMyRchAiV29jpKB9z0MyEsdeFvAAOwIjGXHqMyPLqNxgxBMNzdUEaXuUCQhBEKMFEViMtmGnwOzUNDf742ABJgmgDttc6AJLpdoq3cac603MN7WDXRn2ZHgqw7PD4l92trFlYUOUPYYlqQT1BoR5SVQqsLzuJ1-v0vlF8nmU9N6ms1lRIhZIj0wSlIBh4TP3wU2OSeez9OdoI5-cjxeTzmLQWZ7P49_X99NeOr9Mhrfx7Cz-9i75-Cs-vVgMOsmnH_Hry_tp727yZTF8E4-_300Hy5P3SX-czj-kV71CYEVbdrDbFPbfwvHsLLmdxN1h0h-v5GHNnJ6M4u5NMhnE3ZsCko1VKpWFjd1_G9eESYIyNxh1nBdUqsqwiZ9j0rTFw_REVDzyS62sd6ce-UJQF6hrOMRo1cOCfu3d87kt_dcJPIbdUpQvft80M7qCJMu4arbjI-KairAJr4cmCSLg4tjBdQ3ZuSUF9qpV71WNBphZDn2pgO4LWjvSjVaTUd81nxjUoUyBLYxxTUO5UriFdcPe7Ernq3dUNKh6jXCVUSteAapkoCizaJIg96e5SEZtahKLYBMpgvk4Ooz-AMeWaXT_AgAA",target:"_blank",rel:"noopener noreferrer",children:"浏览器效果如下："})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:x,alt:""})}),"\n",(0,s.jsxs)(n.p,{children:["$effect.pre 可以替代 Svelte4 中的 ",(0,s.jsx)(n.code,{children:"beforeUpdate"})," 方法。Svelte 5 中，",(0,s.jsx)(n.code,{children:"afterUpdate"})," 和 ",(0,s.jsx)(n.code,{children:"beforeUpdate"})," 都会被弃用。"]}),"\n",(0,s.jsxs)(n.h2,{id:"9-effecttracking",children:["9. $effect.tracking",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#9-effecttracking",children:"#"})]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"$effect.tracking"})," 符文之前叫 ",(0,s.jsx)(n.code,{children:"$effect.active"}),"，用于判断代码是否运行在 effect 或 template 中："]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:"<script>\n  console.log('in component setup:', $effect.tracking()); // false\n\n  $effect(() => {\n    console.log('in effect:', $effect.tracking()); // true\n  });\n<\/script>\n\n<p>in template: {$effect.tracking()}</p> \x3c!-- true --\x3e\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://svelte-5-preview.vercel.app/#H4sIAAAAAAAACn3PQWrDMBAF0KtMRSA2xPFeUQU5R92FUUZBVB4N1rgQjO9eKSlkEcjyfz6PmVX5EDEr_bUqGidUWp2Z1UHJjWvIvxgFS85pmV1tTHZzYLEDDeIS5RTxGNO12QcClyZOhCSQURbW-wPs0Ht0cpR5dD-Brk3bnqDvwY8xYzGK8j9pmhY-Lay1eqUfm3eizEsFZWtPA5n-eSYZtkUQnDiOghrWV2IzPVswH113d6DrbHl6SpfgA16UruX2vf0BWo7W2y8BAAA=",title:"https://svelte-5-preview.vercel.app/#H4sIAAAAAAAACn3PQWrDMBAF0KtMRSA2xPFeUQU5R92FUUZBVB4N1rgQjO9eKSlkEcjyfz6PmVX5EDEr_bUqGidUWp2Z1UHJjWvIvxgFS85pmV1tTHZzYLEDDeIS5RTxGNO12QcClyZOhCSQURbW-wPs0Ht0cpR5dD-Brk3bnqDvwY8xYzGK8j9pmhY-Lay1eqUfm3eizEsFZWtPA5n-eSYZtkUQnDiOghrWV2IzPVswH113d6DrbHl6SpfgA16UruX2vf0BWo7W2y8BAAA=",target:"_blank",rel:"noopener noreferrer",children:"浏览器效果如下："})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:A,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"在 Svelte 官方文档中，关于 $effect.tracking 的使用写了这样一个 Demo："}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'import { tick } from "svelte";\n\nexport default function readable<T>(initial_value: T, start: (callback: (update: (v: T) => T) => T) => () => void) {\n  let value = $state(initial_value);\n\n  let subscribers = 0;\n  let stop: null | (() => void) = null;\n\n  return {\n    get value() {\n      // If in a tracking context ...\n      if ($effect.tracking()) {\n        $effect(() => {\n          // ...and there\'s no subscribers yet...\n          if (subscribers === 0) {\n            // ...invoke the function and listen to changes to update state\n            stop = start((fn) => (value = fn(value)));\n          }\n\n          subscribers++;\n\n          // The return callback is called once a listener unlistens\n          return () => {\n            tick().then(() => {\n              subscribers--;\n              // If it was the last subscriber...\n              if (subscribers === 0) {\n                // ...stop listening to changes\n                stop?.();\n                stop = null;\n              }\n            });\n          };\n        });\n      }\n\n      return value;\n    },\n  };\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"因为官方没有举出具体的实例，所以对于初学的同学可能感到有些莫名其妙。其实这段代码实现的是 Svelte 4 中 Readable Store 的符文实现。我给大家举个具体的实例，监听鼠标变化的值："}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"\x3c!-- App.svelte --\x3e\n<script>\n  import readable from './readable.svelte.js'\n  const postion = readable({x: 0, y: 0}, (set) => {\n    window.addEventListener(\"mousemove\", move);\n    function move({ clientX, clientY }) {\n      set((v) => {\n        return {\n          x: clientX,\n          y: clientY,\n        }\n      });\n    }\n    return () => {\n      window.removeEventListener(\"mousemove\", move);\n    }\n  })\n<\/script>\n\n{postion.value.x} , {postion.value.y}\n\n\x3c!-- readable.svelte.js --\x3e\nimport { tick } from 'svelte';\n\nexport default function readable(\n  initial_value,\n  start\n) {\n  let value = $state(initial_value);\n\n  let subscribers = 0;\n  let stop;\n\n  return {\n    get value() {\n      // If in a tracking context ...\n      if ($effect.tracking()) {\n        $effect(() => {\n          // ...and there's no subscribers yet...\n          if (subscribers === 0) {\n            // ...invoke the function and listen to changes to update state\n            stop = start((fn) => (value = fn(value)));\n          }\n\n          subscribers++;\n\n          // The return callback is called once a listener unlistens\n          return () => {\n            tick().then(() => {\n              subscribers--;\n              // If it was the last subscriber...\n              if (subscribers === 0) {\n                // ...stop listening to changes\n                stop?.();\n                stop = null;\n              }\n            });\n          };\n        });\n      }\n\n      return value;\n    }\n  };\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://svelte.dev/playground/a66b84864f3c4943961f113b5dc7698c?version=5.1.11",title:"https://svelte.dev/playground/a66b84864f3c4943961f113b5dc7698c?version=5.1.11",target:"_blank",rel:"noopener noreferrer",children:"浏览器效果如下："})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:h,alt:""})}),"\n",(0,s.jsxs)(n.p,{children:["准确的说，$effect.tracking 解决的不是可以不可以使用 effect 的问题，而是应该不应该使用 effect 的问题，比如在这个例子中，只有当我们在 effect 或模板中使用 ",(0,s.jsx)(n.code,{children:"value"}),"的时候才会注册 effect。"]}),"\n",(0,s.jsxs)(n.p,{children:["有一个关于 Svelte 5 符文的工具库，名为 ",(0,s.jsx)(n.a,{href:"https://runed.dev/docs",title:"https://runed.dev/docs",target:"_blank",rel:"noopener noreferrer",children:"Runed"}),"，它有个工具函数叫做 ",(0,s.jsx)(n.a,{href:"https://runed.dev/docs/utilities/media-query",title:"https://runed.dev/docs/utilities/media-query",target:"_blank",rel:"noopener noreferrer",children:"MediaQuery"}),"，基本用法如下："]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:'<script>\n  import { MediaQuery } from "runed";\n\n  const screen = new MediaQuery("(min-width: 640px)");\n<\/script>\n\n{#if screen.matches}\n  Your screen is less than 640px\n{:else}\n  Your screen is more than 640px\n{/if}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["查看它的",(0,s.jsx)(n.a,{href:"https://github.com/svecosystem/runed/blob/main/packages/runed/src/lib/utilities/MediaQuery/MediaQuery.svelte.ts",title:"https://github.com/svecosystem/runed/blob/main/packages/runed/src/lib/utilities/MediaQuery/MediaQuery.svelte.ts",target:"_blank",rel:"noopener noreferrer",children:"源码"}),"，也同样使用了 $effect.tracking："]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:'export class MediaQuery {\n  #propQuery: MaybeGetter<string>;\n  #query = $derived.by(() => extract(this.#propQuery));\n  #mediaQueryList = $derived(browser ? window.matchMedia(this.#query) : null);\n  #effectRegistered = 0;\n  #matches: boolean | undefined = $state();\n\n  constructor(query: MaybeGetter<string>) {\n    this.#propQuery = query;\n  }\n\n  get matches(): boolean | undefined {\n    if ($effect.tracking() && this.#effectRegistered === 0) {\n      // If we are in an effect and this effect has not been registered yet\n      // we match the current value, register the listener and return match\n      $effect(() => {\n        this.#effectRegistered++;\n\n        useEventListener(\n          () => this.#mediaQueryList,\n          "change",\n          (changed) => (this.#matches = changed.matches)\n        );\n\n        return () => {\n          this.#effectRegistered--;\n          this.#matches = undefined;\n        };\n      });\n    }\n\n    return this.#matches ?? this.#mediaQueryList?.matches;\n  }\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["用法跟上个例子是很像的。可以看到当我们 ",(0,s.jsx)(n.code,{children:"new MediaQuery"})," 的时候并不会注册 effect，只有当调用 ",(0,s.jsx)(n.code,{children:"matches"})," 并在追踪上下文的时候才会注册 effect。"]}),"\n",(0,s.jsxs)(n.h2,{id:"10-effectroot",children:["10. $effect.root",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#10-effectroot",children:"#"})]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"$effect.root"}),"可以创建一个不会自动清理的 effect，可用于手动控制 effect，也可在组件初始化阶段之外创建效果："]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:"<script>\n  let x = $state(0);\n\n  const cleanup = $effect.root(() => {\n    $effect(() => {\n      console.log(x);\n    });\n\n    return () => {\n      console.log('cleanup 1');\n    }\n  });\n<\/script>\n\n<button onclick={() => x++}>{x}</button>\n\n<button onclick={cleanup}>cleanup</button>\n\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://svelte-5-preview.vercel.app/#H4sIAAAAAAAAE32P0WrDMAxFf8WIQVMa2u01Swz9jrkPmasMM1c2tjxSjP99uEk7BmNPku69OkIZJmMxQveWgcYLQgdH76EFvvo6xC-0jNBCdCnoqvRRB-NZKlJskcUsBvEUeWRsnreviqquHUUW2uJIyVcfpwk174Nz3DRbMUiRa07x6vwWF4CzuLfuo5lvVFZc7njFATkFEv9sbe7XXzaP_VpukP7w8wT174nZkXCkrdGfQ16o825XZJ5Lf1h8-UdyvVHk2jyy0MLFnc1k8Awdh4TlVL4BnYIiTmsBAAA=",title:"https://svelte-5-preview.vercel.app/#H4sIAAAAAAAAE32P0WrDMAxFf8WIQVMa2u01Swz9jrkPmasMM1c2tjxSjP99uEk7BmNPku69OkIZJmMxQveWgcYLQgdH76EFvvo6xC-0jNBCdCnoqvRRB-NZKlJskcUsBvEUeWRsnreviqquHUUW2uJIyVcfpwk174Nz3DRbMUiRa07x6vwWF4CzuLfuo5lvVFZc7njFATkFEv9sbe7XXzaP_VpukP7w8wT174nZkXCkrdGfQ16o825XZJ5Lf1h8-UdyvVHk2jyy0MLFnc1k8Awdh4TlVL4BnYIiTmsBAAA=",target:"_blank",rel:"noopener noreferrer",children:"浏览器效果如下："})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:o,alt:""})}),"\n",(0,s.jsxs)(n.p,{children:["效果描述：当点击 ",(0,s.jsx)(n.code,{children:"cleanup"}),"按钮的时候，effect 不再运行，也就不会再打印状态"]}),"\n",(0,s.jsxs)(n.h2,{id:"11-props",children:["11. $props",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#11-props",children:"#"})]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"$props"})," 用于声明组件属性，可替代 Svelte 4 的 ",(0,s.jsx)(n.code,{children:"export let"}),"："]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:"let { optionalProp = 42, requiredProp } = $props();\n"})}),"\n",(0,s.jsxs)(n.p,{children:["支持重命名，可替代 Svelte4 的 ",(0,s.jsx)(n.code,{children:"export { x as y }"}),"语法："]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:"let { catch: theCatch } = $props();\n"})}),"\n",(0,s.jsxs)(n.p,{children:["可替代 ",(0,s.jsx)(n.code,{children:"$props"})," 和 ",(0,s.jsx)(n.code,{children:"$restProps"}),"："]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"let { a, b, c, ...everythingElse } = $props();\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"props 默认只读"}),"，但这句话的意思并不是指子组件不能修改 props，子组件依然可以暂时覆盖 props 的值，而是指对 props 重新赋值不会向上传播，让我们看个例子："]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:"\x3c!-- App.svelte --\x3e\n<script>\n  import Input from './Input.svelte'\n  let value = '1'\n<\/script>\n\nApp: {value}\n\n<hr />\n\n<Input value={value} />\n\n\x3c!-- Input.svelte --\x3e\n<script>\n  let { value } = $props();\n<\/script>\n\n<input type=\"text\" bind:value />\n\nInput: {value}\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://svelte-5-preview.vercel.app/#H4sIAAAAAAAAE42PwQrCMAyGXyUEYQrD4bVuwo4-g_WgLsPC1oY2E2Xs3aWdDMSLtyR__j9fRmxNRwHVaUR76QkV1syYo7w4NuFBnRDmGNzgb3FShps3LAdttZienRc4Wh4EWu96yLZF6razMYtbHQk8Lt1AUEG2y7QtiyWjZlYwJnXSVtvy7qE4pGpOTVL12UgS5ti7xrSGGlTiB5ryhT15_qWPXOOHbIIKVuwdh_Vm_0WobWkSScysNAo9RSNcjW3U7J150-nll1_I8_QGMGOwcGwBAAA=",title:"https://svelte-5-preview.vercel.app/#H4sIAAAAAAAAE42PwQrCMAyGXyUEYQrD4bVuwo4-g_WgLsPC1oY2E2Xs3aWdDMSLtyR__j9fRmxNRwHVaUR76QkV1syYo7w4NuFBnRDmGNzgb3FShps3LAdttZienRc4Wh4EWu96yLZF6razMYtbHQk8Lt1AUEG2y7QtiyWjZlYwJnXSVtvy7qE4pGpOTVL12UgS5ti7xrSGGlTiB5ryhT15_qWPXOOHbIIKVuwdh_Vm_0WobWkSScysNAo9RSNcjW3U7J150-nll1_I8_QGMGOwcGwBAAA=",target:"_blank",rel:"noopener noreferrer",children:"浏览器效果如下："})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:p,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"子组件修改了来自 props 的值，但对 props 重新赋值不会向上传播，所以 input 值的修改并没有影响父组件的 value 值。"}),"\n",(0,s.jsxs)(n.p,{children:["如果你尝试在父组件用 ",(0,s.jsx)(n.code,{children:"bind:"}),"指令绑定 props 属性："]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:"\x3c!-- App.svelte --\x3e\n<Input bind:value />\n"})}),"\n",(0,s.jsx)(n.p,{children:"此时会有错误提示："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:d,alt:""})}),"\n",(0,s.jsxs)(n.p,{children:["要想正确使用，需要将 props 声明为 bindable，也就是接下来要讲的 ",(0,s.jsx)(n.code,{children:"$bindable()"}),"符文。"]}),"\n",(0,s.jsxs)(n.h2,{id:"12-bindable",children:["12. $bindable",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#12-bindable",children:"#"})]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"$bindable()"})," 符文用于将 props 声明为可绑定的，可用于解决父子组件共用一个状态的问题："]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:"\x3c!-- App.svelte --\x3e\n<script>\n  import Input from './Input.svelte'\n  let value = '1'\n<\/script>\n\nApp: {value}\n\n<hr />\n\n<Input bind:value />\n\n\x3c!-- Input.svelte --\x3e\n<script>\n  let { value = $bindable() } = $props();\n<\/script>\n\n<input type=\"text\" bind:value />\n\nInput: {value}\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://svelte-5-preview.vercel.app/#H4sIAAAAAAAAE42PwWrDMAyGX0WIQloIDb16aaHHPcO8Q9oo1ODIwlbKRsi7DzsQ6HbZTb-kX_-nGQfnKaH5mJG7kdDgVQRr1G_JIj3JK2GNKUzxnjttukcnerFs1Y0SosI7y6QwxDBCdWyKOq7GKm95Unh2fiI4Q3WqLLfNduMqYmAu08Wy5fYRobmUar16c9yb1Z37WOMYejc46tFonGipN_Bi-C96hpo3rF2O6W6e9gdYspYYJO0Pby-wlltXoHLC2aLSl1r8jWi5gGxv_UX-XH4AfnCFq3cBAAA=",title:"https://svelte-5-preview.vercel.app/#H4sIAAAAAAAAE42PwWrDMAyGX0WIQloIDb16aaHHPcO8Q9oo1ODIwlbKRsi7DzsQ6HbZTb-kX_-nGQfnKaH5mJG7kdDgVQRr1G_JIj3JK2GNKUzxnjttukcnerFs1Y0SosI7y6QwxDBCdWyKOq7GKm95Unh2fiI4Q3WqLLfNduMqYmAu08Wy5fYRobmUar16c9yb1Z37WOMYejc46tFonGipN_Bi-C96hpo3rF2O6W6e9gdYspYYJO0Pby-wlltXoHLC2aLSl1r8jWi5gGxv_UX-XH4AfnCFq3cBAAA=",target:"_blank",rel:"noopener noreferrer",children:"浏览器效果如下："})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:a,alt:""})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"$bindable()"})," 支持传入一个参数，当属性为 undefined 时，此参数会用作缺省值："]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:"<script>\n  let { bindableProp = $bindable('fallback') } = $props();\n<\/script>\n"})}),"\n",(0,s.jsx)(n.p,{children:"以刚才的代码为例："}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:"\x3c!-- App.svelte --\x3e\n<script>\n  import Input from './Input.svelte'\n  let value = 1\n<\/script>\n\nApp: {value}\n\n<hr />\n\n<Input />\n\n\x3c!-- Input.svelte --\x3e\n<script>\n  let { value = $bindable('123') } = $props();\n<\/script>\n\n<input type=\"text\" bind:value />\n\nInput: {value}\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.a,{href:"https://svelte-5-preview.vercel.app/#H4sIAAAAAAAAE42PwWrDMBBEf2VZCk7AxCS9qY4hx3xDlYMdr6nAlhZpHVqM_71IDoLQS2-a2dHumwUHM1JA9bmgbSdChRdmLFF-OIrwoFEISwxu9vfo1OHuDUujLYCZ2HmBq-VZYPBuguJQJXXYPhYxNZLAox1ngjMcta2rvOHCrGBJs1VbbesvD1WTXtvOp-ietuRBZ2yvtqVVgyVOrjeDoR6V-JnWMrdJ8f_2iaRLZn2LR9pupF1xPL0Xe1ijyd5x2O0_XopoW5vEFc-cNQp9i8ZXyphKNLnyX-7b-guWsXKQkQEAAA==",title:"https://svelte-5-preview.vercel.app/#H4sIAAAAAAAAE42PwWrDMBBEf2VZCk7AxCS9qY4hx3xDlYMdr6nAlhZpHVqM_71IDoLQS2-a2dHumwUHM1JA9bmgbSdChRdmLFF-OIrwoFEISwxu9vfo1OHuDUujLYCZ2HmBq-VZYPBuguJQJXXYPhYxNZLAox1ngjMcta2rvOHCrGBJs1VbbesvD1WTXtvOp-ietuRBZ2yvtqVVgyVOrjeDoR6V-JnWMrdJ8f_2iaRLZn2LR9pupF1xPL0Xe1ijyd5x2O0_XopoW5vEFc-cNQp9i8ZXyphKNLnyX-7b-guWsXKQkQEAAA==",target:"_blank",rel:"noopener noreferrer",children:"浏览器效果如下"}),"："]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:i,alt:""})}),"\n",(0,s.jsxs)(n.p,{children:["但是要注意，当父级使用 ",(0,s.jsx)(n.code,{children:"bind:"})," 传递属性的时候，不允许父级传递 undefined。"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.a,{href:"https://svelte-5-preview.vercel.app/#H4sIAAAAAAAAE42PwWrDMAyGX0WIQVoIDetuXhLocc9Q95A2CjU4trCVshLy7sMOBMouvUm_fun_NONgLEVU5xldNxIqPDFjifLk1MQHWSEsMfop3JJSx1swLK12AGZkHwR-HE8CQ_AjFIcqd4d1sUguSwKPzk6kXV1t2ydmBXPWF-20q-8BqjZX672rcb3Kc6haLHH0vRkM9agkTLSUG3C2v4ucYOYVBxr4SCHd1dKu-Dx-FXtYksjBc9ztv194tatN5koxjUahX9H4SplcmWb77D_3ZfkDpfr__3QBAAA=",title:"https://svelte-5-preview.vercel.app/#H4sIAAAAAAAAE42PwWrDMAyGX0WIQVoIDetuXhLocc9Q95A2CjU4trCVshLy7sMOBMouvUm_fun_NONgLEVU5xldNxIqPDFjifLk1MQHWSEsMfop3JJSx1swLK12AGZkHwR-HE8CQ_AjFIcqd4d1sUguSwKPzk6kXV1t2ydmBXPWF-20q-8BqjZX672rcb3Kc6haLHH0vRkM9agkTLSUG3C2v4ucYOYVBxr4SCHd1dKu-Dx-FXtYksjBc9ztv194tatN5koxjUahX9H4SplcmWb77D_3ZfkDpfr__3QBAAA=",target:"_blank",rel:"noopener noreferrer",children:"浏览器效果如下："}),"："]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:l,alt:""})}),"\n",(0,s.jsxs)(n.h2,{id:"13-inspect",children:["13. $inspect",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#13-inspect",children:"#"})]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"$inspect"})," 类似于 Svelte 4 的 ",(0,s.jsx)(n.code,{children:"@debug"}),"，用于深度追踪状态值的变化："]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:"<script>\n  let count = $state(0);\n  let message = $state('hello');\n\n  // 当 `count` or `message` 改变的时候 console.log\n  $inspect(count, message);\n<\/script>\n\n<button onclick={() => count++}>Increment</button>\n\n<input bind:value={message} />\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"$inspect"})," 返回一个属性 ",(0,s.jsx)(n.code,{children:"with"}),"，它是一个函数，接收一个回调函数作为参数，会替代原本的 console.log。回调函数的第一个参数是 ",(0,s.jsx)(n.code,{children:"init"}),"或者 ",(0,s.jsx)(n.code,{children:"update"}),"，表示更新的时机，剩下的参数则是传入 ",(0,s.jsx)(n.code,{children:"$inspect"})," 的值："]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:"<script>\n  let count = $state(0);\n\n  $inspect(count).with((type, count) => {\n    if (type === 'update') {\n      debugger; // 或者 `console.trace`, 随你\n    }\n  });\n<\/script>\n\n<button onclick={() => count++}>Increment</button>\n"})}),"\n",(0,s.jsxs)(n.p,{children:["一种使用 ",(0,s.jsx)(n.code,{children:"with"})," 查找更改来源的简便写法："]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"$inspect(stuff).with(console.trace);\n"})}),"\n",(0,s.jsxs)(n.p,{children:["注意：",(0,s.jsx)(n.code,{children:"$inspect"})," 仅运行在开发环境"]}),"\n",(0,s.jsxs)(n.h2,{id:"14-host",children:["14. $host",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#14-host",children:"#"})]}),"\n",(0,s.jsx)(n.p,{children:"$host 符文仅用于自定义元素组件内部，且只能用在客户端。表示包含该组件的自定义元素的引用："}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:"\x3c!-- Stepper.svelte --\x3e\n<svelte:options customElement=\"my-stepper\" />\n\n<script>\n  function dispatch(type) {\n    $host().dispatchEvent(new CustomEvent(type));\n  }\n<\/script>\n\n<button onclick={() => dispatch('decrement')}>decrement</button>\n<button onclick={() => dispatch('increment')}>increment</button>\n\n\x3c!-- App.svelte --\x3e\n<script>\n  import './Stepper.svelte';\n\n  let count = $state(0);\n<\/script>\n\n<my-stepper\n  ondecrement={() => count -= 1}\n  onincrement={() => count += 1}\n></my-stepper>\n\n<p>count: {count}</p>\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://svelte.dev/playground/adfafc477e9c443ab2ffac9057304f5a?version=5.1.11",title:"https://svelte.dev/playground/adfafc477e9c443ab2ffac9057304f5a?version=5.1.11",target:"_blank",rel:"noopener noreferrer",children:"浏览器效果如下："})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:c,alt:""})}),"\n",(0,s.jsxs)(n.h2,{id:"15-总结",children:["15. 总结",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#15-总结",children:"#"})]}),"\n",(0,s.jsxs)(n.p,{children:["本篇我们讲解了当前全部 14 个符文的用法，最常用的也就是 ",(0,s.jsx)(n.code,{children:"$state"}),"、",(0,s.jsx)(n.code,{children:"$state.snapshot"}),"、",(0,s.jsx)(n.code,{children:"$derived"}),"、",(0,s.jsx)(n.code,{children:"$effect"}),"、",(0,s.jsx)(n.code,{children:"$props"}),"、",(0,s.jsx)(n.code,{children:"$inspect"}),"这些，初学时了解基本用法即可，因为写 Svelte 项目不可避免的会用到这些符文，在实践中慢慢加深理解即可。"]})]})}function Q(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,r.ah)(),e.components);return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(B,{...e})}):B(e)}let y=Q;Q.__RSPRESS_PAGE_META={},Q.__RSPRESS_PAGE_META["Svelte%20%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97%2F4-%E8%AF%AD%E6%B3%95%E7%AF%87%20%E2%9D%98%20%E7%AC%A6%E6%96%87%E5%85%A8%E5%9B%BE%E9%89%B4.md"]={toc:[{text:"1. 前言",id:"1-前言",depth:2},{text:"2. $state",id:"2-state",depth:2},{text:"3. $state.raw",id:"3-stateraw",depth:2},{text:"4. $state.snapshot",id:"4-statesnapshot",depth:2},{text:"5. $derived",id:"5-derived",depth:2},{text:"6. $derived.by",id:"6-derivedby",depth:2},{text:"7. $effect",id:"7-effect",depth:2},{text:"8. $effect.pre",id:"8-effectpre",depth:2},{text:"9. $effect.tracking",id:"9-effecttracking",depth:2},{text:"10. $effect.root",id:"10-effectroot",depth:2},{text:"11. $props",id:"11-props",depth:2},{text:"12. $bindable",id:"12-bindable",depth:2},{text:"13. $inspect",id:"13-inspect",depth:2},{text:"14. $host",id:"14-host",depth:2},{text:"15. 总结",id:"15-总结",depth:2}],title:"4-语法篇 ❘ 符文全图鉴",headingTitle:"4-语法篇 ❘ 符文全图鉴",frontmatter:{}}}}]);