"use strict";(self.webpackChunkjue_jin_book_press=self.webpackChunkjue_jin_book_press||[]).push([["66530"],{832608:function(e,n,r){r.r(n),r.d(n,{default:()=>h});var s=r(552676),c=r(740453);let i=r.p+"static/image/62f9587907253d9e9fac7ec05929b7d4.99f8605f.webp",l=r.p+"static/image/ae0f19943ff71d50298efc3d71d961b3.ecd762ca.webp",d=r.p+"static/image/e22410a6a9b71f9db79578989de5727d.416f728d.webp";function t(e){let n=Object.assign({h1:"h1",a:"a",blockquote:"blockquote",p:"p",h2:"h2",code:"code",pre:"pre",ol:"ol",li:"li",h3:"h3",img:"img"},(0,c.ah)(),e.components);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.h1,{id:"22-sveltekit--路径别名环境变量server-only",children:["22-SvelteKit ❘ 路径别名、环境变量、Server-only",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#22-sveltekit--路径别名环境变量server-only",children:"#"})]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"推荐学习指数：⭐️️，了解即可"}),"\n"]}),"\n",(0,s.jsxs)(n.h2,{id:"1-前言",children:["1. 前言",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#1-前言",children:"#"})]}),"\n",(0,s.jsx)(n.p,{children:"本篇我们讲解 SveteKit 如何配置路径别名和环境变量，以及如何保证文件只运行在服务端。"}),"\n",(0,s.jsxs)(n.h2,{id:"2-路径别名",children:["2. 路径别名",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#2-路径别名",children:"#"})]}),"\n",(0,s.jsxs)(n.p,{children:["SvelteKit 内置了 ",(0,s.jsx)(n.code,{children:"$lib"}),"路径别名，指向 ",(0,s.jsx)(n.code,{children:"src/lib"}),"目录，这样当你导入 ",(0,s.jsx)(n.code,{children:"src/lib"}),"下的文件时，不需要 ",(0,s.jsx)(n.code,{children:"../../../"}),"这样找到相对地址，而是可以从 ",(0,s.jsx)(n.code,{children:"$lib/..."}),"导入。"]}),"\n",(0,s.jsxs)(n.p,{children:["除了 ",(0,s.jsx)(n.code,{children:"$lib"}),"，还有一个 ",(0,s.jsx)(n.code,{children:"$lib/server"}),"，它指向 ",(0,s.jsx)(n.code,{children:"src/lib/server"}),"文件夹，之所以特殊，是因为这个目录下的所有文件，SveteKit 会阻止导入到客户端模块中。"]}),"\n",(0,s.jsxs)(n.p,{children:["如果你想要配置自己的路径别名，可以在 ",(0,s.jsx)(n.code,{children:"svelte.config.js"}),"中配置："]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"import adapter from '@sveltejs/adapter-auto';\n\nconst config = {\n    kit: {\n        adapter: adapter(),\n        alias: {\n            $components: 'src/components'\n        }\n    }\n};\n\nexport default config;\n"})}),"\n",(0,s.jsxs)(n.p,{children:["此时新建 ",(0,s.jsx)(n.code,{children:"src/components/Button.svelte"}),"，代码如下："]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-html",children:"<button>Click</button>\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"src/routes/+page.svelte"})," 就可以使用路径别名导入："]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-html",children:'<script>\n  import Button from "$components/Button.svelte";\n<\/script>\n\n<button />\n'})}),"\n",(0,s.jsxs)(n.h2,{id:"3-环境变量",children:["3. 环境变量",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#3-环境变量",children:"#"})]}),"\n",(0,s.jsx)(n.p,{children:"通常大部分应用都会用到环境变量。环境变量可以让你："}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"根据不同的环境使用不同的值"}),"\n",(0,s.jsx)(n.li,{children:"防止敏感信息暴露到浏览器中"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["环境变量可以添加到 ",(0,s.jsx)(n.code,{children:".env"}),"文件（项目根目录），还可以使用 ",(0,s.jsx)(n.code,{children:".env.local"}),"或 ",(0,s.jsx)(n.code,{children:".env.[mode]"}),"，表示不同的模式，具体参考 ",(0,s.jsx)(n.a,{href:"https://cn.vitejs.dev/guide/env-and-mode",title:"https://cn.vitejs.dev/guide/env-and-mode",target:"_blank",rel:"noopener noreferrer",children:"Vite 环境变量文档"}),"。"]}),"\n",(0,s.jsxs)(n.p,{children:["写入的环境变量可以从 ",(0,s.jsx)(n.code,{children:"$env/static/private"}),"、",(0,s.jsx)(n.code,{children:"$env/dynamic/private"}),"、",(0,s.jsx)(n.code,{children:"$env/static/public"}),"、",(0,s.jsx)(n.code,{children:"$env/static/public"}),"导入。简单来说，分为 2 类："]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"static 和 dynamic：static 表示值在构建的时候是已知的，可以静态替换，做些优化，但更新需要重新构建部署。dynamic 表示值是动态的，引用的时候才知道具体的值"}),"\n",(0,s.jsx)(n.li,{children:"public 和 private：private 表示只能用于服务端，public 表示服务端客户端都可用"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"我们接下来一一讲解。"}),"\n",(0,s.jsxs)(n.h3,{id:"31-envstaticprivate",children:["3.1. $env/static/private",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#31-envstaticprivate",children:"#"})]}),"\n",(0,s.jsxs)(n.p,{children:["新建 ",(0,s.jsx)(n.code,{children:".env"}),"，代码如下："]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'DB_PASSWORD = "edr83k1eou0"\n'})}),"\n",(0,s.jsxs)(n.p,{children:["此时可以在 ",(0,s.jsx)(n.code,{children:"+page.server.js"}),"中通过 ",(0,s.jsx)(n.code,{children:"$env/static/private"}),"获取。"]}),"\n",(0,s.jsxs)(n.p,{children:["新建 ",(0,s.jsx)(n.code,{children:"src/routes/+page.server.js"}),"，代码如下："]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"import { DB_PASSWORD } from '$env/static/private';\n\nexport function load() {\n    console.log(DB_PASSWORD);\n    return {\n        data: []\n    };\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["打开 ",(0,s.jsx)(n.a,{href:"http://localhost:5173/",title:"http://localhost:5173/",target:"_blank",rel:"noopener noreferrer",children:(0,s.jsx)(n.a,{href:"http://localhost:5173/",target:"_blank",rel:"noopener noreferrer",children:"http://localhost:5173/"})}),"，此时会看到命令行中打印了环境变量的值："]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:d,alt:""})}),"\n",(0,s.jsxs)(n.p,{children:["但如果从 ",(0,s.jsx)(n.code,{children:"+page.svelte"}),"中导入，新建 ",(0,s.jsx)(n.code,{children:"src/routes/+page.svelte"}),"，代码如下："]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-html",children:'<script>\n  import { DB_PASSWORD } from "$env/static/private";\n<\/script>\n\n<h1>Hello World!</h1>\n'})}),"\n",(0,s.jsx)(n.p,{children:"此时命令行会出现报错："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:l,alt:""})}),"\n",(0,s.jsxs)(n.p,{children:["所以 ",(0,s.jsx)(n.code,{children:"$env/static/private"}),"只能导入到服务端模块："]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"+page.server.js"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"+layout.server.js"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"+server.js"})}),"\n",(0,s.jsxs)(n.li,{children:["以 ",(0,s.jsx)(n.code,{children:".server.js"}),"结尾的模块"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"src/lib/server"}),"下的模块"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"导入到客户端代码则会出现报错，这就防止了敏感数据意外发送到浏览器中。"}),"\n",(0,s.jsxs)(n.h3,{id:"32-envdynamicprivate",children:["3.2. $env/dynamic/private",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#32-envdynamicprivate",children:"#"})]}),"\n",(0,s.jsxs)(n.p,{children:["修改 ",(0,s.jsx)(n.code,{children:"src/routes/+page.server.js"}),"，代码如下："]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"import { env } from '$env/dynamic/private';\n\nexport function load() {\n    console.log(env.DB_PASSWORD);\n    return {\n        data: []\n    };\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["使用动态环境变量，需要先导入 ",(0,s.jsx)(n.code,{children:"env"}),"对象，然后从 ",(0,s.jsx)(n.code,{children:"env"})," 对象获取具体的环境变量。"]}),"\n",(0,s.jsxs)(n.h3,{id:"33-envstaticpublic",children:["3.3. $env/static/public",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#33-envstaticpublic",children:"#"})]}),"\n",(0,s.jsxs)(n.p,{children:["如果环境变量要暴露给浏览器，环境变量需要携带 ",(0,s.jsx)(n.code,{children:"PUBLIC_"}),"前缀和私有环境变量做区分。"]}),"\n",(0,s.jsxs)(n.p,{children:["修改 ",(0,s.jsx)(n.code,{children:"svelte-app/.env"}),"，代码如下："]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'DB_PASSWORD = "edr83k1eou0"\n\nPUBLIC_THEME_FOREGROUND="blue"\n'})}),"\n",(0,s.jsxs)(n.p,{children:["修改 ",(0,s.jsx)(n.code,{children:"svelte-app/src/routes/+page.svelte"}),"，代码如下："]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:"<script>\n    import { PUBLIC_THEME_FOREGROUND } from '$env/static/public';\n<\/script>\n\n<h1 style=\"color: {PUBLIC_THEME_FOREGROUND} \">Hello World!</h1>\n"})}),"\n",(0,s.jsx)(n.p,{children:"浏览器效果如下："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:i,alt:""})}),"\n",(0,s.jsxs)(n.h3,{id:"34-envdynamicpublic",children:["3.4. $env/dynamic/public",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#34-envdynamicpublic",children:"#"})]}),"\n",(0,s.jsxs)(n.p,{children:["修改 ",(0,s.jsx)(n.code,{children:"svelte-app/src/routes/+page.svelte"}),"，代码如下："]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:'<script>\n  import { env } from "$env/dynamic/public";\n<\/script>\n\n<h1 style="color: {env.PUBLIC_THEME_FOREGROUND}">Hello World!</h1>\n'})}),"\n",(0,s.jsx)(n.p,{children:"浏览器效果同上。"}),"\n",(0,s.jsxs)(n.h2,{id:"4-server-only",children:["4. Server-only",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#4-server-only",children:"#"})]}),"\n",(0,s.jsx)(n.p,{children:"如何保证自己的模块只在服务端运行呢？"}),"\n",(0,s.jsx)(n.p,{children:"有两种方式："}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["文件名添加 ",(0,s.jsx)(n.code,{children:".server"}),"，比如 ",(0,s.jsx)(n.code,{children:"secrets.server.js"})]}),"\n",(0,s.jsxs)(n.li,{children:["将文件放到 ",(0,s.jsx)(n.code,{children:"$lib/server"}),"中，比如 ",(0,s.jsx)(n.code,{children:"$lib/server/secrets.js"})]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"此时无论是直接还是间接导入这些模块，都会导致错误。官方文档里举的例子："}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// $lib/server/secrets.js\nexport const atlantisCoordinates = [/* redacted */];\n\n// src/routes/utils.js\nexport { atlantisCoordinates } from '$lib/server/secrets.js';\n\nexport const add = (a, b) => a + b;\n\n// src/routes/+page.svelte\n<script>\n    import { add } from './utils.js';\n<\/script>\n"})}),"\n",(0,s.jsxs)(n.p,{children:["虽然 ",(0,s.jsx)(n.code,{children:"+page.svelte"}),"只使用了 ",(0,s.jsx)(n.code,{children:"add"})," 而没有使用 ",(0,s.jsx)(n.code,{children:"atlantisCoordinates"}),"，但敏感信息依然可能会以 JavaScript 的形式出现，所以也被认为是不安全的，此时会有错误提示："]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-html",children:"Cannot import $lib/server/secrets.js into public-facing code:\n- src/routes/+page.svelte\n	- src/routes/utils.js\n		- $lib/server/secrets.js\n"})})]})}function a(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,c.ah)(),e.components);return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(t,{...e})}):t(e)}let h=a;a.__RSPRESS_PAGE_META={},a.__RSPRESS_PAGE_META["Svelte%20%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97%2F22-SvelteKit%20%E2%9D%98%20%E8%B7%AF%E5%BE%84%E5%88%AB%E5%90%8D%E3%80%81%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E3%80%81Server-only.md"]={toc:[{text:"1. 前言",id:"1-前言",depth:2},{text:"2. 路径别名",id:"2-路径别名",depth:2},{text:"3. 环境变量",id:"3-环境变量",depth:2},{text:"3.1. $env/static/private",id:"31-envstaticprivate",depth:3},{text:"3.2. $env/dynamic/private",id:"32-envdynamicprivate",depth:3},{text:"3.3. $env/static/public",id:"33-envstaticpublic",depth:3},{text:"3.4. $env/dynamic/public",id:"34-envdynamicpublic",depth:3},{text:"4. Server-only",id:"4-server-only",depth:2}],title:"22-SvelteKit ❘ 路径别名、环境变量、Server-only",headingTitle:"22-SvelteKit ❘ 路径别名、环境变量、Server-only",frontmatter:{}}}}]);