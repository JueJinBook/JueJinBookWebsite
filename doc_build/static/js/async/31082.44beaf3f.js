"use strict";(self.webpackChunkjue_jin_book_press=self.webpackChunkjue_jin_book_press||[]).push([["31082"],{338781:function(n,e,i){i.r(e),i.d(e,{default:()=>o});var a=i(552676),s=i(740453);let c=i.p+"static/image/dcaeb401c5dfe5d88078b946bd84c9dc.da8802e8.webp",d=i.p+"static/image/b558a258b11eed7778046a70ff1e30d3.ec9c081b.webp",l=i.p+"static/image/f132d665515ce812bc247ce4d48bd455.0ea705d3.webp",t=i.p+"static/image/0739d3cf312ca89fa6d1a37781c1527b.ceec48ee.webp",r=i.p+"static/image/dcf3219f10e151f68a90c22c1fc14464.f4eafb9c.webp";function g(n){let e=Object.assign({h1:"h1",a:"a",p:"p",strong:"strong",h2:"h2",img:"img",pre:"pre",code:"code",blockquote:"blockquote"},(0,s.ah)(),n.components);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(e.h1,{id:"12应用篇-1优化首屏体验lazy-load-初探",children:["12.应用篇 1：优化首屏体验——Lazy-Load 初探",(0,a.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#12应用篇-1优化首屏体验lazy-load-初探",children:"#"})]}),"\n",(0,a.jsx)(e.p,{children:"首先要告诉大家的是，截止到上个章节，我们需要大家绞尽脑汁去理解的“硬核”操作基本告一段落了。从本节开始，我们会一起去实现一些必知必会、同时难度不大的常用优化手段。"}),"\n",(0,a.jsxs)(e.p,{children:["这部分内容不难，但",(0,a.jsx)(e.strong,{children:"很关键"}),"。尤其是近期有校招或跳槽需求的同学，还请务必对这部分内容多加留心，说不定下一次的面试题里就有它们的身影。"]}),"\n",(0,a.jsxs)(e.h2,{id:"lazy-load-初相见",children:["Lazy-Load 初相见",(0,a.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#lazy-load-初相见",children:"#"})]}),"\n",(0,a.jsx)(e.p,{children:"Lazy-Load，翻译过来是“懒加载”。它是针对图片加载时机的优化：在一些图片量比较大的网站（比如电商网站首页，或者团购网站、小游戏首页等），如果我们尝试在用户打开页面的时候，就把所有的图片资源加载完毕，那么很可能会造成白屏、卡顿等现象，因为图片真的太多了，一口气处理这么多任务，浏览器做不到啊！"}),"\n",(0,a.jsx)(e.p,{children:"但我们再想，用户真的需要这么多图片吗？不对，用户点开页面的瞬间，呈现给他的只有屏幕的一部分（我们称之为首屏）。只要我们可以在页面打开的时候把首屏的图片资源加载出来，用户就会认为页面是没问题的。至于下面的图片，我们完全可以等用户下拉的瞬间再即时去请求、即时呈现给他。这样一来，性能的压力小了，用户的体验却没有变差——这个延迟加载的过程，就是 Lazy-Load。"}),"\n",(0,a.jsx)(e.p,{children:"现在我们打开掘金首页："}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)("img",{src:r,alt:""})}),"\n",(0,a.jsx)(e.p,{children:"大家留意一栏文章右侧可能会出现的图片，这里咱们给个特写："}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)("img",{src:t,alt:""})}),"\n",(0,a.jsx)(e.p,{children:"大家现在以尽可能快的速度，疯狂向下拉动页面。发现什么？是不是发现我们图示的这个图片的位置，会出现闪动——有时候我们明明已经拉到目标位置了，文字也呈现完毕了，图片却慢半拍才显示出来。这是因为，掘金首页也采用了懒加载策略。当我们的页面并未滚动至包含图片的 div 元素所在的位置时，它的样式是这样的："}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)("img",{src:l,alt:""})}),"\n",(0,a.jsx)(e.p,{children:"我们把代码提出来看一下："}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-html",children:'<div data-v-b2db8566="" \n    data-v-009ea7bb="" \n    data-v-6b46a625=""   \n    data-src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2018/9/27/16619f449ee24252~tplv-t2oaga2asx-image.image"    \n    class="lazy thumb thumb"    \n    style="background-image: none; background-size: cover;">  \n</div>\n'})}),"\n",(0,a.jsxs)(e.p,{children:["我们注意到 style 内联样式中，背景图片设置为了 none。也就是说这个 div 是没有内容的，它只起到一个",(0,a.jsx)(e.strong,{children:"占位"}),"的作用。"]}),"\n",(0,a.jsx)(e.p,{children:"这个“占位”的概念，在这个例子里或许体现得不够直观。最直观的应该是淘宝首页的 HTML Preview 效果："}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)("img",{src:d,alt:""})}),"\n",(0,a.jsx)(e.p,{children:"我们看到，这个还没来得及被图片填充完全的网页，是用大大小小的空 div 元素来占位的。掘金首页也是如此。"}),"\n",(0,a.jsx)(e.p,{children:"一旦我们通过滚动使得这个 div 出现在了可见范围内，那么 div 元素的内容就会发生变化，呈现如下的内容："}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)("img",{src:c,alt:""})}),"\n",(0,a.jsx)(e.p,{children:"我们给 style 一个特写："}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-html",children:'style="background-image: url(&quot;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2018/9/27/16619f449ee24252~tplv-t2oaga2asx-image.image;); background-size: cover;"\n'})}),"\n",(0,a.jsx)(e.p,{children:"可以看出，style 内联样式中的背景图片属性从 none 变成了一个在线图片的 URL。也就是说，出现在可视区域的瞬间，div 元素的内容被即时地修改掉了——它被写入了有效的图片 URL，于是图片才得以呈现。这就是懒加载的实现思路。"}),"\n",(0,a.jsxs)(e.h2,{id:"一起写一个-lazy-load-吧",children:["一起写一个 Lazy-Load 吧！",(0,a.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#一起写一个-lazy-load-吧",children:"#"})]}),"\n",(0,a.jsx)(e.p,{children:"基于上面的实现思路，我们完全可以手动实现一个属于自己的 Lazy-Load。"}),"\n",(0,a.jsxs)(e.p,{children:["（",(0,a.jsx)(e.strong,{children:"此处敲黑板划重点，Lazy-Load 的思路及实现方式为大厂面试常考题，还望诸位同学引起重视"}),"）"]}),"\n",(0,a.jsx)(e.p,{children:"首先新建一个空项目，目录结构如下："}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)("img",{src:"data:image/webp;base64,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",alt:""})}),"\n",(0,a.jsx)(e.p,{children:"大家可以往 images 文件夹里塞入各种各样自己喜欢的图片。"}),"\n",(0,a.jsx)(e.p,{children:"我们在 index.html 中，为这些图片预置 img 标签："}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-html",children:'<!DOCTYPE html>\n<html lang="en">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <meta http-equiv="X-UA-Compatible" content="ie=edge">\n  <title>Lazy-Load</title>\n  <style>\n    .img {\n      width: 200px;\n      height:200px;\n      background-color: gray;\n    }\n    .pic {\n      // 必要的img样式\n    }\n  </style>\n</head>\n<body>\n  <div class="container">\n    <div class="img">\n      // 注意我们并没有为它引入真实的src\n      <img class="pic" alt="加载中" data-src="./images/1.png">\n    </div>\n    <div class="img">\n      <img class="pic" alt="加载中" data-src="./images/2.png">\n    </div>\n    <div class="img">\n      <img class="pic" alt="加载中" data-src="./images/3.png">\n    </div>\n    <div class="img">\n      <img class="pic" alt="加载中" data-src="./images/4.png">\n    </div>\n    <div class="img">\n      <img class="pic" alt="加载中" data-src="./images/5.png">\n    </div>\n     <div class="img">\n      <img class="pic" alt="加载中" data-src="./images/6.png">\n    </div>\n     <div class="img">\n      <img class="pic" alt="加载中" data-src="./images/7.png">\n    </div>\n     <div class="img">\n      <img class="pic" alt="加载中" data-src="./images/8.png">\n    </div>\n     <div class="img">\n      <img class="pic" alt="加载中" data-src="./images/9.png">\n    </div>\n     <div class="img">\n      <img class="pic" alt="加载中" data-src="./images/10.png">\n    </div>\n  </div>\n</body>\n</html>\n'})}),"\n",(0,a.jsxs)(e.p,{children:["在懒加载的实现中，有两个关键的数值：一个是",(0,a.jsx)(e.strong,{children:"当前可视区域的高度"}),"，另一个是",(0,a.jsx)(e.strong,{children:"元素距离可视区域顶部的高度"}),"。"]}),"\n",(0,a.jsxs)(e.p,{children:[(0,a.jsx)(e.strong,{children:"当前可视区域的高度"}),"， 在和现代浏览器及 IE9 以上的浏览器中，可以用 window.innerHeight 属性获取。在低版本 IE 的标准模式中，可以用 document.documentElement.clientHeight 获取，这里我们兼容两种情况："]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-javascript",children:"const viewHeight = window.innerHeight || document.documentElement.clientHeight \n"})}),"\n",(0,a.jsxs)(e.p,{children:["而",(0,a.jsx)(e.strong,{children:"元素距离可视区域顶部的高度"}),"，我们这里选用 getBoundingClientRect() 方法来获取返回元素的大小及其相对于视口的位置。对此 MDN 给出了非常清晰的解释："]}),"\n",(0,a.jsxs)(e.blockquote,{children:["\n",(0,a.jsx)(e.p,{children:"该方法的返回值是一个 DOMRect 对象，这个对象是由该元素的 getClientRects() 方法返回的一组矩形的集合, 即：是与该元素相关的 CSS 边框集合 。"}),"\n"]}),"\n",(0,a.jsxs)(e.blockquote,{children:["\n",(0,a.jsx)(e.p,{children:"DOMRect 对象包含了一组用于描述边框的只读属性——left、top、right 和 bottom，单位为像素。除了 width 和 height 外的属性都是相对于视口的左上角位置而言的。"}),"\n"]}),"\n",(0,a.jsx)(e.p,{children:"其中需要引起我们注意的就是 left、top、right 和 bottom，它们对应到元素上是这样的："}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)("img",{src:"data:image/webp;base64,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",alt:""})}),"\n",(0,a.jsx)(e.p,{children:"可以看出，top 属性代表了元素距离可视区域顶部的高度，正好可以为我们所用！"}),"\n",(0,a.jsx)(e.p,{children:"Lazy-Load 方法开工啦！"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-html",children:"<script>\n    // 获取所有的图片标签\n    const imgs = document.getElementsByTagName('img')\n    // 获取可视区域的高度\n    const viewHeight = window.innerHeight || document.documentElement.clientHeight\n    // num用于统计当前显示到了哪一张图片，避免每次都从第一张图片开始检查是否露出\n    let num = 0\n    function lazyload(){\n        for(let i=num; i<imgs.length; i++) {\n            // 用可视区域高度减去元素顶部距离可视区域顶部的高度\n            let distance = viewHeight - imgs[i].getBoundingClientRect().top\n            // 如果可视区域高度大于等于元素顶部距离可视区域顶部的高度，说明元素露出\n            if(distance >= 0 ){\n                // 给元素写入真实的src，展示图片\n                imgs[i].src = imgs[i].getAttribute('data-src')\n                // 前i张图片已经加载完毕，下次从第i+1张开始检查是否露出\n                num = i + 1\n            }\n        }\n    }\n    // 监听Scroll事件\n    window.addEventListener('scroll', lazyload, false);\n<\/script>\n"})}),"\n",(0,a.jsxs)(e.h2,{id:"小结",children:["小结",(0,a.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#小结",children:"#"})]}),"\n",(0,a.jsxs)(e.p,{children:["本节我们实现出了一个最基本的懒加载功能。但是大家要注意一点：这个 scroll 事件，是一个",(0,a.jsx)(e.strong,{children:"危险"}),"的事件——它太容易被触发了。试想，用户在访问网页的时候，是不是可以无限次地去触发滚动？尤其是一个页面死活加载不出来的时候，疯狂调戏鼠标滚轮（或者浏览器滚动条）的用户可不在少数啊！"]}),"\n",(0,a.jsx)(e.p,{children:"再回头看看我们上面写的代码。按照我们的逻辑，用户的每一次滚动都将触发我们的监听函数。函数执行是吃性能的，频繁地响应某个事件将造成大量不必要的页面计算。因此，我们需要针对那些有可能被频繁触发的事件作进一步地优化。这里就引出了我们下一节的两位主角——throttle 与 debounce。"}),"\n",(0,a.jsx)(e.p,{children:"（阅读过程中有任何想法或疑问，或者单纯希望和笔者交个朋友啥的，欢迎大家添加我的微信xyalinode与我交流哈~）"})]})}function h(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}=Object.assign({},(0,s.ah)(),n.components);return e?(0,a.jsx)(e,{...n,children:(0,a.jsx)(g,{...n})}):g(n)}let o=h;h.__RSPRESS_PAGE_META={},h.__RSPRESS_PAGE_META["%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E8%B7%B5%2F12.%E5%BA%94%E7%94%A8%E7%AF%87%201%EF%BC%9A%E4%BC%98%E5%8C%96%E9%A6%96%E5%B1%8F%E4%BD%93%E9%AA%8C%E2%80%94%E2%80%94Lazy-Load%20%E5%88%9D%E6%8E%A2.md"]={toc:[{text:"Lazy-Load 初相见",id:"lazy-load-初相见",depth:2},{text:"一起写一个 Lazy-Load 吧！",id:"一起写一个-lazy-load-吧",depth:2},{text:"小结",id:"小结",depth:2}],title:"12.应用篇 1：优化首屏体验——Lazy-Load 初探",headingTitle:"12.应用篇 1：优化首屏体验——Lazy-Load 初探",frontmatter:{}}}}]);