"use strict";(self.webpackChunkjue_jin_book_press=self.webpackChunkjue_jin_book_press||[]).push([["67971"],{723005:function(e,n,s){s.r(n),s.d(n,{default:()=>h});var r=s(552676),c=s(740453);let i=s.p+"static/image/25f8ed08363e89fe639200090bb14f7b.05dec4bb.png",d=s.p+"static/image/d276d08e0df2c81af773ba4a187e9d25.f60d2a2b.png",l=s.p+"static/image/d364d33f45a4cc45e2717de3d90d777f.4432bc32.png";function t(e){let n=Object.assign({h1:"h1",a:"a",h2:"h2",p:"p",h3:"h3",h4:"h4",strong:"strong",code:"code",ul:"ul",li:"li",img:"img",blockquote:"blockquote",pre:"pre"},(0,c.ah)(),e.components);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.h1,{id:"76短信发送",children:["76.短信发送",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#76短信发送",children:"#"})]}),"\n",(0,r.jsxs)(n.h2,{id:"119-短信发送",children:["11.9 短信发送",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#119-短信发送",children:"#"})]}),"\n",(0,r.jsx)(n.p,{children:"结合一些第三方提供的短信API，使用云开发的云函数也能发送短信验证码、系统和活动通知等，下面以腾讯云的短信服务为例。腾讯云有针对Node环境的tencentcloud-sdk-Node.js模块，集成了腾讯云多项服务，除了短信之外，腾讯云服务的几乎所有能力都会集成在这个开发者工具套件（SDK）里。"}),"\n",(0,r.jsxs)(n.h3,{id:"1191-开通腾讯云短信服务",children:["11.9.1 开通腾讯云短信服务",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#1191-开通腾讯云短信服务",children:"#"})]}),"\n",(0,r.jsxs)(n.h4,{id:"1开通短信服务",children:["1、开通短信服务",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#1开通短信服务",children:"#"})]}),"\n",(0,r.jsxs)(n.p,{children:["登录",(0,r.jsx)(n.a,{href:"https://console.cloud.tencent.com/smsv2",target:"_blank",rel:"noopener noreferrer",children:"短信控制台"}),"，这里的账号不限于小程序的账号，其他账号也可以；也不限于是个人账号还是企业账号，不过账号需要进行实名认证，个人认证用户只能发送短信验证码、短信通知等，不能用于营销短信；企业认证用户可以发送短信验证码、短信通知、营销短信等。如果账号已经认证，直接申请短信服务就可以开通了。"]}),"\n",(0,r.jsxs)(n.h4,{id:"2创建应用",children:["2、创建应用",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#2创建应用",children:"#"})]}),"\n",(0,r.jsxs)(n.p,{children:["创建应用可用于个性化管理短信发送任务，例如设置不同的发送频率和发送超量提醒等。打开左侧菜单里的",(0,r.jsx)(n.strong,{children:"应用管理"}),"-",(0,r.jsx)(n.strong,{children:"应用列表"}),"，点击",(0,r.jsx)(n.strong,{children:"创建应用"}),"，应用名称可以为你的小程序名称+云开发，便于区分管理。创建后，会有一个",(0,r.jsx)(n.code,{children:"SDKAppID"}),"，这个之后会用到。"]}),"\n",(0,r.jsxs)(n.h4,{id:"3创建签名和正文模板",children:["3、创建签名和正文模板",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#3创建签名和正文模板",children:"#"})]}),"\n",(0,r.jsxs)(n.p,{children:["国内短信由签名+正文组成，签名符号为【】，发送短信内容时必须带签名。所以要发送短信，需要申请",(0,r.jsx)(n.strong,{children:"短信签名"}),"和",(0,r.jsx)(n.strong,{children:"正文模板"}),"，两者都通过审核后，就可以开始发送短信了。"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"1、创建签名"})}),"\n",(0,r.jsxs)(n.p,{children:["打开左侧菜单里的",(0,r.jsx)(n.strong,{children:"国内短信"}),"-",(0,r.jsx)(n.strong,{children:"签名管理"}),"，点击",(0,r.jsx)(n.strong,{children:"创建签名"}),"，创建完签名后，这个",(0,r.jsx)(n.code,{children:"签名内容"}),"之后会用到。"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"签名用途：选择【自用（签名为本账号实名认证的公司、网站、产品名等）】。"}),"\n",(0,r.jsx)(n.li,{children:"签名类型：选择【小程序】。"}),"\n",(0,r.jsx)(n.li,{children:"签名内容：输入公司名或小程序名或产品名称"}),"\n",(0,r.jsxs)(n.li,{children:["证明类型：选择小程序设置页面截图，然后上传小程序",(0,r.jsx)(n.strong,{children:"设置页面"}),"截图，可以参考案例；"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:l,alt:"创建签名"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"2、创建正文模板"})}),"\n",(0,r.jsxs)(n.p,{children:["打开左侧菜单里的",(0,r.jsx)(n.strong,{children:"国内短信"}),"-",(0,r.jsx)(n.strong,{children:"正文模板管理"}),"，点击",(0,r.jsx)(n.strong,{children:"创建正文模板"}),"，创建完模板后，会有一个模板",(0,r.jsx)(n.code,{children:"ID"}),"，这个之后会用到，也要记住你模板的变量位置。"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"模板名称，建议带有明确目的的名称，比如“注册通知”、“购买成功反馈”等；"}),"\n",(0,r.jsx)(n.li,{children:"短信类型：选择【普通短信】"}),"\n",(0,r.jsxs)(n.li,{children:["短信内容：比如“您正在申请手机注册，验证码为：{1}，{2}分钟内有效！”，这里的",(0,r.jsx)(n.code,{children:"{1}"}),"和",(0,r.jsx)(n.code,{children:"{2}"}),"是你要在代码里传入的变量，变量的编码必须是从{1}开始，传入变量时也要按照顺序传入"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:d,alt:"创建正文模板"})}),"\n",(0,r.jsxs)(n.h4,{id:"3获取安全凭证",children:["3、获取安全凭证",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#3获取安全凭证",children:"#"})]}),"\n",(0,r.jsxs)(n.p,{children:["在使用云API之前，用户首先需要在腾讯云控制台上申请安全凭证(API密钥)，安全凭证包括 SecretID 和 SecretKey。打开腾讯云访问密钥的",(0,r.jsx)(n.a,{href:"https://console.cloud.tencent.com/cam/capi",target:"_blank",rel:"noopener noreferrer",children:"API密钥管理"}),"，点击",(0,r.jsx)(n.strong,{children:"新建密钥"}),"，就可以创建密钥了，创建之后，就可以看到 ",(0,r.jsx)(n.code,{children:"SecretID"}),"和",(0,r.jsx)(n.code,{children:"SecretKey"}),"，这两个之后会用到。"]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"API 密钥是构建腾讯云 API 请求的重要凭证，使用腾讯云 API 可以操作你这个账号名下的所有腾讯云资源，一定要妥善保管和定期更新，不要分享给别人或者上传到网络上。"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:i,alt:"获取安全凭证"})}),"\n",(0,r.jsxs)(n.h3,{id:"1192-使用云函数发送短信",children:["11.9.2 使用云函数发送短信",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#1192-使用云函数发送短信",children:"#"})]}),"\n",(0,r.jsx)(n.p,{children:"使用开发者工具新建一个云函数，比如sms，打开云函数目录中的 package.json ，新增最新版tencentcloud-sdk-Node.js 依赖，右键云函数目录选择在终端中打开输入命令npm install安装依赖：："}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:'"dependencies": {\n  "wx-server-sdk":"latest",\n  "tencentcloud-sdk-Node.js":"latest"\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"然后再在云函数的目录下面新建一个config文件夹，在config文件夹里创建一个config.js，云函数的目录结构如下图所示："}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"sms // 云函数目录\n├── config //config文件夹\n│   └── config.js //config.js文件\n└── index.js\n└── config.json \n└── package.json \n"})}),"\n",(0,r.jsx)(n.p,{children:"然后再在config.js里输入以下代码，填入获取安全凭证里的SecretID 和 SecretKey:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"module.exports = {\n    secretId: 'wxda99ae45313257046',  \n    secretKey: 'josgjwoijgowjgjsogjo', \n  }\n"})}),"\n",(0,r.jsx)(n.p,{children:"再在index.js里输入以下代码，代码的内容比较多，但是基本都是从腾讯云短信的技术文档里直接Copy过来的，我们只需要改里面相应的参数即可，比如"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["req.SmsSdkAppid为",(0,r.jsx)(n.strong,{children:"创建应用"}),"环节里的",(0,r.jsx)(n.code,{children:"SDKAppID"}),"，"]}),"\n",(0,r.jsxs)(n.li,{children:["req.Sign为创建签名里的",(0,r.jsx)(n.code,{children:"签名内容"}),"，"]}),"\n",(0,r.jsxs)(n.li,{children:["req.TemplateID为创建正文模板环节里的模板",(0,r.jsx)(n.code,{children:"ID"}),"，"]}),"\n",(0,r.jsx)(n.li,{children:"req.TemplateParamSet为模板内容里的变量，值为数组，有多少个变量就往数组里填多少个字符串"}),"\n",(0,r.jsx)(n.li,{children:"req.PhoneNumberSet为用户的手机号码，测试时可以填你自己的"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"修改完以上内容之后，就可以触发该云函数给相应的手机号发送短信了："}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:'const cloud = require(\'wx-server-sdk\')\nconst tencentcloud = require("tencentcloud-sdk-Node.js");\ncloud.init({\n  env: cloud.DYNAMIC_CURRENT_ENV,\n})\nconst config= require("./config/config.js")\nconst {secretId,secretKey} = config\nexports.main = async (event, context) => {\n  const smsClient = tencentcloud.sms.v20190711.Client;\n  const models = tencentcloud.sms.v20190711.Models;\n  const Credential = tencentcloud.common.Credential;\n  const ClientProfile = tencentcloud.common.ClientProfile;\n  const HttpProfile = tencentcloud.common.HttpProfile;\n\n  let cred = new Credential(secretId,secretKey)\n  let httpProfile = new HttpProfile();\n  httpProfile.reqMethod = "POST";\n  httpProfile.reqTimeout = 30;\n  httpProfile.endpoint = "sms.tencentcloudapi.com";\n  let clientProfile = new ClientProfile();\n  clientProfile.signMethod = "HmacSHA256";\n  clientProfile.httpProfile = httpProfile;\n  \n  let client = new smsClient(cred, "ap-guangzhou", clientProfile);\n\n  let req = new models.SendSmsRequest();\n\n  req.SmsSdkAppid = "1400364657";\n  req.Sign = "HackWeek";\n  req.ExtendCode = "";\n  req.SenderId = "";\n  req.SessionContext = "";\n\n  req.PhoneNumberSet = ["+86185****3"];\n\n  req.TemplateID = "597853";\n\n  req.TemplateParamSet = ["1234","5"];\n  \n\n  client.SendSms(req, function (err, response) {\n      if (err) {\n          console.log(err);\n          return;\n      }\n      console.log(response.to_json_string());\n  });\n\n}\n'})})]})}function o(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,c.ah)(),e.components);return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(t,{...e})}):t(e)}let h=o;o.__RSPRESS_PAGE_META={},o.__RSPRESS_PAGE_META["%E5%B0%8F%E7%A8%8B%E5%BA%8F%E4%BA%91%E5%BC%80%E5%8F%91%E5%85%A5%E9%97%A8%E5%88%B0%E5%AE%9E%E8%B7%B5%2F76.%E7%9F%AD%E4%BF%A1%E5%8F%91%E9%80%81.md"]={toc:[{text:"11.9 短信发送",id:"119-短信发送",depth:2},{text:"11.9.1 开通腾讯云短信服务",id:"1191-开通腾讯云短信服务",depth:3},{text:"1、开通短信服务",id:"1开通短信服务",depth:4},{text:"2、创建应用",id:"2创建应用",depth:4},{text:"3、创建签名和正文模板",id:"3创建签名和正文模板",depth:4},{text:"3、获取安全凭证",id:"3获取安全凭证",depth:4},{text:"11.9.2 使用云函数发送短信",id:"1192-使用云函数发送短信",depth:3}],title:"76.短信发送",headingTitle:"76.短信发送",frontmatter:{}}}}]);