"use strict";(self.webpackChunkjue_jin_book_press=self.webpackChunkjue_jin_book_press||[]).push([["36535"],{725790:function(e,n,s){s.r(n),s.d(n,{default:()=>X});var c=s(552676),a=s(740453);let i=s.p+"static/image/6230331a271137d8f69d675aabf4bc2e.637826d3.webp",r=s.p+"static/image/87f0a70d0003865f1c627574ac091597.fbe8f199.webp",l=s.p+"static/image/5cc9b03a0d5c7c1457ab14e0adedae60.47990350.webp",p=s.p+"static/image/3276f0c3c4094438d1133ee7456f6062.c1456d5e.webp",d=s.p+"static/image/4a2d23beb0a72398a1a80f4fbc5ec994.0251deaa.webp",t=s.p+"static/image/40b0deff347dc0cc8bb563d2e06ce2dc.7fd6baff.webp",j=s.p+"static/image/f45fe6bf406ff53ce609a706584cd896.1eaa070a.webp",b=s.p+"static/image/09d4cca374bfa5b441da60509473b3cd.9cfb4ed7.webp",x=s.p+"static/image/fb51a2fb823217e48070aec9e2844573.bbd513a7.webp",h=s.p+"static/image/570975921752714c5a00c8b9b7ffa494.64a95a99.webp",f=s.p+"static/image/76d30cd00645e3e52702bc72fc0275f3.a565c78c.webp",o=s.p+"static/image/cb8a4e46c7af67f21a103181767b93e6.c6458f8f.webp",g=s.p+"static/image/2c5e5f6794a369d2940dd75fd7773647.c678d8ab.webp",m=s.p+"static/image/ea996f99f66bc12c281afcc95684dde1.49530341.webp",A=s.p+"static/image/304de20dcb55613bfed73bc723f2b354.0a3d565e.webp",u=s.p+"static/image/63d9438ff44e836ec630711b5079ee1f.e37b4acc.webp",w=s.p+"static/image/33bc1994c9f4fe05f9fa92b60ec82044.99365ea7.webp",v=s.p+"static/image/fdaeda91cfbca64f40f2bcb95763c82b.ff45bcc7.webp",B=s.p+"static/image/8b60ced89a13c1b546e6bb35508ceabc.48eed44d.webp",U=s.p+"static/image/9c08565bf65c3c6f03aa7831e5931920.b997dfd8.webp",L=s.p+"static/image/943bb298098591efcf15ff154fa53cdf.108075ca.webp",V=s.p+"static/image/b92b0ead5bce7ad6b569a430155daf69.9712bb40.webp",k=s.p+"static/image/f1948abb95a3f09396263829a3ae9553.bde20da8.webp",D=s.p+"static/image/755e4217c2bbdf6fe001adbf38b41980.cbcd2e7f.webp",N=s.p+"static/image/11328f458a68f9d5e18eafd86c1dc844.9b933584.webp",E=s.p+"static/image/f09aff8d09db800790c8fc59770909af.b4039853.webp",M=s.p+"static/image/a199681d79027961e5cd497fb3eefed5.5cda5dd9.webp",P=s.p+"static/image/42270257546bbe05fb3098091c3c1e97.2c75a215.webp",I=s.p+"static/image/e2cd67a45240644a0067ad9d28b4909e.5042e31a.webp",S=s.p+"static/image/8eebde44c7143d966caac828968c96b9.41be05ca.webp",H=s.p+"static/image/fb7c6e3ec8051047208d481d9d298dd5.9635cdfe.webp",G=s.p+"static/image/5fde40ec11540aca6665d248656cbc88.a04eaa76.webp",T=s.p+"static/image/266c371b7556ca36a05285d002673f39.f7a4347c.webp",y=s.p+"static/image/610eb4a569a86a8462ed0b012a417cec.d7bb78b9.webp",Z=s.p+"static/image/173df781ccfebcd46f69702ad0ff8347.3b04d764.webp";function z(e){let n=Object.assign({h1:"h1",a:"a",p:"p",img:"img",pre:"pre",code:"code",h2:"h2"},(0,a.ah)(),e.components);return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)(n.h1,{id:"141-nest-的-monorepo-和-library",children:["141. Nest 的 Monorepo 和 Library",(0,c.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#141-nest-的-monorepo-和-library",children:"#"})]}),"\n",(0,c.jsx)(n.p,{children:"上节我们学习微服务时创建了 2 个 Nest 项目，如果微服务多了，可能会创建更多项目。"}),"\n",(0,c.jsx)(n.p,{children:"那问题来了，如果有 10 个微服务，我们就创建 10 个 Nest 项目的 git 仓库么？"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:Z,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"那肯定不行，太难维护了。"}),"\n",(0,c.jsx)(n.p,{children:"这时候我们就需要 monorepo 了。"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:y,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"这样，同一个 git 仓库中存放多个 Nest 项目，外层叫做 workspace。"}),"\n",(0,c.jsx)(n.p,{children:"这样就算是 10 个微服务项目，也能在一个 Git 仓库里管理起来。"}),"\n",(0,c.jsx)(n.p,{children:"Nest 是支持这种 monorepo 的方式的，我们来试试看："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"nest new monorepo-test\n"})}),"\n",(0,c.jsx)(n.p,{children:"创建个 nest 项目"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:T,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"我们添加一个 aaa 的路由："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:G,alt:""})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:"@Get('aaa')\naaa() {\n    return 'aaa';\n}\n"})}),"\n",(0,c.jsx)(n.p,{children:"改下端口："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:H,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"然后把它跑起来："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"npm run start:dev\n"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:S,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"浏览器访问下："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:"data:image/webp;base64,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",alt:""})}),"\n",(0,c.jsx)(n.p,{children:"没啥问题。"}),"\n",(0,c.jsx)(n.p,{children:"然后我们再添加一个 nest 项目："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"nest g app app2\n"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:I,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"它删除了 src 和 test，并创建了 apps 目录："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:P,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"这里的 apps/monorepo-test 就是之前的 src、test 代码："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:M,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"而 apps/app2 就是新创建的 nest 项目，或者叫 nest app。"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:E,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"把之前的服务停掉，重新跑:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"npm run start:dev\n"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:N,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"可以看到，跑的还是之前的那个 nest 项目，只不过换成了 webpack 编译。"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:"data:image/webp;base64,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",alt:""})}),"\n",(0,c.jsx)(n.p,{children:"为什么同样都是 nest run start:dev，换成 monorepo 的形式之后，还是跑之前项目呢？"}),"\n",(0,c.jsx)(n.p,{children:"答案在 nest-cli.json 里："}),"\n",(0,c.jsx)(n.p,{children:"之前 nest-cli.json 是这样的："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:D,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"现在变成了这样："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:k,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"projects 下保存着多个 nest 项目的信息，比如根目录、入口文件、src 目录、编译配置文件。"}),"\n",(0,c.jsx)(n.p,{children:"然后 sourceRoot 和 root 分别指向了默认项目的 src 目录和根目录。"}),"\n",(0,c.jsx)(n.p,{children:"所以跑 nest start 的时候，才会依然跑的是之前的项目。"}),"\n",(0,c.jsx)(n.p,{children:"很明显，如果想跑另一个项目，就要这样："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"npm run start:dev app2\n"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:V,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"比如我在 app2 添加一个 bbb 的路由："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:L,alt:""})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:"@Get('bbb')\nbbb() {\n    return 'bbb';\n}\n"})}),"\n",(0,c.jsx)(n.p,{children:"浏览器访问下："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:"data:image/webp;base64,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",alt:""})}),"\n",(0,c.jsx)(n.p,{children:"这样，app2 的服务就跑起来了。"}),"\n",(0,c.jsx)(n.p,{children:"原理也很简单，就是 nest cli 会根据 app 名字去读取对应的 tscofnig 文件："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:U,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"这就是 nest 的 monorepo。"}),"\n",(0,c.jsx)(n.p,{children:"项目多了以后，难免有一些公共代码，这种公共代码怎么复用呢？"}),"\n",(0,c.jsx)(n.p,{children:"这就涉及到 nest 的另一个特性了：library。"}),"\n",(0,c.jsx)(n.p,{children:"创建一个 library："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"nest g lib lib1\n"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:B,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"它会让你指定一个前缀，这里用默认的 @app。"}),"\n",(0,c.jsx)(n.p,{children:"然后会生成 libs/lib1 目录："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:v,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"在 src 下生成了 module、service 并把它们导出了。"}),"\n",(0,c.jsx)(n.p,{children:"还在 tsconfig.json 的 paths 下添加了对应的别名配置："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:w,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"在 nest-cli.json 里也多了这样一个 projects 配置："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:u,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"我们在 LibService 添加一个 xxx 方法："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:A,alt:""})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:"xxx() {\n    return 'xxx';\n}\n"})}),"\n",(0,c.jsx)(n.p,{children:"然后在 monorepo-test 的 app 里导入 Lib1Module："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:m,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"在 controller 里注入 Lib1Service 并调用它的方法："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:g,alt:""})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:"@Inject(Lib1Service)\nprivate lib : Lib1Service;\n\n@Get('aaa')\naaa() {\n    return 'aaa' + this.lib.xxx();\n}\n"})}),"\n",(0,c.jsx)(n.p,{children:"同样的方式，在 app2 里也导入并使用它："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:o,alt:""})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:f,alt:""})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:"@Inject(Lib1Service)\nprivate lib : Lib1Service;\n\n@Get('bbb')\nbbb() {\n    return 'bbb' + this.lib.xxx();\n}\n"})}),"\n",(0,c.jsx)(n.p,{children:"然后分别把两个服务跑起来："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"npm run start:dev\n\nnpm run start:dev app2\n"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:h,alt:""})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:x,alt:""})}),"\n",(0,c.jsxs)(n.p,{children:["浏览器访问下 ",(0,c.jsx)(n.a,{href:"http://localhost:3001/aaa",target:"_blank",rel:"noopener noreferrer",children:"http://localhost:3001/aaa"})," 和 ",(0,c.jsx)(n.a,{href:"http://localhost:3000/bbb",target:"_blank",rel:"noopener noreferrer",children:"http://localhost:3000/bbb"})]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:"data:image/webp;base64,UklGRtgPAABXRUJQVlA4IMwPAADQYgCdASpyAt4APp1KoU2lo6MiIRY5MLATiWlu4XX7RmiAORX6sf038bvBf/GeGPjG9fe5vra41/N/7DzP/j33X/McIPym1Avyb+f/5D7a/U72V+uf6/0AvdH7Z/r/7147+pr4D9gD+cf2jiaPwP/E9gL9I+rL/Vf/H/cedn9D/3/sJ/sJ6b/s3/bz2rw/CFrv7tBH6VvY2yaCP0uRsIprdBH6XI2EUyZ7sarjrBj92gmM+xDvPsQ7z7EO8+wxBS1gjCK1QkleKLHD7N68RIMZNKXOpYxY5rjj2UthQktUMw8knO0qvRZ6qxwsgahz5h98xjWllfzHZ7MBiAA7/thARiglc9kCNuy0dUVe1jrsDebVQgsKUax0XUkl3J19FifSJ2Ca0gHP+wH7yGlxa1+qqzuNpwveAbeHudQTwnXQAyZWAoQEzuHk3whzaAv7jCpKkiAvwYlwc/092XfBkrUTeBRI/B0mTjMieSZ2UzwqTClUAl2MjdMEfT0saTHTkS2J9l2YEb/5T2xl7/kZXqzHsHdztY6PgyRjOQLRCBQRUCCnUBqcmTQw56ltDgpHl3gTZtCG0sbQoB/EkMh+1cdcArjrGq1KfdI4xEwW4gK7FsWaxquOsarcxM1pbnljdBH6QzNBVelrPzl4Jy8E5eCcvBOXgnLwKYfefYh3n2Id59iHefYh3n2Id12VVW99SOxUJlOS4N0FUOuFmlXHWNVx1jVcdY1XHWNRUfcJVjYRSVh5+Vd7kMEI7zxWZN8SGSdR2JBK8PnHha+T2bk9cmhEelP22RWZYsQqSgHstJmrXQIsrGW2JkPHGw7z7EO8+xDvPsQ7z7EO7Htjikm1Cdl0w1I9GFYkEg3nWKei8p8tQthD2gvQUzzhkppVx1jVcdY1XHWNVx11Rp+6gdeTt9iHefYh3n2Id59iHefYh3n2Id59iHefYh3n2Id59iHefYh3n2Id59iHefYh3n1wVFORB8DsniJ9aZTLCBl4wnG8PdjVcdY1XHWNVx1jVW8FuuEtKH7RSWu0rXF9pWXZ/Ke8ek+JjKQPdnTUdlBMjnIAAP7/mM3+bf/HGP/9Mbevr6+vr62dVzyOyD+IQT19fX19fX19fX19ZBBST3qDKG+NkCEzlmlvrgFWgPGD9XAdSZDkzMsOjwznhlZqiem3L5ohZcbrlS6UmZ7lew0kw58sDiPaimW758xew2I7wTTDPUTHB7Exw5gNNEhqYHv3Ir9favr3UeiZAGbCPdLZH+dD1du77OsJ2ifrsrtknMOo9+x0UraucyRLgyVyuMO9lNLIk5R8jTFLd9bQ9a+29EgyEZGqlDmjeodhuJMIKhyyl4mtmcrrOffFCpknlq7/Erq4oQxQUeTZ/CF0SwfFGCXec77jqBqCZdiWiYm03P4eGMKhAKK4rwYiV+ukV56L5eVDyPfxEJbxkNio9Um4DI6Hsap5c7IgGEUCoeYiF5tmtfiBWCZ52mRiDgaVJ4zO24XGcv4VWP/sKc6RXvLCymbFCw2QGR/YYc+V7xTOur29KgyegXd2227qZIBUwlegvjvfD8C6w3Xa6vvGE38QwPFaTLStyVwcnEgkJd30BpyQs9igwsiMHB52hl2ZBYAVDUtIJmNufrbH1oExaPNfQRpTcMFFxHpABFzZ2ssuKHNIwZ/T+z6agX7g+/yvLdoa1c557BsQ0t2XZGyfGNJFX34m2jTULBZA/WSvo9GJAKHjKH7RM6hOOPa2sTER+mX6GtyMVZvmNvEBEGL9NX9gPftWh9rB4Q0OEW5sqNqsGs+IyCop3TS1weC+NLlrKlSgZr/15Yu9/TGtP4N3Oe+5nZw6Ddw11dsxsfAiUsBXbLuCqLNvuVkBuknqu3jIhlQI2hjWsQcU6+xT8tPvoRYNFNLHENd5JkCaLHGmf1nG0Mg2+g/5llMCVI3sTVXtujmKli2oa+v0s1fYDrteQikHDQCQthw3y2zUvLkWQeDHEkmq744rpbenzp4N50q8qJ3Pv4IG3TXqWn0dgOE8uEO5M1Md6TuMF9BJveHVpc9mP2YXqSTcRMgf1UYLbW6WvQvWRo3ds6PXDCN2EI24A0ptEUkBKqvIhrFvRO1V1JIu756TQbXwIshXgRpjZ6uWd4vTGbXDxlQVLzzHPJRjE0Izvy1nbvuSGswcmi38rFEZhqtd9wLNlPCVgSc1DibjjYJQFYu4JzqTskA+6rxCrBOQRyzWmHixGsHuJ8pwKpldAcncOJRwEoSMyXuEYK3ug69k4DgiZ54z+lvSIH/+VzW09gOQ3i/ZIAvkJFU0lNdI+v38ZSTuQXAw8LoxycEOk+MkDcAg4zb0xU5/UiNZQua7KaDwOHgC6XVBUZrNYUhfMi94ZSlVgz7JS/axjJDEJ6kL8fv8hJmOkHyZBX0xwH1X+MoVnpX0wRRuxOsEKWG0gKl7jxl+64S6M5bUW9jmGuRCF84c9vRTwxO9h+14dDO4riowlZz0DNa+/ik9Svo8Te70kYx/ZBSzMRFhbIxB3INsRr6JU5Qwfwx0Mi2RJS3H6Y6FGBiiShCjl1gNVZRls0R6eRjfAop422f287D956Pg51OACcZgqyiKG5aGnyVcXLy+vki8i2m3nBaAf+i0NF4yJv1b6Q+lSTb1tm0ukDY12M3atdSbMeLnAZF4B3nAlQ3huAosXDx+9xHx2uPO5tfl+CX3qfstSO0yRIWW2bhRgnxEkbkM/X+p2txMRsJn2VaGXQFzVYj+D4WQ84hLPs0+2A9BklVq/+Ti6xitYW+V3MsjiWokdRiXXMb6t9ib7UoU2mDfgRd+CMDf9CALN6p4Q7F0pykSuBbkQh54VsslWUID3zZZhKljFc+yVdSQojQA07JRxjHWl7LmlBcz3IOVMWOpfjZc7Bh9zsUbjbwXK09yR5v05mS/noa2TLjq6ibz2WZalH55/bXSZtsR+WrgnwOZ8FYQ/36gCPjLR4oJ5tlgKfzUewnQgEDcQweg3bQxdtepxoBOgdyoj9/rBMgyipxsGkxtChJz7wPR8toyg1dGjh8NLamRlgMpd+pB93ii0N1buqgNNPInBdDGNQNHrDC9AlFShAb7X6bLT09VBqbhXH272n7bMAJmwU31I5zio/7ius7qrqT0glBRG2w5/nnT7Cy5y2HveG0SWAHTBTndGMVoDIBaqWDmn40UX1rFY1uwogY2WMOkYqHduEQCHXRm+4wTjOFD6TSeH1DjJwqRZ9tWj+jPwmN8VjbaAkLJBLsJtCdncOJnBueiUXecYZw20ktdn+48vgQ0q3wobg47xD+VS2e7DhfskMJf5IXv7ct1lRKoECqFtjbEUix/B4ED1dy/NaaW7UZXKifnEd0ixxmExeXOqtIXh7GewDZE3cWu4h7BqzgdtGy9J4/1ipnUbubjFeOqHZNhYrFZIttXaebfZuE62DcCFdrD5IjgOrzMuYn8mnSnlpqvXU851sTfEq0VYU+lWncxjM+tHEoZ0iDcboikxyvEw5OKO2VAAlBqk4XVfwCssUAAABsJOb0sd+TFl1cWHf52a+muBbgk2oD7IpAAf4Eyf8IKOdgSCV+G/r6gQEE5k11DBas55+5kcW/Xf2ne58DN2qbd364VF5oc4loqPTTH3QE/l1yVHouUlBbUhJ5q5ZlC6wcIwnEZm+TWbRjk7Atqua46UOr7JRHMoGkGPb5Roof5c7LxOs3tZxXw/t1SRneFfnMkOWsWR+8x77geIbWsgkWmqqxykG+q5NbYDgsYjLe4E76kd29mgOPqmV/hseFklyCnnGTsLaKk/tTudFPI2bWVFg660981eA0DdEMufcz6IV0ZqOqGO/wHLgJ/ZTnv8b+8xBPjv0LXjeE5o5GfFqjyXIZBLJaa4Xw6wqGnJ2pPBWGbOsBHNmMpoW+XSMmK5xcp2GvbyTYuV8P2lzxU0K0BzQ/mE306GLa/T2xSgif6Ji7i0Gzg7dNl6QBC3UICmleOwYjxVayo6LSXuYH2u9f08Bp8kEh56Y6zm6HWBweUzd1HDp/uiewtpxWm61sCP8ICi9F5kp16oIGKVbx2oePqgVREcneJIuU6uz4xfn862jYHn6iNBE3PVpVvyAwoeMzgvozR2nZM3bTWZe4+4F/nMLfF19SX6MeBHQvkum2ki4Wat795cVXqcn6pOK5QerZe5R6GHp+wckzkBJKtt+micnRLeCalMsIPJrUjFUh9nfeaIiksINK3Q5UOl9ql5o7vBKGeeBUWzxjFCSp1K1KsCKv0Dpv1CKXjqux1P/0I9GemYe8gqaUfGo/EKDK4G6JRWF4TJIfEYv7JUqJot2JKAQV2QCMEbIuxNSeEw7kVadFp8XGHmJq8u6L5i9CSlBN24NYFpz/M55SuzlwV8oa6/SoWY/joj7zIb1URl5kHcrmZV20z3RjRfX5sEYpgXM2SYJ7auytAotv5Wshnr3sLYpQtoZkQ2vk5ynW16gPnniky8LSXAOZAmpKpAs7P6YdpXRyTOzMhPgCPQVx3l+IQA+O2jp07FbnoNwGzO7ptu2Ahpzh/MZwpLYrfhviCUQvqrAhAVOpD3D6Qim38/r2cBlGZnAmSVa+1+fTddrcf9/zh6pLDoPEGeWzVeZVkq1sI4+iG5mp4APPnaJUG+Mm3RSIlnPMHChlT9pGF7LpuMtVy85b326Xo0BzAM5LRDL62u/UhvsXaPqx9eYD/1Z1/vyvuRgx/33Wt5P/5Z/yrvvZL8QDQ89v/9SHP8YEbTmLS3agXCU+3ftbT2uuzqZm21IeQjGA4e3CE40N0jvNAzY9hH4zkEjD/Wbm11tbsh6+1s30cYn2hmYiso155RJvDy8m47//64IgH//oZTof9RUgHyOgAAAAAAEvvvVLdmiO+Fdkmj4xL8gMuRzev+nhSuqkBWgwiImBFKkKReR9Bwa/gmriz7HebvzJtLaQHNj46blO1zuPOqTHvRLBOCjdyCLjrtylsEuRg0Y7jH/3OscJrYviTsZuUptvX9snxjQpeAxKuoEtykKiUL12GFzD6E5WAFtTnL2zUxJ7M2sKmjnQ1OME4o5qbxEZyf849MQEQNg5TDpklLZ/+1cwHwP6b7CB6i0R2Y6USv1UG0jKSRQm25orciEFw/C3/T+HZT3Nm0+WRSDO//TtjSGjNzKlxgMTpvddif6KEAJYH8q7wbKVxf95iTg7AdBWkIRJh0+BQEm0EkNTlc1iBETN0RH2BMBvJofk2PMC+TEDnAUbz7pJyUjqIiTCD6x8fIdZ/3udNBts0J54mRLmVm6IjoY66K0bsHFRqThazzAigNqtToeN5XzWw6k3woy5SITsEQbSutwwLWKdw2k8imdsHgUd7OW+DHl/A7KOBpC+8MbFx3WtqgYMhg0BwSPOSWbdOeDR05DwastDNkEg8sQAAAAA=",alt:""})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:b,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"可以看到，引入的 library 中的模块生效了。"}),"\n",(0,c.jsx)(n.p,{children:"如果你只是改 lib 下的代码，不想跑服务时，可以单独编译 lib 代码："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"npm run start:dev lib1\n"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:j,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"nest 的 monorepo 和 libray 用起来都挺简单的。"}),"\n",(0,c.jsx)(n.p,{children:"还有个问题，现在 build 之后的代码是什么样的呢？"}),"\n",(0,c.jsx)(n.p,{children:"删掉 dist，然后执行："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"npm run build\n"})}),"\n",(0,c.jsx)(n.p,{children:"产生了一个 apps/monorepo-test/main.js，因为现在换成 webpack 了："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:t,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"然后执行："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"npm run build app2\n"})}),"\n",(0,c.jsxs)(n.p,{children:["现在就多了 apps/app2/main.js\n",(0,c.jsx)("img",{src:d,alt:""})]}),"\n",(0,c.jsx)(n.p,{children:"lib1 也是同理："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"npm run build lib1\n"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:p,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"之所以 application 或者 library 都能知道输出目录在哪，是因为在 tsconfig.json 里配了："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:l,alt:""})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:r,alt:""})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:i,alt:""})}),"\n",(0,c.jsxs)(n.p,{children:["案例代码在",(0,c.jsx)(n.a,{href:"https://github.com/QuarkGluonPlasma/nestjs-course-code/tree/main/monorepo-test",target:"_blank",rel:"noopener noreferrer",children:"小册仓库"})]}),"\n",(0,c.jsxs)(n.h2,{id:"总结",children:["总结",(0,c.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#总结",children:"#"})]}),"\n",(0,c.jsx)(n.p,{children:"微服务项目可能会有很多个项目，为了方便管理，我们会使用 monorepo 的方式。"}),"\n",(0,c.jsx)(n.p,{children:"monorepo 就是在一个 git 仓库里管理多个项目。"}),"\n",(0,c.jsx)(n.p,{children:"nest cli 支持 monorepo，只要执行 nest g app xxx 就会把项目变为 monorepo 的，在 apps 下保存多个 nest 应用。"}),"\n",(0,c.jsx)(n.p,{children:"nest-cli.json 里配置了多个 projects 的信息，以及默认的 project。"}),"\n",(0,c.jsx)(n.p,{children:"npm run start:dev 或者 npm run build 可以加上应用名来编译对应的 app。"}),"\n",(0,c.jsx)(n.p,{children:"此外，多个项目可能有公共代码，这时候可以用 nest g lib xxx 创建 library。"}),"\n",(0,c.jsx)(n.p,{children:"library 保存在 libs 目录下，和 apps 一样可以有多个。"}),"\n",(0,c.jsx)(n.p,{children:"nest 会为 libs 创建别名，可以在其他 app 或者 lib 里用别名引入。"}),"\n",(0,c.jsx)(n.p,{children:"这就是 nest 里创建 monorepo 以及通过 library 复用代码的方式，用起来还是比较简单的。"})]})}function Q(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,a.ah)(),e.components);return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(z,{...e})}):z(e)}let X=Q;Q.__RSPRESS_PAGE_META={},Q.__RSPRESS_PAGE_META["Nest%20%E9%80%9A%E5%85%B3%E7%A7%98%E7%B1%8D%20%20%E6%9C%80%E6%96%B0200%E7%AB%A0%2F141.%20Nest%20%E7%9A%84%20Monorepo%20%E5%92%8C%20Library.md"]={toc:[{text:"总结",id:"总结",depth:2}],title:"141. Nest 的 Monorepo 和 Library",headingTitle:"141. Nest 的 Monorepo 和 Library",frontmatter:{}}}}]);