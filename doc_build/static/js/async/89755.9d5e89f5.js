"use strict";(self.webpackChunkjue_jin_book_press=self.webpackChunkjue_jin_book_press||[]).push([["89755"],{60504:function(e,n,a){e.exports=a.p+"static/image/e9a6f4899a916c10912e0ff4f2720ddb.2a35b8a4.gif"},419915:function(e,n,a){a.r(n),a.d(n,{default:()=>eb});var r=a(552676),d=a(740453);let s=a.p+"static/image/940745f19680e749fb62c7c34d39601b.4d531b4a.gif",c=a.p+"static/image/a685fa303a79dd553c461fbee193742d.b9bda5db.gif",t=a.p+"static/image/534df3b084804d4cf2c7826f9fe24d3e.2e929290.webp",l=a.p+"static/image/e36011e1ea01384aeee10789bf2e3a49.ef69ae0d.webp",i=a.p+"static/image/c92223c8e13fbefd4900b7f5bfc0dc6b.bdedfd9c.webp",o=a.p+"static/image/6940e866dbf771e29a052ca93d016b6f.e974333c.webp",p=a.p+"static/image/b338af785d1c62309f349c9146d30d48.898b8061.webp",h=a.p+"static/image/ad34264cce02300835002499f019de9e.08fd80b0.webp",j=a.p+"static/image/958549e17c977f3da28f24800ea68943.a53a4275.webp",m=a.p+"static/image/9faee108ffc9af82cab03bf6a35f927f.e6edbd1d.webp",x=a.p+"static/image/370e8f12d04f6a7d5bf8910c626f2bd5.f0d109af.webp",f=a.p+"static/image/704b7222cf2ccceac5d12d4d410038b9.db40ac70.webp",g=a.p+"static/image/041564cd9554f9500cb466db40cd4a41.23064234.webp",u=a.p+"static/image/a8e4afa95002636f8026daa3e45162ed.02b46334.gif",b=a.p+"static/image/962d36dd3ed2d0f5d1923eaa245b9540.3c4b6642.webp",v=a.p+"static/image/d772123735d4fb41b72a2d93f75af973.cf74d028.gif";var C=a(60504);let y=a.p+"static/image/d4f37023f8c6216f67e7cbabc2d41827.c11cb7c1.webp",N=a.p+"static/image/ffc2de4a6a1ac372b833bc58c37621fe.2a450373.webp",w=a.p+"static/image/b38ae2a28071d3800769264b3fb5670b.7bd02848.gif",M=a.p+"static/image/2320235024430213af9e4119c9fb9250.4b4157b6.webp",Y=a.p+"static/image/17a72f12c53e480840658d530e784dcd.636163c7.webp",H=a.p+"static/image/0078267ab9e4e995041692f046408fb7.b3afe11a.gif",D=a.p+"static/image/52c4a03cbead725649346a0d33d488f9.9fd0ac90.webp",A=a.p+"static/image/8f71f3e8009bce3b97a041a0cf8cb374.a6891245.webp",R=a.p+"static/image/cd548488a759bf98c743563abeb059a2.b89dc278.gif",P=a.p+"static/image/04cceefc5ea57ae7120e438126936a9f.0e87bdca.webp",k=a.p+"static/image/d40bddd31e6930cd3bba54693bba0bf7.259e1676.webp",F=a.p+"static/image/99f733eb7d7e67ef07b20e295b4a4625.3d8184c6.webp",E=a.p+"static/image/c256cf5c5f3f9083fa941894c2da16e0.663b2e69.webp",I=a.p+"static/image/02692c9280c3a8c6cd6364a64d76219b.7b6744c4.webp",S=a.p+"static/image/7cf248e5f998a3b58353dc657dec5d80.9443e56f.webp",B=a.p+"static/image/fad5b22cff8003bdb5a21f6049b41e77.16ef6402.webp",V=a.p+"static/image/79a46a46a40efeff094c2ac0e2f3e177.77f322d4.webp",L=a.p+"static/image/14bd6648e44b50a285844e648f04c8ea.6fd119c8.webp",z=a.p+"static/image/f5661d104bd3e81d110e02eb5fef4344.204bcb45.webp",J=a.p+"static/image/40eca7af45e914a48d5b05d10d7b6527.f5a4f2a1.webp",K=a.p+"static/image/d153936f2d0a510b62ea3111d7260b36.90cbd4d0.webp",T=a.p+"static/image/0140d1edf1a2edba87646f2c65854fea.c3107cd3.webp",Z=a.p+"static/image/ef1966adf2e5a4c60366fed9c05a265a.4b997ba9.webp",G=a.p+"static/image/afb3e1a21896e3e9fc527744e1bbd43c.cc7ecd03.webp",Q=a.p+"static/image/2bf357d7bd762efdd88c9ef56bf841bf.3609444c.webp",X=a.p+"static/image/38bb161b9157d7928a4801f0c88e5856.6c8b12fb.webp",O=a.p+"static/image/be8e09c88f06f1ebceb709de19086509.e9b8478b.webp",q=a.p+"static/image/e588594aa3010cc7623acc0fe40300d4.483d41fd.webp",U=a.p+"static/image/5605d5519c3c799b409a5c37d54b75f9.fbafaf69.webp",W=a.p+"static/image/995287f6ce2ca0511807dff040c4a5ad.5691b6d9.webp",_=a.p+"static/image/822c4970d5b520b41979a7f1b0a4f406.e2e9ec9e.webp",$=a.p+"static/image/961ec0e6f2fc68f5c988eb1508a69585.1f4c1f72.webp",ee=a.p+"static/image/1983332f1c06ee5814ae4512e2a3c6d1.2dbedc22.webp",en=a.p+"static/image/61a1586f45ab705007035e6a6593036d.8407511b.webp",ea=a.p+"static/image/f271430dda8b4aa6e6b6a1855bb99999.dda1f48e.webp",er=a.p+"static/image/cd5e2e3f1aa5107ff3664f57e137863f.65d126a2.webp",ed=a.p+"static/image/3fb6badff7e4b1a7785ddadf08b434b1.031e77ac.webp",es=a.p+"static/image/72ef36ed4b9092ca86fca1fed3f49a76.3eb6674a.webp",ec=a.p+"static/image/30e93816e5d28e432c4e37266f4fc7f6.31689344.webp",et=a.p+"static/image/d4e6e9b40cdc619f010db3c5da564ad9.b76a641d.webp",el=a.p+"static/image/b0b1c6e5f5126f6abf8507bab06c9929.382897c4.webp",ei=a.p+"static/image/7fdca22cd7f608b4cca84c6e0e50779f.842ef354.webp",eo=a.p+"static/image/57672471e79d6db99336f29604d68987.b0bbaf4c.webp",ep=a.p+"static/image/149debaa0bcd9af14520a1c6b7843248.0cf11b5f.webp",eh=a.p+"static/image/4d4e72168b50f5b7429365fcd02c8d3d.f0a7da28.webp",ej=a.p+"static/image/64a0541427340b461f1ce1eeb0027412.9fe96446.webp",em=a.p+"static/image/048cd10e6316e32a0cadf61da1655f0d.009e484f.webp",ex=a.p+"static/image/6e2082e7659642a4885e53ce8bcfaafd.4ed1445e.webp",ef=a.p+"static/image/c65e20f3f2d058446c97b0139fc171d3.1e7e351c.webp";function eg(e){let n=Object.assign({h1:"h1",a:"a",p:"p",img:"img",pre:"pre",code:"code",h2:"h2"},(0,d.ah)(),e.components);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.h1,{id:"第09章组件实战calendar日历组件下",children:["第09章—组件实战：Calendar日历组件（下）",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#第09章组件实战calendar日历组件下",children:"#"})]}),"\n",(0,r.jsx)(n.p,{children:"\uFEFF基本的布局完成了，我们来添加一些参数："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:ef,alt:""})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"export interface CalendarProps {\n    value: Dayjs;\n    style?: CSSProperties;\n    className?: string | string[];\n    // 定制日期显示，会完全覆盖日期单元格\n    dateRender?: (currentDate: Dayjs) => ReactNode;\n    // 定制日期单元格，内容会被添加到单元格内，只在全屏日历模式下生效。\n    dateInnerContent?: (currentDate: Dayjs) => ReactNode;\n    // 国际化相关\n    locale?: string;\n    onChange?: (date: Dayjs) => void;\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"style 和 className 用于修改 Calendar 组件外层容器的样式。"}),"\n",(0,r.jsx)(n.p,{children:"内部的布局我们都是用的 flex，所以只要外层容器的样式变了，内部的布局会自动适应。"}),"\n",(0,r.jsx)(n.p,{children:"dateRender 是用来定制日期单元格显示的内容的。"}),"\n",(0,r.jsx)(n.p,{children:"比如加一些日程安排，加一些农历或者节日信息："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:ex,alt:""})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:em,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"dateRender 是整个覆盖，连带日期的数字一起，而 dateInnerContent 只会在日期的数字下添加一些内容。"}),"\n",(0,r.jsx)(n.p,{children:"这两个 props 是不一样的。"}),"\n",(0,r.jsx)(n.p,{children:"locale 是用于国际化的，比如切换到中文显示或者是英文显示。"}),"\n",(0,r.jsx)(n.p,{children:"onChange 是当选择了日期之后会触发的回调。"}),"\n",(0,r.jsx)(n.p,{children:"然后实现下这些参数对应的逻辑。"}),"\n",(0,r.jsx)(n.p,{children:"首先是 className 和 style："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:ej,alt:""})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:'function Calendar(props: CalendarProps) {\n\n    const {\n        value,\n        style,\n        className,\n    } = props;\n\n    const classNames = cs("calendar", className);\n\n    return <div className={classNames} style={style}>\n        <Header></Header>\n        <MonthCalendar {...props}/>\n    </div>\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"这里用 classnames 这个包来做 className 的合并。"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"npm install classnames\n"})}),"\n",(0,r.jsx)(n.p,{children:"它可以传入对象或者数组，会自动合并，返回最终的 className："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:eh,alt:""})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:ep,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"当 className 的确定需要一段复杂计算逻辑的时候，就用 classname 这个包。"}),"\n",(0,r.jsx)(n.p,{children:"测试下："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:eo,alt:""})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"import dayjs from 'dayjs';\nimport Calendar from './Calendar';\n\nfunction App() {\n  return (\n    <div className=\"App\">\n      <Calendar value={dayjs('2023-11-08')} className={'aaa'} style={{background: 'yellow'}}></Calendar>\n    </div>\n  );\n}\n\nexport default App;\n\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:ei,alt:""})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:el,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"className 和 style 的处理没问题。"}),"\n",(0,r.jsx)(n.p,{children:"然后我们处理下一个 props： dateRender 和 dateInnerContent。"}),"\n",(0,r.jsx)(n.p,{children:"在 MonthCalendar 里把它取出来，传入到 renderDays 方法里："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:et,alt:""})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"const {\n    dateRender,\n    dateInnerContent\n} = props;\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"renderDays(allDays, dateRender, dateInnerContent)\n"})}),"\n",(0,r.jsx)(n.p,{children:"dateRender 的处理也很简单，就是把渲染日期的逻辑换一下："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:ec,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"在 App.tsx 里传入 dateRender 参数："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:es,alt:""})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"import dayjs from 'dayjs';\nimport Calendar from './Calendar';\n\nfunction App() {\n  return (\n    <div className=\"App\">\n      <Calendar value={dayjs('2023-11-08')} dateRender={(value) => {\n        return <div>\n          <p style={{background: 'yellowgreen', height: '50px'}}>{value.format('YYYY/MM/DD')}</p>\n        </div>\n      }}></Calendar>\n    </div>\n  );\n}\n\nexport default App;\n"})}),"\n",(0,r.jsx)(n.p,{children:"这样，渲染的内容就换成自定义的了："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:ed,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"不过现在我们没有做内容溢出时的处理："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:er,alt:""})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:ea,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"加个 overflow: hidden 就好了："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:en,alt:""})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)("img",{src:ee,alt:""}),"\n而且之前加 padding 的位置也不对。"]}),"\n",(0,r.jsx)(n.p,{children:"改一下渲染日期的逻辑，如果传了 dateRender 那就整个覆盖日期单元格，否则就是只在下面渲染 dateInnerContent 的内容："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:$,alt:""})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:'function renderDays(\n    days: Array<{ date: Dayjs, currentMonth: boolean}>,\n    dateRender: MonthCalendarProps[\'dateRender\'],\n    dateInnerContent:  MonthCalendarProps[\'dateInnerContent\']\n) {\n    const rows = [];\n    for(let i = 0; i < 6; i++ ) {\n        const row = [];\n        for(let j = 0; j < 7; j++) {\n            const item = days[i * 7 + j];\n            row[j] = <div className={\n                "calendar-month-body-cell " + (item.currentMonth ? \'calendar-month-body-cell-current\' : \'\')\n            }>\n                {\n                    dateRender ? dateRender(item.date) : (\n                        <div className="calendar-month-body-cell-date">\n                            <div className="calendar-month-body-cell-date-value">{item.date.date()}</div>\n                            <div className="calendar-month-body-cell-date-content">{dateInnerContent?.(item.date)}</div>\n                        </div>\n                    )\n                }\n            </div>\n        }\n        rows.push(row);\n    }\n    return rows.map(row => <div className="calendar-month-body-row">{row}</div>)\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"改下对应的样式："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:_,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"把加 padding 的位置改为内部的元素。"}),"\n",(0,r.jsx)(n.p,{children:"测试下："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:W,alt:""})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"import dayjs from 'dayjs';\nimport Calendar from './Calendar';\n\nfunction App() {\n  return (\n    <div className=\"App\">\n      <Calendar value={dayjs('2023-11-08')} dateInnerContent={(value) => {\n        return <div>\n          <p style={{background: 'yellowgreen', height: '30px'}}>{value.format('YYYY/MM/DD')}</p>\n        </div>\n      }}></Calendar>\n    </div>\n  );\n}\n\nexport default App;\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:U,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"这样，dateRender 和 dateInnerContent 的逻辑就完成了。"}),"\n",(0,r.jsx)(n.p,{children:"接下来做国际化，也就是 locale 参数的处理。"}),"\n",(0,r.jsx)(n.p,{children:"国际化就是可以让日历支持中文、英文、日文等，其实也很简单，就是把写死的文案换成按照 key 从配置中取的文案就行了。"}),"\n",(0,r.jsx)(n.p,{children:"定义下用到的 ts 类型 src/Calendar/locale/interface.ts"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"export interface CalendarType {\n    formatYear: string;\n    formatMonth: string;\n    today: string;\n    month: {\n        January: string;\n        February: string;\n        March: string;\n        April: string;\n        May: string;\n        June: string;\n        July: string;\n        August: string;       \n        September: string;\n        October: string;\n        November: string;\n        December: string;\n    } & Record<string, any>;\n    week: {\n        monday: string;\n        tuesday: string;\n        wednesday: string;\n        thursday: string;\n        friday: string;\n        saturday: string;\n        sunday: string;\n    } & Record<string, any>\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"然后分别定义中文和英文的配置："}),"\n",(0,r.jsx)(n.p,{children:"src/Calendar/locale/zh-CN.ts"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"import { CalendarType } from \"./interface\";\n\nconst CalendarLocale: CalendarType = {\n    formatYear: 'YYYY 年',\n    formatMonth: 'YYYY 年 MM 月',\n    today: '今天',\n    month: {\n        January: '一月',\n        February: '二月',\n        March: '三月',\n        April: '四月',\n        May: '五月',\n        June: '六月',\n        July: '七月',\n        August: '八月',\n        September: '九月',\n        October: '十月',\n        November: '十一月',\n        December: '十二月',\n    },\n    week: {\n        monday: '周一',\n        tuesday: '周二',\n        wednesday: '周三',\n        thursday: '周四',\n        friday: '周五',\n        saturday: '周六',\n        sunday: '周日',\n    }\n}\n\nexport default CalendarLocale;\n"})}),"\n",(0,r.jsx)(n.p,{children:"src/Calendar/locale/zh-CN.ts"}),"\n",(0,r.jsx)(n.p,{children:"把会用到的文案列出来。"}),"\n",(0,r.jsx)(n.p,{children:"然后再写个英文版："}),"\n",(0,r.jsx)(n.p,{children:"src/Calendar/locale/en-US.ts"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"import { CalendarType } from \"./interface\";\n\nconst CalendarLocale: CalendarType = {\n    formatYear: 'YYYY',\n    formatMonth: 'MMM YYYY',\n    today: 'Today',\n    month: {\n        January: 'January',\n        February: 'February',\n        March: 'March',\n        April: 'April',\n        May: 'May',\n        June: 'June',\n        July: 'July',\n        August: 'August',\n        September: 'September',\n        October: 'October',\n        November: 'November',\n        December: 'December',\n    },\n    week: {\n        monday: 'Monday',\n        tuesday: 'Tuesday',\n        wednesday: 'Wednesday',\n        thursday: 'Thursday',\n        friday: 'Friday',\n        saturday: 'Saturday',\n        sunday: 'Sunday',\n    },\n}\n\nexport default CalendarLocale;\n"})}),"\n",(0,r.jsx)(n.p,{children:"我们先把上面的周一到周日的文案替换了："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:"data:image/webp;base64,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",alt:""})}),"\n",(0,r.jsx)(n.p,{children:"在 MonthCalendar 引入中文的资源包："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:q,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"然后把之前写死的文案，改成按照 key 从资源包中取值的方式："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:O,alt:""})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"function MonthCalendar(props: MonthCalendarProps) {\n\n    const {\n        dateRender,\n        dateInnerContent\n    } = props;\n\n    const weekList = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday']\n\n    const allDays = getAllDays(props.value);\n\n    return <div className=\"calendar-month\">\n        <div className=\"calendar-month-week-list\">\n            {weekList.map((week) => (\n                <div className=\"calendar-month-week-list-item\" key={week}>\n                    {CalendarLocale.week[week]}\n                </div>\n            ))}\n        </div>\n        <div className=\"calendar-month-body\">\n            {\n                renderDays(allDays, dateRender, dateInnerContent)\n            }\n        </div>\n    </div>\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"现在渲染出来的是这样的："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:X,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"只要改一下用的资源包："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:Q,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"文案就变了："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:G,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"这就是国际化。"}),"\n",(0,r.jsx)(n.p,{children:"当然，现在我们是手动切换的资源包，其实应该是全局统一配置的。"}),"\n",(0,r.jsx)(n.p,{children:"这个可以通过 context 来做："}),"\n",(0,r.jsx)(n.p,{children:"新建 src/Calendar/LocaleContext.tsx"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"import { createContext } from \"react\";\n\nexport interface LocaleContextType {\n    locale: string;\n}\n\nconst LocaleContext = createContext<LocaleContextType>({\n    locale: 'zh-CN'\n});\n\nexport default LocaleContext;\n"})}),"\n",(0,r.jsx)(n.p,{children:"然后在 Calendar 组件里用 provider 修改 context 的值："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:Z,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"如果传入了参数，就用指定的 locale，否则，就从浏览器取当前语言："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:T,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"加一个国际化资源包的入口："}),"\n",(0,r.jsx)(n.p,{children:"src/Calendar/locale/index.ts"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:'import zhCN from "./zh-CN";\nimport enUS from "./en-US";\nimport { CalendarType } from "./interface";\n\nconst allLocales: Record<string, CalendarType>= {\n    \'zh-CN\': zhCN,\n    \'en-US\': enUS\n}\n\nexport default allLocales;\n'})}),"\n",(0,r.jsx)(n.p,{children:"把 MonthCalendar 组件的 locale 改成从 context 获取的："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:K,alt:""})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"const localeContext = useContext(LocaleContext);\n\nconst CalendarLocale = allLocales[localeContext.locale];\n"})}),"\n",(0,r.jsx)(n.p,{children:"这样，当不指定 locale 时，就会按照浏览器的语言来设置："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:J,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"当指定 locale 时，就会切换为指定语言的资源包："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:z,alt:""})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:L,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"接下来，我们实现 value 和 onChange 参数的逻辑。"}),"\n",(0,r.jsx)(n.p,{children:"在 MonthCalendar 里取出 value 参数，传入 renderDays 方法："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:V,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"用 classnames 的 api 来拼接 className，如果是当前日期，就加一个 xxx-selected 的 className："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:B,alt:""})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:'function renderDays(\n    days: Array<{ date: Dayjs, currentMonth: boolean}>,\n    dateRender: MonthCalendarProps[\'dateRender\'],\n    dateInnerContent:  MonthCalendarProps[\'dateInnerContent\'],\n    value: Dayjs\n) {\n    const rows = [];\n    for(let i = 0; i < 6; i++ ) {\n        const row = [];\n        for(let j = 0; j < 7; j++) {\n            const item = days[i * 7 + j];\n            row[j] = <div className={\n                "calendar-month-body-cell " + (item.currentMonth ? \'calendar-month-body-cell-current\' : \'\')\n            }\n            >\n                {\n                    dateRender ? dateRender(item.date) : (\n                        <div className="calendar-month-body-cell-date">\n                            <div className={\n                                cs("calendar-month-body-cell-date-value",\n                                    value.format(\'YYYY-MM-DD\') === item.date.format(\'YYYY-MM-DD\')\n                                        ? "calendar-month-body-cell-date-selected"\n                                        : ""\n                                )\n                            }>{item.date.date()}</div>\n                            <div className="calendar-month-cell-body-date-content">{dateInnerContent?.(item.date)}</div>\n                        </div>\n                    )\n                }\n            </div>\n        }\n        rows.push(row);\n    }\n    return rows.map(row => <div className="calendar-month-body-row">{row}</div>)\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"添加对应的样式："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:S,alt:""})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-css",children:"&-selected {\n    background: blue;\n    width: 28px;\n    height: 28px;\n    line-height: 28px;\n    text-align: center;\n    color: #fff;\n    border-radius: 50%;\n    cursor: pointer;\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"现在渲染出来是这样的："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:I,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"然后我们加上点击的处理："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:E,alt:""})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"interface MonthCalendarProps extends CalendarProps {\n    selectHandler?: (date: Dayjs) => void\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"添加一个 selectHandler 的参数，传给 renderDays 方法。"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:F,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"renderDays 方法里取出来，给日期添加上点击事件："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:k,alt:""})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"function renderDays(\n    days: Array<{ date: Dayjs, currentMonth: boolean}>,\n    dateRender: MonthCalendarProps['dateRender'],\n    dateInnerContent:  MonthCalendarProps['dateInnerContent'],\n    value: Dayjs,\n    selectHandler: MonthCalendarProps['selectHandler']\n) {\n    const rows = [];\n    for(let i = 0; i < 6; i++ ) {\n        const row = [];\n        for(let j = 0; j < 7; j++) {\n            const item = days[i * 7 + j];\n            row[j] = <div className={\n                \"calendar-month-body-cell \" + (item.currentMonth ? 'calendar-month-body-cell-current' : '')\n            }\n                onClick={() => selectHandler?.(item.date)}\n            >\n                {\n                    dateRender ? dateRender(item.date) : (\n                        <div className=\"calendar-month-body-cell-date\">\n                            <div className={\n                                cs(\"calendar-month-body-cell-date-value\",\n                                    value.format('YYYY-MM-DD') === item.date.format('YYYY-MM-DD')\n                                        ? \"calendar-month-body-cell-date-selected\"\n                                        : \"\"\n                                )\n                            }>{item.date.date()}</div>\n                            <div className=\"calendar-month-cell-body-date-content\">{dateInnerContent?.(item.date)}</div>\n                        </div>\n                    )\n                }\n            </div>\n        }\n        rows.push(row);\n    }\n    return rows.map(row => <div className=\"calendar-month-body-row\">{row}</div>)\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"然后这个参数是在 Calendar 组件传进来的："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:P,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"我们添加一个 state 来存储当前日期，selectHandler 里调用 onChange 的参数，并且修改当前日期。"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:'function Calendar(props: CalendarProps) {\n\n    const {\n        value,\n        style,\n        className,\n        dateRender,\n        dateInnerContent,\n        locale,\n        onChange\n    } = props;\n\n    const [curValue, setCurValue] = useState<Dayjs>(value);\n\n    const classNames = cs("calendar", className);\n        \n    function selectHandler(date: Dayjs) {\n        setCurValue(date);\n        onChange?.(date);\n    }\n\n    return <LocaleContext.Provider value={{\n        locale: locale || navigator.language\n    }}>\n        <div className={classNames} style={style}>\n            <Header></Header>\n            <MonthCalendar {...props} value={curValue} selectHandler={selectHandler}/>\n        </div>\n    </LocaleContext.Provider>\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"试一下，改下 App.tsx："}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"import dayjs from 'dayjs';\nimport Calendar from './Calendar';\n\nfunction App() {\n  return (\n    <div className=\"App\">\n      <Calendar value={dayjs('2023-11-08')} onChange={(date) => {\n          alert(date.format('YYYY-MM-DD'));\n      }}></Calendar>\n    </div>\n  );\n}\n\nexport default App;\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:R,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"然后实现下 Header 组件里的日期切换："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:A,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"根据传入的 value 来展示日期，点击上下按钮的时候会调用传进来的回调函数："}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:'import { Dayjs } from "dayjs";\ninterface HeaderProps {\n    curMonth: Dayjs;\n    prevMonthHandler: () => void;\n    nextMonthHandler: () => void;\n}\nfunction Header(props: HeaderProps) {\n\n    const {\n        curMonth,\n        prevMonthHandler,\n        nextMonthHandler\n    } = props;\n\n    return <div className="calendar-header">\n        <div className="calendar-header-left">\n            <div className="calendar-header-icon" onClick={prevMonthHandler}>&lt;</div>\n            <div className="calendar-header-value">{curMonth.format(\'YYYY 年 MM 月\')}</div>\n            <div className="calendar-header-icon" onClick={nextMonthHandler}>&gt;</div>\n            <button className="calendar-header-btn">今天</button>\n        </div>\n    </div>\n}\n\nexport default Header;\n'})}),"\n",(0,r.jsx)(n.p,{children:"然后在 Calendar 组件创建 curMonth 的 state，点击上下按钮的时候，修改月份："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:D,alt:""})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"function Calendar(props: CalendarProps) {\n\n    const {\n        value,\n        style,\n        className,\n        dateRender,\n        dateInnerContent,\n        locale,\n        onChange\n    } = props;\n\n    const [curValue, setCurValue] = useState<Dayjs>(value);\n\n    const [curMonth, setCurMonth] = useState<Dayjs>(value);\n\n    const classNames = cs(\"calendar\", className);\n        \n    function selectHandler(date: Dayjs) {\n        setCurValue(date);\n        onChange?.(date);\n    }\n\n    function prevMonthHandler() {\n        setCurMonth(curMonth.subtract(1, 'month'));\n    }\n\n    function nextMonthHandler() {\n        setCurMonth(curMonth.add(1, 'month'));\n    }\n\n    return <LocaleContext.Provider value={{\n        locale: locale || navigator.language\n    }}>\n        <div className={classNames} style={style}>\n            <Header curMonth={curMonth} prevMonthHandler={prevMonthHandler} nextMonthHandler={nextMonthHandler}></Header>\n            <MonthCalendar {...props} value={curValue} selectHandler={selectHandler}/>\n        </div>\n    </LocaleContext.Provider>\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"测试下："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:H,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"但现在月份是变了，但下面的日历没有跟着变。"}),"\n",(0,r.jsx)(n.p,{children:"因为我们之前是拿到 value 所在月份来计算的日历，现在要改成 curMonth 所在的月份。"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:Y,alt:""})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:M,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"这样，月份切换时，就会显示那个月的日历了："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:w,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"然后我们加上今天按钮的处理："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:N,alt:""})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:'import { Dayjs } from "dayjs";\ninterface HeaderProps {\n    curMonth: Dayjs;\n    prevMonthHandler: () => void;\n    nextMonthHandler: () => void;\n    todayHandler: () => void;\n}\nfunction Header(props: HeaderProps) {\n\n    const {\n        curMonth,\n        prevMonthHandler,\n        nextMonthHandler,\n        todayHandler\n    } = props;\n\n    return <div className="calendar-header">\n        <div className="calendar-header-left">\n            <div className="calendar-header-icon" onClick={prevMonthHandler}>&lt;</div>\n            <div className="calendar-header-value">{curMonth.format(\'YYYY 年 MM 月\')}</div>\n            <div className="calendar-header-icon" onClick={nextMonthHandler}>&gt;</div>\n            <button className="calendar-header-btn" onClick={todayHandler}>今天</button>\n        </div>\n    </div>\n}\n\nexport default Header;\n'})}),"\n",(0,r.jsx)(n.p,{children:"在 Calendar 里传入 todayHandler："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:y,alt:""})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"function todayHandler() {\n    const date = dayjs(Date.now());\n\n    setCurValue(date);\n    setCurMonth(date);\n    onChange?.(date);\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"同时修改日期和当前月份，并且还要调用 onChange 回调。"}),"\n",(0,r.jsx)(n.p,{children:"测试下："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:C,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"此外，我们希望点击上下月份的日期的时候，能够跳转到那个月的日历："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:v,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"这个也简单，切换日期的时候顺便修改下 curMonth 就好了："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:b,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"测试下："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:u,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"最后，还要加上 Header 的国际化："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:g,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"就是把写死的文案，改成丛资源包取值的方式就好了。"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:'function Header(props: HeaderProps) {\n\n    const {\n        curMonth,\n        prevMonthHandler,\n        nextMonthHandler,\n        todayHandler\n    } = props;\n\n    const localeContext = useContext(LocaleContext);\n    const CalendarContext = allLocales[localeContext.locale];\n\n    return <div className="calendar-header">\n        <div className="calendar-header-left">\n            <div className="calendar-header-icon" onClick={prevMonthHandler}>&lt;</div>\n            <div className="calendar-header-value">{curMonth.format(CalendarContext.formatMonth)}</div>\n            <div className="calendar-header-icon" onClick={nextMonthHandler}>&gt;</div>\n            <button className="calendar-header-btn" onClick={todayHandler}>{CalendarContext.today}</button>\n        </div>\n    </div>\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"试试看："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:f,alt:""})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:x,alt:""})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:m,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"没啥问题。"}),"\n",(0,r.jsx)(n.p,{children:"这样，我们的 Calendar 组件就完成了。"}),"\n",(0,r.jsx)(n.p,{children:"最后我们再来优化下代码："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:j,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"重复逻辑可以抽离出个方法："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:h,alt:""})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"function changeDate(date: Dayjs) {\n    setCurValue(date);\n    setCurMonth(date);\n    onChange?.(date);\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"渲染逻辑抽离出来的函数，放在组件外需要传很多参数，而这个函数只有这里用，可以移到组件内："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:p,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"这样就不用传那些参数了："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:o,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"此外，我们的 Calendar 的 value 其实是 defaultValue："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:i,alt:"image.png"})}),"\n",(0,r.jsx)(n.p,{children:"和迷你 Calendar 一样，我们也用 ahooks 的 useControllableValue 来做。"}),"\n",(0,r.jsx)(n.p,{children:"安装 ahooks："}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"npm install --save ahooks\n"})}),"\n",(0,r.jsx)(n.p,{children:"把 useState 换成 ahooks 的 useControllableValue："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:l,alt:"image.png"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"export interface CalendarProps {\n    value?: Dayjs;\n    defaultValue?: Dayjs;\n    style?: CSSProperties;\n    className?: string | string[];\n    // 定制日期显示，会完全覆盖日期单元格\n    dateRender?: (currentDate: Dayjs) => ReactNode;\n    // 定制日期单元格，内容会被添加到单元格内，只在全屏日历模式下生效。\n    dateInnerContent?: (currentDate: Dayjs) => ReactNode;\n    // 国际化相关\n    locale?: string;\n    onChange?: (date: Dayjs) => void;\n}\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"const [curValue, setCurValue] = useControllableValue<Dayjs>(props, {\n    defaultValue: dayjs()\n});\n\nconst [curMonth, setCurMonth] = useState<Dayjs>(curValue);\n"})}),"\n",(0,r.jsx)(n.p,{children:"用到 value 的地方加一下 ?："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:t,alt:"image.png"})}),"\n",(0,r.jsx)(n.p,{children:"这样就同时支持受控非受控，也就是 value 和 defaultValue 了。"}),"\n",(0,r.jsx)(n.p,{children:"试一下 defaultValue 非受控模式："}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"import dayjs from 'dayjs';\nimport Calendar from './Calendar';\n\nfunction App() {\n  return (\n    <div className=\"App\">\n      <Calendar defaultValue={dayjs('2023-11-08')}></Calendar>\n    </div>\n  );\n}\n\nexport default App;\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:c,alt:"2024-08-31 19.00.51.gif"})}),"\n",(0,r.jsx)(n.p,{children:"value 受控模式:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"import dayjs from 'dayjs';\nimport Calendar from './Calendar';\nimport { useState } from 'react';\n\nfunction App() {\n  const [value, setValue] =  useState(dayjs('2023-11-08'));\n\n  return (\n    <div className=\"App\">\n      <Calendar value={value} onChange={(val) => {\n        setValue(val)\n      }}></Calendar>\n    </div>\n  );\n}\n\nexport default App;\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:s,alt:"2024-08-31 19.02.47.gif"})}),"\n",(0,r.jsxs)(n.p,{children:["案例代码上传了",(0,r.jsx)(n.a,{href:"https://github.com/QuarkGluonPlasma/react-course-code/tree/main/calendar-component",target:"_blank",rel:"noopener noreferrer",children:"小册仓库"}),"。"]}),"\n",(0,r.jsxs)(n.h2,{id:"总结",children:["总结",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#总结",children:"#"})]}),"\n",(0,r.jsx)(n.p,{children:"上节我们实现了布局，这节加上了参数并且实现了这些参数对应的逻辑。"}),"\n",(0,r.jsx)(n.p,{children:"className 和 style 用于修改外层容器的样式，内部用的 flex 布局，只要容器大小变了，内容会自动适应。"}),"\n",(0,r.jsx)(n.p,{children:"dateRender 和 dateInnerConent 是用于修改日期单元格的内容的，比如显示节日、日程安排等。"}),"\n",(0,r.jsx)(n.p,{children:"locale 是切换语言，国际化就是把写死的文案换成从资源包取值的方式，我们创建了 zh-CN 和 en-US 两个资源包，并且可以通过 locale 参数来切换。"}),"\n",(0,r.jsx)(n.p,{children:"通过 createContext 创建 context 对象来保存 locale 配置，然后通过 Provider 修改其中的值，这样子组件里就通过 useContext 把它取出来就知道当前语言了。"}),"\n",(0,r.jsx)(n.p,{children:"最后我们用 ahooks 的 useControllableValue 同时支持了受控和非受控模式。"}),"\n",(0,r.jsx)(n.p,{children:"日历组件是一个常用组件，而且是经常需要定制的那种，因为各种场景下对它有不同的要求，所以能够自己实现各种日历组件是一个必备技能。"})]})}function eu(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,d.ah)(),e.components);return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(eg,{...e})}):eg(e)}let eb=eu;eu.__RSPRESS_PAGE_META={},eu.__RSPRESS_PAGE_META["React%20%E9%80%9A%E5%85%B3%E7%A7%98%E7%B1%8D%2F%E7%AC%AC09%E7%AB%A0%E2%80%94%E7%BB%84%E4%BB%B6%E5%AE%9E%E6%88%98%EF%BC%9ACalendar%E6%97%A5%E5%8E%86%E7%BB%84%E4%BB%B6%EF%BC%88%E4%B8%8B%EF%BC%89.md"]={toc:[{text:"总结",id:"总结",depth:2}],title:"第09章—组件实战：Calendar日历组件（下）",headingTitle:"第09章—组件实战：Calendar日历组件（下）",frontmatter:{}}}}]);