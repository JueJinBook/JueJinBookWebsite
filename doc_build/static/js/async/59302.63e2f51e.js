"use strict";(self.webpackChunkjue_jin_book_press=self.webpackChunkjue_jin_book_press||[]).push([["59302"],{739704:function(e,c,a){e.exports=a.p+"static/image/09cc318918787b8dc0fe91e645bee4e8.44f229da.webp"},212216:function(e,c,a){e.exports=a.p+"static/image/8c259ff00eff37eba9d80ccb7bbd19d5.7d6f46c8.webp"},264888:function(e,c,a){a.r(c),a.d(c,{default:()=>O});var s=a(552676),n=a(740453);let r=a.p+"static/image/078c80a85e9fe2f64fbfc20c518ac075.e3d63f7a.webp",i=a.p+"static/image/12bd71d6e6cd1d631a03b5a4d3cfef09.4fd022f4.webp",d=a.p+"static/image/8abaada771d722a244d70dea145d7ef0.2a27aea4.webp",l=a.p+"static/image/a513bd29794f152ae17bfa457b6ca5a7.9c874a90.webp",p=a.p+"static/image/f4df39b00d726d094f31380a56543c9b.9d67328b.webp",t=a.p+"static/image/72db930fcb694637059003ea44684b49.cf924994.webp",h=a.p+"static/image/580714914b6b2329afa24b446941070c.ab696efa.webp",j=a.p+"static/image/09185eae3efaabe80c1220faaf45dd80.5788625b.webp",x=a.p+"static/image/eee6d9ea6b224294f4b7d307946ef607.40de4114.webp",o=a.p+"static/image/ae9596b902258c5b12938515824d6212.2f0f9dfe.webp",u=a.p+"static/image/39ff720b8e7e7f17ba3ef4253b200278.0c8c3a59.webp",b=a.p+"static/image/d3918163691350f914dbd31ee639d14a.6920e90d.webp",m=a.p+"static/image/e718a3c82a0a0c579546b425bac71973.adb8411a.webp",v=a.p+"static/image/57cc85cb47a33cb687c872d380e0369e.d8e62d41.webp",f=a.p+"static/image/4e9e35747e5f8cd3401c4d86dd4b3256.209339ec.webp",g=a.p+"static/image/8d301b7ebe308194667134bef0a1c5ea.27707cbc.webp",w=a.p+"static/image/c9fcc4ccb66711d23d52a8b8c6f4b7f4.970ef2c3.webp",E=a.p+"static/image/0929fbbaa9418433ee31977cfeed4493.7af92ecb.webp",k=a.p+"static/image/f38d473f9095aa9cfe9db4b81bae081c.dd0e33ec.webp",A=a.p+"static/image/d2aa9fd0d330e3e720d63d404d94061a.b63163a1.webp",D=a.p+"static/image/c4c23cad07b3cbdcd2aa4fd3a6f8589f.88099af8.webp",R=a.p+"static/image/0d6c3c6ebf5034e53b87372c6ccdbf3a.eb07906a.webp",_=a.p+"static/image/ef40959aa6ef31174ae57dd906c59b69.0c65db63.webp",C=a.p+"static/image/5bb10dc3c90d9c718e9c5af271a4e554.7eed2926.webp",T=a.p+"static/image/162ccae7c43e89f6851df58822a9c410.f3ac2ca8.webp",U=a.p+"static/image/0ca801902adde9e8eda5309e79844a46.df9d692f.webp",B=a.p+"static/image/abb91bf45c3c955d3f39ce137ec75a11.637a9b5c.webp",V=a.p+"static/image/7f5909d4227d36c28ff3fb6e1b719139.b13e81a1.webp";var F=a(739704);let S=a.p+"static/image/38a3bab6fab1d6237c37192c6903e356.ba03605a.webp",L=a.p+"static/image/fa85fdd4f963ccc8711d290067d1e393.58ad2bb2.webp";var M=a(212216);function P(e){let c=Object.assign({h1:"h1",a:"a",p:"p",ul:"ul",li:"li",h2:"h2",pre:"pre",code:"code",img:"img"},(0,n.ah)(),e.components);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(c.h1,{id:"8实战案例调试-vue-项目",children:["8.实战案例：调试 Vue 项目",(0,s.jsx)(c.a,{className:"header-anchor","aria-hidden":"true",href:"#8实战案例调试-vue-项目",children:"#"})]}),"\n",(0,s.jsx)(c.p,{children:"我们学了如何用 VSCode Debugger 调试网页，也过了一遍各种配置，并且学习了 sourcemap，这节我们实战一下。"}),"\n",(0,s.jsx)(c.p,{children:"前面调试了 React 项目，这节来调试下 Vue 项目。"}),"\n",(0,s.jsx)(c.p,{children:"Vue 项目的创建有两种方式："}),"\n",(0,s.jsxs)(c.ul,{children:["\n",(0,s.jsx)(c.li,{children:"用 @vue/cli 创建的 webpack 作为构建工具的项目"}),"\n",(0,s.jsx)(c.li,{children:"用 create-vue 创建的 vite 作为构建工具的项目"}),"\n"]}),"\n",(0,s.jsx)(c.p,{children:"我们分别来看一下："}),"\n",(0,s.jsxs)(c.h2,{id:"调试-vuecli-创建的-webpack-项目",children:["调试 @vue/cli 创建的 webpack 项目",(0,s.jsx)(c.a,{className:"header-anchor","aria-hidden":"true",href:"#调试-vuecli-创建的-webpack-项目",children:"#"})]}),"\n",(0,s.jsx)(c.p,{children:"首先安装 @vue/cli："}),"\n",(0,s.jsx)(c.pre,{children:(0,s.jsx)(c.code,{children:"yarn global add @vue/cli\n"})}),"\n",(0,s.jsx)(c.p,{children:"然后执行 vue create vue-demo1 创建 vue 项目："}),"\n",(0,s.jsx)(c.p,{children:(0,s.jsx)("img",{src:M,alt:""})}),"\n",(0,s.jsx)(c.p,{children:"选择 vue3 的模版。"}),"\n",(0,s.jsx)(c.p,{children:"安装完之后进入到 vue-demo1 目录，执行 npm run serve 把开发服务跑起来。"}),"\n",(0,s.jsx)(c.p,{children:(0,s.jsx)("img",{src:L,alt:""})}),"\n",(0,s.jsx)(c.p,{children:"浏览器访问，会看到渲染出的页面："}),"\n",(0,s.jsx)(c.p,{children:(0,s.jsx)("img",{src:S,alt:""})}),"\n",(0,s.jsx)(c.p,{children:"然后我们进行调试："}),"\n",(0,s.jsx)(c.p,{children:"点击调试窗口的 create a launch.json file 来创建调试配置文件："}),"\n",(0,s.jsx)(c.p,{children:(0,s.jsx)("img",{src:F,alt:""})}),"\n",(0,s.jsx)(c.p,{children:"把 Chrome 调试配置的 url 改成目标 url 就可以进行调试了："}),"\n",(0,s.jsx)(c.p,{children:(0,s.jsx)("img",{src:V,alt:""})}),"\n",(0,s.jsx)(c.p,{children:"点击 debug 启动，在 vue 组件里打个断点，你会发现断点没生效："}),"\n",(0,s.jsx)(c.p,{children:(0,s.jsx)("img",{src:B,alt:""})}),"\n",(0,s.jsx)(c.p,{children:"这是为什么呢？"}),"\n",(0,s.jsx)(c.p,{children:"我们先加个 debugger 来跑一下："}),"\n",(0,s.jsx)(c.p,{children:(0,s.jsx)("img",{src:U,alt:""})}),"\n",(0,s.jsx)(c.p,{children:"然后在 Chrome DevTools 里看下："}),"\n",(0,s.jsx)(c.p,{children:(0,s.jsx)("img",{src:T,alt:""})}),"\n",(0,s.jsx)(c.p,{children:"你会发现他从一个乱七八糟的路径，映射到了 webpack://vue-demo1/src/App.vue?11c4 的路径下。"}),"\n",(0,s.jsx)(c.p,{children:"然后在 VSCode Debugger 里看看这个路径："}),"\n",(0,s.jsx)(c.p,{children:(0,s.jsx)("img",{src:C,alt:""})}),"\n",(0,s.jsx)(c.p,{children:"发现是 /Users/guang/code/vue-demo1/src/App.vue?11c4"}),"\n",(0,s.jsx)(c.p,{children:"本地明显没这个文件，所以就只读了。"}),"\n",(0,s.jsx)(c.p,{children:"其实这个路径已经做过了映射，就是完成了从 webpack:///vue-demo1/src/App.vue?11c4  到 /Users/guang/code/vue-demo1/src/App.vue?11c4 的映射。"}),"\n",(0,s.jsx)(c.p,{children:"看一下 sourceMapPathOverrides 默认这三条配置，很容易看出是最后一条做的映射："}),"\n",(0,s.jsx)(c.p,{children:(0,s.jsx)("img",{src:_,alt:""})}),"\n",(0,s.jsx)(c.p,{children:"但问题就出现在后面多了一个 ?hash 的字符串，导致路径不对了。"}),"\n",(0,s.jsx)(c.p,{children:"那为什么会多这样一个 hash 呢？"}),"\n",(0,s.jsx)(c.p,{children:"这是因为 vue cli 默认的 devtool 设置是 eval-cheap-module-source-map，前面讲过，eval 是每个模块用 eval 包裹，并且通过 sourceURL 指定文件路径，通过 sourceMappingURL 指定 sourcemap。"}),"\n",(0,s.jsx)(c.p,{children:"在 Chrome DevTools 里点击下面的 source map from 的 url："}),"\n",(0,s.jsx)(c.p,{children:(0,s.jsx)("img",{src:R,alt:""})}),"\n",(0,s.jsx)(c.p,{children:"你会发现先映射到了一个中间文件："}),"\n",(0,s.jsx)(c.p,{children:(0,s.jsx)("img",{src:D,alt:""})}),"\n",(0,s.jsx)(c.p,{children:"这个是被 eval 包裹并指定了 sourceURL 的模块代码，会被 Chrome DevTools 当作文件加到 sources 里。"}),"\n",(0,s.jsx)(c.p,{children:"这里有两个 sourceURL，第一个 sourceURL 在 sourceMappingURL 之前，这样 sourcemap 映射到的就是这个 url，也就是被 Chrome DevTools 当作文件的路径。而第二个 sourceURL 在之后，它可以修改当前文件的 url，也就是在调试工具里展示的路径。"}),"\n",(0,s.jsx)(c.p,{children:"然后再点击，会跳转回 bundle 的代码："}),"\n",(0,s.jsx)(c.p,{children:(0,s.jsx)("img",{src:A,alt:""})}),"\n",(0,s.jsx)(c.p,{children:"这些被 eval 包裹的就是一个个的模块代码。"}),"\n",(0,s.jsx)(c.p,{children:"这些是上节讲过的内容，这样有啥问题么？"}),"\n",(0,s.jsx)(c.p,{children:"第一个 sourceURL 的路径是通过 [module] 指定的，而模块名后默认会带 ?hash："}),"\n",(0,s.jsx)(c.p,{children:(0,s.jsx)("img",{src:k,alt:""})}),"\n",(0,s.jsx)(c.p,{children:"所以想要去掉 hash 就不能用 eval 的方式。"}),"\n",(0,s.jsx)(c.p,{children:"所以我们修改下 webpack 的 devtool 配置："}),"\n",(0,s.jsx)(c.p,{children:(0,s.jsx)("img",{src:E,alt:""})}),"\n",(0,s.jsx)(c.p,{children:"从 eval-cheap-module-source-map 变为 source-map。"}),"\n",(0,s.jsx)(c.p,{children:"去掉 eval 是为了避免生成 ?hash 的路径，去掉 cheap 是为了保留列的映射，去掉 module 是因为这里不需要合并 loader 做的转换。"}),"\n",(0,s.jsx)(c.p,{children:"然后重启跑一下 dev server，再次调试："}),"\n",(0,s.jsx)(c.p,{children:"这时你会发现之前不生效的断点现在能生效了："}),"\n",(0,s.jsx)(c.p,{children:(0,s.jsx)("img",{src:w,alt:""})}),"\n",(0,s.jsx)(c.p,{children:"去 Chrome DevTools 里看一下，路径后也没有 ?hash 了："}),"\n",(0,s.jsx)(c.p,{children:(0,s.jsx)("img",{src:g,alt:""})}),"\n",(0,s.jsx)(c.p,{children:"这样就能愉快的调试 vue3 的代码了。"}),"\n",(0,s.jsx)(c.p,{children:"如果你创建的是 vue2 项目，可能还要在 launch.json 的调试配置加这样一段映射（只保留这一条）："}),"\n",(0,s.jsx)(c.p,{children:(0,s.jsx)("img",{src:f,alt:""})}),"\n",(0,s.jsx)(c.p,{children:(0,s.jsx)("img",{src:v,alt:""})}),"\n",(0,s.jsx)(c.pre,{children:(0,s.jsx)(c.code,{className:"language-json",children:'"sourceMapPathOverrides": {\n    "webpack://你的项目名/src/*": "${workspaceFolder}/src/*"\n}\n'})}),"\n",(0,s.jsx)(c.p,{children:"这个项目名就是 project 的名字，你也可以在代码里打个断点，在 Chrome DevTools 里看："}),"\n",(0,s.jsx)(c.p,{children:(0,s.jsx)("img",{src:m,alt:""})}),"\n",(0,s.jsx)(c.p,{children:"我们映射的目的就是把这个路径映射到本地目录。"}),"\n",(0,s.jsx)(c.p,{children:"如果你在 chrome devtools 里看到的路径没有项目名："}),"\n",(0,s.jsx)(c.p,{children:(0,s.jsx)("img",{src:b,alt:""})}),"\n",(0,s.jsx)(c.p,{children:"那就直接这样映射："}),"\n",(0,s.jsx)(c.p,{children:(0,s.jsx)("img",{src:u,alt:""})}),"\n",(0,s.jsx)(c.p,{children:"绝大多数情况下，这样样配就行了。"}),"\n",(0,s.jsx)(c.p,{children:"但有的项目可能 VSCode 还是没映射对，这时候你可以自己映射一下，打个断点看看在 Chrome DevTools 里是什么路径，然后看看本地是什么路径，配置对应的映射就好了。"}),"\n",(0,s.jsx)(c.p,{children:"知道了 vue cli 创建的 webpack 项目怎么调试，我们再来看下 create vue 创建的 vite 项目："}),"\n",(0,s.jsxs)(c.h2,{id:"调试-create-vue-创建的-vite-项目",children:["调试 create vue 创建的 vite 项目",(0,s.jsx)(c.a,{className:"header-anchor","aria-hidden":"true",href:"#调试-create-vue-创建的-vite-项目",children:"#"})]}),"\n",(0,s.jsxs)(c.p,{children:[(0,s.jsx)(c.a,{href:"https://github.com/vuejs/create-vue",target:"_blank",rel:"noopener noreferrer",children:"create vue"})," 是创建 vite 作为构建工具的 vue 项目的工具。"]}),"\n",(0,s.jsx)(c.p,{children:"直接执行 npm init vue@3  即可："}),"\n",(0,s.jsx)(c.p,{children:(0,s.jsx)("img",{src:o,alt:""})}),"\n",(0,s.jsx)(c.p,{children:"进入 vue-demo2 目录，执行安装，启动开发服务器："}),"\n",(0,s.jsx)(c.p,{children:(0,s.jsx)("img",{src:x,alt:""})}),"\n",(0,s.jsx)(c.p,{children:"浏览器访问，可以看到渲染出的页面："}),"\n",(0,s.jsx)(c.p,{children:(0,s.jsx)("img",{src:j,alt:""})}),"\n",(0,s.jsx)(c.p,{children:"我们添加一个调试配置如下："}),"\n",(0,s.jsx)(c.pre,{children:(0,s.jsx)(c.code,{className:"language-json",children:'{\n    "type": "chrome",\n    "request": "launch",\n    "name": "调试 vite 项目",\n    "runtimeExecutable": "canary",\n    "runtimeArgs": [\n        "--auto-open-devtools-for-tabs"\n    ],\n    "userDataDir": false,\n    "url": "http://localhost:5174",\n    "webRoot": "${workspaceFolder}/aaa"\n}\n'})}),"\n",(0,s.jsx)(c.p,{children:"这里设置 userDataDir 为 false，是使用默认用户数据目录，不然 Vue DevTools 之类的插件就要再次安装了。"}),"\n",(0,s.jsx)(c.p,{children:"打个断点，然后 Debug 启动："}),"\n",(0,s.jsx)(c.p,{children:(0,s.jsx)("img",{src:h,alt:""})}),"\n",(0,s.jsx)(c.p,{children:(0,s.jsx)("img",{src:t,alt:""})}),"\n",(0,s.jsx)(c.p,{children:"我们找个 vue 文件打个断点："}),"\n",(0,s.jsx)(c.p,{children:"修改下 HelloWorld.vue 的代码，然后打两个断点："}),"\n",(0,s.jsx)(c.p,{children:(0,s.jsx)("img",{src:p,alt:""})}),"\n",(0,s.jsx)(c.p,{children:"重新启动调试："}),"\n",(0,s.jsx)(c.p,{children:(0,s.jsx)("img",{src:l,alt:""})}),"\n",(0,s.jsx)(c.p,{children:(0,s.jsx)("img",{src:d,alt:""})}),"\n",(0,s.jsx)(c.p,{children:"两个断点都能生效，代码也能直接修改。"}),"\n",(0,s.jsx)(c.p,{children:"还有，调试 @vue/cli 创建的项目时，我们还映射了下 sourcemap 的 path，为啥 create vue 的项目就不需要了呢？"}),"\n",(0,s.jsx)(c.p,{children:"看下 sourcemap 到的文件路径就知道了："}),"\n",(0,s.jsx)(c.p,{children:"运行的代码文件的路径是："}),"\n",(0,s.jsx)(c.p,{children:(0,s.jsx)("img",{src:i,alt:""})}),"\n",(0,s.jsx)(c.p,{children:"sourcemap 到的文件路径是："}),"\n",(0,s.jsx)(c.p,{children:(0,s.jsx)("img",{src:r,alt:""})}),"\n",(0,s.jsxs)(c.p,{children:["从 ",(0,s.jsx)(c.a,{href:"http://localhost:5174",target:"_blank",rel:"noopener noreferrer",children:"http://localhost:5174"})," 后开始，把 /src/components/HelloWorld.vue 文件 sourcemap 到了 /Users/guang/code/vue-demo2/src/components/HelloWorld.vue"]}),"\n",(0,s.jsx)(c.p,{children:"这已经能够对应到本地的文件了，自然也就不需要 sourceMapPathOverrides 的配置。"}),"\n",(0,s.jsx)(c.p,{children:"至此，create vue 创建的 vue 项目我们也知道怎么调试了。"}),"\n",(0,s.jsx)(c.p,{children:"有同学可能会问，为什么 webRoot 要配置成 ${workspaceFolder}/aaa 呢？"}),"\n",(0,s.jsx)(c.p,{children:"这个问题解释起来比较复杂，可以看下一节。"}),"\n",(0,s.jsxs)(c.h2,{id:"总结",children:["总结",(0,s.jsx)(c.a,{className:"header-anchor","aria-hidden":"true",href:"#总结",children:"#"})]}),"\n",(0,s.jsx)(c.p,{children:"这节我们调试了下 vue 项目。"}),"\n",(0,s.jsx)(c.p,{children:"vue 项目有两种创建方式，@vue/cli 和 create vue，分别是创建 webpack 和 vite 作为构建工具的项目。"}),"\n",(0,s.jsx)(c.p,{children:"vue cli 创建的项目，默认情况下打断点不生效，这是因为文件路径后带了 ?hash，这是默认的 eval-cheap-module-source-map 的 devtool 配置导致的，去掉 eval，改为 source-map 即可。"}),"\n",(0,s.jsx)(c.p,{children:"create vue 创建的 vite 做为构建工具的项目 sourcemap 到的路径直接就是本地的路径了，更简单一些。但是会有一些文件被错误映射到源码的问题，需要设置下 webRoot。"}),"\n",(0,s.jsx)(c.p,{children:"学会了 vue 项目的调试，接下来就可以愉快的边调试边写代码了。"})]})}function N(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:c}=Object.assign({},(0,n.ah)(),e.components);return c?(0,s.jsx)(c,{...e,children:(0,s.jsx)(P,{...e})}):P(e)}let O=N;N.__RSPRESS_PAGE_META={},N.__RSPRESS_PAGE_META["%E5%89%8D%E7%AB%AF%E8%B0%83%E8%AF%95%E9%80%9A%E5%85%B3%E7%A7%98%E7%B1%8D%2F8.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B%EF%BC%9A%E8%B0%83%E8%AF%95%20Vue%20%E9%A1%B9%E7%9B%AE.md"]={toc:[{text:"调试 @vue/cli 创建的 webpack 项目",id:"调试-vuecli-创建的-webpack-项目",depth:2},{text:"调试 create vue 创建的 vite 项目",id:"调试-create-vue-创建的-vite-项目",depth:2},{text:"总结",id:"总结",depth:2}],title:"8.实战案例：调试 Vue 项目",headingTitle:"8.实战案例：调试 Vue 项目",frontmatter:{}}}}]);