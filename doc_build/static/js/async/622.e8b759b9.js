"use strict";(self.webpackChunkjue_jin_book_press=self.webpackChunkjue_jin_book_press||[]).push([["622"],{710953:function(e,n,s){s.r(n),s.d(n,{default:()=>B});var c=s(552676),r=s(740453);let i=s.p+"static/image/c792ef258766c2be46a7e41010d324ba.6e21394c.webp",d=s.p+"static/image/6527fc9365644022219490304d58e434.078797dd.webp",a=s.p+"static/image/b3a9ad30a93aeabb1fc0e763e1486365.9cb950d7.webp",p=s.p+"static/image/f4c86f86de5adf2eee5b04d7ef4349f7.6f6cbbde.webp",l=s.p+"static/image/90fab79ae20a653e71d52526dbf211b0.e45450f6.webp",t=s.p+"static/image/09d354f9372899fd616f9cce971d4787.df53635d.webp",o=s.p+"static/image/1333c2e0d8b844ba678dc9fc7abc9c1d.194a90a0.webp",j=s.p+"static/image/61bd354209b1b78d8b66d574d6422585.bc412674.webp",x=s.p+"static/image/1e570e34cde0c641cb98843d88504a69.436f2fc8.webp",m=s.p+"static/image/f6cde24d8cb8f05aa96c2c13440c327c.ad370900.webp",h=s.p+"static/image/b4d0ac434e76588c651e51469473ee05.446aeaa3.webp",g=s.p+"static/image/ee62af9eb676934c8c47746fb376726c.1ecd98f7.webp",b=s.p+"static/image/8a456a396389ccfeca8c5554eb026a5f.c56c6b37.webp",f=s.p+"static/image/156af606bad0153c90c63609fa31bbba.fd630625.webp",k=s.p+"static/image/54a9266f7cebd75447aa4a79db8abf4b.dda010dc.webp",u=s.p+"static/image/cc5d27bce24da50fa6e4330d506c3268.31d2a28b.webp",A=s.p+"static/image/591299cce62a9bac856e17435f5b6eee.31a28f70.webp",y=s.p+"static/image/065267e24637b6b0967fa08dc319f482.62e044a2.webp",w=s.p+"static/image/60e7f7f9b9f8139f4971a94394dc13d7.4bd479c7.webp",q=s.p+"static/image/c58718eb7b779611a4e485d9c77123c0.85c0c62b.webp",v=s.p+"static/image/edb6286f8c2124761e0a00153db53c49.c6f0d13b.webp",O=s.p+"static/image/c7e7815b0c3eb5731abe74c55730c0b0.53d3a624.webp",N=s.p+"static/image/7398c1e15a8a71b446c006235ba05113.2c06cdac.webp",R=s.p+"static/image/44287c7e4887257a8af5bfc6b43aa481.28849e22.webp",I=s.p+"static/image/19ae1873c2337c4b50c5ee3858ec0571.a64bd2e7.webp",M=s.p+"static/image/7757755819cbc19e1ce0aa59ed571682.a8d34dc2.webp",T=s.p+"static/image/0261fe8a411046796984e5eb266da855.112d9a77.webp",E=s.p+"static/image/d91931e15b72f469fbfe332a2cf93895.dd121c83.webp",S=s.p+"static/image/58769c9ce23b4c97368b23d6180e973c.6c88ede0.webp",U=s.p+"static/image/4ebddc2febde9ffc61a92ad9fb580308.efaadb5e.webp",F=s.p+"static/image/8488b126fb11190b744b62cf90a71c8c.eb6e5a0e.webp",P=s.p+"static/image/34846ced3a5c93f2b985e871cab007c0.0681c1cc.webp",X=s.p+"static/image/e18a01155aa474a34079e2319d0e4b74.d3eb334c.webp",V=s.p+"static/image/2ce7f6a689e75997aff36c8580a701c8.a776bb8d.webp",Z=s.p+"static/image/47b864466c7c234797b7ae591813db58.4f92234b.webp";function W(e){let n=Object.assign({p:"p",pre:"pre",code:"code",img:"img",a:"a",h2:"h2"},(0,r.ah)(),e.components);return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.p,{children:"我们学习了 Nest、Mysql、Redis，并且在 Nest 里远程连接 Mysql 和 Redis 来做数据存储、增删改查。"}),"\n",(0,c.jsx)(n.p,{children:"Mysql 和 Redis 都是跑在 Docker 容器里的。"}),"\n",(0,c.jsx)(n.p,{children:"部署 Nest 项目的时候也是跑的 dockerfile + docker build 产生的镜像。"}),"\n",(0,c.jsx)(n.p,{children:"这就涉及到了 3 个 Docker 容器：Nest、Mysql、Redis。"}),"\n",(0,c.jsx)(n.p,{children:"后面可能还会涉及到更多的 Docker 容器。"}),"\n",(0,c.jsx)(n.p,{children:"那么问题来了，每次想把项目跑起来都要 docker run 一堆镜像也太麻烦了，有没有什么简便方式呢？"}),"\n",(0,c.jsx)(n.p,{children:"而且，这么多的容器怎么保证启动顺序呢？"}),"\n",(0,c.jsx)(n.p,{children:"解决方式是有的，就是 Docker Compose。"}),"\n",(0,c.jsx)(n.p,{children:"我们先来看看不用 Docker Compose 的时候怎么部署："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"nest new docker-compose-test -p npm\n"})}),"\n",(0,c.jsx)(n.p,{children:"创建个 nest 项目："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:Z,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"安装 tyeporm、mysql2；"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"npm install --save @nestjs/typeorm typeorm mysql2\n"})}),"\n",(0,c.jsx)(n.p,{children:"然后在 AppModule 引入 TypeOrmModule："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:"import { Module } from '@nestjs/common';\nimport { TypeOrmModule } from '@nestjs/typeorm';\nimport { AppController } from './app.controller';\nimport { AppService } from './app.service';\n\n@Module({\n  imports: [\n    TypeOrmModule.forRoot({\n      type: \"mysql\",\n      host: \"localhost\",\n      port: 3306,\n      username: \"root\",\n      password: \"guang\",\n      database: \"aaa\",\n      synchronize: true,\n      logging: true,\n      entities: [],\n      poolSize: 10,\n      connectorPackage: 'mysql2',\n      extra: {\n          authPlugin: 'sha256_password',\n      }\n    }),\n  ],\n  controllers: [AppController],\n  providers: [AppService],\n})\nexport class AppModule {}\n\n"})}),"\n",(0,c.jsx)(n.p,{children:"这里的 database 我们在 mysql workbench 里创建下："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sql",children:"CREATE DATABASE `aaa` DEFAULT CHARACTER SET utf8mb4 ;\n"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:V,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"添加一个 aaa.entity.ts"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:'import { Column, Entity, PrimaryGeneratedColumn } from "typeorm";\n\n@Entity()\nexport class Aaa {\n    @PrimaryGeneratedColumn()\n    id: number;\n\n    @Column({\n        length: 30\n    })\n    aaa: string;\n\n    @Column({\n        length: 30\n    })\n    bbb: string;\n}\n\n'})}),"\n",(0,c.jsx)(n.p,{children:"在 entities 里注册下："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:X,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"然后把 nest 服务跑起来："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"npm run start:dev\n"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:P,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"可以看到，执行了 create table 的 sql。"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:F,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"说明 mysql 是连接成功了。"}),"\n",(0,c.jsx)(n.p,{children:"然后再引入 redis："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"npm install redis \n"})}),"\n",(0,c.jsx)(n.p,{children:"添加一个 redis client 的 provider："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:U,alt:""})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:"{\n  provide: 'REDIS_CLIENT',\n  async useFactory() {\n    const client = createClient({\n        socket: {\n            host: 'localhost',\n            port: 6379\n        }\n    });\n    await client.connect();\n    return client;\n  }\n}\n"})}),"\n",(0,c.jsx)(n.p,{children:"在 AppService 里注入下："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:S,alt:""})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:"import { Controller, Get, Inject } from '@nestjs/common';\nimport { RedisClientType } from 'redis';\nimport { AppService } from './app.service';\n\n@Controller()\nexport class AppController {\n  constructor(private readonly appService: AppService) {}\n\n  @Inject('REDIS_CLIENT')\n  private redisClient: RedisClientType;\n\n  @Get()\n  async getHello() {\n    const keys = await this.redisClient.keys('*');\n    console.log(keys);\n\n    return this.appService.getHello();\n  }\n}\n\n"})}),"\n",(0,c.jsx)(n.p,{children:"这里用到的 mysql、redis 都是之前通过 docker 跑的："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:E,alt:""})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:T,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"忘记怎么跑 msyql 和 redis 的 docker 容器的同学去翻一下这两个的入门章节。"}),"\n",(0,c.jsxs)(n.p,{children:["然后访问下 ",(0,c.jsx)(n.a,{href:"http://localhost:3000",target:"_blank",rel:"noopener noreferrer",children:"http://localhost:3000"})]}),"\n",(0,c.jsxs)(n.p,{children:["打印了 redis 里的 key：\n",(0,c.jsx)("img",{src:M,alt:""})]}),"\n",(0,c.jsx)(n.p,{children:"在 RedisInsight 里看到的也是这些："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:I,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"这就说明 redis 服务连接成功了。"}),"\n",(0,c.jsx)(n.p,{children:"这里就不写具体的业务逻辑了。"}),"\n",(0,c.jsx)(n.p,{children:"假设我们 nest 服务开发完了，想部署，那就要写这样的 dockerfile："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-docker",children:'FROM node:18.0-alpine3.14 as build-stage\n\nWORKDIR /app\n\nCOPY package.json .\n\nRUN npm install\n\nCOPY . .\n\nRUN npm run build\n\n# 76. 为什么要使用 Docker Compose ？\nFROM node:18.0-alpine3.14 as production-stage\n\nCOPY --from=build-stage /app/dist /app\nCOPY --from=build-stage /app/package.json /app/package.json\n\nWORKDIR /app\n\nRUN npm install --production\n\nEXPOSE 3000\n\nCMD ["node", "/app/main.js"]\n'})}),"\n",(0,c.jsx)(n.p,{children:"用多阶段构建的方式，最后只保留生产阶段的镜像。"}),"\n",(0,c.jsx)(n.p,{children:"用 alpine 的基础镜像，体积会减小很多。"}),"\n",(0,c.jsx)(n.p,{children:"这些前面讲过。"}),"\n",(0,c.jsx)(n.p,{children:"在根目录添加这个 Dockerfile，然后 docker build 一下："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"docker build -t eee .\n"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:R,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"（我这里稍微有点久，用了 200 多秒）"}),"\n",(0,c.jsx)(n.p,{children:"在 docker desktop 里可以看到这个镜像："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:N,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"那假设在服务器上，要怎么部署这个 nest 应用呢？"}),"\n",(0,c.jsx)(n.p,{children:"我们先把 mysql、redis 的容器停掉。"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:O,alt:""})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:v,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"在服务器上，是没有 docker desktop 的，所以接下来我们通过命令行的方式："}),"\n",(0,c.jsx)(n.p,{children:"先跑 mysql 的 docker 容器："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"docker run -d -p 3306:3306 -v /Users/guang/mysql-data:/var/lib/mysql --name mysql-container mysql\n"})}),"\n",(0,c.jsx)(n.p,{children:"-d 是 deamon，放到后台运行的意思。"}),"\n",(0,c.jsx)(n.p,{children:"-p 是端口映射"}),"\n",(0,c.jsx)(n.p,{children:"-v 是挂载数据卷，把宿主机目录映射到容器内的目录（这里要换成你自己的）"}),"\n",(0,c.jsx)(n.p,{children:"-name 是容器名"}),"\n",(0,c.jsx)(n.p,{children:"可能还需要指定环境变量："}),"\n",(0,c.jsx)(n.p,{children:"-e MYSQL_ROOT_PASSWORD=xxx 设置 root 用户的密码"}),"\n",(0,c.jsx)(n.p,{children:"因为我之前跑过，在数据卷的那个目录有之前的设置，所以不用设置了。"}),"\n",(0,c.jsx)(n.p,{children:"跑起来可以看到容器 id："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:q,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"然后再跑下 redis 的 docker 容器："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"docker run -d -p 6379:6379 -v /Users/guang/aaa:/data --name redis-container redis\n"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:w,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"之后跑 nest 的："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"docker run -d -p 3000:3000 --name nest-container eee\n"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:y,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"看下 3个容器的日志"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"docker logs mysql-container\n"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:A,alt:""})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"docker logs redis-container\n"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:u,alt:""})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"docker logs nest-container\n"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:k,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"这时候你会发现报错了，说是 127.0.0.1 的 6379 端口连不上。"}),"\n",(0,c.jsx)(n.p,{children:"为什么呢？"}),"\n",(0,c.jsx)(n.p,{children:"因为这时候 127.0.0.1 就是容器内的端口了，不是宿主机的。"}),"\n",(0,c.jsx)(n.p,{children:"所以要把 ip 换成宿主机 ip 才行。"}),"\n",(0,c.jsx)(n.p,{children:"查一下本机的 ip 地址："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:f,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"然后把 AppModule 里的 redis 和 mysql 连接信息改一下："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:b,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"之后重新 build 一个镜像："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"docker build -t fff .\n"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:g,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"这次构建用了 120s，比上次快，因为本地有缓存了。"}),"\n",(0,c.jsx)(n.p,{children:"把之前的容器删掉："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"docker rm nest-container\n"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:h,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"然后在数据库里把 aaa这个表删掉："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:m,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"再跑 nest 容器："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"docker run -d -p 3000:3000 --name nest-container fff\n"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:x,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"这时候再查看日志："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"docker logs nest-container\n"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:j,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"这时候就正常了。"}),"\n",(0,c.jsx)(n.p,{children:"可以看到 sql 打印是正确的。"}),"\n",(0,c.jsx)(n.p,{children:"表也创建成功了："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:o,alt:"image.png"})}),"\n",(0,c.jsxs)(n.p,{children:["浏览器访问下 ",(0,c.jsx)(n.a,{href:"http://localhost:3000",target:"_blank",rel:"noopener noreferrer",children:"http://localhost:3000"})]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:"data:image/webp;base64,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",alt:"image.png"})}),"\n",(0,c.jsx)(n.p,{children:"再次 docker logs 看看："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:t,alt:"image.png"})}),"\n",(0,c.jsx)(n.p,{children:"可以看到 redis 服务也连接成功了。"}),"\n",(0,c.jsx)(n.p,{children:"这样我们就把 mysql、redis、nest 3个 docker 容器跑了起来。"}),"\n",(0,c.jsx)(n.p,{children:"可以发现我们跑了 3 次  docker build，而且还要注意顺序，不然 nest 服务跑起来了，但是 mysql 服务没跑起来，就会报错。"}),"\n",(0,c.jsx)(n.p,{children:"前面说，docker compose 可以解决这种问题。"}),"\n",(0,c.jsx)(n.p,{children:"怎么解决呢？"}),"\n",(0,c.jsx)(n.p,{children:"把 3 个容器停掉："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"docker stop nest-container mysql-container redis-container\n"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:l,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"然后在根目录添加一个 docker-compose.yml"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-yaml",children:"services:\n  nest-app:\n    build:\n      context: ./\n      dockerfile: ./Dockerfile\n    depends_on:\n      - mysql-container\n      - redis-container\n    ports:\n      - '3000:3000'\n  mysql-container:\n    image: mysql\n    ports:\n      - '3306:3306'\n    volumes:\n      - /Users/guang/mysql-data:/var/lib/mysql\n    environment:\n      MYSQL_DATABASE: aaa\n      MYSQL_ROOT_PASSWORD: guang\n  redis-container:\n    image: redis\n    ports:\n      - '6379:6379'\n    volumes:\n      - /Users/guang/aaa:/data\n"})}),"\n",(0,c.jsx)(n.p,{children:"每个 services 都是一个 docker 容器，名字随便指定。"}),"\n",(0,c.jsx)(n.p,{children:"这里指定了 nest-app、mysql-container、reids-container 3 个service："}),"\n",(0,c.jsx)(n.p,{children:"然后 nest-app 配置了 depends_on 其他两个 service。"}),"\n",(0,c.jsx)(n.p,{children:"这样 docker-compose 就会先启动另外两个，再启动这个，这样就能解决顺序问题。"}),"\n",(0,c.jsx)(n.p,{children:"然后 mysql-container、redis-container 的 service 指定了 image 和 ports、volumes 的映射，这些都很容易看懂。"}),"\n",(0,c.jsx)(n.p,{children:"mysql 容器跑的时候还要指定 MYSQL_DATABASE 和 MYSQL_ROOT_PASSWORD 环境变量。"}),"\n",(0,c.jsx)(n.p,{children:"MYSQL_ROOT_PASSWORD 是 root 用户的密码，MYSQL_DATABASE 是会自动创建的 database。"}),"\n",(0,c.jsx)(n.p,{children:"nest-app 指定了 context 下的 dockerfile 路径，端口映射。"}),"\n",(0,c.jsx)(n.p,{children:"然后我们通过 docker-compose 把它跑起来："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"docker-compose up\n"})}),"\n",(0,c.jsx)(n.p,{children:"docker-compose 和 docker 命令是一起的，docker 能用，docker-compose 就能用。"}),"\n",(0,c.jsx)(n.p,{children:"它会把所有容器的日志合并输出："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:p,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"可以看到是先跑的 mysql、redis，再跑的 nest。"}),"\n",(0,c.jsx)(n.p,{children:"只不过 mysql 服务启动有点慢，会连接失败几次。"}),"\n",(0,c.jsx)(n.p,{children:"最后是会成功的："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:a,alt:""})}),"\n",(0,c.jsxs)(n.p,{children:["浏览器访问下 ",(0,c.jsx)(n.a,{href:"http://localhost:3000",target:"_blank",rel:"noopener noreferrer",children:"http://localhost:3000"})]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:"data:image/webp;base64,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",alt:""})}),"\n",(0,c.jsx)(n.p,{children:"可以看到 redis 也连接成功了："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:d,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"这样，我们只需要定义 docker-compose.yaml 来声明容器的顺序和启动方式，之后执行 docker-compose up 一条命令就能按照顺序启动所有的容器。"}),"\n",(0,c.jsx)(n.p,{children:"启动流程就简便了很多。"}),"\n",(0,c.jsx)(n.p,{children:"这就是 docker-compose 的意义。"}),"\n",(0,c.jsx)(n.p,{children:"这时候如果你去 docker desktop 里看下，会发现它有专门的显示方式："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:i,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"多个容器可以一起管理。"}),"\n",(0,c.jsxs)(n.p,{children:["案例代码在",(0,c.jsx)(n.a,{href:"https://github.com/QuarkGluonPlasma/nestjs-course-code/tree/main/docker-compose-test",target:"_blank",rel:"noopener noreferrer",children:"小册仓库"}),"。"]}),"\n",(0,c.jsxs)(n.h2,{id:"总结",children:["总结",(0,c.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#总结",children:"#"})]}),"\n",(0,c.jsx)(n.p,{children:"这节我们通过 docker、docker-compose 两种方式来部署了 nest 项目。"}),"\n",(0,c.jsx)(n.p,{children:"docker 的方式需要手动 docker build 来构建 nest 应用的镜像。"}),"\n",(0,c.jsx)(n.p,{children:"然后按顺序使用 docker run 来跑 mysql、redis、nest 容器。"}),"\n",(0,c.jsx)(n.p,{children:"（要注意 nest 容器里需要使用宿主机 ip 来访问 mysql、redis 服务）"}),"\n",(0,c.jsx)(n.p,{children:"而 docker compose 就只需要写一个 docker-compose.yml 文件，配置多个 service 的启动方式和 depends_on 依赖顺序。"}),"\n",(0,c.jsx)(n.p,{children:"然后 docker-compose up 就可以批量按顺序启动一批容器。"}),"\n",(0,c.jsx)(n.p,{children:"基本上，我们跑 Nest 项目都会依赖别的服务，所以在单台机器跑的时候都是需要用 Docker Compose 的。"})]})}function J(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,r.ah)(),e.components);return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(W,{...e})}):W(e)}let B=J;J.__RSPRESS_PAGE_META={},J.__RSPRESS_PAGE_META["Nest%20%E9%80%9A%E5%85%B3%E7%A7%98%E7%B1%8D%20%20%E6%9C%80%E6%96%B0200%E7%AB%A0%2F76.%20%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E4%BD%BF%E7%94%A8%20Docker%20Compose%20%EF%BC%9F.md"]={toc:[{text:"总结",id:"总结",depth:2}],title:"",headingTitle:"",frontmatter:{}}}}]);