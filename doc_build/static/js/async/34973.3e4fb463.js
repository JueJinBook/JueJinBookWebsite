"use strict";(self.webpackChunkjue_jin_book_press=self.webpackChunkjue_jin_book_press||[]).push([["34973"],{959295:function(e,n,r){r.r(n),r.d(n,{default:()=>h});var d=r(552676),i=r(740453);let s=r.p+"static/image/40cf26c5b9b9c06540a7759350350deb.d4c3ba1c.webp",t=r.p+"static/image/7f30ff8030203443d0e2a1f77cdb8849.7da84642.webp",a=r.p+"static/image/3893aab69aecfe5b909856f3d1b6723d.60fdef5a.webp";function c(e){let n=Object.assign({h1:"h1",a:"a",h2:"h2",h3:"h3",p:"p",ul:"ul",li:"li",img:"img",code:"code",pre:"pre",ol:"ol"},(0,i.ah)(),e.components);return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(n.h1,{id:"27渲染篇-_-edge-runtime",children:["27.渲染篇 _ Edge Runtime",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#27渲染篇-_-edge-runtime",children:"#"})]}),"\n",(0,d.jsxs)(n.h2,{id:"1-edge-runtime",children:["1. Edge Runtime",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#1-edge-runtime",children:"#"})]}),"\n",(0,d.jsxs)(n.h3,{id:"11-介绍",children:["1.1 介绍",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#11-介绍",children:"#"})]}),"\n",(0,d.jsx)(n.p,{children:"学习 Next.js 的时候，我们可能会接触到 Edge Runtime 和 Node.js Runtime 这两个概念。在 Next.js 中，你可以把运行时（runtime）理解为执行期间一组可用的库、API、和常规功能的集合。在服务端，有两个可以用于渲染应用的运行时："}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"Nodejs Runtime，这是默认的运行时，可以使用 Node.js API 和其生态的包"}),"\n",(0,d.jsxs)(n.li,{children:["Edge Runtime，基于 ",(0,d.jsx)(n.a,{href:"https://nextjs.org/docs/app/api-reference/edge",target:"_blank",rel:"noopener noreferrer",children:"Web API"})]}),"\n"]}),"\n",(0,d.jsx)(n.p,{children:"在 Next.js 中，Edge Runtime 是 Nodejs API 的子集，功能上虽有限制，但对应也更轻量，速度也更快，适用于开发小而简单的功能，以低延迟实现动态、个性化的内容。"}),"\n",(0,d.jsx)(n.p,{children:"仅仅是这样的了解是不是还很懵逼？为了讲解 Edge Runtime 这个概念，我们先从 CDN 开始说起。"}),"\n",(0,d.jsx)(n.p,{children:"CDN，全称 Content Delivery Network，中文译为“内容分发网络”，它是由分布于不同地理位置的服务器及数据中心组成的虚拟网络，目的在于以最小的延迟将内容分发给用户。简单的来说，你在杭州请求在美国的网站，因为物理距离太远，响应会有延迟，但如果将网站的内容同步到杭州的服务器上，转而请求杭州服务器上的内容，响应时间就会加快。这组在杭州的用于缓存和传送网络内容的服务器就被称为 “Edge”。"}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)("img",{src:a,alt:"image.png"}),"\n以前的 Edge 只能存储一些静态的资源，但这不够强大，当你已经是个成熟的 Edge 时，你得学着能够执行代码，当能够执行代码时，CDN 网络就变成了更为强大的边缘网络（Edge Network），在 Edge 发生的计算，也被称为边缘计算，它可以为主要服务器分担一部分处理内容。理解这些概念，也有助于理解 Edge Runtime 这个概念，其术语 Edge 指的正是这种面向即时无服务器计算的环境。"]}),"\n",(0,d.jsx)(n.p,{children:"你可能会想到 Serverless。Serverless 很好，但每次请求的时候都会开启不同的实例，并重新初始化环境，尽管底层架构会做很多优化，但依然不能最大限度的复用资源。而对于 Edge Runtime，你可以通过 Vercel Edge functions 或者 Cloudflare workers 或者其他一些工具来部署 Edge Runtime 环境，Edge Runtime 并不运行 Nodejs，而使用 V8 引擎和 Web APIs，这样更加轻量，启动速度更快。多个请求可以使用一个实例，更好的复用资源。"}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)("img",{src:t,alt:"image.png"}),"\n有了 Edge Runtime 的优化再加上 Streaming，这就更快了："]}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)("img",{src:s,alt:"image.png"}),"\n总结一下，你可以把 Edge Runtime 理解成一个特殊的运行环境，在这个环境里，只能使用标准的 Web APIs，但对应也会带来更好的性能。至于具体支持哪些，查看 Next.js 提供的 ",(0,d.jsx)(n.a,{href:"https://nextjs.org/docs/app/api-reference/edge",target:"_blank",rel:"noopener noreferrer",children:"Edge Runtime Supports"})," 文档。"]}),"\n",(0,d.jsxs)(n.h3,{id:"12-开启",children:["1.2 开启",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#12-开启",children:"#"})]}),"\n",(0,d.jsxs)(n.p,{children:["你可以在 Next.js 中为单个路由指定运行时。为此，你需要声明一个名为 ",(0,d.jsx)(n.code,{children:"runtime"})," 的变量并导出它。变量必须是字符串，值为 ",(0,d.jsx)(n.code,{children:"'nodejs'"})," 或者 ",(0,d.jsx)(n.code,{children:"'edge'"}),"。举个例子："]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-javascript",children:"// app/page.js\nexport const runtime = 'edge' // 'nodejs' (default) | 'edge'\n"})}),"\n",(0,d.jsxs)(n.p,{children:["也可以在布局上定义 ",(0,d.jsx)(n.code,{children:"runtime"}),"，这会将 Edge Runtime 应用于该布局下的所有路由："]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-javascript",children:"// app/layout.js\nexport const runtime = 'edge' // 'nodejs' (default) | 'edge'\n"})}),"\n",(0,d.jsx)(n.p,{children:"如果你没有声明，默认是 Node.js Runtime，所以如果不打算修改，也无须使用该选项。"}),"\n",(0,d.jsxs)(n.h2,{id:"参考链接",children:["参考链接",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#参考链接",children:"#"})]}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"https://nextjs.org/docs/app/building-your-application/routing/loading-ui-and-streaming",target:"_blank",rel:"noopener noreferrer",children:"https://nextjs.org/docs/app/building-your-application/routing/loading-ui-and-streaming"})}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"https://edge-runtime.vercel.app/",target:"_blank",rel:"noopener noreferrer",children:"https://edge-runtime.vercel.app/"})}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"https://www.cdnetworks.com/cn/what-is-a-cdn/",target:"_blank",rel:"noopener noreferrer",children:"https://www.cdnetworks.com/cn/what-is-a-cdn/"})}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"https://zhuanlan.zhihu.com/p/510366735",target:"_blank",rel:"noopener noreferrer",children:"https://zhuanlan.zhihu.com/p/510366735"})}),"\n"]})]})}function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,i.ah)(),e.components);return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(c,{...e})}):c(e)}let h=l;l.__RSPRESS_PAGE_META={},l.__RSPRESS_PAGE_META["Next.js%20%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97%2F27.%E6%B8%B2%E6%9F%93%E7%AF%87%20_%20Edge%20Runtime.md"]={toc:[{text:"1. Edge Runtime",id:"1-edge-runtime",depth:2},{text:"1.1 介绍",id:"11-介绍",depth:3},{text:"1.2 开启",id:"12-开启",depth:3},{text:"参考链接",id:"参考链接",depth:2}],title:"27.渲染篇 _ Edge Runtime",headingTitle:"27.渲染篇 _ Edge Runtime",frontmatter:{}}}}]);