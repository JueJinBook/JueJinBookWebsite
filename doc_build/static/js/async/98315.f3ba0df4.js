"use strict";(self.webpackChunkjue_jin_book_press=self.webpackChunkjue_jin_book_press||[]).push([["98315"],{558062:function(e,n,c){c.r(n),c.d(n,{default:()=>T});var s=c(552676),d=c(740453);let i=c.p+"static/image/d4e2992de95bf8607d41cbd32e04baed.bdd78a1b.webp",a=c.p+"static/image/9abb14460b02c74ace1008a16fab8132.e7ec0f00.webp",r=c.p+"static/image/64fb8c0e0784e79d3d7ddbc9b2e22c12.17344b0b.webp",p=c.p+"static/image/ce0079c63ffb199c7276e4df64cc866f.f0486963.webp",t=c.p+"static/image/12458896673b46b1741330b9fe584cfc.c5410b7a.webp",l=c.p+"static/image/cb5e79ffd9ffb5105bad87a6799743bc.9815e53f.webp",x=c.p+"static/image/95518ad4c79f6ae72ed7445eef6a0c7b.3e4e8c76.webp",j=c.p+"static/image/cc75958fc9b5e1c3dc815dbd4d06a5fb.22d25822.webp",h=c.p+"static/image/6aa4f37420b488b15c85e6de8cdad4b5.7e13670b.webp",b=c.p+"static/image/b18e330e2ef10b554d06eb3c2bdc9fcf.986ad6c1.webp",o=c.p+"static/image/d07207888ab93eaecfe7d2c0c7d04b0f.85f89d1d.webp",f=c.p+"static/image/4e39dbf8e66fa0f7e919ad1b125b0fb1.507abee3.webp",m=c.p+"static/image/f85fdf92dc2c4c5a07542cec78776691.b73b2bce.webp",g=c.p+"static/image/8e0c61e7cea55cf5713f5c396798cc7e.873aa929.webp",u=c.p+"static/image/fb6fb4341517eeb982a6ffccafdf52dd.e5ad4b9b.webp",A=c.p+"static/image/5759ec5f455ac5b506c3c5ed6045bf46.ce48680a.webp",w=c.p+"static/image/1400f887cdde9fa04fe23371bcff6746.9bc906bf.webp",B=c.p+"static/image/ec63f5ffeaec5a12e5f5e403bd55c3ff.1ff4fe56.webp",v=c.p+"static/image/af88da42dfa0c70949c76bf33cb71ad4.bf017cd0.webp",P=c.p+"static/image/dd02a619513ea03df8b986064c34e241.1dfc50df.webp",D=c.p+"static/image/99de2c62071dbcfd913aefabf96e04e9.81d1a441.webp",U=c.p+"static/image/3cdb9af37de75a48d624ceb3cb62e50c.611c7318.webp",q=c.p+"static/image/95694dc5356c2842ae20b6829f5b3ea0.90241a5d.webp",k=c.p+"static/image/2872bcae8638bd21fd169cdf76463ba6.4b4ab596.webp",L=c.p+"static/image/1c4e94f4dbf6cc6aa882c6494f4125dc.ff1fd3b1.webp",S=c.p+"static/image/ce0ae031dd3b201c5955e67202a32bc7.f3130801.webp",X=c.p+"static/image/f74c09386ebc9fc29d469bffe3f39231.a7433e52.webp",K=c.p+"static/image/371b2f8c1e39ffb53d84a6656e8e49b6.404820de.webp",C=c.p+"static/image/0155df835aea020ccd1f60719f05ec92.76c9321d.webp",E=c.p+"static/image/2c5b9ee79b3cd8ac7cc28076907918c0.2632a2c2.webp",Y=c.p+"static/image/604b926382b0e69d7d62b91261a97b7e.ea04ffbe.webp",R=c.p+"static/image/fc6677fb363f3a94fe0bea34a7ac00cf.23e6920d.webp";function M(e){let n=Object.assign({h1:"h1",a:"a",p:"p",pre:"pre",code:"code",img:"img",ul:"ul",li:"li",h2:"h2"},(0,d.ah)(),e.components);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.h1,{id:"26实战案例调试-ant-design-组件源码",children:["26.实战案例：调试 Ant Design 组件源码",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#26实战案例调试-ant-design-组件源码",children:"#"})]}),"\n",(0,s.jsx)(n.p,{children:"写 react 项目的小伙伴应该都用过 antd 组件库，但绝大多数同学并没有看过它的源码。"}),"\n",(0,s.jsx)(n.p,{children:"而想深入掌握 antd 组件库，只熟悉参数是不行的，必须要深入到源码层面。"}),"\n",(0,s.jsx)(n.p,{children:"所以今天就来分享下如何调试 antd 的源码。"}),"\n",(0,s.jsx)(n.p,{children:"而且我敢说这种调试源码的方式 90% 的前端都不会。"}),"\n",(0,s.jsx)(n.p,{children:"为什么呢？看到后面你就知道了。"}),"\n",(0,s.jsx)(n.p,{children:"首先，我们用 create-react-app 创建一个 react 项目："}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"yarn create react-app antd-react-test\n"})}),"\n",(0,s.jsx)(n.p,{children:"创建成功后，进入到项目里，把 dev server 跑起来。"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:R,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"浏览器访问可以看到渲染出的页面："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:Y,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"然后我们安装 antd，在入口组件里引入样式和 Button 组件："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:E,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"页面会显示这个 Button："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:C,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"那怎么调试这个 Button 组件的源码呢？"}),"\n",(0,s.jsx)(n.p,{children:"可以这样："}),"\n",(0,s.jsx)(n.p,{children:"首先，创建一个 VSCode 调试配置："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:K,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"指定调试的 URL，然后启动调试。"}),"\n",(0,s.jsx)(n.p,{children:"在组件里打个断点，代码会在这里断住："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:X,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"可以看到调用栈中上一帧是 renderWithHooks，这就是 react 源码里调用函数组件的地方。"}),"\n",(0,s.jsx)(n.p,{children:"点击那个调用栈，你就会看到："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:S,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"它调用了 App 的函数组件，传入了参数，拿到渲染后的 children 做后续处理。"}),"\n",(0,s.jsx)(n.p,{children:"所有函数组件都是在这里被调用的，而 antd 的组件也全部是函数组件，那么我们在这里加个断点，打名字为 Button 的函数组件被调用的时候断住不就行了？"}),"\n",(0,s.jsx)(n.p,{children:"这种在某种条件下才断住的情况可以用条件断点："}),"\n",(0,s.jsx)(n.p,{children:"右键选择添加条件断点："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:L,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"输入断住的条件："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:k,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"当组件名字包含 Button 的时候才断住。"}),"\n",(0,s.jsx)(n.p,{children:"然后刷新："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:q,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"你会看到 App 组件明明也是函数组件，却没有在这里断住，而 InternalButton 在这里断住了。"}),"\n",(0,s.jsx)(n.p,{children:"这就是条件断点的作用。"}),"\n",(0,s.jsx)(n.p,{children:"这个 InternalButton 就是  antd 里的 Button 组件。"}),"\n",(0,s.jsx)(n.p,{children:"step into 进入函数内部："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:U,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"你会发现这确实是 Button 组件的源码，但却是被编译后的，比如 jsx 都被编译成了 React.createElement："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:D,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"这样是可以调试 Button 组件源码的，但是比较别扭。"}),"\n",(0,s.jsx)(n.p,{children:"那能不能直接调试 Button 组件对应的 tsx 源码呢？"}),"\n",(0,s.jsx)(n.p,{children:"可以的，这就要用到 sourcemap 了。"}),"\n",(0,s.jsx)(n.p,{children:"我们得把 antd 的源码下载下来(我下载的时候是 4.23）："}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"git clone --depth=1 --single-branch git@github.com:ant-design/ant-design.git\n"})}),"\n",(0,s.jsx)(n.p,{children:"下载的时候加个 --single-branch 是下载单个分支， --depth=1 是下载单个 commit， 这样速度会快几十倍，是个有用的加速小技巧。"}),"\n",(0,s.jsx)(n.p,{children:"antd 下载下来，安装完依赖之后，我们开始 build。"}),"\n",(0,s.jsx)(n.p,{children:"但你会发现 package.json 中有 build 命令，有 dist 命令，该执行哪个呢？"}),"\n",(0,s.jsx)(n.p,{children:"这个就需要了解下 antd 的几种入口了。"}),"\n",(0,s.jsx)(n.p,{children:"去 react 项目的 node_modules 下，找到 antd 的 package.json 看一下，你会发现它有三种入口："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:P,alt:""})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"main 是 commonjs 的入口，也就是 require('antd') 的时候会走这个。"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"module 是 esm 的入口，也就是 import xx from 'antd' 的时候会走这个。"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"unpkg 是 UMD 的入口，也就是通过 script 标签引入的时候或者 commonjs 的方式等都可以用。"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"分别对应了 lib、es、dist 的目录。"}),"\n",(0,s.jsx)(n.p,{children:"所以 antd 项目里的 dist 命令就是单独生成 UMD 代码的，而 build 命令是生成这三种代码。"}),"\n",(0,s.jsx)(n.p,{children:"这三种形式的代码都是可用的，这里我们选择构建 UMD 形式的代码，因为它会用 webpack 打包，而另外两种是通过 gulp 构建的。我对 webpack 更熟悉一些。"}),"\n",(0,s.jsx)(n.p,{children:"执行 npm run dist，就会构建出 dist 目录，下面是 UMD 的代码："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:v,alt:""})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:B,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"你会发现默认的构建就是会生成 sourcemap 的，其实你去那个 react 测试项目里看下，从 npm 下载的 antd 包也带了 sourcemap："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:w,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"那直接用 dist 入口的代码就能调试源码了么？"}),"\n",(0,s.jsx)(n.p,{children:"我们试一下："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:A,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"把引入组件的地方换成 dist 目录下，也就是用 UMD 形式的入口。"}),"\n",(0,s.jsx)(n.p,{children:"重新跑调试："}),"\n",(0,s.jsx)(n.p,{children:"你会发现代码确实比之前更像源码了。"}),"\n",(0,s.jsx)(n.p,{children:"之前前面是这样的："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:u,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"现在是这样："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:g,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"也就是没了 babel runtime 的代码，这明显是源码了。"}),"\n",(0,s.jsx)(n.p,{children:"但是你往后看："}),"\n",(0,s.jsx)(n.p,{children:"之前是这样的："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:m,alt:""})}),"\n",(0,s.jsxs)(n.p,{children:["现在是这样：\n",(0,s.jsx)("img",{src:f,alt:""})]}),"\n",(0,s.jsx)(n.p,{children:"依然还是 React.createElement，而不是 jsx，也没有 ts 的代码。"}),"\n",(0,s.jsx)(n.p,{children:"说明它还不是最初的源码。"}),"\n",(0,s.jsx)(n.p,{children:"为什么会出现这种既是源码又不是源码的情况呢？"}),"\n",(0,s.jsx)(n.p,{children:"因为它的编译流程是这样的："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:o,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"代码经过了 tsc 的编译，然后又经过了 babel 的编译，最后再通过 webpack 打包成 bundle.js。"}),"\n",(0,s.jsx)(n.p,{children:"tsc 和 babel 的编译都会生成 sourcemap，而 webpack 也会生成一个 sourcemap。"}),"\n",(0,s.jsx)(n.p,{children:"webpack 的 sourcemap 默认只会根据最后一个 loader 的 sourcemap 来生成。"}),"\n",(0,s.jsx)(n.p,{children:"所以说上面我们用了 sourcemap 之后只能关联到 babel 处理之前的代码，像 ts 语法、jsx 代码这些都没有了。"}),"\n",(0,s.jsx)(n.p,{children:"因为没有关联更上一级的 ts-loader 的 sourcemap，自然是没法直接映射回源码的。"}),"\n",(0,s.jsx)(n.p,{children:"所以想映射回最初的 tsx 源码，只要关联了每一级 loader 的 sourcemap 就可以了。而这个是可以配置的，就是 devtool。"}),"\n",(0,s.jsx)(n.p,{children:"devtool 可以设置 soruce-map，就是生成 sourcemap，但是这个不会关联 loader 的 sourcemap。"}),"\n",(0,s.jsx)(n.p,{children:"还可以设置 cheap-module-source-map，这个 module 就是关联 loader 的 soruce-map 的意思。（那个 cheap 是只保留行的 sourcemap，生成速度会更快）"}),"\n",(0,s.jsx)(n.p,{children:"思路理清楚了，我们去改下编译配置："}),"\n",(0,s.jsx)(n.p,{children:"antd 的编译工具链在 @ant-design/tools 这个包里，从 antd/node_modules/@antd-design/tools/lib/getWebpackConfig.js 就可以找到 webpack 的配置："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:b,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"搜一下 ts-loader，你就会看到这段配置："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:h,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"确实就像我们分析的，tsx 会经过 ts-loader 和 babel-loader 的处理。"}),"\n",(0,s.jsx)(n.p,{children:"搜一下 devtool，你会发现它的配置是 source-map："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:j,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"这就是 antd 虽然有 sourcemap，但是关联不到 tsx 源码的原因。"}),"\n",(0,s.jsx)(n.p,{children:"那我们给它改一下："}),"\n",(0,s.jsx)(n.p,{children:"把 devtool 改为 cheap-module-source-map。"}),"\n",(0,s.jsx)(n.p,{children:"并且改一下 babel 配置，设置 sourceMap 为 true，让它生成 sourcemap。"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:x,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"ts也同样要生成 sourcemap，不过那个是在根目录的 tsconfig.json里改："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:l,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"改完这三点之后，再重新跑 npm run dist。"}),"\n",(0,s.jsx)(n.p,{children:"dist 目录下会生成新的 antd.js 和 antd.js.map。"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:"data:image/webp;base64,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",alt:""})}),"\n",(0,s.jsx)(n.p,{children:"把它复制到 react 项目的 node_modules/antd/dist 下，覆盖之前的。"}),"\n",(0,s.jsx)(n.p,{children:"清一下 babel-loader 的缓存，删除整个 .cache 目录："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:t,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"重新跑 dev server。"}),"\n",(0,s.jsx)(n.p,{children:"注意，这里要用 dist 下的代码："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:p,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"然后再跑到断点的位置，进入组件源码，你会进入一个新世界："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:r,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"ts 类型、jsx 的语法，熟悉的感觉又回来了，这不就是 antd 组件的源码么！"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:a,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"你可以断点调试 antd 的参数是怎么处理的，什么参数会走什么逻辑等。"}),"\n",(0,s.jsx)(n.p,{children:"这个完全不影响正常开发，也就是把 antd 换成了从 antd/dist/antd 引入而已，开发完了换回去就行。"}),"\n",(0,s.jsx)(n.p,{children:"现在开发 antd 组件还有看文档么？"}),"\n",(0,s.jsx)(n.p,{children:"直接看源码它不更香么！"}),"\n",(0,s.jsx)(n.p,{children:"有的同学可能会担心 node_modules 下的改动保存不下来。"}),"\n",(0,s.jsx)(n.p,{children:"这个也不是问题，可以执行下 npx patch-package  antd，会生成这样一个 patch 文件:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:i,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"patch 文件里记录了你对 antd 包的改动，这个可以上传到 git 仓库，其他小伙伴拉下来再执行 npx patch-package 就会自动应用这些改动。"}),"\n",(0,s.jsx)(n.p,{children:"至此，我们成功的调试了 antd 组件的 tsx 源码。"}),"\n",(0,s.jsx)(n.p,{children:"为什么说 90% 的前端不会调试它的源码呢？"}),"\n",(0,s.jsx)(n.p,{children:"主要是涉及的技术比较多："}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"VSCode Chrome Debugger 调试网页，这个知道的人就不多"}),"\n",(0,s.jsx)(n.li,{children:"react 源码里 renderWithHooks 是调用函数组件的地方"}),"\n",(0,s.jsx)(n.li,{children:"条件断点可以在满足条件的时候断住"}),"\n",(0,s.jsx)(n.li,{children:"antd 的 esm、commonjs、UMD 三种入口"}),"\n",(0,s.jsx)(n.li,{children:"sourcemap 是干啥的，虽然经常接触，但还是有很多前端没用过"}),"\n",(0,s.jsx)(n.li,{children:"webpack 的 cheap-module-source-map 的含义，为什么需要关联 loader 的 sourcemap"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"而调试 antd 的组件源码需要综合运用这些技术，难度还是比较高的。"}),"\n",(0,s.jsx)(n.p,{children:"但这些都是我们前面学过的东西，在这里串起来了，把学过的东西串起来的时候是不是还挺爽的～"}),"\n",(0,s.jsx)(n.p,{children:"能综合运用所学技术来解决具体遇到的问题，这就是我们学习多种技术的目的。"}),"\n",(0,s.jsxs)(n.h2,{id:"总结",children:["总结",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#总结",children:"#"})]}),"\n",(0,s.jsx)(n.p,{children:"antd 是 react 主流组件库，我们经常使用它但可能并没有调试过它的源码。"}),"\n",(0,s.jsx)(n.p,{children:"我们可以在 renderWithHooks 里调用函数组件的地方打个条件断点，在调用想调试的组件时断住，这样我们就可以 step into 到该组件定义的地方。"}),"\n",(0,s.jsx)(n.p,{children:"但是这样调试的并不是最初的源码，没有 jsx 和 ts 语法。"}),"\n",(0,s.jsx)(n.p,{children:"想调试最初的 tsx 源码需要用 sourcemap。"}),"\n",(0,s.jsx)(n.p,{children:"antd 有三种入口：es 目录对应 esm 入口，lib 目录对应 commonjs 入口，dist 目录对应 UMD 入口。"}),"\n",(0,s.jsx)(n.p,{children:"把 antd 代码下载下来，执行 npm run dist 就可以生成 UMD 形式的代码。"}),"\n",(0,s.jsx)(n.p,{children:"想要 sourcemap 映射到 tsx 源码，需要把 devtool 设置成 cheap-module-source-map，然后开启 babel-loader 和 ts-loader 的 sourcemap。"}),"\n",(0,s.jsx)(n.p,{children:"把产物覆盖 antd 的 dist 下的产物，再调试就可以直接调试 antd 组件的 tsx 源码了。"}),"\n",(0,s.jsx)(n.p,{children:"用 antd 组件写业务逻辑之余，对什么组件感兴趣，可以顺便去看看它的源码，它不香么？"}),"\n",(0,s.jsx)(n.p,{children:"（这节我们用到了条件断点，上节学的各种断点在特定场景下都很有用，大家要能灵活运用）"})]})}function H(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,d.ah)(),e.components);return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(M,{...e})}):M(e)}let T=H;H.__RSPRESS_PAGE_META={},H.__RSPRESS_PAGE_META["%E5%89%8D%E7%AB%AF%E8%B0%83%E8%AF%95%E9%80%9A%E5%85%B3%E7%A7%98%E7%B1%8D%2F26.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B%EF%BC%9A%E8%B0%83%E8%AF%95%20Ant%20Design%20%E7%BB%84%E4%BB%B6%E6%BA%90%E7%A0%81.md"]={toc:[{text:"总结",id:"总结",depth:2}],title:"26.实战案例：调试 Ant Design 组件源码",headingTitle:"26.实战案例：调试 Ant Design 组件源码",frontmatter:{}}}}]);