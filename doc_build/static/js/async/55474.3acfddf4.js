"use strict";(self.webpackChunkjue_jin_book_press=self.webpackChunkjue_jin_book_press||[]).push([["55474"],{25132:function(e,n,s){s.r(n),s.d(n,{default:()=>X});var a=s(552676),c=s(740453);let i=s.p+"static/image/cc6d0a8e75b99f74f96db67092b23009.00072e46.webp",r=s.p+"static/image/50d19d47a7588406cf725633962fcfcc.7f7dac03.webp",p=s.p+"static/image/5800159a2b75a710bdf9f453af14f409.f79bf4fa.webp",l=s.p+"static/image/66da512cad3d9c520b090b750eb56274.b3e90328.webp",t=s.p+"static/image/e82165649bc0ce6b3b5a4dc12e87ff6e.dbe3a9ed.webp",d=s.p+"static/image/db8050d6e7d0d3aa95e06c4f89c88284.40864c77.webp",o=s.p+"static/image/1f7f48e8ca8aff43bb887b77dfcf73bc.94a1ba8c.webp",h=s.p+"static/image/92088b591ef9d5d7f7bd80e15c1b00a8.7c230f00.webp",f=s.p+"static/image/6592b90777072e26f628bd044d4d169d.8832c06e.webp",x=s.p+"static/image/b68e0127c44ad7dcd56c7842ed158c1a.735a14fb.webp",j=s.p+"static/image/ce769623aa00cee1622794ff1e31a5a2.0b5fa2d4.webp",m=s.p+"static/image/390eb93af94f75d5b2d574a5b89598a2.c61439b2.webp",g=s.p+"static/image/5b72a134f98a2ba5cc6d67197fa86b5a.5545b5a9.webp",b=s.p+"static/image/460c271d1372cbf9a59e7ca097c1ed89.84985542.webp",u=s.p+"static/image/db6e69aa340fc919852cf80a14da5760.a992621e.webp",A=s.p+"static/image/e23f8393f9fa40ec40481bdc5aa261a1.6c70e2ab.webp",P=s.p+"static/image/12444d8fa4d1e569dbd6127dc50548e1.6c82e546.webp",w=s.p+"static/image/a29fad5c972dbc0b7f559b91ac1c309a.296eecee.webp",E=s.p+"static/image/1f2ec7b75d487926c763146baf2f1419.407f20de.webp",k=s.p+"static/image/52da5332e2e2141893e5397ba04c2448.613ca998.webp",v=s.p+"static/image/6faef18e1661e820a3ef0dc808b09503.169695d2.webp",F=s.p+"static/image/3e14755965958bd2c52372bf338f24fc.93a3b7da.webp",N=s.p+"static/image/fa876ac3c58fb2d3fc87fff1eec86973.2a5592ca.webp",S=s.p+"static/image/16a643d643f470107389b049e9bd1cba.a8632edc.webp",G=s.p+"static/image/c93f30c011ad29ddc9581ee19d000db7.fdf5a0c0.webp",I=s.p+"static/image/7fd7721d699ea70266b9251662d513d5.a3ae3328.webp",R=s.p+"static/image/afe36db447580d9dada71c1cee977bd2.3baf59f9.webp",y=s.p+"static/image/c1ffe694531ed01ef9b6e61eeb3ea19f.739c1a1a.webp",O=s.p+"static/image/fd0c1dfd80ea19c0f76f04a6a03fb80f.58c2e12d.webp",W=s.p+"static/image/4c0540971d7eb287f5592500be550d4d.899cc10e.webp",L=s.p+"static/image/ed12083c87f8712d2f77e8c5befee8f6.c2e5ec1e.webp",U=s.p+"static/image/03425a262dfddc0c674f0740ed466828.ff16ff8f.webp",Q=s.p+"static/image/0749b8b6fd0c40be8ae8b814118b6f2c.646df35a.webp",q=s.p+"static/image/fdb0a73a2b820762940f287592a75215.a284448f.webp",Z=s.p+"static/image/5b1c6daf426fb5f0027ce8754eda97b6.2a322a03.webp",B=s.p+"static/image/81a61dc0571a0464fe606f36d5d767f6.489ab84f.webp",M=s.p+"static/image/7764ebd9cfceb78e4df61cfd2aa82f80.39a801b8.webp",K=s.p+"static/image/b03a28c5bd72308db74fe31cc5db6ab6.39a871ad.webp",Y=s.p+"static/image/6fd302e80b92f0700da56d2714fdc117.ced5457e.webp",H=s.p+"static/image/cf0f0b892c252722fae5915339f17156.b08b1313.webp",T=s.p+"static/image/09c77569b256dbef6ed792c16d16dbcd.2731b9f0.webp";function J(e){let n=Object.assign({h1:"h1",a:"a",p:"p",img:"img",pre:"pre",code:"code",h2:"h2"},(0,c.ah)(),e.components);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(n.h1,{id:"100-基于-sharp-实现-gif-压缩工具",children:["100. 基于 sharp 实现 gif 压缩工具",(0,a.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#100-基于-sharp-实现-gif-压缩工具",children:"#"})]}),"\n",(0,a.jsx)(n.p,{children:"不知道大家有没有场景会需要 GIF 压缩，我是经常会用到。"}),"\n",(0,a.jsx)(n.p,{children:"因为公众号的图片最大支持 10M，但是我录制出来的 GIF 经常超过 10M。"}),"\n",(0,a.jsx)(n.p,{children:"比如这样一个图片："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:T,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"在编辑器上传会提示超过 10 M 了："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:H,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"这时候就需要 GIF 压缩，不然文章发不了。"}),"\n",(0,a.jsx)(n.p,{children:"于是我在百度搜素 GIF 压缩，就找到了一个工具："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:Y,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"它确实能解决我的问题："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:K,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"但是要花钱："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:M,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"一年 148 呢，对一个小工具来说还是挺贵的。"}),"\n",(0,a.jsx)(n.p,{children:"但没办法，这对我是刚需，总不能不发文章了吧。"}),"\n",(0,a.jsx)(n.p,{children:"于是去年年底我就开了一年的会员："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:B,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"但最近发现有 npm 包可以做这个，没必要买这种网站的会员。。。"}),"\n",(0,a.jsx)(n.p,{children:"当时我的心情是这样的："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:"data:image/webp;base64,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",alt:""})}),"\n",(0,a.jsx)(n.p,{children:"这个 npm 包就是 sharp，它是用来处理各种图片的："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:Z,alt:""})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:q,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"它可以用来调整图片的大小，对图片做旋转、颜色调整、合成图片等。"}),"\n",(0,a.jsx)(n.p,{children:"这些功能我用不到，我就关心它的 gif 压缩功能。"}),"\n",(0,a.jsx)(n.p,{children:"看了下文档，大概这样用："}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"const sharp = require('sharp');\n\nsharp('1.image.gif', {\n    animated: true,\n    limitInputPixels: false\n}).gif({\n    colours: 10\n}).toFile('2.image.gif')\n"})}),"\n",(0,a.jsx)(n.p,{children:"我们先试试看："}),"\n",(0,a.jsx)(n.p,{children:"node 执行这个文件，可以看到产生了 2.image.gif，只有 2.7 M"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:Q,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"要知道之前的 1.image.gif 可是有 21M 啊："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:U,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"然后打开它看看："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:L,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"没啥问题。"}),"\n",(0,a.jsx)(n.p,{children:"回过头来，我们再来看看这段代码："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:W,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"animated 设为 true 是读取所有的帧，不然默认只会读取 gif 的第一帧。"}),"\n",(0,a.jsx)(n.p,{children:"limitInputPixels 设为 false 是不限制大小，默认太大的图片是会报错的。"}),"\n",(0,a.jsx)(n.p,{children:"然后是输出参数："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:O,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"colours 是颜色的数量，默认是 256。"}),"\n",(0,a.jsx)(n.p,{children:"一般色彩不丰富的图片，可以把 colours 设置的小一点。"}),"\n",(0,a.jsx)(n.p,{children:"当把 colours 设置为 2，图片就变成这样了："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:y,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"图片也更小了一些："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:R,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"具体怎么设置压缩级别和颜色数量，还是看需求。"}),"\n",(0,a.jsx)(n.p,{children:"总之，我们完全可以用 sharp 来自己做 gif 压缩，没必要买这种工具网站的会员。。。"}),"\n",(0,a.jsx)(n.p,{children:"不过体验上还是网页更好一点，我们也来写个这种网页："}),"\n",(0,a.jsx)(n.p,{children:"用 create-react-app 创建个项目："}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"npx create-react-app gif-compression-frontend\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:I,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"进入项目目录，安装 antd："}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"npm install --save antd\n"})}),"\n",(0,a.jsx)(n.p,{children:"修改下 App.js"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"import { DatePicker } from 'antd';\n\nfunction App() {\n  return (\n    <div>\n      <DatePicker/>\n    </div>\n  );\n}\n\nexport default App;\n"})}),"\n",(0,a.jsx)(n.p,{children:"然后把开发服务跑起来："}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"npm run start\n"})}),"\n",(0,a.jsx)(n.p,{children:"浏览器访问下："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:G,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"antd 引入成功了。"}),"\n",(0,a.jsx)(n.p,{children:"然后我们来写下上传文件的 UI："}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"import React from 'react';\nimport { InboxOutlined } from '@ant-design/icons';\nimport { message, Upload } from 'antd';\n\nconst { Dragger } = Upload;\n\nconst props = {\n  name: 'file',\n  action: 'http://localhost:3005',\n  onChange(info) {\n    const { status } = info.file;\n    if (status === 'done') {\n      message.success(`${info.file.name} 文件上传成功`);\n    } else if (status === 'error') {\n      message.error(`${info.file.name} 文件上传失败`);\n    }\n  }\n};\n\nconst App = () => (\n  <Dragger {...props}>\n    <p className=\"ant-upload-drag-icon\">\n      <InboxOutlined />\n    </p>\n    <p className=\"ant-upload-text\">点击或拖拽文件到这个区域来上传</p>\n  </Dragger>\n);\n\nexport default App;\n"})}),"\n",(0,a.jsx)(n.p,{children:"大概是这样的："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:S,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"antd 会 post 方式请求 action 对应的接口，带上上传的文件："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:N,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"我们再用 nest 写个后端服务接收下："}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"nest new gif-compression-backend\n"})}),"\n",(0,a.jsx)(n.p,{children:"创建个 nest 项目："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:F,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"修改 main.ts，启用跨域支持，并修改启动端口为 3005"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:v,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"把它跑起来："}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"npm run start:dev\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:k,alt:""})}),"\n",(0,a.jsxs)(n.p,{children:["浏览器访问 ",(0,a.jsx)(n.a,{href:"http://localhost:3005",target:"_blank",rel:"noopener noreferrer",children:"http://localhost:3005"})," 可以看到 hello world，说明 nest 服务跑成功了："]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:"data:image/webp;base64,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",alt:""})}),"\n",(0,a.jsx)(n.p,{children:"然后我们来添加下文章上传的接口："}),"\n",(0,a.jsx)(n.p,{children:"安装需要的 ts 类型的包："}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"npm install -D @types/multer\n"})}),"\n",(0,a.jsx)(n.p,{children:"在 AppController 里添加这样一个路由："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:E,alt:""})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"@Post('upload')\n@UseInterceptors(FileInterceptor('file', {\n  dest: 'uploads'\n}))\nuploadFile(@UploadedFile() file: Express.Multer.File) {\n  console.log('file', file);\n}\n"})}),"\n",(0,a.jsx)(n.p,{children:"这段代码是提取 file 参数的内容，保存到 dest 目录下，然后把文件对象传入该方法。"}),"\n",(0,a.jsx)(n.p,{children:"然后我们改下前端代码的上传接口："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:w,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"测试下上传："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:P,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"提示文件上传成功了，然后在服务端控制台也打印了文件信息，并且在 uploads 目录下可以看到这个文件："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:A,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"这些文件在浏览器打开，可以看到就是上传的 gif："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:u,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"然后我们把文件路径返回就好了："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:b,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"现在上传文件成功之后就可以拿到这个文件在服务端的路径了："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:g,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"然后我们再实现下压缩，在 AppController 增加一个接口："}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"@Get('compression')\ncompression(@Query('path') filePath: string, @Query('color', ParseIntPipe) color:number) {\n    console.log(filePath, color);\n\n    if(!existsSync(filePath)) {\n      throw new BadRequestException('文件不存在');\n    }\n    return 'success';\n}\n"})}),"\n",(0,a.jsx)(n.p,{children:"接收 path、color 的 query 参数，分别是文件路径、颜色数量的意思。"}),"\n",(0,a.jsx)(n.p,{children:"其中 color  要使用 ParseIntPipe 转成 int 类型。"}),"\n",(0,a.jsx)(n.p,{children:"测试下："}),"\n",(0,a.jsxs)(n.p,{children:["访问 ",(0,a.jsx)(n.a,{href:"http://localhost:3005/compression?path=uploads/xxx&color=10",target:"_blank",rel:"noopener noreferrer",children:"http://localhost:3005/compression?path=uploads/xxx&color=10"})]}),"\n",(0,a.jsx)(n.p,{children:"提示文件不存在："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:m,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"服务端接收到了传过来的参数："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:j,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"然后换一个真实存在的路径，返回 success："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:x,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"说明服务端找到了这个路径的文件："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:f,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"接下来安装 sharp 来实现压缩："}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"npm install --save sharp\n"})}),"\n",(0,a.jsx)(n.p,{children:"修改下 compression 方法："}),"\n",(0,a.jsx)(n.p,{children:"调用 sharp 来压缩 gif 图片，并注入 response 对象来返回文件下载响应："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:h,alt:""})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"@Get('compression')\nasync compression(\n    @Query('path') filePath: string,\n    @Query('color', ParseIntPipe) color:number,\n    @Res() res: Response\n) {\n\n    if(!existsSync(filePath)) {\n      throw new BadRequestException('文件不存在');\n    }\n\n    const data = await sharp(filePath, {\n        animated: true,\n        limitInputPixels: false\n    }).gif({\n        compressionLevel: level,\n        colours: color\n    }).toBuffer();\n\n    res.set('Content-Disposition', `attachment; filename=\"dest.gif\"`);\n\n    res.send(data);\n}\n"})}),"\n",(0,a.jsx)(n.p,{children:"测试下："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:o,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"访问这个接口，带上文件路径和压缩的参数，会返回压缩后的文件："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:d,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"然后我们在前端页面上加一个表单来填参数，然后访问这个接口压缩文件："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:t,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"代码如下："}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"import React, { useState } from 'react';\nimport { InboxOutlined } from '@ant-design/icons';\nimport { message, Upload, Form, Input, Button } from 'antd';\n\nconst { Dragger } = Upload;\n\nconst App = () => {\n  const [form] = Form.useForm();\n  const [filePath, setFilePath] = useState('');\n  const [fileName, setFileName] = useState('');\n\n  const compress = async (values) => {\n    console.log(values);\n    console.log(filePath);\n  };\n\n  const props = {\n    name: 'file',\n    action: 'http://localhost:3005/upload',\n    onChange(info) {\n      const { status } = info.file;\n      if (status === 'done') {\n        setFilePath(info.file.response);\n        setFileName(info.file.name);\n        message.success(`${info.file.name} 文件上传成功`);\n      } else if (status === 'error') {\n        message.error(`${info.file.name} 文件上传失败`);\n      }\n    }\n  };\n\n  return <div>\n    <Form style={{width: 500, margin: '50px auto'}}form={form} onFinish={compress}>\n      <Form.Item\n        label=\"颜色数量\"\n        name=\"color\"\n      >\n        <Input />\n      </Form.Item>\n\n      <Form.Item>\n        <Dragger {...props}>\n          <p className=\"ant-upload-drag-icon\">\n            <InboxOutlined />\n          </p>\n          <p className=\"ant-upload-text\">点击或拖拽文件到这个区域来上传</p>\n        </Dragger>\n      </Form.Item>\n\n      <Form.Item>\n        <Button type=\"primary\" htmlType=\"submit\">压缩</Button>\n      </Form.Item>\n    </Form>\n  </div>\n}\n\nexport default App;\n"})}),"\n",(0,a.jsx)(n.p,{children:"用 filePath 的 state 来保存上传后的文件路径，用 fileName 保存文件名。"}),"\n",(0,a.jsx)(n.p,{children:"在点击登录的时候打印下表单的值和 filePath。"}),"\n",(0,a.jsx)(n.p,{children:"我们试试看："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:l,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"3 个参数都拿到了，然后调用下压缩接口。"}),"\n",(0,a.jsx)(n.p,{children:"安装 axios："}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"npm install --save axios\n"})}),"\n",(0,a.jsx)(n.p,{children:"修改下 compress 方法："}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"const compress = async (values) => {\n    const res = await axios.get('http://localhost:3005/compression', {\n      params: {\n        color: values.color || 256,\n        level: values.level || 9,\n        path: filePath\n      },\n      responseType: 'arraybuffer'\n    });\n\n    const blob = new Blob([res.data], { type: 'image/jpeg' });\n    const url = URL.createObjectURL(blob);\n    const link = document.createElement('a'); \n    link.href = url; \n    link.download = fileName;\n    link.click(); \n\n    message.success('压缩成功');\n};\n"})}),"\n",(0,a.jsx)(n.p,{children:"访问 comporession 接口，传入参数，指定返回数据的类型为 arraybuffer。"}),"\n",(0,a.jsx)(n.p,{children:"然后用 URL.createObjectURL 创建 blob 的 url，设置为 a 标签的 src，指定 download 属性的值也就是文件名，然后触发点击。"}),"\n",(0,a.jsx)(n.p,{children:"这样，就能把返回的 arraybuffer 作为文件下载了。"}),"\n",(0,a.jsx)(n.p,{children:"我们试试看："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:p,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"整个流程都跑通了！"}),"\n",(0,a.jsx)(n.p,{children:"我们试下刚开始那个 21M 的文件，压缩之后下载的是 2.7M。"}),"\n",(0,a.jsx)(n.p,{children:"和用这个网站压缩的差不多："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:r,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"更重要的是不用每年 138 的会员费。"}),"\n",(0,a.jsx)(n.p,{children:"案例代码在小册仓库："}),"\n",(0,a.jsxs)(n.p,{children:["前端代码：",(0,a.jsx)(n.a,{href:"https://github.com/QuarkGluonPlasma/nestjs-course-code/tree/main/gif-compression-frontend",target:"_blank",rel:"noopener noreferrer",children:"https://github.com/QuarkGluonPlasma/nestjs-course-code/tree/main/gif-compression-frontend"})]}),"\n",(0,a.jsxs)(n.p,{children:["后端代码：",(0,a.jsx)(n.a,{href:"https://github.com/QuarkGluonPlasma/nestjs-course-code/tree/main/gif-compression-backend",target:"_blank",rel:"noopener noreferrer",children:"https://github.com/QuarkGluonPlasma/nestjs-course-code/tree/main/gif-compression-backend"})]}),"\n",(0,a.jsxs)(n.h2,{id:"总结",children:["总结",(0,a.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#总结",children:"#"})]}),"\n",(0,a.jsx)(n.p,{children:"压缩 gif 图片是我的刚需，之前都是买某网站的 138 的年度会员，直到我发现了 sharp 这个包。"}),"\n",(0,a.jsx)(n.p,{children:"它是用来处理各种图片的，调整大小、旋转等等，我们只用它的 gif 压缩的功能。"}),"\n",(0,a.jsx)(n.p,{children:"然后我们也做了一个网站，前端 react + antd，后端 nest + sharp。"}),"\n",(0,a.jsx)(n.p,{children:"后端提供一个 /upload 接口用于上传文件，返回文件路径。"}),"\n",(0,a.jsx)(n.p,{children:"又提供了一个 /compression 接口用来压缩 gif，返回压缩后的文件。"}),"\n",(0,a.jsx)(n.p,{children:"整个流程如下："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:i,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"其实最好再做一步: 把这个应用通过 dockerfile 来 build 成 docker 镜像，随时用，随时跑。"}),"\n",(0,a.jsx)(n.p,{children:"再需要压缩图片的时候，不用花钱买会员了，直接用自己的压缩工具就好了。"})]})}function D(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,c.ah)(),e.components);return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(J,{...e})}):J(e)}let X=D;D.__RSPRESS_PAGE_META={},D.__RSPRESS_PAGE_META["Nest%20%E9%80%9A%E5%85%B3%E7%A7%98%E7%B1%8D%20%20%E6%9C%80%E6%96%B0200%E7%AB%A0%2F100.%20%E5%9F%BA%E4%BA%8E%20sharp%20%E5%AE%9E%E7%8E%B0%20gif%20%E5%8E%8B%E7%BC%A9%E5%B7%A5%E5%85%B7.md"]={toc:[{text:"总结",id:"总结",depth:2}],title:"100. 基于 sharp 实现 gif 压缩工具",headingTitle:"100. 基于 sharp 实现 gif 压缩工具",frontmatter:{}}}}]);