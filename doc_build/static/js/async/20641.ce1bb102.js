"use strict";(self.webpackChunkjue_jin_book_press=self.webpackChunkjue_jin_book_press||[]).push([["20641"],{164083:function(e,n,r){r.r(n),r.d(n,{default:()=>h});var i=r(552676),s=r(740453);let c=r.p+"static/image/9c37bebd5278918867ed04b46479a132.843ffe72.webp",l=r.p+"static/image/130cf7818a7a12676dc5a717fb0cbb41.bfeb67e7.webp";function d(e){let n=Object.assign({h1:"h1",a:"a",p:"p",ul:"ul",li:"li",code:"code",pre:"pre",h2:"h2",img:"img"},(0,s.ah)(),e.components);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.h1,{id:"29-福利2坑点槽点",children:["29 福利2：坑点，槽点",(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#29-福利2坑点槽点",children:"#"})]}),"\n",(0,i.jsx)(n.p,{children:"这章主要介绍下我在做 Uniapp 开发时的一些各端的坑及解决方案。"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"在小程序中的原生组件，如果在他的上部有元素，元素的层级会失效"}),"\n",(0,i.jsxs)(n.li,{children:["阻止事件冒泡时要在外层加一层标签 ",(0,i.jsx)(n.code,{children:'<view @tap.stop="stop"></view>'}),"，直接加 ",(0,i.jsx)(n.code,{children:".stop"})," 方法无效"]}),"\n",(0,i.jsxs)(n.li,{children:["不要用",(0,i.jsx)(n.code,{children:"v-show"}),"，可以用 ",(0,i.jsx)(n.code,{children:"v-if"})," 或者通过class绑定来解决"]}),"\n",(0,i.jsxs)(n.li,{children:["弹出层的遮罩要阻止页面滚动，可以在遮罩的 touchmove 事件中加上 ",(0,i.jsx)(n.code,{children:'@touchmove.prevent=""'})," 默认事件"]}),"\n",(0,i.jsx)(n.li,{children:"swiper有默认高度，不写高度会无法渲染，需要动态计算图片宽高以覆盖"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-html",children:'    <swiper :style="{height: `${imageHeight}px`}">\n        ...\n    </swiper>\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["swiper动态加载数据，先前是多数组，加载后只有一组数据时，图片会显示空白，原因是之前切换了",(0,i.jsx)(n.code,{children:"current"}),"，加载后数据对不上，尝试把",(0,i.jsx)(n.code,{children:"current"}),"设置为",(0,i.jsx)(n.code,{children:"0"})]}),"\n",(0,i.jsxs)(n.li,{children:["图片，接口等地址（业务域名和服务器域名）必须是",(0,i.jsx)(n.code,{children:"https"}),"，在真机会无法显示或报错，但模拟器调试不影响"]}),"\n",(0,i.jsx)(n.li,{children:"主页面的生命周期用 onLoad 代替 created，onReady 代替 mounted，组件内使用原来的created 与 mounted"}),"\n",(0,i.jsxs)(n.li,{children:["webview 组件地址参数如果有中文，会报错，调试也很难发现，在构建地址前先用 ",(0,i.jsx)(n.code,{children:"encodeURIComponent"})," 转义"]}),"\n",(0,i.jsxs)(n.li,{children:["图片加载过程中会先变形，瞬间又恢复正常，可以用 ",(0,i.jsx)(n.code,{children:"height：auto"})," 解决"]}),"\n",(0,i.jsxs)(n.li,{children:["image标签之间存在小细缝，可以设置",(0,i.jsx)(n.code,{children:"display:block"}),"和",(0,i.jsx)(n.code,{children:"font-size:0"})]}),"\n",(0,i.jsxs)(n.li,{children:["做吸顶效果时，安卓大多数机型还是不支持 ",(0,i.jsx)(n.code,{children:"position: sticky"})]}),"\n",(0,i.jsxs)(n.li,{children:["微信用户头像域名有",(0,i.jsx)(n.code,{children:"wx.glogo.cn"}),"，也有",(0,i.jsx)(n.code,{children:"thirdwx.qlogo.cn"})]}),"\n",(0,i.jsxs)(n.li,{children:["菊花码扫码地址只支持32位长度，并且返回的数据存在",(0,i.jsx)(n.code,{children:"options.scene"}),"里"]}),"\n",(0,i.jsxs)(n.li,{children:["微信小程序组件的",(0,i.jsx)(n.code,{children:"getRelationNodes"}),"和头条小程序的返回值写法不统一，而且头条小程序子组件里不能用",(0,i.jsx)(n.code,{children:"key"}),"这个关键字，导致在父组件获取子组件值一直为空，可以尝试变成",(0,i.jsx)(n.code,{children:"keys"})]}),"\n",(0,i.jsx)(n.li,{children:"抖音里的小程序原生下拉刷新无效，今日头条里正常 (2020-11-25)"}),"\n",(0,i.jsxs)(n.li,{children:["抖音里的小程序",(0,i.jsx)(n.code,{children:"<block tt:for={{list}}>"}),"无效，乖乖的用",(0,i.jsx)(n.code,{children:"<view>"}),"吧"]}),"\n"]}),"\n",(0,i.jsxs)(n.h2,{id:"小程序最新订阅消息",children:["小程序最新订阅消息",(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#小程序最新订阅消息",children:"#"})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/subscribe-message.html",target:"_blank",rel:"noopener noreferrer",children:"官方文档"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"调试只能在真机中，本地开发者工具的wx原型链是没有 requestSubscribeMessage 方法的会报错"}),"\n",(0,i.jsx)(n.li,{children:"只能是用户点击触发"}),"\n",(0,i.jsxs)(n.li,{children:["有微信版本限制，",(0,i.jsx)(n.a,{href:"https://developers.weixin.qq.com/miniprogram/dev/api/open-api/subscribe-message/wx.requestSubscribeMessage.html",target:"_blank",rel:"noopener noreferrer",children:"requestSubscribeMessage方法详解"})]}),"\n"]}),"\n",(0,i.jsxs)(n.h2,{id:"小程序自定义预处理命令",children:["小程序自定义预处理命令",(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#小程序自定义预处理命令",children:"#"})]}),"\n",(0,i.jsxs)(n.p,{children:["这里有必要说下， ",(0,i.jsx)(n.a,{href:"https://developers.weixin.qq.com/miniprogram/dev/devtools/debug.html#%E8%87%AA%E5%AE%9A%E4%B9%89%E9%A2%84%E5%A4%84%E7%90%86",target:"_blank",rel:"noopener noreferrer",children:"自定义预处理命令"}),"，官方文档写得确实不敢恭维，文档像是一笔带过，全靠悟，难道是觉得可有可无，没人用的意思？！要知道没点经验的同学，那是完全不知如何使用。"]}),"\n",(0,i.jsxs)(n.p,{children:["微信开发者工具，右上角有个详情 => 本地设置 => 启用自定义处理命令，命令支持 ",(0,i.jsx)(n.code,{children:"node"}),"，",(0,i.jsx)(n.code,{children:"bash"}),"语法。"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)("img",{src:l,alt:""})}),"\n",(0,i.jsx)(n.p,{children:"来个栗子：自动切换本地开发环境，我使用 nodejs 编写命令"}),"\n",(0,i.jsxs)(n.p,{children:["开发环境配置文件",(0,i.jsx)(n.code,{children:"./config/config.js"})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)("img",{src:c,alt:""})}),"\n",(0,i.jsxs)(n.p,{children:["为防止上传代码时，团队成员忘了切回正式环境，强制做",(0,i.jsx)(n.code,{children:"上传前预处理"}),"，把本地",(0,i.jsx)(n.code,{children:"ENV = dev"}),"，切回 ",(0,i.jsx)(n.code,{children:"ENV = prod"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"const FS = require('fs')\n//读取文件，并且替换文件中指定的字符串\nlet replaceFile = function(filePath, sourceRegx, targetStr) {\n    FS.readFile(filePath, function(err, data) {\n        if (err) {\n            return err\n        }\n        let str = data.toString()\n        str = str.replace(sourceRegx, targetStr)\n        FS.writeFile(filePath, str, function(err) {\n            if (err) return err\n        })\n    })\n}\nFS.readdir('./config', function(err, files) {\n    if (err) {\n        return err\n    }\n    if (files.length != 0) {\n        files.forEach((item) => {\n            let path = './config/' + item\n            //判断文件的状态，用于区分文件名/文件夹\n            FS.stat(path, function(err, status) {\n                if (err) {\n                    return err\n                }\n                let isFile = status.isFile() //是文件\n                let isDir = status.isDirectory() //是文件夹\n                if (isFile) {\n                    replaceFile(path, /const ENV = \\\"dev\\\"/g, 'const ENV = \\\"prod\\\"')\n                }\n                if (isDir) {\n                    console.log(\"文件夹：\" + item)\n                }\n            })\n        })\n    }\n})\n"})}),"\n",(0,i.jsxs)(n.h2,{id:"小结",children:["小结",(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#小结",children:"#"})]}),"\n",(0,i.jsx)(n.p,{children:"本章是我在开发中碰到的坑点，不能一一列举全，如你有发现新坑新槽，也欢迎留言告知我。"})]})}function t(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,s.ah)(),e.components);return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}let h=t;t.__RSPRESS_PAGE_META={},t.__RSPRESS_PAGE_META["Uniapp%20%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E8%BF%9B%E9%98%B6%2F29%20%E7%A6%8F%E5%88%A92%EF%BC%9A%E5%9D%91%E7%82%B9%EF%BC%8C%E6%A7%BD%E7%82%B9.md"]={toc:[{text:"小程序最新订阅消息",id:"小程序最新订阅消息",depth:2},{text:"小程序自定义预处理命令",id:"小程序自定义预处理命令",depth:2},{text:"小结",id:"小结",depth:2}],title:"29 福利2：坑点，槽点",headingTitle:"29 福利2：坑点，槽点",frontmatter:{}}}}]);