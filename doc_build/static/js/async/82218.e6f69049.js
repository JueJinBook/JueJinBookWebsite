"use strict";(self.webpackChunkjue_jin_book_press=self.webpackChunkjue_jin_book_press||[]).push([["82218"],{831987:function(e,n,i){e.exports=i.p+"static/image/11f02b45b07c2b0bf8061f613dfdca54.0a762dfc.webp"},597036:function(e,n,i){e.exports=i.p+"static/image/2412ad1c05bf31e48f1dee164e42eb6d.1aa8b226.webp"},26678:function(e,n,i){e.exports=i.p+"static/image/2e246653481c02c5b8b125fe087826e4.2175e9a2.webp"},38205:function(e,n,i){e.exports=i.p+"static/image/2f8016986692a09c9764afdf31628f6e.b4506f44.webp"},446621:function(e,n,i){e.exports=i.p+"static/image/4bac5722c2cd684849b2ece8119bc35f.c3271b76.webp"},128796:function(e,n,i){e.exports=i.p+"static/image/ad040184a19163f6bc0913081f5bf5cf.b53dde76.webp"},574512:function(e,n,i){e.exports=i.p+"static/image/c9a9fcafeffa29b7d566c648aae1b26b.a4df74fa.webp"},994421:function(e,n,i){e.exports=i.p+"static/image/d9ac238557a93e935bee7438a7918dd2.e22328df.webp"},671780:function(e,n,i){e.exports=i.p+"static/image/f1c869791994bfd6e4e046e3023ade6c.1246d0f2.webp"},528221:function(e,n,i){i.r(n),i.d(n,{default:()=>b});var c=i(552676),r=i(740453),s=i(128796),d=i(446621),a=i(26678),p=i(38205),t=i(831987),l=i(994421),h=i(574512),o=i(671780),x=i(597036);function j(e){let n=Object.assign({h1:"h1",a:"a",p:"p",img:"img",pre:"pre",code:"code",h2:"h2"},(0,r.ah)(),e.components);return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)(n.h1,{id:"37远程调试移动端网页的原理",children:["37.远程调试移动端网页的原理",(0,c.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#37远程调试移动端网页的原理",children:"#"})]}),"\n",(0,c.jsx)(n.p,{children:"前两节我们学习了用 chrome 远程调试安卓移动端网页，用 safari 远程调试 ios 移动端网页："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:x,alt:""})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:o,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"那他们是怎么实现呢？"}),"\n",(0,c.jsx)(n.p,{children:"首先，我们知道调试是 client server 的架构，比如 chrome 会使用 CDP 协议来传输数据。"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:h,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"传递的 CDP 数据可以通过 Protocol monitor 看到："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:l,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"pc 端是这样，移动端也是这样，只不过传递协议数据的方式不大一样。"}),"\n",(0,c.jsx)(n.p,{children:"要想起一个有 CDP server 的浏览器，需要单独指定一些参数。"}),"\n",(0,c.jsx)(n.p,{children:"pc 端是跑 chrome 的时候带上 remote-debugging-port 参数，类似这样："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"/Applications/Google\\ Chrome.app/Contents/MacOS/Google\\ Chrome --remote-debugging-port=9222\n"})}),"\n",(0,c.jsx)(n.p,{children:"然后就可以连上这个端口进行调试了，不管你是用 chrome devtools 还是 vscode debugger 或者其余的 frontend UI。"}),"\n",(0,c.jsx)(n.p,{children:"那移动端呢？"}),"\n",(0,c.jsx)(n.p,{children:"自然也是一样的，要开启调试模式才有这个 CDP Server 可以连接。"}),"\n",(0,c.jsx)(n.p,{children:"andorid 的 app 里面的 weview 需要类似这样的方式开启调试："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:"// Android 4.4 以上 WebView 才真正使用 Blink 内核，所以需要在此版本及以上系统。\nif (Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT) {\n    WebView.setWebContentsDebuggingEnabled(true);\n}\n"})}),"\n",(0,c.jsx)(n.p,{children:"所以你想调试 app 里网页的话，让移动端开发给你一个调试包即可。"}),"\n",(0,c.jsx)(n.p,{children:"有了 CDP Server 的标志就是你访问 9229 端口的 /json 是可以看到所有页面的 websocket 地址的："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:t,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"每个页面就可以连接对应的 ws 服务端来进行 CDP 协议数据的交换，实现调试。"}),"\n",(0,c.jsx)(n.p,{children:"那问题来了，pc 端怎么访问移动端的页面呢？"}),"\n",(0,c.jsx)(n.p,{children:"有两种方式，第一种是通过 USB，连上 USB 之后就可以使用 android 的 adb 工具来转发端口："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"adb forward tcp:9229\n"})}),"\n",(0,c.jsx)(n.p,{children:"之后就可以进行通信，自然也就可以调试了。"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:p,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"ios 下也有类似的工具。"}),"\n",(0,c.jsx)(n.p,{children:"当然，也可以通过 wifi 的方式，只不过这种就需要单独起一个 ws 服务做转发了。"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:a,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"这个 ws 服务做的事情比较简单，就是原封不动转发了下 CDP 数据。"}),"\n",(0,c.jsx)(n.p,{children:"这样就能实现 wifi 调试，扫码调试等功能。"}),"\n",(0,c.jsx)(n.p,{children:"这就是远程调试移动端网页的原理。"}),"\n",(0,c.jsx)(n.p,{children:"最后，android 这个实时看到移动端网页的界面是怎么实现的呢？"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:d,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"其实就是一帧帧截图实现的。"}),"\n",(0,c.jsx)(n.p,{children:"CDP 协议里有这样一个传输 base64 的截图数据的事件："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:s,alt:""})}),"\n",(0,c.jsxs)(n.h2,{id:"总结",children:["总结",(0,c.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#总结",children:"#"})]}),"\n",(0,c.jsx)(n.p,{children:"我们可以通过 chrome、safari 调试移动端的网页，原理就是开启调试模式之后，可以通过 CDP server 和 client 进行通信，从而实现调试。"}),"\n",(0,c.jsx)(n.p,{children:"pc 端开启调试只要指定 remote-debugging-port 的启动参数即可，而移动端则需要指定 webview 的参数。"}),"\n",(0,c.jsx)(n.p,{children:"可以通过 USB 调试，是因为 adb 做了端口转发，也可以通过 wifi 调试，这种就需要自己实现一个 ws 服务做中转了。"}),"\n",(0,c.jsx)(n.p,{children:"理解了远程调试的原理，当你再用各种移动端网页调试工具、小程序调试工具、跨端调试工具等，心里就有底了。"})]})}function f(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,r.ah)(),e.components);return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(j,{...e})}):j(e)}let b=f;f.__RSPRESS_PAGE_META={},f.__RSPRESS_PAGE_META["%E5%89%8D%E7%AB%AF%E8%B0%83%E8%AF%95%E9%80%9A%E5%85%B3%E7%A7%98%E7%B1%8D%2F37.%E8%BF%9C%E7%A8%8B%E8%B0%83%E8%AF%95%E7%A7%BB%E5%8A%A8%E7%AB%AF%E7%BD%91%E9%A1%B5%E7%9A%84%E5%8E%9F%E7%90%86.md"]={toc:[{text:"总结",id:"总结",depth:2}],title:"37.远程调试移动端网页的原理",headingTitle:"37.远程调试移动端网页的原理",frontmatter:{}}}}]);