"use strict";(self.webpackChunkjue_jin_book_press=self.webpackChunkjue_jin_book_press||[]).push([["37389"],{926308:function(e,n,r){e.exports=r.p+"static/image/2838042fbcdaa8ed79443d2fe33853b4.f43013b2.webp"},632738:function(e,n,r){e.exports=r.p+"static/image/4123d9612454c7e1bfedaf27d25530be.d623a86d.webp"},528670:function(e,n,r){r.r(n),r.d(n,{default:()=>P});var i=r(552676),s=r(740453);let t=r.p+"static/image/fa9cd71df8a3f32d2c4521902c710931.f2d3f2f7.webp",c=r.p+"static/image/2dbadf01761aafc8251c89ee1b056589.59d3fadb.webp",a=r.p+"static/image/23d89eae59150ab41dbbf16d6c79466b.d7822122.webp",d=r.p+"static/image/bb508da1a8da6b4f60a8b23a0b33e9b3.90b1483d.webp",p=r.p+"static/image/9f444b9895eefe48f77423cd6ccc5094.38ea1935.webp",l=r.p+"static/image/1a38c0051688914d16f8abbae105a602.4f19c94d.webp",m=r.p+"static/image/a1dc6baf4086db9bc09a29a84addcbd3.d3a62fb8.webp",o=r.p+"static/image/b4c28c27934859daa39d814f2bdba01f.f4dc17fd.webp",h=r.p+"static/image/88c2abf95e432b04a0c39dcd54338d5c.6a8d91bf.webp",j=r.p+"static/image/37b6e16af9ef4efd8a6637d4265f4645.8a12c12f.webp",x=r.p+"static/image/7e80871801ceb300c4e50962d350107d.93b836ec.webp",g=r.p+"static/image/689d8a5be89e69fe5d90373f092be9c5.7d99f988.webp";var b=r(632738);let f=r.p+"static/image/09056d4e73dac1bca64e91d1be021f60.ee92176b.webp",A=r.p+"static/image/6451b3332636ddf9d5f6e1c6e3e59198.096fe691.webp";var u=r(926308);let v=r.p+"static/image/7d9e55bb907a343d4f7edeec1afebe8e.018c069e.webp";function w(e){let n=Object.assign({h1:"h1",a:"a",p:"p",pre:"pre",code:"code",img:"img",h2:"h2"},(0,s.ah)(),e.components);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.h1,{id:"151-在-nest-里集成-prisma",children:["151. 在 Nest 里集成 Prisma",(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#151-在-nest-里集成-prisma",children:"#"})]}),"\n",(0,i.jsx)(n.p,{children:"我们学 Prisma，最终还是要和 Nest 结合用的，就像我们学 TypeORM 时那样。"}),"\n",(0,i.jsx)(n.p,{children:"其实也很简单，还是基于 schema 生成 client 的 api，然后调用这些 api 来 CRUD。"}),"\n",(0,i.jsx)(n.p,{children:"只不过 Nest 里的调用方式不大一样。"}),"\n",(0,i.jsx)(n.p,{children:"我们新建个 nest 项目："}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"nest new nest-prisma-test\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)("img",{src:v,alt:""})}),"\n",(0,i.jsx)(n.p,{children:"进入项目，安装 prisma"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"npm install prisma --save-dev\n"})}),"\n",(0,i.jsx)(n.p,{children:"然后执行 init 创建 schema 文件："}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"npx prisma init\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)("img",{src:u,alt:""})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)("img",{src:A,alt:""})}),"\n",(0,i.jsx)(n.p,{children:"改下 .env 的配置："}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'DATABASE_URL="mysql://root:guang@localhost:3306/prisma_test"\n'})}),"\n",(0,i.jsx)(n.p,{children:"并且修改下 schema 里的 datasource 部分："}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'datasource db {\n  provider = "mysql"\n  url      = env("DATABASE_URL")\n}\n\n'})}),"\n",(0,i.jsx)(n.p,{children:"然后创建 model："}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)("img",{src:f,alt:""})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'generator client {\n  provider = "prisma-client-js"\n}\n\ndatasource db {\n  provider = "mysql"\n  url      = env("DATABASE_URL")\n}\n\nmodel Department {\n  id        Int    @id @default(autoincrement())\n  name      String  @db.VarChar(20)\n  createTime DateTime @default(now())\n  updateTime DateTime @updatedAt\n  employees     Employee[]\n}\n\nmodel Employee {\n  id         Int       @id @default(autoincrement())\n  name      String     @db.VarChar(20)\n  phone     String     @db.VarChar(30)  \n\n  deaprtmentId Int\n  department     Department      @relation(fields: [deaprtmentId], references: [id])\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"这里就是 Department、Employee 两个 model，之间是一对多的关系。"}),"\n",(0,i.jsx)(n.p,{children:"然后先 migrate reset，重置下数据库："}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"npx prisma migrate reset \n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)("img",{src:b,alt:""})}),"\n",(0,i.jsx)(n.p,{children:"然后创建新的 migration:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"npx prisma migrate dev --name init\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)("img",{src:g,alt:""})}),"\n",(0,i.jsx)(n.p,{children:"这时候数据库就就有这两个表了："}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)("img",{src:x,alt:""})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)("img",{src:j,alt:""})}),"\n",(0,i.jsx)(n.p,{children:"外键约束也创建好了："}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)("img",{src:h,alt:""})}),"\n",(0,i.jsx)(n.p,{children:"并且 migrate dev 还会生成 client 代码，接下来我们就可以直接来做 CRUD 了。"}),"\n",(0,i.jsx)(n.p,{children:"问题来了：之前我们都是直接 ts-node 跑的一个脚本，里面调用 client 的 api 来做 CRUD，现在和 Nest 集成后怎么做呢？"}),"\n",(0,i.jsx)(n.p,{children:"很简单，创建个 Service 就好了。"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"nest g service prisma --flat --no-spec\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)("img",{src:o,alt:""})}),"\n",(0,i.jsx)(n.p,{children:"改下 PrismaService，继承 PrismaClient，这样它就有 crud 的 api 了："}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"import { Injectable, OnModuleInit } from '@nestjs/common';\nimport { PrismaClient } from '@prisma/client';\n\n@Injectable()\nexport class PrismaService extends PrismaClient implements OnModuleInit {\n\n    constructor() {\n        super({\n            log: [\n                {\n                    emit: 'stdout',\n                    level: 'query'\n                }\n            ]\n        })\n    }\n\n    async onModuleInit() {\n        await this.$connect();\n    }\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"在 constructor 里设置 PrismaClient 的 log 参数，也就是打印 sql 到控制台。"}),"\n",(0,i.jsx)(n.p,{children:"在 onModuleInit 的生命周期方法里调用 $connect 来连接数据库。"}),"\n",(0,i.jsx)(n.p,{children:"然后再创建两个 service："}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"nest g service department --flat --no-spec\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)("img",{src:m,alt:""})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"nest g service employee --flat --no-spec\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)("img",{src:l,alt:""})}),"\n",(0,i.jsx)(n.p,{children:"这俩 service 里注入 PrismaService，不就可以 CRUD 了么？"}),"\n",(0,i.jsx)(n.p,{children:"改下 DepartmentService："}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"import { Inject, Injectable } from '@nestjs/common';\nimport { PrismaService } from './prisma.service';\nimport { Prisma } from '@prisma/client';\n\n@Injectable()\nexport class DepartmentService {\n\n    @Inject(PrismaService)\n    private prisma: PrismaService;\n\n    async create(data: Prisma.DepartmentCreateInput) {\n        return await this.prisma.department.create({\n            data,\n            select: {\n                id: true\n            }\n        });\n    }\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"插入数据之后，再把 id 查询出来返回。"}),"\n",(0,i.jsx)(n.p,{children:"这里的 data 的 ts 类型不用自己定义，生成的 client 代码里有。"}),"\n",(0,i.jsx)(n.p,{children:"输入 Prisma.Deparment 就会提示出来"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)("img",{src:p,alt:""})}),"\n",(0,i.jsx)(n.p,{children:"还有 EmployeeService："}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"import { Inject, Injectable } from '@nestjs/common';\nimport { PrismaService } from './prisma.service';\nimport { Prisma } from '@prisma/client';\n\n@Injectable()\nexport class EmployeeService {\n\n    @Inject(PrismaService)\n    private prisma: PrismaService;\n\n    async create(data: Prisma.EmployeeCreateInput) {\n        return await this.prisma.employee.create({\n            data,\n            select: {\n                id: true\n            }\n        });\n    }\n}\n\n"})}),"\n",(0,i.jsx)(n.p,{children:"也定义了 create 方法。"}),"\n",(0,i.jsx)(n.p,{children:"然后在 AppController 里注入这俩 service："}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)("img",{src:d,alt:""})}),"\n",(0,i.jsx)(n.p,{children:"声明一个 create 的路由，里面创建一个 department，再创建一个 employee。"}),"\n",(0,i.jsx)(n.p,{children:"empolyee 通过 id 关联这个 department。"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"import { Controller, Get, Inject } from '@nestjs/common';\nimport { AppService } from './app.service';\nimport { DepartmentService } from './department.service';\nimport { EmployeeService } from './employee.service';\n\n@Controller()\nexport class AppController {\n  constructor(private readonly appService: AppService) {}\n\n  @Get()\n  getHello(): string {\n    return this.appService.getHello();\n  }\n\n  @Inject(DepartmentService)\n  private departmentService: DepartmentService;\n\n  @Inject(EmployeeService)\n  private employeeService: EmployeeService;\n\n  @Get('create')\n  async create() {\n    const department = await this.departmentService.create({\n      name: '技术部'\n    });\n\n    await this.employeeService.create({\n      name: '张三',\n      phone: '13222222222',\n      department: {\n        connect: {\n          id: department.id\n        }\n      }\n    });\n\n    return 'done';\n  }\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"把 nest 项目跑起来："}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"npm run start:dev\n"})}),"\n",(0,i.jsxs)(n.p,{children:["浏览器访问下 ",(0,i.jsx)(n.a,{href:"http://localhost:3000/create",target:"_blank",rel:"noopener noreferrer",children:"http://localhost:3000/create"})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)("img",{src:"data:image/webp;base64,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",alt:""})}),"\n",(0,i.jsx)(n.p,{children:"生成了 2 条 insert 语句："}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)("img",{src:a,alt:""})}),"\n",(0,i.jsx)(n.p,{children:"在 mysql workbench 里也可以看到插入的 2 条记录："}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)("img",{src:c,alt:""})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)("img",{src:t,alt:""})}),"\n",(0,i.jsx)(n.p,{children:"这样，prisma 和 nest 的集成就完成了。"}),"\n",(0,i.jsx)(n.p,{children:"当然，我们只是测试了 create 方法，其余的 api 也是一样的，就不展开了。"}),"\n",(0,i.jsxs)(n.p,{children:["案例代码在",(0,i.jsx)(n.a,{href:"https://github.com/QuarkGluonPlasma/nestjs-course-code/tree/main/nest-prisma-test",target:"_blank",rel:"noopener noreferrer",children:"小册仓库"})]}),"\n",(0,i.jsxs)(n.h2,{id:"总结",children:["总结",(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#总结",children:"#"})]}),"\n",(0,i.jsx)(n.p,{children:"这节我们做了 Prisma 和 Nest 的集成。"}),"\n",(0,i.jsx)(n.p,{children:"其实还是先用 prisma init 创建 schema 文件，然后修改 model 后用 prisma migrate dev 同步到数据库和生成 client 代码。"}),"\n",(0,i.jsx)(n.p,{children:"只不过之后使用 client 代码的方式不同。"}),"\n",(0,i.jsx)(n.p,{children:"我们创建了个 Service 继承 PrismaClient，在 constructor 里设置初始化参数。"}),"\n",(0,i.jsx)(n.p,{children:"之后把这个 service 的实例注入到别的 service 里，就可以做 CRUD 了。"}),"\n",(0,i.jsx)(n.p,{children:"这样，Prisma 怎么和 Nest 集成，我们就学会了。"})]})}function S(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,s.ah)(),e.components);return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(w,{...e})}):w(e)}let P=S;S.__RSPRESS_PAGE_META={},S.__RSPRESS_PAGE_META["Nest%20%E9%80%9A%E5%85%B3%E7%A7%98%E7%B1%8D%20%20%E6%9C%80%E6%96%B0200%E7%AB%A0%2F151.%20%E5%9C%A8%20Nest%20%E9%87%8C%E9%9B%86%E6%88%90%20Prisma.md"]={toc:[{text:"总结",id:"总结",depth:2}],title:"151. 在 Nest 里集成 Prisma",headingTitle:"151. 在 Nest 里集成 Prisma",frontmatter:{}}}}]);