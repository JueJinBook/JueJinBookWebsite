"use strict";(self.webpackChunkjue_jin_book_press=self.webpackChunkjue_jin_book_press||[]).push([["87532"],{895447:function(e,n,a){a.r(n),a.d(n,{default:()=>B});var d=a(552676),s=a(740453);let t=a.p+"static/image/3237b09f6603d570dfc9aac722d402e9.21a59512.gif",c=a.p+"static/image/3dd71de8862470bb943e8914e71b03cb.c7956fea.gif",i=a.p+"static/image/a23358d2057e059f4b540bff2cce7ad2.46918d17.webp",r=a.p+"static/image/b867880ce8f7fcd93d72a6b42a75955c.dc61fb93.webp",l=a.p+"static/image/401f574f7fd683b2d16dd332567789ae.a438bca8.webp",p=a.p+"static/image/ac50f7cbcc8f0b28f797f932755e7b7d.3c9d70a2.gif",h=a.p+"static/image/a0ec772fd72de831bbedc3a569d9e0bb.a3dca532.webp",o=a.p+"static/image/42c68a688d32f7260a410269791752ef.e49f7e98.webp",x=a.p+"static/image/06ee0eb00126235af872198958563472.6e299b2b.webp",j=a.p+"static/image/dd603e1faadca90cea2218f45730f132.089ec13e.gif",m=a.p+"static/image/efeb23116a6b9996250a0b9c10a92a01.b85058d9.webp",f=a.p+"static/image/9411214cee05caab8130798c031d092d.77c038c9.webp",g=a.p+"static/image/0eafda48f4941011c7ab7231cb4a4a08.87523e87.webp",u=a.p+"static/image/a84d260c5875e376a6fa26201b8f9bb5.c8f57e60.webp",v=a.p+"static/image/dfd1747797a8cf38447178f3996b6ae4.797bfcd9.webp",b=a.p+"static/image/a82a18e3883bf164c687e83c87b3378b.1786c98f.webp",y=a.p+"static/image/030aa9be384a14972c637cb2fc6ed032.66f34799.webp",D=a.p+"static/image/46728fba2b3d95fb6e07ed3ab22b8ef9.de799a2e.webp",C=a.p+"static/image/78ad4d0b4d55caf725d4bb7ceb39e9ca.ffa5a8e3.webp",N=a.p+"static/image/87d63835d4d8f49f30d572290f756b43.05d2348b.webp",w=a.p+"static/image/8d094dc9377316d2b58f1df95b8f8cf6.bbc98ffc.webp",k=a.p+"static/image/d39125ce92c21bea27b76d288330a1bd.a88947b3.webp",A=a.p+"static/image/62cd042fee022ef0f5725cc894cfb093.822d4e1f.webp",M=a.p+"static/image/52db9ea99bbe963a68eed69f43c42bea.97e549f6.webp",F=a.p+"static/image/f1ef89ebd696db6413b25f8fb2da7d3b.8ac229ff.webp",V=a.p+"static/image/03ad8813d7638d6a9b2d0307b9576202.fd258e17.webp",Q=a.p+"static/image/2405bd04d683749945eb23a7c4cca765.08671387.webp",S=a.p+"static/image/bc999725177451d337e68cbd2994bc2e.aa2a1e5c.webp",E=a.p+"static/image/33ea0e9d336c2fae898d2c6119041f92.aedd061f.webp",H=a.p+"static/image/0f3f3643580d4fc413260a346fda9937.3907d833.webp",P=a.p+"static/image/0deaae0c60468fe7fa4f084bf9fd1a97.f46e843c.webp",R=a.p+"static/image/bd422695e8b049a39f6a36dc1f492c1f.f31a00cc.webp";function T(e){let n=Object.assign({h1:"h1",a:"a",p:"p",img:"img",pre:"pre",code:"code",h2:"h2"},(0,s.ah)(),e.components);return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(n.h1,{id:"第07章组件实战迷你calendar",children:["第07章—组件实战：迷你Calendar",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#第07章组件实战迷你calendar",children:"#"})]}),"\n",(0,d.jsx)(n.p,{children:"\uFEFF日历组件想必大家都用过，在各个组件库里都有。"}),"\n",(0,d.jsx)(n.p,{children:"比如 antd 的 Calendar 组件（或者 DatePicker 组件）："}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:R,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"那这种日历组件是怎么实现的呢？"}),"\n",(0,d.jsx)(n.p,{children:"其实原理很简单，今天我们就来自己实现一个。"}),"\n",(0,d.jsx)(n.p,{children:"首先，要过一下 Date 的 api："}),"\n",(0,d.jsx)(n.p,{children:"创建 Date 对象时可以传入年月日时分秒。"}),"\n",(0,d.jsx)(n.p,{children:"比如 2023 年 7 月 30，就是这么创建："}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-javascript",children:"new Date(2023, 6, 30);\n"})}),"\n",(0,d.jsx)(n.p,{children:"可以调用 toLocaleString 来转成当地日期格式的字符串显示："}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:P,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"有人说 7 月为啥第二个参数传 6 呢？"}),"\n",(0,d.jsx)(n.p,{children:"因为 Date 的 month 是从 0 开始计数的，取值是 0 到 11："}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:H,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"而日期 date 是从 1 到 31。"}),"\n",(0,d.jsx)(n.p,{children:"而且有个小技巧，当你 date 传 0 的时候，取到的是上个月的最后一天："}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:E,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"-1 就是上个月的倒数第二天，-2 就是倒数第三天这样。"}),"\n",(0,d.jsx)(n.p,{children:"这个小技巧有很大的用处，可以用这个来拿到每个月有多少天："}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:S,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"今年一月 31 天、二月 28 天、三月 31 天。。。"}),"\n",(0,d.jsx)(n.p,{children:"除了日期外，也能通过 getFullYear、getMonth 拿到年份和月份："}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:Q,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"还可以通过 getDay 拿到星期几。"}),"\n",(0,d.jsx)(n.p,{children:"比如今天（2023-7-19）是星期三："}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:"data:image/webp;base64,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",alt:""})}),"\n",(0,d.jsx)(n.p,{children:"就这么几个 api 就已经可以实现日历组件了。"}),"\n",(0,d.jsx)(n.p,{children:"不信？我们来试试看："}),"\n",(0,d.jsx)(n.p,{children:"用 cra 创建 typescript 的 react 项目："}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"npx create-react-app --template=typescript calendar-test\n"})}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:V,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"我们先来写下静态的布局："}),"\n",(0,d.jsx)(n.p,{children:"大概一个 header，下面是从星期日到星期六，再下面是从 1 到 31："}),"\n",(0,d.jsx)(n.p,{children:"改下 App.tsx:"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-javascript",children:'import React from \'react\';\nimport \'./index.css\';\n\nfunction Calendar() {\n  return (\n    <div className="calendar">\n      <div className="header">\n        <button>&lt;</button>\n        <div>2023 年 7 月</div>\n        <button>&gt;</button>\n      </div>\n      <div className="days">\n        <div className="day">日</div>\n        <div className="day">一</div>\n        <div className="day">二</div>\n        <div className="day">三</div>\n        <div className="day">四</div>\n        <div className="day">五</div>\n        <div className="day">六</div>\n        <div className="empty"></div>\n        <div className="empty"></div>\n        <div className="day">1</div>\n        <div className="day">2</div>\n        <div className="day">3</div>\n        <div className="day">4</div>\n        <div className="day">5</div>\n        <div className="day">6</div>\n        <div className="day">7</div>\n        <div className="day">8</div>\n        <div className="day">9</div>\n        <div className="day">10</div>\n        <div className="day">11</div>\n        <div className="day">12</div>\n        <div className="day">13</div>\n        <div className="day">14</div>\n        <div className="day">15</div>\n        <div className="day">16</div>\n        <div className="day">17</div>\n        <div className="day">18</div>\n        <div className="day">19</div>\n        <div className="day">20</div>\n        <div className="day">21</div>\n        <div className="day">22</div>\n        <div className="day">23</div>\n        <div className="day">24</div>\n        <div className="day">25</div>\n        <div className="day">26</div>\n        <div className="day">27</div>\n        <div className="day">28</div>\n        <div className="day">29</div>\n        <div className="day">30</div>\n        <div className="day">31</div>\n      </div>\n    </div>\n  );\n}\n\nexport default Calendar;\n'})}),"\n",(0,d.jsx)(n.p,{children:"直接跑起来看下渲染结果再讲布局："}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"npm run start\n"})}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:F,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"这种布局还是挺简单的："}),"\n",(0,d.jsx)(n.p,{children:"header 就是一个 space-between 的 flex 容器："}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:M,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"下面是一个 flex-wrap 为 wrap，每个格子宽度为 100% / 7 的容器："}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:A,alt:""})}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:k,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"全部样式如下："}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-css",children:".calendar {\n  border: 1px solid #aaa;\n  padding: 10px;\n  width: 300px;\n  height: 250px;\n}\n\n.header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  height: 40px;\n}\n\n.days {\n  display: flex;\n  flex-wrap: wrap;\n}\n\n.empty, .day {\n  width: calc(100% / 7);\n  text-align: center;\n  line-height: 30px;\n}\n\n.day:hover {\n  background-color: #ccc;\n  cursor: pointer;\n}\n"})}),"\n",(0,d.jsx)(n.p,{children:"然后我们再来写逻辑："}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:w,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"首先，我们肯定要有一个 state 来保存当前的日期，默认值是今天。"}),"\n",(0,d.jsx)(n.p,{children:"然后点击左右按钮，会切换到上个月、下个月的第一天。"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-javascript",children:"const [date, setDate] = useState(new Date());\n\nconst handlePrevMonth = () => {\n    setDate(new Date(date.getFullYear(), date.getMonth() - 1, 1));\n};\n\nconst handleNextMonth = () => {\n    setDate(new Date(date.getFullYear(), date.getMonth() + 1, 1));\n};\n"})}),"\n",(0,d.jsx)(n.p,{children:"然后渲染的年月要改为当前 date 对应的年月："}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:N,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"我们试试看："}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:C,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"年月部分没问题了。"}),"\n",(0,d.jsx)(n.p,{children:"再来改下日期部分："}),"\n",(0,d.jsx)(n.p,{children:"我们定义一个 renderDates 方法："}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-javascript",children:'const daysOfMonth = (year: number, month: number) => {\n    return new Date(year, month + 1, 0).getDate();\n};\n\nconst firstDayOfMonth = (year: number, month: number) => {\n    return new Date(year, month, 1).getDay();\n};\n\nconst renderDates = () => {\n    const days = [];\n\n    const daysCount = daysOfMonth(date.getFullYear(), date.getMonth());\n    const firstDay = firstDayOfMonth(date.getFullYear(), date.getMonth());\n\n    for (let i = 0; i < firstDay; i++) {\n      days.push(<div key={`empty-${i}`} className="empty"></div>);\n    }\n\n    for (let i = 1; i <= daysCount; i++) {\n      days.push(<div key={i} className="day">{i}</div>);\n    }\n\n    return days;\n};\n'})}),"\n",(0,d.jsx)(n.p,{children:"首先定义个数组，来存储渲染的内容。"}),"\n",(0,d.jsx)(n.p,{children:"然后计算当前月有多少天，这里用到了前面那个 new Date 时传入 date 为 0 的技巧。"}),"\n",(0,d.jsx)(n.p,{children:"再计算当前月的第一天是星期几，也就是 new Date(year, month, 1).getDay()"}),"\n",(0,d.jsx)(n.p,{children:"这样就知道从哪里开始渲染，渲染多少天了。"}),"\n",(0,d.jsx)(n.p,{children:"然后先一个循环，渲染 day - 1 个 empty 的块。"}),"\n",(0,d.jsx)(n.p,{children:"再渲染 daysCount 个 day 的块。"}),"\n",(0,d.jsx)(n.p,{children:"这样就完成了日期渲染："}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:D,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"我们来试试看："}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:y,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"没啥问题。"}),"\n",(0,d.jsx)(n.p,{children:"这样，我们就完成了一个 Calendar 组件！"}),"\n",(0,d.jsx)(n.p,{children:"是不是还挺简单的？"}),"\n",(0,d.jsx)(n.p,{children:"确实，Calendar 组件的原理比较简单。"}),"\n",(0,d.jsx)(n.p,{children:"接下来，我们增加两个参数，defaultValue 和 onChange。"}),"\n",(0,d.jsx)(n.p,{children:"这俩参数和 antd 的 Calendar 组件一样。"}),"\n",(0,d.jsx)(n.p,{children:"我们用非受控模式的写法。"}),"\n",(0,d.jsx)(n.p,{children:"defaultValue 参数设置为 date 的初始值："}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:b,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"试试看："}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:v,alt:""})}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-javascript",children:"function Test() {\n  return <div>\n    <Calendar defaultValue={new Date('2023-3-1')}></Calendar>\n    <Calendar defaultValue={new Date('2023-8-15')}></Calendar>\n  </div>\n}\n"})}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:u,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"年月是对了，但是日期对不对我们也看不出来，所以还得加点选中样式："}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:g,alt:""})}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-css",children:".day:hover, .selected {\n  background-color: #ccc;\n  cursor: pointer;\n}\n"})}),"\n",(0,d.jsx)(n.p,{children:"现在就可以看到选中的日期了："}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:f,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"没啥问题。"}),"\n",(0,d.jsx)(n.p,{children:"然后我们再加上 onChange 的回调函数："}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:m,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"就是在点击 day 的时候，setDate 修改内部状态，然后回调 onChange 方法。"}),"\n",(0,d.jsx)(n.p,{children:"这里是非受控模式的写法，不知道为什么这么写可以看下上节内容。"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-javascript",children:'const renderDates = () => {\n    const days = [];\n\n    const daysCount = daysOfMonth(date.getFullYear(), date.getMonth());\n    const firstDay = firstDayOfMonth(date.getFullYear(), date.getMonth());\n\n    for (let i = 0; i < firstDay; i++) {\n      days.push(<div key={`empty-${i}`} className="empty"></div>);\n    }\n\n    for (let i = 1; i <= daysCount; i++) {\n      const clickHandler = () => {\n        const curDate = new Date(date.getFullYear(), date.getMonth(), i);\n        setDate(curDate);\n        onChange?.(curDate);\n      }\n      if(i === date.getDate()) {\n        days.push(<div key={i} className="day selected" onClick={() => clickHandler()}>{i}</div>);  \n      } else {\n        days.push(<div key={i} className="day" onClick={() => clickHandler()}>{i}</div>);\n      }\n    }\n\n    return days;\n}\n'})}),"\n",(0,d.jsx)(n.p,{children:"我们试试看："}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-javascript",children:"function Test() {\n    return <div>\n        <Calendar defaultValue={new Date('2023-3-1')} onChange={(date)=> {\n          alert(date.toLocaleDateString())\n        }}></Calendar>\n        <Calendar defaultValue={new Date('2023-8-15')}></Calendar>\n    </div>\n}\n"})}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)("img",{src:j,alt:""}),"\n也没啥问题。"]}),"\n",(0,d.jsx)(n.p,{children:"现在这个 Calendar 组件就是可用的了，可以通过 defaultValue 来传入初始的 date 值，修改 date 之后可以在 onChange 里拿到最新的值。"}),"\n",(0,d.jsx)(n.p,{children:"大多数人到了这一步就完成 Calendar 组件的封装了。"}),"\n",(0,d.jsx)(n.p,{children:"这当然没啥问题。"}),"\n",(0,d.jsx)(n.p,{children:"但其实你还可以再做一步，提供 ref 来暴露一些 Canlendar 组件的 api。"}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:x,alt:""})}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:o,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"用的时候这样用："}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:h,alt:""})}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-javascript",children:"import React, { useEffect, useImperativeHandle, useRef, useState } from 'react';\nimport './index.css';\n\ninterface CalendarProps {\n  defaultValue?: Date,\n  onChange?: (date: Date) => void\n}\n\ninterface CalendarRef {\n  getDate: () => Date,\n  setDate: (date: Date) => void,\n}\n\nconst InternalCalendar: React.ForwardRefRenderFunction<CalendarRef, CalendarProps> = (props, ref) => {\n  const {\n    defaultValue = new Date(),\n    onChange,\n  } = props;\n\n  const [date, setDate] = useState(defaultValue);\n\n  useImperativeHandle(ref, () => {\n    return {\n      getDate() {\n        return date;\n      },\n      setDate(date: Date) {\n        setDate(date)\n      }\n    }\n  });\n\n  const handlePrevMonth = () => {\n    setDate(new Date(date.getFullYear(), date.getMonth() - 1, 1));\n  };\n\n  const handleNextMonth = () => {\n    setDate(new Date(date.getFullYear(), date.getMonth() + 1, 1));\n  };\n\n  const monthNames = [\n    '一月',\n    '二月',\n    '三月',\n    '四月',\n    '五月',\n    '六月',\n    '七月',\n    '八月',\n    '九月',\n    '十月',\n    '十一月',\n    '十二月',\n  ];\n\n  const daysOfMonth = (year: number, month: number) => {\n    return new Date(year, month + 1, 0).getDate();\n  };\n\n  const firstDayOfMonth = (year: number, month: number) => {\n    return new Date(year, month, 1).getDay();\n  };\n\n  const renderDates = () => {\n    const days = [];\n\n    const daysCount = daysOfMonth(date.getFullYear(), date.getMonth());\n    const firstDay = firstDayOfMonth(date.getFullYear(), date.getMonth());\n\n    for (let i = 0; i < firstDay; i++) {\n      days.push(<div key={`empty-${i}`} className=\"empty\"></div>);\n    }\n\n    for (let i = 1; i <= daysCount; i++) {\n      const clickHandler = () => {\n        const curDate = new Date(date.getFullYear(), date.getMonth(), i);\n        setDate(curDate);\n        onChange?.(curDate);\n      }\n      if(i === date.getDate()) {\n        days.push(<div key={i} className=\"day selected\" onClick={() => clickHandler()}>{i}</div>);  \n      } else {\n        days.push(<div key={i} className=\"day\" onClick={() => clickHandler()}>{i}</div>);\n      }\n    }\n\n    return days;\n  };\n\n  return (\n    <div className=\"calendar\">\n      <div className=\"header\">\n        <button onClick={handlePrevMonth}>&lt;</button>\n        <div>{date.getFullYear()}年{monthNames[date.getMonth()]}</div>\n        <button onClick={handleNextMonth}>&gt;</button>\n      </div>\n      <div className=\"days\">\n        <div className=\"day\">日</div>\n        <div className=\"day\">一</div>\n        <div className=\"day\">二</div>\n        <div className=\"day\">三</div>\n        <div className=\"day\">四</div>\n        <div className=\"day\">五</div>\n        <div className=\"day\">六</div>\n        {renderDates()}\n      </div>\n    </div>\n  );\n}\n\nconst Calendar = React.forwardRef(InternalCalendar);\n\nfunction Test() {\n  const calendarRef = useRef<CalendarRef>(null);\n\n  useEffect(() => {\n    console.log(calendarRef.current?.getDate().toLocaleDateString());\n\n    setTimeout(() => {\n      calendarRef.current?.setDate(new Date(2024, 3, 1));\n    }, 3000);\n  }, []);\n\n  return <div>\n    {/* <Calendar defaultValue={new Date('2023-3-1')} onChange={(date: Date) => {\n        alert(date.toLocaleDateString());\n    }}></Calendar> */}\n    <Calendar ref={calendarRef} defaultValue={new Date('2024-8-15')}></Calendar>\n  </div>\n}\nexport default Test;\n"})}),"\n",(0,d.jsx)(n.p,{children:"试试看："}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:p,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"ref 的 api 也都生效了。"}),"\n",(0,d.jsx)(n.p,{children:"这就是除了 props 之外，另一种暴露组件 api 的方式。"}),"\n",(0,d.jsx)(n.p,{children:"你经常用的 Canlendar 或者 DatePicker 组件就是这么实现的，"}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:l,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"当然，这些组件除了本月的日期外，其余的地方不是用空白填充的，而是上个月、下个月的日期。"}),"\n",(0,d.jsx)(n.p,{children:"这个也很简单，拿到上个月、下个月的天数就知道填什么日期了。"}),"\n",(0,d.jsx)(n.p,{children:"此外，我们的组件只支持非受控模式怎么行呢？"}),"\n",(0,d.jsx)(n.p,{children:"受控模式也得支持。"}),"\n",(0,d.jsx)(n.p,{children:"上节讲过如何同时兼容两种，这里我们就直接用 ahooks 的 useControllableValue 来做了。"}),"\n",(0,d.jsx)(n.p,{children:"安装 ahooks："}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"npm install --save ahooks\n"})}),"\n",(0,d.jsx)(n.p,{children:"把 useState 换成 ahooks 的 useControllableValue："}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:r,alt:""})}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-javascript",children:"const [date, setDate] =  useControllableValue(props,{\n    defaultValue: new Date()\n});\n"})}),"\n",(0,d.jsx)(n.p,{children:"这里的 defaultValue 是当 props.value 和 props.defaultValue 都没传入时的默认值。"}),"\n",(0,d.jsx)(n.p,{children:"clickHanlder 这里就只需要调用 setDate 不用调用 onChange 了："}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:i,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"如果对 useControllable 这个 hook 有疑问，可以看下上节我们自己实现的那个 hook。"}),"\n",(0,d.jsx)(n.p,{children:"测试下："}),"\n",(0,d.jsx)(n.p,{children:"受控模式："}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-javascript",children:"function Test() {\n  const [date, setDate] = useState(new Date());\n\n  return <Calendar value={date} onChange={(newDate) => {\n      setDate(newDate);\n      alert(newDate.toLocaleDateString());\n  }}></Calendar>\n}\n"})}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:c,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"非受控模式："}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-javascript",children:"function Test() {\n  return <Calendar defaultValue={new Date()} onChange={(newDate) => {\n      alert(newDate.toLocaleDateString());\n  }}></Calendar>\n}\n"})}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:t,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"没啥问题。"}),"\n",(0,d.jsxs)(n.p,{children:["案例代码上传了",(0,d.jsx)(n.a,{href:"https://github.com/QuarkGluonPlasma/react-course-code/tree/main/mini-calendar-test",target:"_blank",rel:"noopener noreferrer",children:"小册仓库"}),"。"]}),"\n",(0,d.jsxs)(n.h2,{id:"总结",children:["总结",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#总结",children:"#"})]}),"\n",(0,d.jsx)(n.p,{children:"Calendar 或者 DatePicker 组件我们经常会用到，今天自己实现了一下。"}),"\n",(0,d.jsx)(n.p,{children:"其实原理也很简单，就是 Date 的 api。"}),"\n",(0,d.jsx)(n.p,{children:"new Date 的时候 date 传 0 就能拿到上个月最后一天的日期，然后 getDate 就可以知道那个月有多少天。"}),"\n",(0,d.jsx)(n.p,{children:"然后再通过 getDay 取到这个月第一天是星期几，就知道怎么渲染这个月的日期了。"}),"\n",(0,d.jsx)(n.p,{children:"我们用 react 实现了这个 Calendar 组件，支持传入 defaultValue 指定初始日期，传入 onChange 作为日期改变的回调。"}),"\n",(0,d.jsx)(n.p,{children:"除了 props 之外，还额外提供 ref 的 api，通过 forwarRef + useImperativeHandle 的方式。"}),"\n",(0,d.jsx)(n.p,{children:"最开始只是非受控组件，后来我们又基于 ahooks 的 useControllableValue 同时支持了受控和非受控的用法。"}),"\n",(0,d.jsx)(n.p,{children:"整天用 Calendar 组件，不如自己手写一个吧！"})]})}function L(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,s.ah)(),e.components);return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(T,{...e})}):T(e)}let B=L;L.__RSPRESS_PAGE_META={},L.__RSPRESS_PAGE_META["React%20%E9%80%9A%E5%85%B3%E7%A7%98%E7%B1%8D%2F%E7%AC%AC07%E7%AB%A0%E2%80%94%E7%BB%84%E4%BB%B6%E5%AE%9E%E6%88%98%EF%BC%9A%E8%BF%B7%E4%BD%A0Calendar.md"]={toc:[{text:"总结",id:"总结",depth:2}],title:"第07章—组件实战：迷你Calendar",headingTitle:"第07章—组件实战：迷你Calendar",frontmatter:{}}}}]);