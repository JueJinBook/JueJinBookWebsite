"use strict";(self.webpackChunkjue_jin_book_press=self.webpackChunkjue_jin_book_press||[]).push([["80901"],{691271:function(e,n,s){s.r(n),s.d(n,{default:()=>h});var a=s(552676),r=s(740453);let c=s.p+"static/image/12066a240bca208627e664dcc234fdae.8c335d65.png";function i(e){let n=Object.assign({h1:"h1",a:"a",h2:"h2",p:"p",h3:"h3",pre:"pre",code:"code",img:"img",h4:"h4"},(0,r.ah)(),e.components);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(n.h1,{id:"18小程序api实战",children:["18.小程序API实战",(0,a.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#18小程序api实战",children:"#"})]}),"\n",(0,a.jsxs)(n.h2,{id:"32-小程序api实战",children:["3.2 小程序API实战",(0,a.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#32-小程序api实战",children:"#"})]}),"\n",(0,a.jsx)(n.p,{children:"要使用JavaScript来实现小程序的具体的功能，除了要了解如何操作由不同的数据类型构成的实际数据以外，还需要掌握如何使用JavaScript适时的调用小程序封装好的API。编程语言的逻辑、数据以及API是小程序应用开发最核心的组成部分。"}),"\n",(0,a.jsxs)(n.h3,{id:"321-全局对象wx",children:["3.2.1 全局对象wx",(0,a.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#321-全局对象wx",children:"#"})]}),"\n",(0,a.jsx)(n.p,{children:"wx是小程序的全局对象，用于承载小程序能力相关API。小程序开发框架提供丰富的微信原生 API，可以方便的调起微信提供的能力，如获取用户信息，了解网络状态等。大家可以在微信开发者工具的控制台Console里了解一下这个wx这个对象。"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"wx\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:c,alt:"全局对象wx"})}),"\n",(0,a.jsxs)(n.p,{children:["可以看到wx的所有属性和方法，如果你对wx的哪个属性和方法不了解，你可以查阅",(0,a.jsx)(n.a,{href:"https://developers.weixin.qq.com/miniprogram/dev/api/",target:"_blank",rel:"noopener noreferrer",children:"API技术文档"}),"。"]}),"\n",(0,a.jsxs)(n.h3,{id:"322-控制台实战小程序api",children:["3.2.2 控制台实战小程序API",(0,a.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#322-控制台实战小程序api",children:"#"})]}),"\n",(0,a.jsx)(n.p,{children:"开发者工具的console控制台除了可以用于运行测试JavaScript的代码外，还可以来运行测试小程序以及云开发的API。接下来我们会先来介绍一些能够实际看得到效果的接口，大家可以直接把代码输入到控制台查看效果，而每一个接口都在API技术文档里有介绍，建议实战与文档一起结合起来学习。"}),"\n",(0,a.jsxs)(n.h4,{id:"1了解网络状态",children:["1、了解网络状态",(0,a.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#1了解网络状态",children:"#"})]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"wx.getNetworkType()"}),"接口可以用于获取小程序所在的手机当前的网络状态是WiFi、3G、4G、5G？这样的场景经常会有，比如播放视频音乐或玩一些游戏以及流量大图片时，如果网络处于非WiFi状态时就会有流量注意的提醒。"]}),"\n",(0,a.jsx)(n.p,{children:"大家可以切换一下开发者工具的模拟器的网络，然后多次在控制台console输入以下代码查看有什么不同："}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"wx.getNetworkType({\n  success(res) {\n    console.log(res)\n  }\n});\n"})}),"\n",(0,a.jsxs)(n.h4,{id:"2-获取设备信息",children:["2、 获取设备信息",(0,a.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#2-获取设备信息",children:"#"})]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"wx.getSystemInfo()"}),"可以用于获取用户手机的微信版本、操作系统及版本、屏幕分辨率、设备的型号与品牌、基础库版本等信息。"]}),"\n",(0,a.jsx)(n.p,{children:"大家可以留意打印的res对象与使用res的点表示法访问具体属性有什么区别。接口返回的具体属性的含义则需要我们查阅技术文档来大致了解。"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:'wx.getSystemInfo({\n  success (res) {\n    console.log("设备的所有信息",res)\n    console.log(res.model)\n    console.log(res.pixelRatio)\n    console.log(res.windowWidth)\n    console.log(res.windowHeight)\n    console.log(res.language)\n    console.log(res.version)\n    console.log(res.platform)\n  }\n})\n'})}),"\n",(0,a.jsxs)(n.h4,{id:"3页面链接跳转",children:["3、页面链接跳转",(0,a.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#3页面链接跳转",children:"#"})]}),"\n",(0,a.jsxs)(n.p,{children:["除了可以获取到用户、设备、网络等的信息，使用控制台来调用对象的方法也可以执行一些动作，比如页面跳转",(0,a.jsx)(n.code,{children:"wx.navigateTo()"}),"的接口。前面我们在home页面的下面建了一个imgshow的二级页面，我们在控制台Console里输入："]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"wx.navigateTo({\n  url: '/pages/home/imgshow/imgshow'\n})\n"})}),"\n",(0,a.jsxs)(n.p,{children:["还可以在控制台直接调用",(0,a.jsx)(n.code,{children:"wx.navigateBack()"}),"返回页面的上一层，在控制台里输入"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"wx.navigateBack({\n  delta: 1\n})\n"})}),"\n",(0,a.jsxs)(n.h4,{id:"4显示消息提示框",children:["4、显示消息提示框",(0,a.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#4显示消息提示框",children:"#"})]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"wx.showToast()"}),"接口可以来显示消息提示框，比如操作成功、操作失败等都需要给用户一个反馈，这个时候就需要调用这个接口，我们在console控制台打印一下，看看模拟器小程序的效果："]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"wx.showToast({\n  title: '弹出成功',\n  icon: 'success',\n  duration: 1000\n})\n"})}),"\n",(0,a.jsxs)(n.h4,{id:"5设置当前页面的标题",children:["5、设置当前页面的标题",(0,a.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#5设置当前页面的标题",children:"#"})]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"wx.setNavigationBarTitle()"}),"可以用来设置当前页面的标题。在我们实际生活中，会经常看到资讯、商品、博客有无数个新闻、商品、文章，打开不同的页面都会显示对应的标题，这个当然不会像静态页面一样写死，而都是用JavaScript来控制的，而小程序就会调用这个接口。"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"wx.setNavigationBarTitle({\n  title: '控制台更新的标题'\n})\n"})}),"\n",(0,a.jsxs)(n.h4,{id:"6打开文件选择器上传文件",children:["6、打开文件选择器上传文件",(0,a.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#6打开文件选择器上传文件",children:"#"})]}),"\n",(0,a.jsxs)(n.p,{children:["调用",(0,a.jsx)(n.code,{children:"wx.chooseImage()"}),"打开图片上传选择器，其实就已经可以将电脑上面的图片上传到小程序端，只是由于一个接口只干一件事情，上传的图片路径需要我们用其他函数来处理才行。"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"wx.chooseImage({\n  count: 1,\n  sizeType: ['original', 'compressed'],\n  sourceType: ['album', 'camera'],\n  success (res) {\n    const tempFilePaths = res.tempFilePaths\n  }\n})\n"})}),"\n",(0,a.jsxs)(n.h4,{id:"7控制台实战云开发api",children:["7、控制台实战云开发API",(0,a.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#7控制台实战云开发api",children:"#"})]}),"\n",(0,a.jsxs)(n.p,{children:["在前面我们已经说过",(0,a.jsx)(n.code,{children:"wx"}),"是小程序的全局对象，而在这个对象里的",(0,a.jsx)(n.code,{children:"cloud"}),"属性也是一个对象，这个是用于承载云开发在小程序端的相关能力的API，我们仍然可以通过console控制台了解相关信息。"]}),"\n",(0,a.jsx)(n.p,{children:"我们可以在控制台依次打印如下内容，至于具体的含义，大家可以通过以后章节的学习来了解："}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"wx.cloud\nwx.cloud.database()\nwx.cloud.database().command\nwx.cloud.database().command.aggregate\n"})}),"\n",(0,a.jsx)(n.p,{children:"小程序的这些API有的是返回数据（如网络状态、设备信息、用户信息等），有的是在小程序上出现交互（消息提示框、模态框、操作菜单、标题的设置），还有的需要传入一些参数等等。这一部分主要是让大家明白控制台Console的强大之处，以及通过控制台实战的方法对小程序API的运行机制有一个初步的了解。"}),"\n",(0,a.jsxs)(n.h3,{id:"323-api的可用性判断与权限",children:["3.2.3 API的可用性判断与权限",(0,a.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#323-api的可用性判断与权限",children:"#"})]}),"\n",(0,a.jsxs)(n.h4,{id:"1api的可用性",children:["1、API的可用性",(0,a.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#1api的可用性",children:"#"})]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"wx.canIUse('console.log')\nwx.canIUse('CameraContext.onCameraFrame')\nwx.canIUse('CameraFrameListener.start')\nwx.canIUse('Image.src')\n\n// wx接口参数、回调或者返回值\nwx.canIUse('openBluetoothAdapter')\nwx.canIUse('getSystemInfoSync.return.safeArea.left')\nwx.canIUse('getSystemInfo.success.screenWidth')\nwx.canIUse('showToast.object.image')\nwx.canIUse('onCompassChange.callback.direction')\nwx.canIUse('request.object.method.GET')\n\n// 组件的属性\nwx.canIUse('live-player')\nwx.canIUse('text.selectable')\nwx.canIUse('button.open-type.contact')\n"})}),"\n",(0,a.jsxs)(n.h4,{id:"2提前发起权限设置",children:["2、提前发起权限设置",(0,a.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#2提前发起权限设置",children:"#"})]}),"\n",(0,a.jsx)(n.p,{children:"部分接口需要经过用户授权同意才能调用。我们把这些接口按使用范围分成多个scope ，用户选择对 scope 来进行授权，当授权给一个 scope 之后，其对应的所有接口都可以直接使用。"}),"\n",(0,a.jsxs)(n.p,{children:["使用",(0,a.jsx)(n.code,{children:"wx.authorize"}),"可以提前向用户发起授权请求，调用后会立刻弹窗询问用户是否同意授权小程序使用某项权限，如果用户之前已经同意授权，则不会出现弹窗，直接返回成功，这些权限有scope.userInfo是否允许获取用户信息，scope.record是否允许录音、scope.writePhotosAlbum是否允许保存到相册等等"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"wx.authorize({\n  scope: 'scope.record',\n  success () {\n    // 用户已经同意小程序使用录音功能，后续调用 wx.startRecord 接口不会弹窗询问\n    wx.startRecord()\n  }\n})\n"})}),"\n",(0,a.jsxs)(n.h4,{id:"3获取用户信息",children:["3、获取用户信息",(0,a.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#3获取用户信息",children:"#"})]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"wx.getUserInfo()"}),"接口可以用于获取微信用户的一些基本信息，比如头像、昵称、城市等等，常用与小程序的用户基础信息与社交场景。不过调用这个接口的前提是先要取得用户的授权，而且还不能通过",(0,a.jsx)(n.code,{children:'wx.authorize({scope: "scope.userInfo"})'}),"的方式（因为不会弹出授权窗口），只能通过button的 ",(0,a.jsx)(n.code,{children:'open-type="getUserInfo"'}),"，方法如下："]}),"\n",(0,a.jsx)(n.p,{children:"新建一个页面，比如user，然后再在user.wxml里输入以下代码，点击按钮之后就会弹出授权弹窗，如果已经授权了，就不会有弹窗了："}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-xml",children:'<button open-type="getUserInfo">弹出授权弹窗</button>\n'})}),"\n",(0,a.jsx)(n.p,{children:"当授权完成之后然后我们可以在控制台console里输入以下代码，看得到什么信息，点击开发者工具菜单里的”清缓存“的”全部清除“之后再输入看看什么效果："}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"wx.getUserInfo({\n  success(res) {\n    console.log(res);\n  }\n});\n"})}),"\n",(0,a.jsx)(n.p,{children:"上面仅仅只是列举了很少一部分的API，小程序的API有数千个之多，用法也都不相同，因此在学习的时候，要善于查询技术文档。这些API也都是零散的，技术文档也做了一定的分门别类，开发一个实际的应用，这些API也并不会全部用到。"}),"\n",(0,a.jsx)(n.p,{children:"其实API本质上是一个个封装好了的函数，一个对象，除了可以在控制台调用它们之外，还可以通过事件机制来触发，后面会介绍点击事件、页面的生命周期等方法。"})]})}function d(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,r.ah)(),e.components);return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(i,{...e})}):i(e)}let h=d;d.__RSPRESS_PAGE_META={},d.__RSPRESS_PAGE_META["%E5%B0%8F%E7%A8%8B%E5%BA%8F%E4%BA%91%E5%BC%80%E5%8F%91%E5%85%A5%E9%97%A8%E5%88%B0%E5%AE%9E%E8%B7%B5%2F18.%E5%B0%8F%E7%A8%8B%E5%BA%8FAPI%E5%AE%9E%E6%88%98.md"]={toc:[{text:"3.2 小程序API实战",id:"32-小程序api实战",depth:2},{text:"3.2.1 全局对象wx",id:"321-全局对象wx",depth:3},{text:"3.2.2 控制台实战小程序API",id:"322-控制台实战小程序api",depth:3},{text:"1、了解网络状态",id:"1了解网络状态",depth:4},{text:"2、 获取设备信息",id:"2-获取设备信息",depth:4},{text:"3、页面链接跳转",id:"3页面链接跳转",depth:4},{text:"4、显示消息提示框",id:"4显示消息提示框",depth:4},{text:"5、设置当前页面的标题",id:"5设置当前页面的标题",depth:4},{text:"6、打开文件选择器上传文件",id:"6打开文件选择器上传文件",depth:4},{text:"7、控制台实战云开发API",id:"7控制台实战云开发api",depth:4},{text:"3.2.3 API的可用性判断与权限",id:"323-api的可用性判断与权限",depth:3},{text:"1、API的可用性",id:"1api的可用性",depth:4},{text:"2、提前发起权限设置",id:"2提前发起权限设置",depth:4},{text:"3、获取用户信息",id:"3获取用户信息",depth:4}],title:"18.小程序API实战",headingTitle:"18.小程序API实战",frontmatter:{}}}}]);