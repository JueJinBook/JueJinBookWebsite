"use strict";(self.webpackChunkjue_jin_book_press=self.webpackChunkjue_jin_book_press||[]).push([["38674"],{517393:function(e,n,a){a.r(n),a.d(n,{default:()=>P});var s=a(552676),i=a(740453);let r=a.p+"static/image/b3ecd74e686e9671aa20e7c14d4e1d52.462cb7b4.gif",t=a.p+"static/image/516b200150b78774e453dde8cf1efe20.bbb1e4c8.gif",c=a.p+"static/image/e6cb0f5d9561d6ee40ff7edac2217b12.d4e0a325.gif",d=a.p+"static/image/69342d126741693145812b9c3a6dee19.302e1dd9.gif",l=a.p+"static/image/00e4b3bbd2f58f4b085ab53284472e5a.b163469b.gif",p=a.p+"static/image/08c872cb4d98b82e70b1d2c9f164bd5d.a38a725a.webp",m=a.p+"static/image/ec9750d6d052c879853b25d4ae852cb6.47e139a7.gif",x=a.p+"static/image/514fa4fe88a9fd508bfda503dd5b686c.8e592ade.webp",o=a.p+"static/image/fa693bc38c53223409a710ec072511a0.40543e44.gif",h=a.p+"static/image/851ddaf3ff9a515cc5a79e54f25ab7ce.e1c0a9d1.webp",g=a.p+"static/image/0160a2be54737042fbc1f0ae367001f2.087c3796.gif",u=a.p+"static/image/ac47305a1815efc76762cdeca03333d5.93a8e187.webp",j=a.p+"static/image/732082a5efc118bdcbe605c32f3f1863.96d8f7f8.webp",f=a.p+"static/image/571c64cacccb3509db50f713692940e2.3ac928d7.gif",b=a.p+"static/image/ca06637baf38615565e59b44e372286a.0a256df0.webp",E=a.p+"static/image/663e1b38be4a3d2f73bf099dbf8e12a4.40554575.webp",y=a.p+"static/image/1eaef413fcf1d69bc26dd383841769b6.70329f86.webp",v=a.p+"static/image/3e92dda4f846ecf4cfcde3a0b52411f0.efe5c586.webp",A=a.p+"static/image/753f7bcc2e84659c02a76493699eeb66.d574f268.webp",B=a.p+"static/image/3b7833620e0ec3b3b19fd0a6654d8f44.f5d8f55d.webp",w=a.p+"static/image/0ef9454c85547c1f5ae40d711caf0928.46899590.webp",N=a.p+"static/image/fbc5d6034af7936cf7760ad82e9e9683.aedc11fc.gif",k=a.p+"static/image/1f1b6725d557ee4e6f50b076410228ca.4b8a135c.webp",F=a.p+"static/image/cdf62d9e405ad6bc785423e8a4ebcd10.0d3a1ae9.webp";function I(e){let n=Object.assign({h1:"h1",a:"a",p:"p",pre:"pre",code:"code",img:"img",h2:"h2"},(0,i.ah)(),e.components);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.h1,{id:"163-考试系统新增试卷回收站",children:["163. 考试系统：新增试卷、回收站",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#163-考试系统新增试卷回收站",children:"#"})]}),"\n",(0,s.jsx)(n.p,{children:"这节我们实现新增试卷和回收站的功能。"}),"\n",(0,s.jsx)(n.p,{children:"先在 interfaces/index.tsx 加一下 add 接口："}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"export async function examAdd(values: ExamAdd) {\n    return await examServiceInstance.post('/exam/add', values);\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"然后写一下新增试卷的弹窗："}),"\n",(0,s.jsx)(n.p,{children:"pages/ExamList/ExamAddModal.tsx"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:'import { Button, Form, Input, Modal, message } from "antd";\nimport { useForm } from "antd/es/form/Form";\nimport TextArea from "antd/es/input/TextArea";\nimport { examAdd } from "../../interfaces";\n\ninterface ExamAddModalProps {\n    isOpen: boolean;\n    handleClose: Function\n}\n\nconst layout = {\n    labelCol: { span: 6 },\n    wrapperCol: { span: 18 }\n}\n\nexport interface ExamAdd {\n    name: string;\n}\n\nexport function ExamAddModal(props: ExamAddModalProps) {\n\n    const [form] = useForm<ExamAdd>();\n\n    const handleOk = async function() {\n        await form.validateFields();\n\n        const values = form.getFieldsValue();\n\n        try{\n            const res = await examAdd(values);\n\n            if(res.status === 201 || res.status === 200) {\n                message.success(\'创建成功\');\n                form.resetFields();\n                props.handleClose();\n            }\n        } catch(e: any){\n            message.error(e.response?.data?.message || \'系统繁忙，请稍后再试\');\n        }\n    }\n\n    return <Modal \n        title="新增试卷"\n        open={props.isOpen}\n        onOk={handleOk}\n        onCancel={() => props.handleClose()}\n        okText={\'创建\'}\n        cancelText={\'取消\'}    \n    >\n        <Form\n            form={form}\n            colon={false}\n            {...layout}\n        >\n            <Form.Item\n                label="试卷名"\n                name="name"\n                rules={[\n                    { required: true, message: \'请输入试卷名!\' },\n                ]}\n            >\n                <Input />\n            </Form.Item>\n        </Form>\n    </Modal>\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"Modal 内是一个表单，点击创建会调用 examAdd 接口。"}),"\n",(0,s.jsx)(n.p,{children:"在 ExamList/index.tsx 里调用下："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:F,alt:"image.png"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:k,alt:"image.png"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:'import { Button, message } from "antd";\nimport "./index.scss";\nimport { useEffect, useState } from "react";\nimport { examList } from "../../interfaces";\nimport { ExamAddModal } from "./ExamAddModal";\n\ninterface Exam {\n    id: number\n    name: string\n    isPublish: boolean\n    isDelete: boolean\n    content: string\n}\n\nexport function ExamList() {\n\n    const [list, setList] = useState<Array<Exam>>();\n    const [isExamAddModalOpen, setIsExamAddModalOpen] = useState(false);\n\n    async function query() {\n        try {\n            const res = await examList();\n            if(res.status === 201 || res.status === 200) {\n                setList(res.data)\n            } \n        } catch(e: any){\n            message.error(e.response?.data?.message || \'系统繁忙，请稍后再试\');\n        }\n    }\n\n    useEffect(() => {\n        query()\n    }, []);\n\n    return <div id="ExamList-container">\n        <div className="header">\n            <h1>考试系统</h1>\n        </div>\n        <div className="body">\n            <div className="operate">\n                <Button type="primary" onClick={() => {\n                    setIsExamAddModalOpen(true);\n                }}>新建试卷</Button>\n            </div>\n            <div className="list">\n                {\n                    list?.map(item => {\n                        return <div className="item">\n                            <p>{item.name}</p>\n                            <div className="btns">\n                                <Button className="btn" type="primary" style={{background: \'darkblue\'}}>{item.isPublish ?  \'停止\' : \'发布\' }</Button>\n                                <Button className="btn" type="primary" style={{background: \'green\'}}>编辑</Button>\n                                <Button className="btn" type="primary" style={{background: \'darkred\'}}>删除</Button>\n                            </div>\n                        </div>\n                    })\n                }\n            </div>\n        </div>\n        <ExamAddModal isOpen={isExamAddModalOpen} handleClose={() => {\n            setIsExamAddModalOpen(false);\n            query();\n        }}/>\n    </div>\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"测试下："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:N,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"没啥问题。"}),"\n",(0,s.jsx)(n.p,{children:"然后实现发布状态的修改："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:w,alt:"image.png"})}),"\n",(0,s.jsx)(n.p,{children:"之前我们只实现了 publish 接口，没实现 unpublish 接口。"}),"\n",(0,s.jsx)(n.p,{children:"在后端代码加一下："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:B,alt:"image.png"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"@Get('unpublish/:id')\n@RequireLogin()\nasync unpublish(@UserInfo('userId') userId: number, @Param('id') id: string) {\n    return this.examService.unpublish(userId, +id);\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:A,alt:"image.png"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"async unpublish(userId: number, id: number) {\n    return this.prismaService.exam.update({\n      where: {\n        id,\n        createUserId: userId\n      },\n      data: {\n        isPublish: false\n      }\n    })\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"试下效果："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:v,alt:"image.png"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:y,alt:"image.png"})}),"\n",(0,s.jsx)(n.p,{children:"在前端代码的 interfaces/index.tsx 调用下："}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"export async function examPublish(id: number) {\n    return await examServiceInstance.get('/exam/publish/' + id );\n}\n\nexport async function examUnpublish(id: number) {\n    return await examServiceInstance.get('/exam/unpublish/' + id );\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"然后在 ExamList/index.tsx 组件里用一下："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:E,alt:"image.png"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:b,alt:"image.png"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"async function changePublishState(id: number, publish: boolean) {\n    try {\n        const res = publish ? await examUnpublish(id) : await examPublish(id);\n        if(res.status === 201 || res.status === 200) {\n            message.success(publish ? '已取消发布' : '已发布');\n            query();\n        } \n    } catch(e: any){\n        message.error(e.response?.data?.message || '系统繁忙，请稍后再试');\n    }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"试一下："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:f,alt:"2024-08-26 13.08.07.gif"})}),"\n",(0,s.jsx)(n.p,{children:"没啥问题。"}),"\n",(0,s.jsx)(n.p,{children:"然后再来实现删除功能。"}),"\n",(0,s.jsx)(n.p,{children:"在 interfaces/index.tsx 增加删除接口："}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"export async function examDelete(id: number) {\n    return await examServiceInstance.delete('/exam/delete/' + id );\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"点击删除按钮的时候调用下："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:j,alt:"image.png"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:u,alt:"image.png"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"async function deleteExam(id: number) {\n    try {\n        const res = await examDelete(id);\n        if(res.status === 201 || res.status === 200) {\n            message.success('已删除');\n            query();\n        } \n    } catch(e: any){\n        message.error(e.response?.data?.message || '系统繁忙，请稍后再试');\n    }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"试一下："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:g,alt:"2024-08-26 13.13.16.gif"})}),"\n",(0,s.jsx)(n.p,{children:"这时候其实已经删除了，只不过我们用的逻辑删除。"}),"\n",(0,s.jsx)(n.p,{children:"在列表过滤下："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:h,alt:"image.png"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"list?.filter(item => {\n    return !item.isDelete\n})\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:o,alt:"2024-08-26 13.15.31.gif"})}),"\n",(0,s.jsx)(n.p,{children:"然后支持下回收站的显示："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:x,alt:"image.png"})}),"\n",(0,s.jsx)(n.p,{children:"加一个状态表示是否在回收站，点击按钮切换状态。"}),"\n",(0,s.jsx)(n.p,{children:"显示的时候根据是否在回收站决定显示 isDelete 是 true 还是 false 的数据。"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"const [bin, setBin] = useState(false);\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"<Button onClick={() => {\n    setBin(bin => !bin)\n}}>{bin ? '退出回收站' : '打开回收站'}</Button>\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"list?.filter(item => {\n    return bin ? item.isDelete === true : item.isDelete === false\n})\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:m,alt:"2024-08-26 13.20.59.gif"})}),"\n",(0,s.jsx)(n.p,{children:"这样，回收站功能就完成了。"}),"\n",(0,s.jsx)(n.p,{children:"我们再给删除加个二次确认弹窗："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:p,alt:"image.png"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:'<Popconfirm\n    title="试卷删除"\n    description="确认放入回收站吗？"\n    onConfirm={() => deleteExam(item.id)}\n    okText="Yes"\n    cancelText="No"\n>                                  \n    <Button className="btn" type="primary" style={{background: \'darkred\'}}>删除</Button>\n</Popconfirm>\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:l,alt:"2024-08-26 13.23.32.gif"})}),"\n",(0,s.jsx)(n.p,{children:"整体测试下："}),"\n",(0,s.jsx)(n.p,{children:"创建两个考试："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:d,alt:"2024-08-26 13.24.19.gif"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:c,alt:"2024-08-26 13.24.52.gif"})}),"\n",(0,s.jsx)(n.p,{children:"删除其中一个，然后进回收站看一下："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:t,alt:"2024-08-26 13.25.29.gif"})}),"\n",(0,s.jsx)(n.p,{children:"再试下发布功能："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:r,alt:"2024-08-26 13.26.01.gif"})}),"\n",(0,s.jsx)(n.p,{children:"没啥问题。"}),"\n",(0,s.jsx)(n.p,{children:"这样，试卷的新增、删除、回收站就都完成了。"}),"\n",(0,s.jsx)(n.p,{children:"案例代码在小册仓库："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://github.com/QuarkGluonPlasma/nestjs-course-code/tree/main/exam-system-frontend",target:"_blank",rel:"noopener noreferrer",children:"前端代码"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://github.com/QuarkGluonPlasma/nestjs-course-code/tree/main/exam-system",target:"_blank",rel:"noopener noreferrer",children:"后端代码"})}),"\n",(0,s.jsxs)(n.h2,{id:"总结",children:["总结",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#总结",children:"#"})]}),"\n",(0,s.jsx)(n.p,{children:"这节我们实现了试卷新增、发布试卷、回收站功能。"}),"\n",(0,s.jsx)(n.p,{children:"新增试卷会弹窗展示表单，输入信息后调用接口并刷新列表。"}),"\n",(0,s.jsx)(n.p,{children:"删除、发布后也会刷新列表。"}),"\n",(0,s.jsx)(n.p,{children:"回收站就是根据 isDelete 来过滤列表里的数据。"}),"\n",(0,s.jsx)(n.p,{children:"下节我们来做试卷编辑的功能。"})]})}function M(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,i.ah)(),e.components);return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(I,{...e})}):I(e)}let P=M;M.__RSPRESS_PAGE_META={},M.__RSPRESS_PAGE_META["Nest%20%E9%80%9A%E5%85%B3%E7%A7%98%E7%B1%8D%20%20%E6%9C%80%E6%96%B0200%E7%AB%A0%2F163.%20%E8%80%83%E8%AF%95%E7%B3%BB%E7%BB%9F%EF%BC%9A%E6%96%B0%E5%A2%9E%E8%AF%95%E5%8D%B7%E3%80%81%E5%9B%9E%E6%94%B6%E7%AB%99.md"]={toc:[{text:"总结",id:"总结",depth:2}],title:"163. 考试系统：新增试卷、回收站",headingTitle:"163. 考试系统：新增试卷、回收站",frontmatter:{}}}}]);