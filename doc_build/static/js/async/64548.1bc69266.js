"use strict";(self.webpackChunkjue_jin_book_press=self.webpackChunkjue_jin_book_press||[]).push([["64548"],{931636:function(e,n,i){i.r(n),i.d(n,{default:()=>F});var c=i(552676),s=i(740453);let a=i.p+"static/image/1bf19b3db500768cbfcbf2b8b42b1872.05675a76.webp",l=i.p+"static/image/9e678d93edb3a52d51aa46085e66f491.3bca5584.webp",p=i.p+"static/image/4e433a2d7d0551b53dc22ca5e7f8131c.68065e26.webp",r=i.p+"static/image/31086e66f1f60a2cd252d9eb7677a3e9.91488393.webp",t=i.p+"static/image/4e4364f0c3ab2e042b2b5605ddd930ba.a411a71d.webp",d=i.p+"static/image/ce415a767129ac5ddacd1758fff7e5a8.c2ad86e8.webp",x=i.p+"static/image/fe41f6b3523daaccdca230e64f86a8d2.d6b2ba47.webp",h=i.p+"static/image/728e9a28de2844240f80e3a572a3c2fe.8f3afaba.webp",j=i.p+"static/image/809987e41cf108683a1c054df8a8a3db.9cfed31f.webp",b=i.p+"static/image/8eea0a15edd0d413805bdb441bc77514.e08a5a5a.webp",g=i.p+"static/image/f7777113b59bfdc6619169d1f154fbbb.bbacd6ea.webp",o=i.p+"static/image/dc8f5e6004c4efa242dca6b3ab5e709c.3bb12adf.webp",m=i.p+"static/image/a551ca5e903828017bbdcaababd7c804.231427bd.webp",f=i.p+"static/image/f086e6ae2a01b5a608e780bfda683e90.bd59c13e.webp",A=i.p+"static/image/4a1cf77aeae6237c61856363d6d78b16.36350d87.webp",u=i.p+"static/image/c9fcded74fbc454d04f5ddc69228fdbb.9da6f5e9.webp",w=i.p+"static/image/591d93e4f19ac4161882003797d34054.23cd5a12.webp",E=i.p+"static/image/850a10480e62664b5fbf7b198f83256f.238de327.webp",M=i.p+"static/image/94136dcd6371427d650fc1c8c5e4d98f.a6253808.webp",S=i.p+"static/image/723d6003a4c62ce9e2ea6fc8dc29fc54.4423b32e.webp",v=i.p+"static/image/2d176618250a5f3898d761ac5186f541.5cf0146c.webp",k=i.p+"static/image/181d1aa5c14ba6bd1482f77cbbbb2064.9c3ba866.webp",P=i.p+"static/image/e3bafa4727177ff94c0d1022635d44e5.ed8bd82c.webp",q=i.p+"static/image/28e72eceb37b7a8cb8b37adbf29a112c.11bdcac5.webp",D=i.p+"static/image/0e280b16e37e0db561655d832044d00b.d931fafa.webp",W=i.p+"static/image/314a3571bb12c242f4ecf0c15cd9b2d6.354bf0e3.webp",Z=i.p+"static/image/0bcf0c8e4bb5226ceee96a1fd684f292.5a524540.webp",C=i.p+"static/image/6bc2c6ac2284499402e70c5bc4aadfea.146face0.webp";function O(e){let n=Object.assign({blockquote:"blockquote",p:"p",a:"a",h1:"h1",pre:"pre",code:"code",img:"img",ol:"ol",li:"li",h2:"h2",strong:"strong",ul:"ul",em:"em"},(0,s.ah)(),e.components);return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)(n.blockquote,{children:["\n",(0,c.jsxs)(n.p,{children:["仓库地址：",(0,c.jsx)(n.a,{href:"https://github.com/czm1290433700/nextjs-cms",target:"_blank",rel:"noopener noreferrer",children:"https://github.com/czm1290433700/nextjs-cms"})]}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:"上一节课程，我们学习了 Nextjs 中静态页面的开发方式，了解了 Nextjs 的文件约定式路由，模板页面的开发和通用 layout 的配置，不过之前的页面数据仍然是通过静态的数据进行注入的。从这节课开始，我们将继续完善官网项目数据层的链路。"}),"\n",(0,c.jsx)(n.p,{children:"作为 C 端网站，通常都有一个后台数据配置的平台，即 CMS（内容管理平台）。这个平台是居于后端与前端之间的一个数据管理平台，通常给运营或是相关审核同学进行内容的配置。"}),"\n",(0,c.jsx)(n.p,{children:"官网也不例外，不同的是，官网的数据具备更强的实时性要求，不仅仅是数据文章，包括 logo、标题等官网内可见的数据，其实都可能会涉及到频繁变动，那么，怎么去搭建一个后台平台可以灵活配置官网数据，又可以尽可能低地降低开发成本呢？"}),"\n",(0,c.jsx)(n.p,{children:"我们知道设计模式中有一种模式是装饰者模式，通过定义装饰类型，来对基础类型提供一些额外的能力，从而达到我们需要的不同场景，所以其实针对 CMS ，我们也并不需要从头去开发，因为大部分场景下的基础能力其实是高度相似的，只是不同的业务场景所需要配置的表格和字段不同。"}),"\n",(0,c.jsx)(n.p,{children:"这里我推荐大家使用 Strapi， 这是一个开源无头的 CMS 配置 Api。基于 Strapi ，可以快速针对我们的业务场景搭建一套对应的 CMS，包括增删改查和联表等较复杂场景，都可以通过可视化的配置实现。对于自定义较高的场景，它也暴露了相关的参数进行自定义，我们可以使用较少的开发量去实现特殊场景，下面我们就通过 Strapi 来实现我们官网后台的数据配置。"}),"\n",(0,c.jsxs)(n.h1,{id:"8数据可视化基于-strapi-实现后台数据的灵活配置",children:["8.数据可视化：基于 Strapi 实现后台数据的灵活配置",(0,c.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#8数据可视化基于-strapi-实现后台数据的灵活配置",children:"#"})]}),"\n",(0,c.jsx)(n.p,{children:"首先我们执行 Strapi 提供的脚手架命令来初始化项目。"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"npx create-strapi-app nextjs-cms --quickstart\n"})}),"\n",(0,c.jsx)(n.p,{children:"它会在当前目录生成名为 nextjs-cms 的项目，并且会自动运行，我们也可以进入到项目目录中执行脚本运行。"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"npm install\nnpm run develop\n"})}),"\n",(0,c.jsx)(n.p,{children:"会打开一个登录页，我们按照指示配置一下账号密码，登录一下就可以了。"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:C,alt:"image.png"})}),"\n",(0,c.jsxs)(n.h1,{id:"数据的可视化配置",children:["数据的可视化配置",(0,c.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#数据的可视化配置",children:"#"})]}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsx)(n.h2,{children:"结构体的定义"}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:"在完成上面的登录后，我们可以进到 Strapi 的管理页面。"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:Z,alt:"image.png"})}),"\n",(0,c.jsxs)(n.p,{children:["其中",(0,c.jsx)(n.code,{children:"content manager"}),"是我们 Api 的数据，而",(0,c.jsx)(n.code,{children:"content-type builder"}),"对应我们 Api 的结构体，我们以上一章节 layout 下的静态数据举例："]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:'footerData: {\n      title: "Demo",\n      linkList: [\n        {\n          title: "技术栈",\n          list: [\n            {\n              label: "react",\n            },\n            {\n              label: "typescript",\n            },\n            {\n              label: "ssr",\n            },\n            {\n              label: "nodejs",\n            },\n          ],\n        },\n        {\n          title: "了解更多",\n          list: [\n            {\n              label: "掘金",\n              link: "https://juejin.cn/user/2714061017452557",\n            },\n            {\n              label: "知乎",\n              link: "https://www.zhihu.com/people/zmAboutFront",\n            },\n            {\n              label: "csdn",\n            },\n          ],\n        },\n        {\n          title: "联系我",\n          list: [{ label: "微信" }, { label: "QQ" }],\n        },\n      ],\n      qrCode: {\n        image: code,\n        text: "祯民讲前端微信公众号",\n      },\n      copyRight: "Copyright \xa9 2022 xxx. 保留所有权利",\n      siteNumber: "粤ICP备XXXXXXXX号-X",\n      publicNumber: "粤公网安备 xxxxxxxxxxxxxx号",\n    },\n  }\n'})}),"\n",(0,c.jsxs)(n.p,{children:["针对这样一个结构体，应该如何去定义我们的 Api 呢，首先我们切到 ",(0,c.jsx)(n.code,{children:"content-type builder"}),"。"]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:W,alt:"image.png"})}),"\n",(0,c.jsxs)(n.p,{children:["大家打开的时候应该只有一个 User，这几个结构体是我后面创建的，可以看到，这其中定义的其实就是我们需要的对应字段和它们的类型，如果需要创建一个新的结构体，我们点击",(0,c.jsx)(n.code,{children:"create new collection type"}),"。"]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:D,alt:"image.png"})}),"\n",(0,c.jsxs)(n.p,{children:["填完",(0,c.jsx)(n.code,{children:"display name"}),"后，对应的单数和复数 id 它会自动生成，就是右边的两项，name 我们填需要的结构体就可以，至于右边的 tab 是一些高级配置，我们这里用不到可以先不管它。"]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:q,alt:"image.png"})}),"\n",(0,c.jsxs)(n.p,{children:["然后为我们的结构体创建一些字段，常见的类型包括文本、boolean值、富文本，这些这里都是有的，咱们以 title 举例，因为是一个字符串，所以我们点 ",(0,c.jsx)(n.code,{children:"text"}),"。"]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:P,alt:"image.png"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:k,alt:"image.png"})}),"\n",(0,c.jsx)(n.p,{children:"咱们这个直接用短文本就好，然后高级配置我们可以选个必填和唯一。"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:"data:image/webp;base64,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",alt:"image.png"})}),"\n",(0,c.jsxs)(n.p,{children:["对应的字段就加好了，对于别的部分，我们用相同的方式加进来就可以，稍微特殊一些的字段是 linkList，可以看到它其实是一个对象数组，我们先把 footdata 的关系按照思维导图梳理一下。\n",(0,c.jsx)("img",{src:"data:image/webp;base64,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",alt:"image.png"})]}),"\n",(0,c.jsx)(n.p,{children:"按照数据结构我们可以发现，footerdata 和 linklist，它们是一对多的关系，而 linklist 中又包含多个link，也是一对多的关系，所以要描述这部分字段，光 layout 一个结构体是不够的，我们需要创建 linklist 和 link，然后给它们之间来建立对应的关系。"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:v,alt:"image.png"})}),"\n",(0,c.jsx)(n.p,{children:"确定了思路，我们按照上面的来创建好 linklist 和 link 的结构体。"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:S,alt:"image.png"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:M,alt:"image.png"})}),"\n",(0,c.jsx)(n.p,{children:"那 linklist 和 link 的关系我们应该怎么建立呢？可以按之前说的，我们在 linklist 结构体中，点新建字段。"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:E,alt:"image.png"})}),"\n",(0,c.jsx)(n.p,{children:"然后我们点击 relation 属性，这个属性我们用来联立结构体之间的数据库关系。"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:w,alt:"image.png"})}),"\n",(0,c.jsx)(n.p,{children:"这里说一下从属和普通联合的区别，如果是从属关系，对应的属性会加到需要关联的结构体，并不会体现在当前表，可以理解为 a 是 b 的一个属性。如果是普通的联合，图中 icon 带有箭头的，是将 b 作为属性加到 a 中，每次切换下面也有对应的英文描述，大家可以结合理解。"}),"\n",(0,c.jsx)(n.p,{children:"根据上面我们说的关系，这里应该是选最后一个，也就是一对多，link 是作为 linklist 的属性来存在的，我们可以点完成，发现就已经加上了。"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:u,alt:"image.png"})}),"\n",(0,c.jsx)(n.p,{children:"接下来，我们按照上面的原理配置完所有的结构体即可。"}),"\n",(0,c.jsxs)(n.ol,{start:"2",children:["\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsx)(n.h2,{children:"结构体数据的写入"}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(n.p,{children:["定义完结构体以后，我们需要为结构体加入一些数据，通常在开发完后，运营相关的同学配置，就只要进行这一步就可以了，别的部分就不需要再调整了，我们点击",(0,c.jsx)(n.code,{children:"content manager"}),"。"]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:A,alt:"image.png"})}),"\n",(0,c.jsxs)(n.p,{children:["数据的配置我们需要按照",(0,c.jsx)(n.strong,{children:"从子到父"}),"的原则，很好理解，因为 layout 有相关的字段依赖于 linklist， linklist 又依赖于 link，所以只有 link 配置完以后，才可以进行 linklist 和 layout 的配置，这里我们以 link 和 linklist 举例。"]}),"\n",(0,c.jsxs)(n.p,{children:["切到 link 的部分，点击 ",(0,c.jsx)(n.code,{children:"create new entry"}),"，可以进到下面的页面，我们输入完内容以后，可以进行保存，这里保存有两个按钮， 一个是 save， 一个是 publish，如果点击 publish 会生效到实际 cdn， 这里我们可以先点击 publish， 实际场景下运营配置的时候可以点 save，在 review 没问题后再发布即可。"]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:f,alt:"image.png"})}),"\n",(0,c.jsx)(n.p,{children:"配置完大致是这样的："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:m,alt:"image.png"})}),"\n",(0,c.jsxs)(n.p,{children:["然后我们配置 linklist 的部分，同样是点",(0,c.jsx)(n.code,{children:"create new entry"}),"。"]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:o,alt:"image.png"})}),"\n",(0,c.jsx)(n.p,{children:"除了基本的字段，右侧还会有对应关联的字段，勾选我们需要的就可以关联上了。"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:g,alt:"image.png"})}),"\n",(0,c.jsx)(n.p,{children:"保存完成后，我们可以看到对应的关联对象内容，确认无误就行了，然后剩下的部分我们用同样的原理完成就行。"}),"\n",(0,c.jsxs)(n.ol,{start:"3",children:["\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsx)(n.h2,{children:"Api 权限配置及上线"}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:"结构体和数据定义完成后，我们已经完成大半了，现在问题是我们应该在哪里配置我们的 Api，使得有个 cdn 可以看到呢？"}),"\n",(0,c.jsxs)(n.p,{children:["我们点击",(0,c.jsx)(n.code,{children:"settings -> Roles"}),"，这里是权限配置的部分，包含作者权限和公共权限，因为需要所有的人可以看到我们的接口，所以我们点 public 右侧的 \uD83D\uDD8A（如果有特别需求的同学，可以点击 ",(0,c.jsx)(n.code,{children:"add new role"})," 新增权限角色，再进行后续的步骤。"]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:b,alt:"image.png"})}),"\n",(0,c.jsx)(n.p,{children:"可以看到，我们之前定义的结构体，左侧对应结构体支持的类型，右侧对应结构体接口的指向 Api 路由。因为我们这边要给对应的接口配置全查和单查的能力，所以我们勾选上 find 和 findOne。"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:j,alt:"image.png"})}),"\n",(0,c.jsxs)(n.p,{children:["因为 layout 依赖于 link 和 link-list，所以 link 和 link-list 的结构体我们也需勾选上 find 和 findOne，完成这些后，我们访问 ",(0,c.jsx)(n.a,{href:"http://localhost:1337/api/layouts",target:"_blank",rel:"noopener noreferrer",children:"http://localhost:1337/api/layouts"})," 试一下。"]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:h,alt:"image.png"})}),"\n",(0,c.jsxs)(n.p,{children:["细心的同学会发现，好像只有基础的字段，联表的 linklist 和 link 去哪里了？这是因为 Strapi 默认是不会填充联表关系的，我们可以在路由后加",(0,c.jsx)(n.code,{children:"populate=*"}),"，这个入参的意义是为所有的关系填充一级关系。"]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:x,alt:"image.png"})}),"\n",(0,c.jsx)(n.p,{children:"可以看到现在已经有了，不过这个入参只能填充一级深度，如果有两层这种写法就不行了，引用一个官网的例子。"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:d,alt:"image.png"})}),"\n",(0,c.jsxs)(n.p,{children:["比如这样的结构，我们需要指定对应属性和子属性才可以，如果是这样，那可真的太糟糕了，每次我们配置一个复杂的结构体得花多少精力来配置入参呀！为了解决这个问题，我推荐大家使用",(0,c.jsx)(n.code,{children:"strapi-plugin-populate-deep"}),"，这是基于 Strapi 的一个深度插件，我们切到项目目录下的终端安装一下。"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"npm install strapi-plugin-populate-deep --save\n"})}),"\n",(0,c.jsxs)(n.p,{children:["然后重启一下，我们尝试访问 ",(0,c.jsx)(n.a,{href:"http://localhost:1337/api/layouts?populate=deep",target:"_blank",rel:"noopener noreferrer",children:"http://localhost:1337/api/layouts?populate=deep"})," 。"]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:t,alt:"image.png"})}),"\n",(0,c.jsxs)(n.p,{children:["deep 参数的含义为使用默认的最大深度填充请求，即 5 层，如果 5 层不满足大家的需求，需要更多，入参的调整也很方便，比如针对 10 层的场景，我们只需要传递入参 ",(0,c.jsx)(n.code,{children:"populate=deep,10"}),"就可以，相比原生复杂的语法定义好理解很多~"]}),"\n",(0,c.jsxs)(n.h1,{id:"项目结构--调试",children:["项目结构 & 调试",(0,c.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#项目结构--调试",children:"#"})]}),"\n",(0,c.jsx)(n.p,{children:"上面我们通过可视化配置了一个接口，不过 Strapi 的能力远不止此，它提供了大量的 openApi ，可以支持自定义接口的开发，为了大家后续能更好理解自定义开发的过程，我们一起来看看之前脚手架生成的 Strapi 项目结构是怎么样的。"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:r,alt:"image.png"})}),"\n",(0,c.jsx)(n.p,{children:"这其中咱们最需要关注的有三个文件夹："}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsx)(n.p,{children:".tmp/data.db: 我们项目的 db 文件，存放有 user、结构体、Api 鉴权等所有数据，默认使用 SQLite，我们可以使用 navicat for SQLite 打开看看。"}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:p,alt:"image.png"})}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:["config/ *",(0,c.jsx)(n.em,{children:"."})," : config目录下包含着我们项目使用的配置，比如数据库、中间件等配置，可以通过它来换用别的数据库或是进行跨域网关等操作。以数据库文件举例，我们可以看到，其中使用着 SQlite 的数据库，并指向了上面我们提到的 db 文件路径。"]}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:l,alt:"image.png"})}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"src/api/*: 这其中定义着我们之前配置的结构体，我们可以在这其中对我们配置的 Api 数据进行拦截进行一些额外的处理等自定义操作，具体我们会在下一节课举例说明。"}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:"因为是一个服务器端项目，所以我们肯定也需要在服务器层进行接口的调试，调试的方式很简单，我们只需要在 VSCode 的 debugger 控制台下运行项目，然后正常 debugger 即可。"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:a,alt:"image.png"})}),"\n",(0,c.jsxs)(n.h1,{id:"小结",children:["小结",(0,c.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#小结",children:"#"})]}),"\n",(0,c.jsx)(n.p,{children:"这节课，我们学习了怎么通过 Strapi 搭建一个符合我们自己业务场景的 CMS，并定义了对应的 find 接口用于后续的查询，同时我们遇到了不能深度联表的问题，并引入了对应的深度查询插件来解决。我们还学习了 Strapi 的项目结构和调试能力，为下一节课的自定义学习打下了基础。"}),"\n",(0,c.jsx)(n.p,{children:"下一节课我们将在目前 CMS 接口基础上进行一些自定义的调整，并且定义 BFF 层调用我们这节课配置好的数据源接口，来替换之前我们写的固定的静态数据，完成整个数据链路的过程。"})]})}function Q(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,s.ah)(),e.components);return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(O,{...e})}):O(e)}let F=Q;Q.__RSPRESS_PAGE_META={},Q.__RSPRESS_PAGE_META["SSR%20%E5%AE%9E%E6%88%98%EF%BC%9A%E5%AE%98%E7%BD%91%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97%2F8.%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%EF%BC%9A%E5%9F%BA%E4%BA%8E%20Strapi%20%E5%AE%9E%E7%8E%B0%E5%90%8E%E5%8F%B0%E6%95%B0%E6%8D%AE%E7%9A%84%E7%81%B5%E6%B4%BB%E9%85%8D%E7%BD%AE.md"]={toc:[],title:"小结",headingTitle:"小结",frontmatter:{}}}}]);