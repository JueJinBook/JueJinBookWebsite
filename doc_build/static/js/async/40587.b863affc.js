"use strict";(self.webpackChunkjue_jin_book_press=self.webpackChunkjue_jin_book_press||[]).push([["40587"],{961313:function(e,s,c){c.r(s),c.d(s,{default:()=>Z});var n=c(552676),i=c(740453);let t=c.p+"static/image/e27ef1857befd909d58c29d4c2ab7b74.3b827bfd.webp",r=c.p+"static/image/e6664debbed7aecf947bc3d4892f74ba.b47e9552.webp",a=c.p+"static/image/c7e701a792d4a252fd89f3057bb8e98b.f4e8e4c6.webp",d=c.p+"static/image/d7b2544b63e5f32490c69c801448d678.692257e3.webp",p=c.p+"static/image/26cd48121ef2820b80236b2ba2538549.de70f858.webp",l=c.p+"static/image/bf99892d426466bb2d7c4337d82abd46.5adb8d88.webp",j=c.p+"static/image/0d0b7de6e9240ade487d7c74260ea474.52e7c96f.webp",h=c.p+"static/image/f3b8ed9309eeacbbf8df02fe4024ed97.34bb6ef6.webp",x=c.p+"static/image/5c9744cfa5274f59f86ed0ce3bffb05e.ca577f1c.webp",b=c.p+"static/image/f1e4424af1ad1953ffe0050e26ac8f00.4cad8b41.webp",o=c.p+"static/image/61af4f21544e2f991bc0d079ed2f4470.c23320bb.webp",m=c.p+"static/image/03570e21e9f4b81c17d3f089d17e5da8.bed727c3.webp",f=c.p+"static/image/6ecb901445d107a95724bbf014e6d7eb.3b03e00b.webp",g=c.p+"static/image/17ef70f79a77b94ea72537fb01b45f48.5ed17d5a.webp",u=c.p+"static/image/40bf5cc4d9210a9851e612bbd421fdc9.90c7fb8e.webp",A=c.p+"static/image/0d5d62b9485557c1af5675cb67d66f6a.e1d7b944.webp",E=c.p+"static/image/6da69b4d5ed6a04c441172fd618989ba.58adf3d2.webp",N=c.p+"static/image/7ba75b45f4da55fc34bc9b879b3d0a99.bbba2ac1.webp",w=c.p+"static/image/381e03beaf46e5f994e46c0f1e839168.3fa4ffec.webp",J=c.p+"static/image/413b6c98100a26e4e52fbbd92d37715f.c8bc96a0.webp",Q=c.p+"static/image/c55fae1b5f0d2a829fdc1c11789875a1.7c62be47.webp",k=c.p+"static/image/c93badbc3cd9c8cb04fe9bb03912cbdb.f09bb4e4.webp",P=c.p+"static/image/ba075fdeab24ed090560b32468c9b58c.4714a971.webp",I=c.p+"static/image/439222906ca9fba2d0771b85f2236cf8.25787cf4.webp",B=c.p+"static/image/a432b3360eaad1335bd6e43f36e0602a.ff633034.webp",C=c.p+"static/image/e534b618043e0f0cd7eeec60d8aecf0f.d3e7aaf0.webp",D=c.p+"static/image/fe81bf4e278b43d606ccdb53c40a56f8.299a1f35.webp",H=c.p+"static/image/962e14805fdb56389dc249551df1774d.c3e1c641.webp",O=c.p+"static/image/eac043fd81313f49c87caa3ad85ca6d2.0f84cfc5.webp",S=c.p+"static/image/bf669c832242a9cde4c4601404bb719e.6427f2c7.webp",K=c.p+"static/image/2f95438fac075f40a8e7a7068b431d44.6400fd7d.webp",y=c.p+"static/image/a4288e0b0de9055e605e1e0cb5f02d7f.2164f698.webp",R=c.p+"static/image/30798cd2346b05cf11f9b9e08425f28e.4cfc2bf0.webp",M=c.p+"static/image/60e650b1f68a64ad7dcfb7aa3c4296ae.e91a43b7.webp";function U(e){let s=Object.assign({h1:"h1",a:"a",p:"p",h2:"h2",pre:"pre",code:"code",img:"img"},(0,i.ah)(),e.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(s.h1,{id:"17实战案例调试-nestjs-项目和源码",children:["17.实战案例：调试 Nest.js 项目和源码",(0,n.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#17实战案例调试-nestjs-项目和源码",children:"#"})]}),"\n",(0,n.jsx)(s.p,{children:"Nest.js 是当下最流行的 Node.js 服务端框架，它建立在 Express 之上，实现了 IOC 的架构模式，并且对很多方案都有集成，比如 websocket、graphql 等。"}),"\n",(0,n.jsx)(s.p,{children:"当然，这节不是讲 Nest.js 的原理，而是讲如何调试 Nest.js 的项目，如何调试 Nest.js 的源码。"}),"\n",(0,n.jsxs)(s.h2,{id:"调试-nestjs-项目",children:["调试 Nest.js 项目",(0,n.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#调试-nestjs-项目",children:"#"})]}),"\n",(0,n.jsx)(s.p,{children:"Nest.js 提供了快速创建项目的命令行工具 @nest/cli，首先全局安装它："}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{children:"npm i -g @nestjs/cli\n"})}),"\n",(0,n.jsx)(s.p,{children:"然后用 nest new nest-test 快速创建一个 nest 的项目。"}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)("img",{src:M,alt:""})}),"\n",(0,n.jsx)(s.p,{children:"进入项目目录，执行 npm run start 就会启动服务："}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)("img",{src:R,alt:""})}),"\n",(0,n.jsxs)(s.p,{children:["然后浏览器访问 ",(0,n.jsx)(s.a,{href:"http://localhost:3000",target:"_blank",rel:"noopener noreferrer",children:"http://localhost:3000"})," ，可以看到 Hello World，说明服务启动成功了。"]}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)("img",{src:"data:image/webp;base64,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",alt:""})}),"\n",(0,n.jsx)(s.p,{children:"然后我们创建一个 node 调试配置，指定 npm 为 runtime："}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)("img",{src:y,alt:""})}),"\n",(0,n.jsx)(s.p,{children:"这里 console 要设置为 integratedTerminal，这样日志会输出在 terminal，就和我们手动执行 npm run start 是一样的。"}),"\n",(0,n.jsx)(s.p,{children:"不然，日志会输出在 debug console。颜色啥的都不一样："}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)("img",{src:K,alt:""})}),"\n",(0,n.jsx)(s.p,{children:"点击 Debug 启动："}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)("img",{src:S,alt:""})}),"\n",(0,n.jsx)(s.p,{children:"注意，用 deubg 方式跑之前要把之前起的服务关掉，不然端口会被占用。"}),"\n",(0,n.jsx)(s.p,{children:"或者也可以用这样的方式杀死占用哪个端口的进程："}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)("img",{src:O,alt:""})}),"\n",(0,n.jsx)(s.p,{children:"在 controller 打个断点："}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)("img",{src:H,alt:""})}),"\n",(0,n.jsxs)(s.p,{children:["然后浏览器重新访问 ",(0,n.jsx)(s.a,{href:"http://localhost:3000",target:"_blank",rel:"noopener noreferrer",children:"http://localhost:3000"})]}),"\n",(0,n.jsx)(s.p,{children:"这时候代码就会在断点处断住："}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)("img",{src:D,alt:""})}),"\n",(0,n.jsx)(s.p,{children:"这样就可以愉快的调试 Nest.js 项目了。"}),"\n",(0,n.jsx)(s.p,{children:"接下来我们再来调试下 Nest.js 源码。"}),"\n",(0,n.jsxs)(s.h2,{id:"调试-nestjs-源码",children:["调试 Nest.js 源码",(0,n.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#调试-nestjs-源码",children:"#"})]}),"\n",(0,n.jsx)(s.p,{children:"其实调用栈里，我们的代码之前的部分，就是 Nest.js 框架的代码："}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)("img",{src:C,alt:""})}),"\n",(0,n.jsx)(s.p,{children:"但是这明显是编译后的代码："}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)("img",{src:B,alt:""})}),"\n",(0,n.jsx)(s.p,{children:"而我们是想调试 Nest 的 ts 源码的，这就需要用到 sourcemap 了。"}),"\n",(0,n.jsx)(s.p,{children:"从 npm registry 下载的包是没有 sourcemap 的代码，想要 sourcemap，需要自己 build 源码。"}),"\n",(0,n.jsx)(s.p,{children:"把 Nest 项目下载下来，并安装依赖（加个 --depth=1 是下载单 commit，--single-branch 是下载单个分支，这样速度会快很多）："}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{children:"git clone --depth=1 --single-branch https://github.com/nestjs/nest\n"})}),"\n",(0,n.jsx)(s.p,{children:"执行 npm run build，它会用 tsc 编译代码："}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)("img",{src:I,alt:""})}),"\n",(0,n.jsx)(s.p,{children:"并且在 build 命令执行完之后会自动执行 postbuild："}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)("img",{src:P,alt:""})}),"\n",(0,n.jsx)(s.p,{children:"它做的事情就是把编译后的文件移动到 node_modules/@nestjs 目录下："}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)("img",{src:k,alt:""})}),"\n",(0,n.jsx)(s.p,{children:"执行 npm run build，你就会在 node_modules/@nestjs 下看到这样的代码："}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)("img",{src:Q,alt:""})}),"\n",(0,n.jsx)(s.p,{children:"只包含了 js 和 ts，没有 sourcemap："}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)("img",{src:J,alt:""})}),"\n",(0,n.jsx)(s.p,{children:"生成 sourcemap 需要改下 tsc 编译配置，也就是 packages/tsconfig.build.json 文件："}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)("img",{src:w,alt:""})}),"\n",(0,n.jsx)(s.p,{children:"设置 sourceMap 为 true 也就是生成 sourcemap，但默认的 sourcemap 里不包含内联的源码，也就是 sourcesContent 部分，需要设置 inlineSources 来包含。"}),"\n",(0,n.jsx)(s.p,{children:"再次执行 npm run build，就会生成带有 sourcemap 的代码："}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)("img",{src:N,alt:""})}),"\n",(0,n.jsx)(s.p,{children:"并且 sourcemap 是内联了源码的："}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)("img",{src:E,alt:""})}),"\n",(0,n.jsx)(s.p,{children:"然后我们跑一下 Nest 的项目，直接跑 samples 目录下的项目即可，这是 Nest 内置的一些案例项目："}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)("img",{src:A,alt:""})}),"\n",(0,n.jsx)(s.p,{children:"创建这样一个调试配置："}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)("img",{src:u,alt:""})}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-json",children:'{\n    "name": "Launch via NPM",\n    "request": "launch",\n    "runtimeArgs": [\n        "run-script",\n        "start"\n    ],\n    "runtimeExecutable": "npm",\n    "console": "integratedTerminal",\n    "cwd": "${workspaceFolder}/sample/01-cats-app/",\n    "skipFiles": [\n        "<node_internals>/**"\n    ],\n    "type": "node"\n}\n'})}),"\n",(0,n.jsx)(s.p,{children:"主要是要指定 cwd 为那个项目的目录，也就是在那个目录下执行 npm run start。"}),"\n",(0,n.jsx)(s.p,{children:"我们在 cats 的 controller 里打个断点："}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)("img",{src:g,alt:""})}),"\n",(0,n.jsxs)(s.p,{children:["然后浏览器访问 ",(0,n.jsx)(s.a,{href:"http://localhost:3000/cats",target:"_blank",rel:"noopener noreferrer",children:"http://localhost:3000/cats"})," ，代码就会在断点处断住："]}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)("img",{src:f,alt:""})}),"\n",(0,n.jsx)(s.p,{children:"但是现在调用栈中的依然不是源码："}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)("img",{src:m,alt:""})}),"\n",(0,n.jsx)(s.p,{children:"这是为什么呢？"}),"\n",(0,n.jsx)(s.p,{children:"这是因为这样一个调试配置 resolveSourceMapLocations："}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)("img",{src:o,alt:""})}),"\n",(0,n.jsx)(s.p,{children:"它的默认值是排除掉了 node_modules 目录的，也就是不会查找 node_modules 下的 sourcemap。"}),"\n",(0,n.jsx)(s.p,{children:"去掉那条配置："}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)("img",{src:b,alt:""})}),"\n",(0,n.jsx)(s.p,{children:"再跑一下："}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)("img",{src:x,alt:""})}),"\n",(0,n.jsx)(s.p,{children:"这时候 sourcemap 就生效了，可以看到调用栈中显示的就是 Nest 的 ts 源码。"}),"\n",(0,n.jsx)(s.p,{children:"这样就达到了调试 Nest 源码的目的。"}),"\n",(0,n.jsx)(s.p,{children:"只不过现在 nest 的 ts 源码是只读的："}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)("img",{src:h,alt:""})}),"\n",(0,n.jsx)(s.p,{children:"这是因为 sourcemap 到的路径不对，我们可以再去改下配置，修改生成的 sourcemap 的路径："}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)("img",{src:j,alt:""})}),"\n",(0,n.jsx)(s.p,{children:"那为什么 sourcemap 到的路径不对呢？"}),"\n",(0,n.jsx)(s.p,{children:"看下 map 文件："}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)("img",{src:l,alt:""})}),"\n",(0,n.jsx)(s.p,{children:"sourcemap 到的路径是 sourceRoot + sources 文件名。"}),"\n",(0,n.jsx)(s.p,{children:"我们需要设置下 sourcesRoot。"}),"\n",(0,n.jsx)(s.p,{children:"nest 的这几个目录下都有单独的 tsconfig.build.json，需要分别设置："}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)("img",{src:p,alt:""})}),"\n",(0,n.jsx)(s.p,{children:"比如我设置了 core 包下的 tsconfig.build.json 的 sourceRoot 为 core 包的绝对路径："}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)("img",{src:d,alt:""})}),"\n",(0,n.jsx)(s.p,{children:"再次 build，生成的 map 文件就是这样的："}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)("img",{src:a,alt:""})}),"\n",(0,n.jsx)(s.p,{children:"重新跑下调试："}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)("img",{src:r,alt:""})}),"\n",(0,n.jsx)(s.p,{children:"现在的路径就对了，内容不再只读，而且点击可以直接跳到源码文件："}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)("img",{src:t,alt:""})}),"\n",(0,n.jsx)(s.p,{children:"至此，我们就可以愉快的调试 Nest.js 源码了。"}),"\n",(0,n.jsxs)(s.h2,{id:"总结",children:["总结",(0,n.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#总结",children:"#"})]}),"\n",(0,n.jsx)(s.p,{children:"Nest.js 是流行的 node 服务端框架，这节我们实战了下 Nest 项目的调试和源码的调试。"}),"\n",(0,n.jsx)(s.p,{children:"调试 Nest.js 项目就是用 npm 的方式启动调试配置，指定下 console 为 terminal 就可以了。"}),"\n",(0,n.jsx)(s.p,{children:"调试 Nest.js 源码的话，需要把 Nest 源码下载下来，build 出一份带有 sourcemap 版本的代码，同时还要设置 resolveSourcemapLocations 去掉排除 node_modules 的配置，然后再调试，就可以直接调试 Nest 的 ts 源码了。"})]})}function X(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:s}=Object.assign({},(0,i.ah)(),e.components);return s?(0,n.jsx)(s,{...e,children:(0,n.jsx)(U,{...e})}):U(e)}let Z=X;X.__RSPRESS_PAGE_META={},X.__RSPRESS_PAGE_META["%E5%89%8D%E7%AB%AF%E8%B0%83%E8%AF%95%E9%80%9A%E5%85%B3%E7%A7%98%E7%B1%8D%2F17.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B%EF%BC%9A%E8%B0%83%E8%AF%95%20Nest.js%20%E9%A1%B9%E7%9B%AE%E5%92%8C%E6%BA%90%E7%A0%81.md"]={toc:[{text:"调试 Nest.js 项目",id:"调试-nestjs-项目",depth:2},{text:"调试 Nest.js 源码",id:"调试-nestjs-源码",depth:2},{text:"总结",id:"总结",depth:2}],title:"17.实战案例：调试 Nest.js 项目和源码",headingTitle:"17.实战案例：调试 Nest.js 项目和源码",frontmatter:{}}}}]);