"use strict";(self.webpackChunkjue_jin_book_press=self.webpackChunkjue_jin_book_press||[]).push([["52991"],{838101:function(e,n,c){e.exports=c.p+"static/image/30abbb63229ec443eeaaddb1222bc698.50c8ff22.webp"},113043:function(e,n,c){c.r(n),c.d(n,{default:()=>ed});var d=c(552676),i=c(740453);let r=c.p+"static/image/f3ea4ad5676ae01dc6fa657da8e581ca.db3e6a00.webp",s=c.p+"static/image/83ffcfc6639b7e714331e6549eb6ab15.0d36daf4.webp",l=c.p+"static/image/8b1614007e7fb9a9f2ab825cfeebbe74.139077ce.webp",a=c.p+"static/image/6e219de4867dc38aaa8b4f5ec4d7c49c.123dce96.webp",p=c.p+"static/image/c29dbd66442bbacc80a4c16ac19cbbb8.5f7c5bb2.webp",x=c.p+"static/image/6da463951209200c4cc7cf58dc744107.015088da.webp",j=c.p+"static/image/979ded84248803d1d5dfc553740fb391.de304525.webp",t=c.p+"static/image/60a78d9564ac8ba602c606352f5018b9.928901bc.webp",h=c.p+"static/image/314237eff14e7d1480736a7afef38932.f0de023d.webp",b=c.p+"static/image/ff791d82a93c1cc3bf48b7d6d5427eaa.6e24acd6.webp",f=c.p+"static/image/b4fa6dfe9a43b48d0d39d45afb0b3aef.bcb2d281.webp",o=c.p+"static/image/27bafb31aa75e5ca8d9674637ada70ad.b09250b8.webp",g=c.p+"static/image/7adc2c1c91adc3cce40146ad4e47b566.1774e5db.webp",A=c.p+"static/image/73106177f32e2e12cefece4264d94100.32c2a80c.webp",m=c.p+"static/image/eeff159a233ae6efc5720a0374fd953c.526ffe88.webp",u=c.p+"static/image/350c45917eaf60c8c6039829ee87ff49.3e7a393e.webp",k=c.p+"static/image/599214af24b921649c21f6ad2ae18c56.8e0869ee.webp",D=c.p+"static/image/128f7132f4f2eef3a4e12e5147ad4dba.551155bb.webp",w=c.p+"static/image/c1cfa947d0803ae00180878c3047c923.955d2f00.webp",P=c.p+"static/image/25fa88d1b2067ddd58ffe407efc27c77.36929258.webp",z=c.p+"static/image/23d47e00412d64e4925128b74051cb7d.50913f0e.webp",v=c.p+"static/image/15a79be91e9363fb66015e5cf3c3898d.bb2b2596.webp",C=c.p+"static/image/98d04597d30abd2b2863f7b168522638.bc361e25.webp",O=c.p+"static/image/81b25c864fd7be6d90c7daa96a6b8188.e29bf58e.webp",R=c.p+"static/image/c1c1cb57c12d4982df74fbb17aa589c9.c3c651a3.webp",W=c.p+"static/image/b50786f1ee649bb29549ad8f1811fb18.aedaa151.webp",Q=c.p+"static/image/07bb590b3d75c869e846a9ec8b3e0679.230a52d2.webp",y=c.p+"static/image/1e7910e305b2f3328a4ee66208d1f9eb.59750c10.webp",T=c.p+"static/image/58fcfb7edb3a3b4378645a44aa54f5b7.6850bc0e.webp",M=c.p+"static/image/519b9f6c703409bc9dd4bf16b2afc430.f0bf936d.webp",Y=c.p+"static/image/167cf4b7f03ca6961b61829c620f856d.611b1d0d.webp",N=c.p+"static/image/e856722b0b1a60ba296ad3efb0b997d1.672c83f7.webp",U=c.p+"static/image/7364381eb87878f0b0f672d58dc69b63.aa5ee467.webp",X=c.p+"static/image/1d19b2f7e116dd6411e966eba850c8e2.4e55411c.webp",E=c.p+"static/image/5f513d58dab5415b9a5c7688778448b4.4987ccbf.webp",L=c.p+"static/image/8e8015dd481eae8516eee3c061de7b18.650e313d.webp",G=c.p+"static/image/f1381b91c1f3d5b681208613a8370809.7f173029.webp",B=c.p+"static/image/276455b89922eb81c2d9a6eddb712901.c2f3c6f7.webp";var I=c(838101);let J=c.p+"static/image/d1667103fa5409a87b43c30247b03667.5d58cf03.webp",Z=c.p+"static/image/989c408d1c09eadbd515a618d1e65489.513756a0.webp",H=c.p+"static/image/5e040a8908ba5f28d7b23caf5fddc0be.892ef06f.webp",V=c.p+"static/image/00718fb1412e61b8a38bda21e5caeabc.43e64b89.webp",K=c.p+"static/image/a64bc89858d453cf8891c2804a0397ba.c3f4fa34.webp",F=c.p+"static/image/82a1bed3b328caf4a603b3413ff68574.55b77589.webp",q=c.p+"static/image/4ba4eadd03fa7b154bf50adfd13da7f6.fdfcdecd.webp",S=c.p+"static/image/6d918258609f623ad5a4c6a509dff052.e8a54f40.webp",_=c.p+"static/image/711148e8cea7e39e9a45282be9ccb46e.76405a67.webp",$=c.p+"static/image/304eec324561cc77fb5bfe41e0c6e022.9fe6f828.webp",ee=c.p+"static/image/4abb0c4565441cf4e396ebad2dd9f140.10604964.webp";function en(e){let n=Object.assign({p:"p",img:"img",pre:"pre",code:"code",a:"a",h2:"h2",ul:"ul",li:"li"},(0,i.ah)(),e.components);return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(n.p,{children:"Docker 是一种容器技术，它可以在操作系统上创建多个相互隔离的容器。容器内独立安装软件、运行服务。"}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:ee,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"但是，这个容器和宿主机还是有关联的，比如可以把宿主机的端口映射到容器内的端口、宿主机某个目录挂载到容器内的目录。"}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:$,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"比如映射了 3000 端口，那容器内 3000 端口的服务，就可以在宿主机的 3000 端口访问了。"}),"\n",(0,d.jsx)(n.p,{children:"比如挂载了 /aaa 到容器的 /bbb/ccc，那容器内读写 /bbb/ccc 目录的时候，改的就是宿主机的 /aaa 目录，反过来，改宿主机 /aaa 目录，容器内的 /bbb/ccc 也会改，这俩同一个。"}),"\n",(0,d.jsx)(n.p,{children:"这分别叫做端口映射、数据卷（volume）挂载。"}),"\n",(0,d.jsx)(n.p,{children:"这个容器是通过镜像起来的，通过 docker run image-name。"}),"\n",(0,d.jsx)(n.p,{children:"比如:"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"docker run -p 3000:3000 -v /aaa:/bbb/ccc --name xxx-container xxx-image\n"})}),"\n",(0,d.jsx)(n.p,{children:"通过 xxx-image 镜像跑起来一个叫做 xxx-container 的容器。"}),"\n",(0,d.jsx)(n.p,{children:"-p 指定端口映射，映射宿主机的 3000 到容器的 3000 端口。"}),"\n",(0,d.jsx)(n.p,{children:"-v 指定数据卷挂载，挂载宿主机的 /aaa 到容器的 /bbb/ccc 目录。"}),"\n",(0,d.jsx)(n.p,{children:"这个镜像是通过 Dockerfile 经过 build 产生的。"}),"\n",(0,d.jsx)(n.p,{children:"也就是这样的流程："}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:_,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"一般在项目里维护 Dockerfile ，然后执行 docker build 构建出镜像、push 到镜像仓库，部署的时候 pull 下来用 docker run 跑起来。"}),"\n",(0,d.jsx)(n.p,{children:"基本 CI/CD 也是这样的流程："}),"\n",(0,d.jsx)(n.p,{children:"CI 的时候 git clone 项目，根据 dockerfile 构建出镜像，打上 tag，push 到仓库。"}),"\n",(0,d.jsx)(n.p,{children:"CD 的时候把打 tag 的镜像下下来，docker run 跑起来。"}),"\n",(0,d.jsx)(n.p,{children:"这个 Dockerfile 是在项目里维护的，虽然 CI/CD 流程不用自己搞，但是 Dockefile 还是要开发者自己写的。"}),"\n",(0,d.jsx)(n.p,{children:"比如我创建一个 nest 项目："}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"npx nest new dockerfile-test -p npm\n"})}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:S,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"然后执行 npm run build，之后把它跑起来："}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"npm run build\nnode ./dist/main.js\n"})}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:q,alt:""})}),"\n",(0,d.jsxs)(n.p,{children:["这时候访问 ",(0,d.jsx)(n.a,{href:"http://localhost:3000",target:"_blank",rel:"noopener noreferrer",children:"http://localhost:3000"})," 可以看到 hello world，说明服务跑成功了:"]}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:"data:image/webp;base64,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",alt:""})}),"\n",(0,d.jsx)(n.p,{children:"那如何通过 Docker 部署这个服务呢？"}),"\n",(0,d.jsx)(n.p,{children:"我们来写下 Dockerfile："}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-docker",children:'FROM node:18\n\nWORKDIR /app\n\nCOPY package.json .\n\nCOPY *.lock .\n\nRUN npm config set registry https://registry.npmmirror.com/\n\nRUN npm install\n\nCOPY . .\n\nRUN npm run build\n\nEXPOSE 3000\n\nCMD [ "node", "./dist/main.js" ]\n'})}),"\n",(0,d.jsx)(n.p,{children:"FROM node:18 是继承 node:18 基础镜像。"}),"\n",(0,d.jsx)(n.p,{children:"WORKDIR /app 是指定当前目录为 /app"}),"\n",(0,d.jsx)(n.p,{children:"COPY 复制宿主机的 package.json 和 lock 文件到容器的当前目录，也就是 /app 下"}),"\n",(0,d.jsx)(n.p,{children:"RUN 是执行命令，这里执行了 npm install。"}),"\n",(0,d.jsx)(n.p,{children:"然后再复制其余的文件到容器内。"}),"\n",(0,d.jsx)(n.p,{children:"EXPOSE 指定容器需要暴露的端口是 3000。"}),"\n",(0,d.jsx)(n.p,{children:"CMD 指定容器跑起来时执行的命令是 node ./dist/main.js。"}),"\n",(0,d.jsx)(n.p,{children:"然后通过 docker build 把它构建成镜像："}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"docker build -t dockerfile-test:first .\n"})}),"\n",(0,d.jsx)(n.p,{children:"-t 是指定名字和标签，这里镜像名为 dockerfile-test 标签为 first。"}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:F,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"然后在 docker desktop 的 images 里就可以看到这个镜像了："}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:K,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"就是现在镜像稍微大了点，有 1.45 G。"}),"\n",(0,d.jsx)(n.p,{children:"我们先跑起来看看："}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"docker run -d -p 2333:3000 --name first-container dockerfile-test:first\n"})}),"\n",(0,d.jsx)(n.p,{children:"-d 是后台运行。"}),"\n",(0,d.jsx)(n.p,{children:"-p 指定端口映射，映射宿主机的 2333 端口到容器的 3000 端口。"}),"\n",(0,d.jsx)(n.p,{children:"--name 指定容器名"}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:V,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"然后就可以看到容器部分有了这个容器了："}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:H,alt:""})}),"\n",(0,d.jsxs)(n.p,{children:["浏览器访问 ",(0,d.jsx)(n.a,{href:"http://localhost:2333",target:"_blank",rel:"noopener noreferrer",children:"http://localhost:2333"})," 就可以访问容器内跑的这个服务："]}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:"data:image/webp;base64,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",alt:""})}),"\n",(0,d.jsx)(n.p,{children:"这就是 Dockerfile 构建成镜像，然后通过容器跑起来的流程。"}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:Z,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"但是刚才也发现了，现在镜像太大了，有 1.45G 呢，怎么优化一下呢？"}),"\n",(0,d.jsx)(n.p,{children:"这就涉及到了第一个技巧："}),"\n",(0,d.jsxs)(n.h2,{id:"使用-alpine-镜像而不是默认的-linux-镜像",children:["使用 alpine 镜像，而不是默认的 linux 镜像",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#使用-alpine-镜像而不是默认的-linux-镜像",children:"#"})]}),"\n",(0,d.jsx)(n.p,{children:"docker 容器内跑的是 linux 系统，各种镜像的 dockerfile 都会继承 linux 镜像作为基础镜像。"}),"\n",(0,d.jsx)(n.p,{children:"比如我们刚刚创建的那个镜像，点开详情可以看到它的镜像继承关系："}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:J,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"最终还是继承了 debian 的 Linux 镜像，这是一个 linux 发行版。"}),"\n",(0,d.jsx)(n.p,{children:"但其实这个 linux 镜像可以换成更小的版本，也就是 alpine。"}),"\n",(0,d.jsx)(n.p,{children:"它裁剪了很多不必要的 linux 功能，使得镜像体积大幅减小了。"}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:I,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"alpine 是高山植物，就是很少的资源就能存活的意思。"}),"\n",(0,d.jsx)(n.p,{children:"我们改下 dockerfile，使用 alpine 的镜像："}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:B,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"node:18-alpine3.14 是使用 18 版本的 node 镜像，它底层使用 alpine 3.14 的基础镜像。"}),"\n",(0,d.jsx)(n.p,{children:"然后 docker build"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"docker build -t dockerfile-test:second .\n"})}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:G,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"这次的 tag 为 second。"}),"\n",(0,d.jsx)(n.p,{children:"然后在 docker desktop 里看下："}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:L,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"好家伙，足足小了 900M。"}),"\n",(0,d.jsx)(n.p,{children:"我们点开看看："}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:E,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"可以看到它的底层 linux 镜像是 alpine3.14。"}),"\n",(0,d.jsx)(n.p,{children:"体积小了这么多，功能还正常么？"}),"\n",(0,d.jsx)(n.p,{children:"我们跑跑看："}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"docker run -d -p 2334:3000 --name second-container dockerfile-test:second\n"})}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:X,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"docker desktop 可以看到这个跑起来的容器："}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:U,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"浏览器访问下，依然是正常的："}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:"data:image/webp;base64,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",alt:""})}),"\n",(0,d.jsx)(n.p,{children:"alpine 只是去掉了很多 linux 里用不到的功能，使得镜像体积更小。"}),"\n",(0,d.jsx)(n.p,{children:"这就是第一个技巧。"}),"\n",(0,d.jsx)(n.p,{children:"然后再来看第二个："}),"\n",(0,d.jsxs)(n.h2,{id:"使用多阶段构建",children:["使用多阶段构建",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#使用多阶段构建",children:"#"})]}),"\n",(0,d.jsx)(n.p,{children:"看下这个 dockerfile，大家发现有啥问题没："}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:N,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"有的同学可能会说：为什么先复制 package.json 进去，安装依赖之后再复制其他文件，直接全部复制进去不就行了？"}),"\n",(0,d.jsx)(n.p,{children:"不是的，这两种写法的效果不同。"}),"\n",(0,d.jsx)(n.p,{children:"docker 是分层存储的，dockerfile 里的每一行指令是一层，会做缓存。"}),"\n",(0,d.jsx)(n.p,{children:"每次 docker build 的时候，只会从变化的层开始重新构建，没变的层会直接复用。"}),"\n",(0,d.jsx)(n.p,{children:"也就说现在这种写法，如果 package.json 没变，那么就不会执行 npm install，直接复用之前的。"}),"\n",(0,d.jsx)(n.p,{children:"那如果一开始就把所有文件复制进去呢？"}),"\n",(0,d.jsx)(n.p,{children:"那不管 package.json 变没变，任何一个文件变了，都会重新 npm install，这样没法充分利用缓存，性能不好。"}),"\n",(0,d.jsx)(n.p,{children:"我们试试看就知道了："}),"\n",(0,d.jsx)(n.p,{children:"现在重新跑 docker build，不管跑多少次，速度都很快，因为文件没变，直接用了镜像缓存："}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"docker build -t dockerfile-test:second .\n"})}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:Y,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"现在我们改下 README.md："}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:M,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"然后重新跑 build："}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:T,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"现在花了 25s，其实是没有重新 npm install 的。"}),"\n",(0,d.jsx)(n.p,{children:"然后改下 package.json："}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:y,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"再跑 docker build"}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:Q,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"时间明显多了很多，过程中你可以看到在 npm install 那层停留了很长时间。"}),"\n",(0,d.jsx)(n.p,{children:"这就是为什么要这样写："}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:W,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"这里没问题，大家还能发现有没有什么别的问题么？"}),"\n",(0,d.jsx)(n.p,{children:"问题就是源码和很多构建的依赖是不需要的，但是现在都保存在了镜像里。"}),"\n",(0,d.jsx)(n.p,{children:"实际上我们只需要构建出来的 ./dist 目录下的文件还有运行时的依赖。"}),"\n",(0,d.jsx)(n.p,{children:"那怎么办呢？"}),"\n",(0,d.jsx)(n.p,{children:"这时可以用多阶段构建："}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-docker",children:'FROM node:18-alpine3.14 as build-stage\n\nWORKDIR /app\n\nCOPY package.json .\n\nRUN npm config set registry https://registry.npmmirror.com/\n\nRUN npm install\n\nCOPY . .\n\nRUN npm run build\n\n# 42. 提升 Dockerfile 水平的 5 个技巧\nFROM node:18-alpine3.14 as production-stage\n\nCOPY --from=build-stage /app/dist /app\nCOPY --from=build-stage /app/package.json /app/package.json\n\nWORKDIR /app\n\nRUN npm config set registry https://registry.npmmirror.com/\n\nRUN npm install --production\n\nEXPOSE 3000\n\nCMD ["node", "/app/main.js"]\n'})}),"\n",(0,d.jsx)(n.p,{children:"FROM 后面添加一个 as 来指定当前构建阶段的名字。"}),"\n",(0,d.jsx)(n.p,{children:"通过 COPY --from=xxx 可以从上个阶段复制文件过来。"}),"\n",(0,d.jsx)(n.p,{children:"然后 npm install 的时候添加 --production，这样只会安装 dependencies 的依赖。"}),"\n",(0,d.jsx)(n.p,{children:"docker build 之后，只会留下最后一个阶段的镜像。"}),"\n",(0,d.jsx)(n.p,{children:"也就是说，最终构建出来的镜像里是没有源码的，有的只是 dist 的文件和运行时依赖。"}),"\n",(0,d.jsx)(n.p,{children:"这样镜像就会小很多。"}),"\n",(0,d.jsx)(n.p,{children:"我们来试试看："}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"docker build -t dockerfile-test:third -f 222.Dockerfile .\n"})}),"\n",(0,d.jsx)(n.p,{children:"标签为 third。"}),"\n",(0,d.jsx)(n.p,{children:"-f 是指定 Dockerfile 的名字。"}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:R,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"然后 desktop 里看下构建出来的镜像："}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:O,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"镜像体积比没有用多阶段构建的时候小了 250 M。"}),"\n",(0,d.jsx)(n.p,{children:"然后跑起来试试看："}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:C,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"这次映射 2335 端口到容器内的 3000 端口。"}),"\n",(0,d.jsx)(n.p,{children:"依然能正常访问："}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:"data:image/webp;base64,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",alt:""})}),"\n",(0,d.jsx)(n.p,{children:"这就是第二个技巧，多阶段构建。"}),"\n",(0,d.jsxs)(n.h2,{id:"使用-arg-增加构建灵活性",children:["使用 ARG 增加构建灵活性",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#使用-arg-增加构建灵活性",children:"#"})]}),"\n",(0,d.jsx)(n.p,{children:"我们写一个 test.js"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-javascript",children:"console.log(process.env.aaa);\nconsole.log(process.env.bbb);\n"})}),"\n",(0,d.jsx)(n.p,{children:"打印了环境变量 aaa、bbb"}),"\n",(0,d.jsx)(n.p,{children:"跑一下："}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"export aaa=1 bbb=2\nnode ./test.js\n"})}),"\n",(0,d.jsx)(n.p,{children:"可以看到打印了这俩环境变量："}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:v,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"然后我们写个 dockerfile，文件名是 333.Dockerfile："}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-docker",children:'FROM node:18-alpine3.14\n\nARG aaa\nARG bbb\n\nWORKDIR /app\n\nCOPY ./test.js .\n\nENV aaa=${aaa} \\\n    bbb=${bbb}\n\nCMD ["node", "/app/test.js"]\n'})}),"\n",(0,d.jsx)(n.p,{children:"使用 ARG 声明构建参数，使用 ${xxx} 来取"}),"\n",(0,d.jsx)(n.p,{children:"然后用 ENV 声明环境变量。"}),"\n",(0,d.jsx)(n.p,{children:"dockerfile 内换行使用 \\"}),"\n",(0,d.jsx)(n.p,{children:"之后构建的时候传入构建参数："}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"docker build --build-arg aaa=3 --build-arg bbb=4 -t arg-test -f 333.Dockerfile .\n"})}),"\n",(0,d.jsx)(n.p,{children:"通过 --build-arg xxx=yyy 传入 ARG 参数的值。"}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:z,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"点击查看镜像详情，可以看到 ARG 已经被替换为具体的值了："}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:P,alt:""})}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:w,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"然后跑起来："}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"docker run  --name fourth-container arg-test\n"})}),"\n",(0,d.jsx)(n.p,{children:"这次就不用 -d 后台运行了，直接看下日志："}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:D,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"可以看到容器内拿到的环境变量就是 ENV 设置的。"}),"\n",(0,d.jsx)(n.p,{children:"也就是说 ARG 是构建时的参数，ENV 时运行时的变量。"}),"\n",(0,d.jsx)(n.p,{children:"灵活使用 ARG，可以增加 dockerfile 的灵活性。"}),"\n",(0,d.jsx)(n.p,{children:"这就是第三个技巧。"}),"\n",(0,d.jsxs)(n.h2,{id:"cmd-结合-entrypoint",children:["CMD 结合 ENTRYPOINT",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#cmd-结合-entrypoint",children:"#"})]}),"\n",(0,d.jsx)(n.p,{children:"前面我们指定容器跑起来之后运行什么命令，用的是 CMD："}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:k,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"其实还可以写成 ENTRYPOINT："}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:u,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"这两种写法有什么区别么？"}),"\n",(0,d.jsx)(n.p,{children:"我们来试试："}),"\n",(0,d.jsx)(n.p,{children:"写个 444.Dockerfile"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-docker",children:'FROM node:18-alpine3.14\n\nCMD ["echo", "光光", "到此一游"]\n'})}),"\n",(0,d.jsx)(n.p,{children:"然后 build："}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"docker build -t cmd-test -f 444.Dockerfile .\n"})}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:m,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"然后 run 一下："}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"docker run cmd-test\n"})}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:"data:image/webp;base64,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",alt:""})}),"\n",(0,d.jsx)(n.p,{children:"没有指定 --name 时，会生成一个随机容器名。"}),"\n",(0,d.jsx)(n.p,{children:"就是这种："}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:A,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"这不是重点。"}),"\n",(0,d.jsx)(n.p,{children:"重点是用 CMD 的时候，启动命令是可以重写的："}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:'docker run cmd-test echo "东东"\n'})}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:g,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"可以替换成任何命令。"}),"\n",(0,d.jsx)(n.p,{children:"而用 ENTRYPOINT 就不会："}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-docker",children:'FROM node:18-alpine3.14\n\nENTRYPOINT ["echo", "光光", "到此一游"]\n'})}),"\n",(0,d.jsx)(n.p,{children:"docker build:"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"docker build -t cmd-test -f 444.Dockerfile .\n"})}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)("img",{src:o,alt:""}),"\ndocker run:"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:'docker run cmd-test echo "东东"\n'})}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:f,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"可以看到，现在 dockerfile 里 ENTRYPOINT 的命令依然执行了。"}),"\n",(0,d.jsx)(n.p,{children:"docker run 传入的参数作为了 echo 的额外参数。"}),"\n",(0,d.jsx)(n.p,{children:"这就是 ENTRYPOINT 和 CMD 的区别。"}),"\n",(0,d.jsx)(n.p,{children:"一般还是 CMD 用的多点，可以灵活修改启动命令。"}),"\n",(0,d.jsx)(n.p,{children:"其实 ENTRYPOINT 和 CMD 是可以结合使用的。"}),"\n",(0,d.jsx)(n.p,{children:"比如这样："}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-docker",children:'FROM node:18-alpine3.14\n\nENTRYPOINT ["echo", "光光"]\n\nCMD ["到此一游"]\n'})}),"\n",(0,d.jsx)(n.p,{children:"docker build："}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"docker build -t cmd-test -f 444.Dockerfile .\n"})}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:b,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"docker run:"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"docker run cmd-test\ndocker run cmd-test 66666\n"})}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:h,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"当没传参数的时候，执行的是 ENTRYPOINT + CMD 组合的命令，而传入参数的时候，只有 CMD 部分会被覆盖。"}),"\n",(0,d.jsx)(n.p,{children:"这就起到了默认值的作用。"}),"\n",(0,d.jsx)(n.p,{children:"所以，用 ENTRYPOINT + CMD 的方式更加灵活。"}),"\n",(0,d.jsx)(n.p,{children:"这是第四个技巧。"}),"\n",(0,d.jsxs)(n.h2,{id:"copy-vs-add",children:["COPY vs ADD",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#copy-vs-add",children:"#"})]}),"\n",(0,d.jsx)(n.p,{children:"其实不只是 ENTRYPOINT 和 CMD 相似，dockerfile 里还有一对指令也比较相似，就是 ADD 和 COPY。"}),"\n",(0,d.jsx)(n.p,{children:"这俩都可以把宿主机的文件复制到容器内。"}),"\n",(0,d.jsx)(n.p,{children:"但有一点区别，就是对于 tar.gz 这种压缩文件的处理上："}),"\n",(0,d.jsx)(n.p,{children:"我们创建一个 aaa 目录，下面添加两个文件："}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:t,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"使用 tar 命令打包："}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"tar -zcvf aaa.tar.gz ./aaa\n"})}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:j,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"然后写个 555.Dockerfile"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-docker",children:"FROM node:18-alpine3.14\n\nADD ./aaa.tar.gz /aaa\n\nCOPY ./aaa.tar.gz /bbb\n"})}),"\n",(0,d.jsx)(n.p,{children:"docker build 生成镜像："}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"docker build -t add-test -f 555.Dockerfile .\n"})}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:x,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"docker run 跑起来："}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"docker run -d --name sixth-container add-test\n"})}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:p,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"可以看到，ADD 把 tar.gz 给解压然后复制到容器内了。"}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:a,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"而 COPY 没有解压，它把文件整个复制过去了："}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:l,alt:""})}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:s,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"也就是说，ADD、COPY 都可以用于把目录下的文件复制到容器内的目录下。"}),"\n",(0,d.jsx)(n.p,{children:"但是 ADD 还可以解压 tar.gz 文件。"}),"\n",(0,d.jsx)(n.p,{children:"一般情况下，还是用 COPY 居多。"}),"\n",(0,d.jsxs)(n.p,{children:["案例代码在",(0,d.jsx)(n.a,{href:"https://github.com/QuarkGluonPlasma/nestjs-course-code/tree/main/dockerfile-test",target:"_blank",rel:"noopener noreferrer",children:"小册仓库"})]}),"\n",(0,d.jsxs)(n.h2,{id:"总结",children:["总结",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#总结",children:"#"})]}),"\n",(0,d.jsx)(n.p,{children:"Docker 是流行的容器技术，它可以在操作系统上创建多个隔离的容器，在容器内跑各种服务。"}),"\n",(0,d.jsx)(n.p,{children:"它的流程是 Dockerfile 经过 docker build 生成 docker 镜像，然后 docker run 来跑容器。"}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:r,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"docker run 的时候可以通过 -p 指定宿主机和容器的端口映射，通过 -v 挂载数据卷到容器内的某个目录。"}),"\n",(0,d.jsx)(n.p,{children:"CI/CD 基本也是这套流程，但是 Dockerfile 是要开发者自己维护的。"}),"\n",(0,d.jsx)(n.p,{children:"Dockerfile 有挺多技巧："}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"使用 alpine 的镜像，而不是默认的 linux 镜像，可以极大减小镜像体积，比如 node:18-alpine3.14 这种"}),"\n",(0,d.jsx)(n.li,{children:"使用多阶段构建，比如一个阶段来执行 build，一个阶段把文件复制过去，跑起服务来，最后只保留最后一个阶段的镜像。这样使镜像内只保留运行需要的文件以及 dependencies。"}),"\n",(0,d.jsx)(n.li,{children:"使用 ARG 增加构建灵活性，ARG 可以在 docker build 时通过 --build-arg xxx=yyy 传入，在 dockerfile 中生效，可以使构建过程更灵活。如果是想定义运行时可以访问的变量，可以通过 ENV 定义环境变量，值使用 ARG 传入。"}),"\n",(0,d.jsx)(n.li,{children:"CMD 和 ENTRYPOINT 都可以指定容器跑起来之后运行的命令，CMD 可以被覆盖，而 ENTRYPOINT 不可以，两者结合使用可以实现参数默认值的功能。"}),"\n",(0,d.jsx)(n.li,{children:"ADD 和 COPY 都可以复制文件到容器内，但是 ADD 处理 tar.gz 的时候，还会做一下解压。"}),"\n"]}),"\n",(0,d.jsx)(n.p,{children:"灵活使用这些技巧，可以让你的 Dockerfile 更加灵活、性能更好。"})]})}function ec(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,i.ah)(),e.components);return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(en,{...e})}):en(e)}let ed=ec;ec.__RSPRESS_PAGE_META={},ec.__RSPRESS_PAGE_META["Nest%20%E9%80%9A%E5%85%B3%E7%A7%98%E7%B1%8D%20%20%E6%9C%80%E6%96%B0200%E7%AB%A0%2F42.%20%E6%8F%90%E5%8D%87%20Dockerfile%20%E6%B0%B4%E5%B9%B3%E7%9A%84%205%20%E4%B8%AA%E6%8A%80%E5%B7%A7.md"]={toc:[{text:"使用 alpine 镜像，而不是默认的 linux 镜像",id:"使用-alpine-镜像而不是默认的-linux-镜像",depth:2},{text:"使用多阶段构建",id:"使用多阶段构建",depth:2},{text:"使用 ARG 增加构建灵活性",id:"使用-arg-增加构建灵活性",depth:2},{text:"CMD 结合 ENTRYPOINT",id:"cmd-结合-entrypoint",depth:2},{text:"COPY vs ADD",id:"copy-vs-add",depth:2},{text:"总结",id:"总结",depth:2}],title:"",headingTitle:"",frontmatter:{}}}}]);