"use strict";(self.webpackChunkjue_jin_book_press=self.webpackChunkjue_jin_book_press||[]).push([["80175"],{955073:function(e,n,i){i.r(n),i.d(n,{default:()=>j});var r=i(552676),c=i(740453);let s=i.p+"static/image/1eed62a0847812e572c866df6064f68d.30da99b3.webp",l="data:image/webp;base64,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",d=i.p+"static/image/20b29a2d2e18b2224072ece04a783c90.544a06c1.webp",a=i.p+"static/image/28954e69ca028dd0177ac1cae2908391.c20934ba.webp",h=i.p+"static/image/f8c9c36faaec916b504ff0e6d402bf8f.f117ac95.webp",t=i.p+"static/image/7782a076ff7ce057e8323bc75dfd7295.67f72574.webp";function o(e){let n=Object.assign({h1:"h1",a:"a",p:"p",h2:"h2",code:"code",img:"img",ul:"ul",li:"li",h3:"h3",pre:"pre",blockquote:"blockquote"},(0,c.ah)(),e.components);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.h1,{id:"12中级进阶-----冯氏光照模型为物体增加镜面高光效果",children:["12.中级进阶 --- 冯氏光照模型：为物体增加镜面高光效果",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#12中级进阶-----冯氏光照模型为物体增加镜面高光效果",children:"#"})]}),"\n",(0,r.jsx)(n.p,{children:"前两个章节我们讲述了冯氏光照模型的环境光和漫反射光，本节我们学习组成冯氏光照的最后一个因素：镜面高光。"}),"\n",(0,r.jsxs)(n.h2,{id:"镜面高光现象",children:["镜面高光现象",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#镜面高光现象",children:"#"})]}),"\n",(0,r.jsx)(n.p,{children:"大家小时候应该都做过这样的恶作剧，上课的时候拿一面镜子，对准某个同学，慢慢调整镜子的角度，直到反射的太阳光照在对方的脸上，然后引起该同学的极度不适。"}),"\n",(0,r.jsx)(n.p,{children:"有没有想过为什么会有这种现象？"}),"\n",(0,r.jsx)(n.p,{children:"有的同学答了，这是因为镜子的反射光正好进入了同学的眼睛里。"}),"\n",(0,r.jsx)(n.p,{children:"说的没错，那假如我拿一件衣服来反射太阳光，能不能达到同样的效果。"}),"\n",(0,r.jsx)(n.p,{children:"很多同学脱口而出：不能。"}),"\n",(0,r.jsx)(n.p,{children:"是的，可是大家有没有想过为什么不能？"}),"\n",(0,r.jsx)(n.p,{children:"也许大家会出于直觉回答，因为衣服不反光，镜子反光。其实也对，但不太严谨。事实上衣服也反光，只是衣服表面过于粗糙，光线被散射到了各个方向，不能集中射向一个方向，导致进入人眼的光线强度大大削弱。镜子就不同了，镜子比较光滑，光线反射方向比较统一，进入人眼的光线强度也就越多，从而产生刺眼的效果。"}),"\n",(0,r.jsxs)(n.p,{children:["冯氏光照模型使用",(0,r.jsx)(n.code,{children:"镜面高光分量"}),"来模拟这种现象。"]}),"\n",(0,r.jsxs)(n.h2,{id:"镜面高光的表示与计算",children:["镜面高光的表示与计算",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#镜面高光的表示与计算",children:"#"})]}),"\n",(0,r.jsx)(n.p,{children:"与漫反射分量相同，镜面高光也是根据光线的入射方向向量和法向量来决定的，只不过镜面高光还需要依赖视线的观察方向，也就是眼睛是从什么方向观察的物体。"}),"\n",(0,r.jsx)(n.p,{children:"视线方向向量与反射光向量的之间的夹角越小，夹角余弦值就会越大，那么人眼感受到的光照就会越强，反之，光照越暗。因此，我们使用夹角的余弦值表示镜面高光因子，然后再用镜面高光因子乘以光线颜色即可求出镜面高光分量："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:t,alt:""})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["1、首先需要求出反射光向量",(0,r.jsx)(n.code,{children:"reflectDirection"}),"和人眼视线方向向量",(0,r.jsx)(n.code,{children:"viewDirection"}),"。"]}),"\n",(0,r.jsx)(n.li,{children:"2、归一化两个向量。"}),"\n",(0,r.jsx)(n.li,{children:"3、求出两个归一化向量的点积，得到镜面高光因子。"}),"\n",(0,r.jsx)(n.li,{children:"4、将上一步求出的高光因子乘以光线颜色，得到镜面高光分量。"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["本节我们使用 GLSL 内置的反射向量算法",(0,r.jsx)(n.code,{children:"reflect(inVec, normal)"}),"，其中 ",(0,r.jsx)(n.code,{children:"inVec"})," 为入射向量，方向由光源指向入射点，",(0,r.jsx)(n.code,{children:"normal"})," 为入射点的法向量。"]}),"\n",(0,r.jsxs)(n.h2,{id:"如何实现镜面高光",children:["如何实现镜面高光",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#如何实现镜面高光",children:"#"})]}),"\n",(0,r.jsx)(n.p,{children:"接下来，我们开始编码实现镜面高光效果。"}),"\n",(0,r.jsxs)(n.h3,{id:"计算反射光向量",children:["计算反射光向量",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#计算反射光向量",children:"#"})]}),"\n",(0,r.jsxs)(n.p,{children:["反射光向量在片元着色器中实现，参照上一节漫反射分量的计算，我们已经有了光源位置",(0,r.jsx)(n.code,{children:"u_LightPosition"}),"和入射点位置",(0,r.jsx)(n.code,{children:"v_Position"}),"，所以可以求得入射光向量："]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-glsl",children:"//求出入射光向量\nvec3 lightDirection = v_Position - u_LightPosition\n"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"切记，在使用GLSL 的reflect 函数计算反射光向量时，一定要确保入射光向量的方向是从光源位置指向入射点位置。"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["有了入射光向量，我们还需要入射点的法向量",(0,r.jsx)(n.code,{children:"v_Normal"}),"，这个值已经从顶点着色器中插值化后传到片元着色器了，所以我们可以直接拿来用："]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-glsl",children:"vec3 reflectDirection =reflect(normalize(lightDirection), normalize(v_Normal));\n"})}),"\n",(0,r.jsx)(n.p,{children:"这样就求出了反射光向量，接下来我们计算视线观察向量。"}),"\n",(0,r.jsxs)(n.h3,{id:"计算视线观察向量",children:["计算视线观察向量",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#计算视线观察向量",children:"#"})]}),"\n",(0,r.jsxs)(n.p,{children:["我们将入射点到观察者的方向向量定义为视线观察向量，为了计算这个向量，我们需要知道入射点的位置以及观察者的位置，入射点的位置我们有了，现在需要观察者的位置，我们将人眼在世界坐标系下的坐标作为观察者位置，然后将其用 ",(0,r.jsx)(n.code,{children:"uniform"})," 变量的形式传递到片元着色器中。"]}),"\n",(0,r.jsxs)(n.p,{children:["因此我们的片元着色器要增加一个 ",(0,r.jsx)(n.code,{children:"uniform"})," 变量接收观察者坐标。"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-glsl",children:"// 观察者坐标。\nuniform vec3 viewPosition;\n"})}),"\n",(0,r.jsx)(n.p,{children:"有了观察者坐标，我们就可以计算出视线观察向量了。"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-glsl",children:"// 视线观察向量\nvec3 viewDirection = viewPosition - v_Position;\n"})}),"\n",(0,r.jsxs)(n.h3,{id:"计算镜面高光因子",children:["计算镜面高光因子",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#计算镜面高光因子",children:"#"})]}),"\n",(0,r.jsx)(n.p,{children:"前面求出了视线观察向量和反射光向量，接下来我们就可以计算镜面高光因子了。"}),"\n",(0,r.jsxs)(n.p,{children:["首先，归一化",(0,r.jsx)(n.code,{children:"视线观察向量"}),"和",(0,r.jsx)(n.code,{children:"反射光向量"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-glsl",children:"viewDirection = normalize(viewDirection);\nreflectDirection = normalize(reflectDirection);\n"})}),"\n",(0,r.jsxs)(n.p,{children:["然后计算这两个向量的点积，这里要注意一点，就是如果这两个向量的点积为负数，则说明视线观察向量和反射光向量大于 90 度，是没有反射光进入眼睛的，所以我们使用 ",(0,r.jsx)(n.code,{children:"max"}),"函数取点积和 0 之间的最大值。"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-glsl",children:"// 镜面高光因子\nfloat specialFactor = dot(viewDirection, reflectDirection);\n// 如果为负值，一律设置为 0。\nspecialFactor = max(specialFactor, 0.0);\n"})}),"\n",(0,r.jsx)(n.p,{children:"完整的片元着色器程序如下："}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-glsl",children:"    precision mediump float;\n    varying vec4 v_Color;\n    uniform vec3 u_LightColor;\n    uniform float u_AmbientFactor;\n    uniform vec3 u_LightPosition;\n    varying vec3 v_Position;\n    varying vec3 v_Normal;\n    uniform vec3 u_ViewPosition;\n    void main(){\n      // 环境光分量\n      vec3 ambient = u_AmbientFactor * u_LightColor; //环境光分量\n      // 光线照射向量\n      vec3 lightDirection =  v_Position - u_LightPosition;\n      // 归一化光线照射向量\n      lightDirection= normalize(lightDirection);\n      // 漫反射因子\n      float diffuseFactor = dot(normalize(lightDirection), normalize(v_Normal));\n      // 如果大于 90 度，则无光线进入人眼，漫反射因子设置为0。\n      diffuseFactor = max(diffuseFactor, 0.0);\n      // 漫反射光照\n      vec3 diffuseLightColor =u_LightColor * diffuseFactor;\n      \n      // 归一化视线观察向量\n      vec3 viewDirection = normalize(v_Position - u_ViewPosition);\n		//反射向量\n      vec3 reflectDirection = reflect(-lightDirection, normalize(v_Normal));\n      \n      // 初始化镜面光照因子\n      float specialFactor = 0.0;\n      // 如果有光线进入人眼。\n      if(diffuseFactor > 0.0){\n       	specialFactor = dot(normalize(viewDirection), normalize(reflectDirection));\n        specialFactor = max(specialFactor,0.0);\n     }\n     // 计算镜面光照分量\n      vec3 specialLightColor  = u_LightColor * specialFactor * 0.5;\n      // 计算总光照\n      vec3 outColor = ambient + diffuseLightColor + specialLightColor;\n      // 将物体自身颜色乘以总光照，即人眼看到的物体颜色。\n      gl_FragColor = v_Color * vec4(outColor, 1); \n    }\n\n"})}),"\n",(0,r.jsxs)(n.p,{children:["加入光照之后，我们的着色器代码就变多了，但其实并不复杂，仅仅是",(0,r.jsx)(n.code,{children:"取值"}),"、",(0,r.jsx)(n.code,{children:"计算"}),"、",(0,r.jsx)(n.code,{children:"赋值"}),"操作而已。"]}),"\n",(0,r.jsxs)(n.h3,{id:"javascript-部分",children:["JavaScript 部分",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#javascript-部分",children:"#"})]}),"\n",(0,r.jsx)(n.p,{children:"镜面光照我们需要为着色器传递一个人眼观察位置，所以我们的JavaScript 部分需要修改："}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"// 获取着色器全局变量 `u_ViewPosition`\nvar u_ViewPosition = gl.getUniformLocation(program, 'u_ViewPosition');\n"})}),"\n",(0,r.jsx)(n.p,{children:"将人眼观察位置放置在 z 轴正方向 10 位置，即物体的前面。"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"var uniforms = {\n	eyeX: 0,\n	eyeY: 0,\n	eyeZ: 10\n};\n\ngl.uniform3f(u_ViewPosition, uniforms['eyeX'], uniforms['eyeY'], uniforms['eyeZ']);\n"})}),"\n",(0,r.jsxs)(n.p,{children:["完整的代码大家可以参见",(0,r.jsx)(n.a,{href:"/",children:"这里"}),"，我们比较下加入镜面高光前后的效果。"]}),"\n",(0,r.jsx)(n.p,{children:"无镜面高光时："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:"data:image/webp;base64,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",alt:""})}),"\n",(0,r.jsx)(n.p,{children:"添加镜面高光后："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:l,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"观察上面两幅图，我们能很直观地看到添加镜面高光后，球体正中央有一个明晃晃的光圈，符合真实世界中的场景。"}),"\n",(0,r.jsxs)(n.h2,{id:"反光度",children:["反光度",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#反光度",children:"#"})]}),"\n",(0,r.jsxs)(n.p,{children:["但是，这个刺眼的光圈面积太大了，我们需要给它添加一个称为",(0,r.jsx)(n.code,{children:"反光度"}),"(shininess)的参数约束光圈的大小，一个物体的反光度越大，反光率就越强，散射的光就越少，我们看到的高光面积就越小。"]}),"\n",(0,r.jsxs)(n.p,{children:["我们定义一个",(0,r.jsx)(n.code,{children:"u_Shininess"}),"的变量表示物体的反光度，然后用前面求得的高光因子乘以 2 的shininess次幂作为最终的高光因子。这样就可以让我们的光圈变得小一些。"]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"求幂计算可以通过GLSL 内置的公式 pow(2, shininess)求得。"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-glsl",children:"specialFactor = max(specialFactor, 0.0);\nspecialFactor = pow(specialFactor, u_Shininess);\n"})}),"\n",(0,r.jsx)(n.p,{children:"一般情况下，我们设置物体的反光度为 32 就可以了，但是特殊场景下，效果可能不理想，这时候，我们就需要根据实际情况调整反光度了。"}),"\n",(0,r.jsx)(n.p,{children:"我们将反光度设置成 32，看下增加反光度后的效果："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:h,alt:""})}),"\n",(0,r.jsxs)(n.p,{children:["这会效果明显好多了，我们可以看到光圈点很小了，大家可以",(0,r.jsx)(n.a,{href:"/",children:"点击此处"}),"查看我做的 demo，调节反光度看下效果。"]}),"\n",(0,r.jsxs)(n.h3,{id:"blinn-phong光照模型",children:["Blinn-Phong光照模型",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#blinn-phong光照模型",children:"#"})]}),"\n",(0,r.jsx)(n.p,{children:"冯氏光照模型不仅能够很好的近似真实光照，而且性能也相当高。但是\n这种光照在某些场景下仍然有些缺陷，大家观察前面没有添加反光度时的图片，应该能发现高光光圈边缘有一圈很明显的暗灰色断痕，但大家再看一下增加反光度后的效果，却没发现这种现象。这是为什么呢？"}),"\n",(0,r.jsx)(n.p,{children:"产生这个问题的原因是，在高光边缘部位，由于人眼视线向量和反射光向量夹角大于90度，那么夹角的余弦值便小于 0，按照冯氏光照模型的镜面光照算法，夹角余弦值小于 0 时， 我们的镜面高光分子系数就会用 0 来代替。所以高光边缘部位及以外的部分就没有了镜面光照分量，试想一下，如果反光度越小，镜面高光区域就越大，那高光区域边缘部位漫反射光的分量所占比重就会比较小，在高光边缘部位就会产生一种较大的亮度差，给人一种暗灰色断痕的感觉。反之，反光度越小，光圈越小，相应地，光圈周围漫反射光的分量所占比重就比较大，所以不会在高光边缘产生过大的亮度差。"}),"\n",(0,r.jsx)(n.p,{children:"如下图，反射光线和视线观察向量之间的夹角γ 大于90度，所以此时镜面高光分量为 0。"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:a,alt:""})}),"\n",(0,r.jsxs)(n.p,{children:["其实，这种观察角度，镜面高光分量还是应该有的，只是值比较小而已。所以，出现了 Blin Phong 光照模型，这种光照模型不再利用反射向量，而是采用了",(0,r.jsx)(n.code,{children:"半程向量"})," ，半程向量是视线和反射光之间夹角的一半方向上的单位向量，利用半程向量和法向量之间的夹角余弦来表示镜面高光因子，半程向量和法向量之间的夹角越小，镜面高光分量越大，如下图所示："]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:d,alt:""})}),"\n",(0,r.jsxs)(n.h3,{id:"实现-blin-phong-光照",children:["实现 Blin Phong 光照",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#实现-blin-phong-光照",children:"#"})]}),"\n",(0,r.jsx)(n.p,{children:"我们在冯氏光照代码的基础上加以修改，实现 Blin 光照模型。与冯氏光照模型不同的是，我们需要半程向量，半程向量该如何求呢？"}),"\n",(0,r.jsx)(n.p,{children:"按照向量的计算规则，半程向量只需要我们将视线观察向量和反射向量相加，然后将得出的结果归一化就可以求出了。"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-glsl",children:"// 计算半程向量\nvec3 halfVector = normalize(reflectDirection + viewDirection);\n// 计算高光因子\nfloat specialFactor = dot(normalize(v_Nomral), halfVector);\n"})}),"\n",(0,r.jsx)(n.p,{children:"利用 GLSL 的内置函数，我们就很容易的求出来了。"}),"\n",(0,r.jsx)(n.p,{children:"从冯氏光照模型进化成 Blin光照模型，我们只需要改动这么一处就可以了，是不是觉得很简单呢？"}),"\n",(0,r.jsx)(n.p,{children:"算法是很简单，但是我希望大家还是能够把算法背后的原理搞清楚。这才是大家学习的目的。"}),"\n",(0,r.jsx)(n.p,{children:"好了，我们比较一下反光度同时为 1 的时候，冯氏光照和 Blin 光照之间的差别。"}),"\n",(0,r.jsx)(n.p,{children:"冯氏光照效果："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:l,alt:""})}),"\n",(0,r.jsx)(n.p,{children:"Blin 光照效果："}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)("img",{src:s,alt:""})}),"\n",(0,r.jsxs)(n.p,{children:["可以看到，采用 ",(0,r.jsx)(n.code,{children:"Blin光照模型"}),"后， 镜面高光区域过度的更加自然。"]}),"\n",(0,r.jsxs)(n.h2,{id:"回顾",children:["回顾",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#回顾",children:"#"})]}),"\n",(0,r.jsxs)(n.p,{children:["至此，我们就讲完了冯氏光照模型，以及为了解决冯氏光照的缺陷而引入的 ",(0,r.jsx)(n.code,{children:"Blin 光照模型"}),"。"]}),"\n",(0,r.jsx)(n.p,{children:"本节也涉及到了许多向量矩阵之间的计算，大家多加练习，不要被这些计算搞晕了。"}),"\n",(0,r.jsx)(n.p,{children:"接下来我们进入下一个环节的学习，对 GLSL 的语法进行一个总结。"})]})}function x(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,c.ah)(),e.components);return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}let j=x;x.__RSPRESS_PAGE_META={},x.__RSPRESS_PAGE_META["WebGL%20%E5%85%A5%E9%97%A8%E4%B8%8E%E5%AE%9E%E8%B7%B5%2F12.%E4%B8%AD%E7%BA%A7%E8%BF%9B%E9%98%B6%20---%20%E5%86%AF%E6%B0%8F%E5%85%89%E7%85%A7%E6%A8%A1%E5%9E%8B%EF%BC%9A%E4%B8%BA%E7%89%A9%E4%BD%93%E5%A2%9E%E5%8A%A0%E9%95%9C%E9%9D%A2%E9%AB%98%E5%85%89%E6%95%88%E6%9E%9C.md"]={toc:[{text:"镜面高光现象",id:"镜面高光现象",depth:2},{text:"镜面高光的表示与计算",id:"镜面高光的表示与计算",depth:2},{text:"如何实现镜面高光",id:"如何实现镜面高光",depth:2},{text:"计算反射光向量",id:"计算反射光向量",depth:3},{text:"计算视线观察向量",id:"计算视线观察向量",depth:3},{text:"计算镜面高光因子",id:"计算镜面高光因子",depth:3},{text:"JavaScript 部分",id:"javascript-部分",depth:3},{text:"反光度",id:"反光度",depth:2},{text:"Blinn-Phong光照模型",id:"blinn-phong光照模型",depth:3},{text:"实现 Blin Phong 光照",id:"实现-blin-phong-光照",depth:3},{text:"回顾",id:"回顾",depth:2}],title:"12.中级进阶 --- 冯氏光照模型：为物体增加镜面高光效果",headingTitle:"12.中级进阶 --- 冯氏光照模型：为物体增加镜面高光效果",frontmatter:{}}}}]);