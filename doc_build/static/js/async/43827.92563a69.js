"use strict";(self.webpackChunkjue_jin_book_press=self.webpackChunkjue_jin_book_press||[]).push([["43827"],{839923:function(e,n,r){r.r(n),r.d(n,{default:()=>S});var s=r(552676),c=r(740453);let i=r.p+"static/image/70a6668f6d4f6a47dd22906c6f6f9a19.0a877b6f.webp",t=r.p+"static/image/e7cf48dfe7454589e0c606ad4709b19b.266ab184.webp",p=r.p+"static/image/bc5733b4a5d031952f78ed6e834e86d9.7d2951dd.webp",o=r.p+"static/image/301ad089ce335ad36a425a6a513cfd58.639d0c1d.webp",d=r.p+"static/image/1b11542bdb60905709983c1f2407572d.112f8832.webp",l=r.p+"static/image/585e6ca4340a5b1043403d96f663f368.3ad2686f.webp",a=r.p+"static/image/c97da5e301c33929d6251c75853ba327.0d2d58e7.webp",A=r.p+"static/image/435846374d9071b40d92f9e832130d3c.5a8f3e12.webp",h=r.p+"static/image/075a41b028ae782b776ab47210929058.e868633d.webp",j=r.p+"static/image/65bd7095270c4e03ccc9e387a85029f8.c7976a09.webp",m=r.p+"static/image/cd6368e9bea11cff6afc46fe2f466eb0.27d4a550.webp",x=r.p+"static/image/fa700935fd3284087e3e9cf27b6a6613.8328871b.webp",g=r.p+"static/image/be3af1927e2e477393bad1fd6278b889.c2231fa5.webp",f=r.p+"static/image/738a0f8f95c7c4df93cd6041027407cd.6f005562.webp",b=r.p+"static/image/42673ed232d14bc3a36c7665dc6e85d6.9856a127.webp",v=r.p+"static/image/39f982dcc2733d2fd511ab03f4d89f0c.8655554c.webp",B=r.p+"static/image/1b2a524dd38f703f6871818a729abb0c.872d905e.webp",u=r.p+"static/image/738c0cb3646e252d7656171e74477232.a6f04ad6.webp",C=r.p+"static/image/d78c3c86fdc85ea547a7ea925f7f3ec4.3cc0a684.webp",w=r.p+"static/image/b221b446769312da445c7517c6dabcc6.da452f16.webp",P=r.p+"static/image/114965e81b958601921394e631afbc90.4fad9917.webp",E=r.p+"static/image/12b20787cca5c3cc91ec5209f43b38be.35a782a4.webp";function G(e){let n=Object.assign({h1:"h1",a:"a",p:"p",img:"img",pre:"pre",code:"code",h2:"h2"},(0,c.ah)(),e.components);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.h1,{id:"145-基于-grpc-实现跨语言的微服务通信",children:["145. 基于 gRPC 实现跨语言的微服务通信",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#145-基于-grpc-实现跨语言的微服务通信",children:"#"})]}),"\n",(0,s.jsx)(n.p,{children:"后端系统大多都是微服务的架构，而且还可能同时有多种语言实现的微服务，比如 java、go、python、c++、node 等。"}),"\n",(0,s.jsx)(n.p,{children:"那么问题来了，多种语言实现的微服务之间如何通信呢？"}),"\n",(0,s.jsx)(n.p,{children:"有的同学会说 http 不就行？"}),"\n",(0,s.jsx)(n.p,{children:"但 http 是文本传输，通信效率低。更重要的是这些微服务并不会提供 http 接口，因为它们又不是直接面向客户端的。"}),"\n",(0,s.jsx)(n.p,{children:"跨语言调用服务一般会用 gRPC，它是 google 出的一种跨语言的远程方法调用的方案。"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:"data:image/webp;base64,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",alt:""})}),"\n",(0,s.jsx)(n.p,{children:"其中，RPC 是 Remote Procedure Call，远程过程调用。"}),"\n",(0,s.jsx)(n.p,{children:"比如 java 微服务有个方法 aaa，node 微服务想调用它，就可以通过 gRPC 来实现。"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:"data:image/webp;base64,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",alt:""})}),"\n",(0,s.jsx)(n.p,{children:"这节我们就来用一下 gRPC。"}),"\n",(0,s.jsx)(n.p,{children:"当然，我们不会真的创建 java 的微服务，而是会用两个 nest 的微服务之间实现 gRPC 通信。"}),"\n",(0,s.jsx)(n.p,{children:"在 java、phthon、go 等语言的微服务里，接入 gRPC 都是类似的。"}),"\n",(0,s.jsx)(n.p,{children:"我们创建个 nest 项目："}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"nest new grpc-client\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:E,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"我们用 monorepo 的形式来放 client 和 server 的代码。"}),"\n",(0,s.jsx)(n.p,{children:"执行："}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"nest g app grpc-server\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:P,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"这样，就有了两个 nest 的 application："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:w,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"改下 grpc-server 的启动端口号为 3001:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:C,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"分别把两个 nest 应用跑起来："}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"npm run start:dev grpc-client\n\nnpm run start:dev grpc-server\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:u,alt:""})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:B,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"浏览器访问下："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:"data:image/webp;base64,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",alt:""})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:"data:image/webp;base64,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",alt:""})}),"\n",(0,s.jsx)(n.p,{children:"这就代表两个 nest 应用都跑起来了。"}),"\n",(0,s.jsx)(n.p,{children:"然后我们把 grpc-server 改造成 grpc 的微服务。"}),"\n",(0,s.jsx)(n.p,{children:"安装用到的微服务的包："}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"npm install --save @nestjs/microservices\n"})}),"\n",(0,s.jsx)(n.p,{children:"grpc 的包："}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"npm install --save @grpc/grpc-js @grpc/proto-loader\n"})}),"\n",(0,s.jsx)(n.p,{children:"修改下 grpc-server 的 main.ts"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"import { NestFactory } from '@nestjs/core';\nimport { GrpcOptions, Transport } from '@nestjs/microservices';\nimport { GrpcServerModule } from './grpc-server.module';\nimport { join } from 'path';\n\nasync function bootstrap() {\n  const app = await NestFactory.createMicroservice<GrpcOptions>(GrpcServerModule, {\n    transport: Transport.GRPC,\n    options: {\n      url: 'localhost:8888',\n      package: 'book',\n      protoPath: join(__dirname, 'book/book.proto'),\n    },\n  });\n\n  await app.listen();\n}\nbootstrap();\n\n"})}),"\n",(0,s.jsx)(n.p,{children:"和我们前面创建微服务的方式一样，只不过传输方式 transport 改为 GRPC，然后指定微服务监听端口为 8888。"}),"\n",(0,s.jsx)(n.p,{children:"然后在 options 指定 protoPath。"}),"\n",(0,s.jsx)(n.p,{children:"在 src 下创建这个对应的文件："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:v,alt:""})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:'syntax = "proto3";\n\npackage book;\n\nservice BookService {\n  rpc FindBook (BookById) returns (Book) {}\n}\n\nmessage BookById {\n  int32 id = 1;\n}\n\nmessage Book {\n  int32 id = 1;\n  string name = 2;\n  string desc = 3;\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"这是一种叫做 protocol buffer 的语法。"}),"\n",(0,s.jsx)(n.p,{children:"我们安装个语法高亮插件"}),"\n",(0,s.jsx)(n.p,{children:"搜索 ext:proto，也就是处理 .proto 文件的插件："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:b,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"安装之后就有语法高亮了："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:f,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"为什么要有一种 protocol buffer 的语法呢？"}),"\n",(0,s.jsx)(n.p,{children:"因为要跨语言通信，不同语言的语法又不一样，那怎么通信呢？"}),"\n",(0,s.jsx)(n.p,{children:"定义一种用于通信的语言，各种语言都支持这种语法的解析不就行了？"}),"\n",(0,s.jsx)(n.p,{children:"这就是为什么会有 protocol buffer。"}),"\n",(0,s.jsx)(n.p,{children:"这些语法也很容易看懂："}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'syntax = "proto3"\n'})}),"\n",(0,s.jsx)(n.p,{children:"是使用 proto3 版本的语法。"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"package book;\n"})}),"\n",(0,s.jsx)(n.p,{children:"是当前包为 book，也就是一种命名空间。"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"service BookService {\n  rpc FindBook (BookById) returns (Book) {}\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"这个就是定义当前服务可以远程调用的方法。"}),"\n",(0,s.jsx)(n.p,{children:"有一个 FindBook 方法，参数是 BookById，返回值是 Book"}),"\n",(0,s.jsx)(n.p,{children:"然后下面就是参数和返回值的消息格式："}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"message BookById {\n  int32 id = 1;\n}\n\nmessage Book {\n  int32 id = 1;\n  string name = 2;\n  string desc = 3;\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"book.proto 只是定义了可用的方法和参数返回值的格式，我们还要在 controller 里实现对应的方法："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:g,alt:""})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"@GrpcMethod('BookService', 'FindBook')\nfindBook(data: { id: number}) {\n    const items = [\n      { id: 1, name: '前端调试通关秘籍', desc: '网页和 node 调试' },\n      { id: 2, name: 'Nest 通关秘籍', desc: 'Nest 和各种后端中间件' },\n    ];\n    return items.find(({ id }) => id === data.id);\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"实现了 findBook 方法，并通过 @GrpcMethod 把它标识为  grpc 的远程调用的方法。"}),"\n",(0,s.jsx)(n.p,{children:"在 nest-cli.json 添加 assets 配置，让 nest 在 build 的时候把 proto 也复制到 dist 目录下："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:x,alt:""})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:'"assets": ["**/*.proto"],\n"watchAssets": true,\n'})}),"\n",(0,s.jsx)(n.p,{children:"把它跑起来："}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"npm run start:dev grpc-server\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:m,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"这时 dist 下就有 grpc-server 的代码了："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:j,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"然后我们在 grpc-client 里连上它："}),"\n",(0,s.jsx)(n.p,{children:"在 AppModule 里添加连接 grpc-server 的微服务的配置："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:h,alt:""})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"import { Module } from '@nestjs/common';\nimport { AppController } from './app.controller';\nimport { AppService } from './app.service';\nimport { ClientsModule, Transport } from '@nestjs/microservices';\nimport { join } from 'path';\n\n@Module({\n  imports: [\n    ClientsModule.register([\n      {\n        name: 'BOOK_PACKAGE',\n        transport: Transport.GRPC,\n        options: {\n          url: 'localhost:8888',\n          package: 'book',\n          protoPath: join(__dirname, 'book/book.proto'),\n        },\n      },\n    ]),\n  ],\n  controllers: [AppController],\n  providers: [AppService],\n})\nexport class AppModule {}\n"})}),"\n",(0,s.jsx)(n.p,{children:"同样，客户端也是需要 proto 文件的，不然不知道怎么解析协议数据。"}),"\n",(0,s.jsx)(n.p,{children:"把 book/book.proto 文件复制过来："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:A,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"然后在 AppController 里实现调用远程方法的逻辑："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:a,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"注入 BOOK_PACKAGE 的 grpc 客户端对象。"}),"\n",(0,s.jsx)(n.p,{children:"在 onModuleInit 的时候调用 getService 方法，拿到 BookService 的实例。"}),"\n",(0,s.jsx)(n.p,{children:"然后调用它的 findBook 方法。"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"import { Controller, Get, Inject, Param, Query } from '@nestjs/common';\nimport { AppService } from './app.service';\nimport { ClientGrpc } from '@nestjs/microservices';\n\ninterface FindById {\n  id: number;\n}\ninterface Book {\n  id: number;\n  name: string;\n  desc: string;  \n}\ninterface BookService {\n  findBook(param: FindById): Book \n}\n@Controller()\nexport class AppController {\n  constructor(private readonly appService: AppService) {}\n\n  @Inject('BOOK_PACKAGE') \n  private client: ClientGrpc;\n\n  private bookService: BookService;\n\n  onModuleInit() {\n    this.bookService = this.client.getService('BookService');\n  }\n\n  @Get('book/:id')\n  getHero(@Param('id') id: number) {\n    return this.bookService.findBook({\n      id\n    });\n  }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"把它跑起来："}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"npm run start:dev grpc-client\n"})}),"\n",(0,s.jsx)(n.p,{children:"浏览器访问下："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:l,alt:""})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:d,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"可以看到，远程方法调用成功了。"}),"\n",(0,s.jsx)(n.p,{children:"这就是基于 grpc 的远程方法调用，用 java、python、go、c++ 等实现的微服务也是这样来通信。"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:o,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"通过 protocol buffer 的语法定义通信数据的格式，比如 package、service 等。"}),"\n",(0,s.jsx)(n.p,{children:"然后 server 端实现 service 对应的方法，client 端远程调用这个 service。"}),"\n",(0,s.jsx)(n.p,{children:"比如在 java 的 srping 里，需要安装这两个依赖："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:p,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"然后也是定义这样的 proto 文件："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:t,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"之后定义对应的 servie："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:i,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"和 node 里差不多。"}),"\n",(0,s.jsx)(n.p,{children:"这样就能跨语言调用对方的方法了。"}),"\n",(0,s.jsxs)(n.p,{children:["案例代码在",(0,s.jsx)(n.a,{href:"https://github.com/QuarkGluonPlasma/nestjs-course-code/tree/main/grpc-client",target:"_blank",rel:"noopener noreferrer",children:"小册仓库"})]}),"\n",(0,s.jsxs)(n.h2,{id:"总结",children:["总结",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#总结",children:"#"})]}),"\n",(0,s.jsx)(n.p,{children:"这节我们学习了基于 gRPC 的远程方法调用。"}),"\n",(0,s.jsx)(n.p,{children:"不同语言的微服务之间可以基于 gRPC 来相互调用对方的方法。"}),"\n",(0,s.jsx)(n.p,{children:"它的实现方式是通过 protocol buffer 的语法来定义通信数据的格式，定义 package、service。"}),"\n",(0,s.jsx)(n.p,{children:"然后 server 端实现 service 对应的方法，client 端远程调用这些 service。"}),"\n",(0,s.jsx)(n.p,{children:"这样就可以实现在 java、node、go、python 等多种语言之间实现微服务的远程方法调用。"})]})}function k(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,c.ah)(),e.components);return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(G,{...e})}):G(e)}let S=k;k.__RSPRESS_PAGE_META={},k.__RSPRESS_PAGE_META["Nest%20%E9%80%9A%E5%85%B3%E7%A7%98%E7%B1%8D%20%20%E6%9C%80%E6%96%B0200%E7%AB%A0%2F145.%20%E5%9F%BA%E4%BA%8E%20gRPC%20%E5%AE%9E%E7%8E%B0%E8%B7%A8%E8%AF%AD%E8%A8%80%E7%9A%84%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%80%9A%E4%BF%A1.md"]={toc:[{text:"总结",id:"总结",depth:2}],title:"145. 基于 gRPC 实现跨语言的微服务通信",headingTitle:"145. 基于 gRPC 实现跨语言的微服务通信",frontmatter:{}}}}]);