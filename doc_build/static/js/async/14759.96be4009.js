"use strict";(self.webpackChunkjue_jin_book_press=self.webpackChunkjue_jin_book_press||[]).push([["14759"],{954289:function(e,c,s){s.r(c),s.d(c,{default:()=>y});var a=s(552676),n=s(740453);let r=s.p+"static/image/f2aface7a24680dc5e2b1ac7371bb2cb.18d45ce1.webp",d=s.p+"static/image/41aaa34add4b36c6dc4606308d0301af.30c8b327.webp",p=s.p+"static/image/928e63ce0f2b73ffd9e799bb7ed8d96d.50ea3bce.webp",i=s.p+"static/image/617d123247ab492f3180fcd98e096919.a23a523a.webp",l=s.p+"static/image/4e0fcb12365f65a440fda0120725cdd9.ba62573a.webp",h=s.p+"static/image/3967347ba5f99a843f041699d019b813.ff58ad6d.webp",o=s.p+"static/image/37de48494bc2d5d2e11b53a390d7f05a.2276c694.webp",t=s.p+"static/image/0dc321404d269a8b41f8ebff672d83d8.320e0de7.webp",x=s.p+"static/image/88f8eba52eccf22f29fc2074b59ae0e7.3a67526c.webp",j=s.p+"static/image/cca37fef0cc69be84b91ff365cefa5c6.8174dce3.webp",m=s.p+"static/image/f6fc8ba0f76250b4e27c8a14432065be.795b4453.webp",u=s.p+"static/image/e3603dd5f8931a7617164ded915048e8.5855a8a6.webp",b=s.p+"static/image/949c70eb9a9a77d2a1e39b1d57f4537b.1ead1d8a.webp",f=s.p+"static/image/5df570c5209993592f1d1680a608eb38.aba3912b.webp",g=s.p+"static/image/bfd9e9569b7542ec54f9115ef5ed9c0c.55619a3a.webp",v=s.p+"static/image/7539de516988e3c4d3331c14aac05f31.788e8dfe.webp",A=s.p+"static/image/1eb2f81c2e4a3cd28a2d4b33b055009b.660ce1f7.webp",k=s.p+"static/image/bd32bee2ba78bec125bf120664b36759.656d2d8f.webp",E=s.p+"static/image/b7627fda8523daf3c8334d7d138f05a3.f89f256b.webp",w=s.p+"static/image/f0afa1aba07097c3fc2429cfae3a7196.d72cedc8.webp",M=s.p+"static/image/1aed4797da3620aeefb7a43418816d47.d5d9aab7.webp",F=s.p+"static/image/cea32de984e6631380bb6487c5afa69b.92f55e1b.webp",U=s.p+"static/image/ef4435a2d1e7baea8123eded3c2bb173.e6cb23e0.webp",D=s.p+"static/image/a9ede97135ad14e4797be676d4e84253.c8b2f16f.webp",B=s.p+"static/image/7974be554d0d2fa26d8058c4cfaf7729.fb84d9d7.webp",P=s.p+"static/image/7cb87fbea761e70f50feb41805dd245a.68698f14.webp";function C(e){let c=Object.assign({h1:"h1",a:"a",p:"p",ul:"ul",li:"li",img:"img",code:"code",h2:"h2",strong:"strong"},(0,n.ah)(),e.components);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(c.h1,{id:"6webpack-的-sourcemap-配置",children:["6.Webpack 的 sourcemap 配置",(0,a.jsx)(c.a,{className:"header-anchor","aria-hidden":"true",href:"#6webpack-的-sourcemap-配置",children:"#"})]}),"\n",(0,a.jsx)(c.p,{children:"上节我们学习了什么是 sourcemap，这还不够，webpack 对 sourcemap 做了很多封装。"}),"\n",(0,a.jsx)(c.p,{children:"想彻底掌握 sourcemap，还要搞懂 webpack 的 sourcemap 配置。"}),"\n",(0,a.jsx)(c.p,{children:"webpack 的 sourcemap 配置是比较麻烦的，比如这两个配置的区别："}),"\n",(0,a.jsxs)(c.ul,{children:["\n",(0,a.jsx)(c.li,{children:"eval-nosources-cheap-module-source-map"}),"\n",(0,a.jsx)(c.li,{children:"hidden-source-map"}),"\n"]}),"\n",(0,a.jsx)(c.p,{children:"是不是分不清楚？"}),"\n",(0,a.jsx)(c.p,{children:"其实它是有规律的。"}),"\n",(0,a.jsx)(c.p,{children:"你把配置写错的时候，webpack 会提示你一个正则："}),"\n",(0,a.jsx)(c.p,{children:(0,a.jsx)("img",{src:P,alt:""})}),"\n",(0,a.jsx)(c.p,{children:(0,a.jsx)(c.code,{children:"^(inline-|hidden-|eval-)?(nosources-)?(cheap-(module-)?)?source-map$"})}),"\n",(0,a.jsx)(c.p,{children:"这个就是配置的规律，是几种基础配置的组合。"}),"\n",(0,a.jsx)(c.p,{children:"搞懂了每一种基础配置，比如 eval、nosources、cheap、module，按照规律组合起来，也就搞懂了整体的配置。"}),"\n",(0,a.jsx)(c.p,{children:"那这每一种配置都是什么意思呢？"}),"\n",(0,a.jsx)(c.p,{children:"我们分别来看一下。"}),"\n",(0,a.jsxs)(c.p,{children:["(可以用",(0,a.jsx)(c.a,{href:"https://github.com/QuarkGluonPlasma/fe-debug-exercize/tree/main/react-source-debug",target:"_blank",rel:"noopener noreferrer",children:"后面一节的项目代码"}),"来测试)"]}),"\n",(0,a.jsxs)(c.h2,{id:"eval",children:["eval",(0,a.jsx)(c.a,{className:"header-anchor","aria-hidden":"true",href:"#eval",children:"#"})]}),"\n",(0,a.jsx)(c.p,{children:"eval 的 api 是动态执行 JS 代码的。比如："}),"\n",(0,a.jsx)(c.p,{children:(0,a.jsx)("img",{src:B,alt:""})}),"\n",(0,a.jsx)(c.p,{children:"但有个问题，eval 的代码打不了断点。"}),"\n",(0,a.jsx)(c.p,{children:"怎么解决这个问题呢？"}),"\n",(0,a.jsx)(c.p,{children:"浏览器支持了这样一种特性，只要在 eval 代码的最后加上 //# sourceURL=xxx，那就会以 xxx 为名字把这段代码加到 sources 里。那不就可以打断点了么？"}),"\n",(0,a.jsx)(c.p,{children:"比如这样："}),"\n",(0,a.jsx)(c.p,{children:(0,a.jsx)("img",{src:D,alt:""})}),"\n",(0,a.jsxs)(c.p,{children:["执行以后，你会发现 sources 多了",(0,a.jsx)(c.code,{children:"光.js"}),"的文件："]}),"\n",(0,a.jsx)(c.p,{children:(0,a.jsx)("img",{src:U,alt:""})}),"\n",(0,a.jsx)(c.p,{children:"它是可以打断点的，比如在 add 里打个断点，然后再执行 eval。"}),"\n",(0,a.jsx)(c.p,{children:"你会发现它断住了！"}),"\n",(0,a.jsx)(c.p,{children:(0,a.jsx)("img",{src:F,alt:""})}),"\n",(0,a.jsx)(c.p,{children:"除了指定 source 文件外，还可以进一步指定 sourcemap 来映射到源码："}),"\n",(0,a.jsx)(c.p,{children:(0,a.jsx)("img",{src:M,alt:""})}),"\n",(0,a.jsx)(c.p,{children:"这样，动态 eval 的代码也能关联到源码，并且能打断点了！"}),"\n",(0,a.jsx)(c.p,{children:"webpack 就利用了 eval 这个特性来优化的 sourcemap 生成的性能，比如你可以指定 devtool 为 eval："}),"\n",(0,a.jsx)(c.p,{children:(0,a.jsx)("img",{src:w,alt:""})}),"\n",(0,a.jsx)(c.p,{children:"生成的代码就是每个模块都被 eval 包裹的，并且有 sourceUrl 来指定文件名："}),"\n",(0,a.jsx)(c.p,{children:(0,a.jsx)("img",{src:E,alt:""})}),"\n",(0,a.jsx)(c.p,{children:"这样有啥好处呢？"}),"\n",(0,a.jsx)(c.p,{children:"快呀，因为只要指定个文件名就行，不用生成 sourcemap。sourcemap 的生成还是很慢的，要一个个 mapping 的处理，做编码之类的。"}),"\n",(0,a.jsx)(c.p,{children:"每个模块的代码都被 eval 包裹，那么执行的时候就会在 sources 里生成对应的文件，这样就可以打断点了："}),"\n",(0,a.jsx)(c.p,{children:(0,a.jsx)("img",{src:k,alt:""})}),"\n",(0,a.jsx)(c.p,{children:"不过这样只是把每个模块的代码分了出去，并没有做源码的关联，如果相关联源码，可以再开启 sourcemap："}),"\n",(0,a.jsx)(c.p,{children:(0,a.jsx)("img",{src:A,alt:""})}),"\n",(0,a.jsx)(c.p,{children:"你会发现生成的代码也是用 eval 包裹的，但除了 sourceUrl 外，还有 sourceMappingUrl："}),"\n",(0,a.jsx)(c.p,{children:(0,a.jsx)("img",{src:v,alt:""})}),"\n",(0,a.jsx)(c.p,{children:"再运行的时候除了 eval 的代码会生成文件放在 sources 外，还会做 sourcemap 的映射："}),"\n",(0,a.jsx)(c.p,{children:(0,a.jsx)("img",{src:g,alt:""})}),"\n",(0,a.jsx)(c.p,{children:"webpack 的 sourcemap 的配置就利用了浏览器对 eval 代码的调试支持。"}),"\n",(0,a.jsx)(c.p,{children:"所以为什么这个配置项不叫 sourcemap 而叫 devtool 呢？"}),"\n",(0,a.jsx)(c.p,{children:"因为不只是 sourcemap 呀，eval 的方式也行。"}),"\n",(0,a.jsx)(c.p,{children:"再来看下一个基础配置："}),"\n",(0,a.jsxs)(c.h2,{id:"source-map",children:["source-map",(0,a.jsx)(c.a,{className:"header-anchor","aria-hidden":"true",href:"#source-map",children:"#"})]}),"\n",(0,a.jsx)(c.p,{children:"source-map 的配置是生成独立的 sourcemap 文件："}),"\n",(0,a.jsx)(c.p,{children:(0,a.jsx)("img",{src:f,alt:""})}),"\n",(0,a.jsx)(c.p,{children:(0,a.jsx)("img",{src:"data:image/webp;base64,UklGRg4PAABXRUJQVlA4IAIPAAAwTACdASo2AZ4APp1InUslpCKhpbM7+LATiU3fj5MU3GbdhPb7bmBfAd90YDr+yT+p7zAOcp+5HqA/YD1av8Z+4HuP9AD/Af5nrOPQv/cL05v2m+Fn+zf9/0mdWW8a/4Xtb/13hX49/g3tf62WV/r31LPk/3R/T+U3fb8bdQ78c/l3+i3gnU/ML9tvsn/U8STUmyAP5l/X/S//J+Fd6b7AH8a/03qz/337Ueej6l/ab4Dul3+63sKHO+1Cmtql9VJmq6KEX5t9VPn26h1xOOE+TN3Weyvv65fVABlu+PWtTgzZCOsrElCUZzdXjK8BJGpPt1DriggyAwct5CQ9OmJ/FvlaS6+bPYR68gmvuodcG6siSJFZXZitLQaiyCy8DvNInG3DUzw5gGZnLDeOWKyYEM3C0Pzi3ftVU/vyflr+mudmZ26tuE2mE3W23Ok4ZpPoYfWtbIeSVwfJX4QqQTX3B4ObKhs6KR/hsLRlCWJr3vVcP8CqWXMomY8MLz7FiJDVNPDwmmWcNrnKEH7lrpTW5hcRQSBpX+Ri3BfY//UgY4zCO6oUgJ71xphNZeDrCc+6O80icbcys0mxnX7+jBmSf7HFC+Ds0vihGsZEpI4mKiCmkAu2ZaYO6fWiN5Vv2gt3R5vaHnR82X6yXyPEkU1IeNvfqNsjYvwjoe/3jw9zOb3N2R7Ps4ZFmytF8nG9fld+EkQzZe75tqABhTyxwMEVrNPx1xL0qOhA7CBy/UAg5mEDXLbWmghlzsxH9iI2GW8hLdRe5lxX5oWJ7LArWpU/3IS83Xv3rSM/6ey86sSUt/0A8jZdicKwbqAA/v3vdn5ltZ9VMFDiVN2bMEsAlLt7XuDbkiaPXClav3wTkVkqRSn38mizyTXwaVJk7rGLf5HvIryB4W0yc8G677y1f3CxKqgSKhRKnJOTpcK/jWyx9MDm72/Snck4xI4bPw6GMVlHP48+dzIkBfOG54lowCiZyrol/lD8nHTlLaj8EAyrxbE6psrw8sEWh3fichFK7ijrUAdtUgJxN3A1dR6AOt5d6Ct/sTD+DfWLaaX+wQdNVP9cDxn3VqUBUEFVZyY553eE4sp87fSiMh1efzAyZyrZnMtZGdjHF91VsdGrOLfLzl4Q7973Al7yOFEvoVe1axGbmO9D+myjCx5/IGxJMeQhuUM7uAu3d3JOLoDDE0pc+cDWKZ0htLq1E5R4WmfmQ0xKuDWqXSj64MLHFm8jEVzs7MDkb+Lg0soi5BMToSPtsQRl3roaMENVGU7ZgH7pmwyId9ZZgAQAGcUaaMnQah05xjKUjHgQ3jVpk1x3PEjthdXj4jVAjneIQoMWEj0u+E1IB41g3ScnSBWln47gbf+IZ4DLK/qpXi1UMROZBkB3ode8zI/CPe6sM0QMGh+ATsvqcXnb+FtXvGXW7NhtFc1Zjf+Fdk29ZzJsm3rPq82aRo2OuTwERdyn+C6DHLsyZaSMEGccdoAbcH9tJkVGTBnAB7C1syrAA9ha2ZVgAewtc3LrB/51aTl5PPzopuzQHh3cKyMOhRntvUFbpFwiIATD42JWSamps4YU3EJPAweINOMWX/N6kh0j4npf8k7QvQQqk8xClu9v7nWdl+Fua9/7d0gjiQPFjId2jQos4A5YVc35Nrkv1FCrZ/V4wMRI+aZOyHO/e4cuQmnjNRR/Xxsi8l5g9gHqT11vcZ9jdDquMLpmQRMqme676nk+nG5CjyBU9viHsOGW/sDzPBLvMbfPE3nTDSKmLlUgAQ2/04Skif1+3Y+F3rWx8c2lxlEvylk7c9+IU5oNn5AmhdHIzGd/hs/ELkjR9aEC7dUG4Qr1QgCn6jFNdcTO3tzAImDmbr5B3azzqrFuw6/QXpT/K8mLGnlCfwFynszTGFW2c1sp+A4mBIH26k3gFqLHgDiHk55LxackgJONzLhNVSIuAIAur70sULav2bBI/vh0rB9K6MXcAu48oleDFj55RUPwv3lFvG9nHQK3bUY4PgjCLSHfbQPWYYIUyKxTch7eA7sN4jNCbXezGPx3lSL0stMRKCPAKJNC3ts9wD7Vf4ypgRxc2QEy4IN4tp3ZeKphL9vSW7sY6+Ca0DomT/ooXOnkj50pUJw+xyrlzIUB+mlwS3XkeqvAIA29ePgKExnCc2uqcVzba/YJP3CKS+sGVb+hptwAB5defoRVFTIVVrzOBtpgGjOx3cQHgDpPVfZ8YWMesykren8+pdbuzjLQy+fMmvVDBZknn5BmELxa1Un6AgBxKC9sQ3Ees+M7elJNw5fSFkOijzxCngqhoWU7vPpShyCu9iqIgTsd6pF03xK6DGlAYpAknt//8Jg6j6A1dMhAWMfgQKiQwbrZ2AIA84LKBavfVoFfg9qIZYI7T8t0cN/5c+/lWIXvtegipcshdQlCaIbn8f8ElOk6PTHAOjtzZ3Lmj1D38nYrMJmXpOftAwtBY+gO3vNs63I5ISNaDq06K2+T51ElBXgFYF+EKP5Sb6P7qtBBkt2sogBhJwKBZJLK32CDb5TvBlgcEI7DNfzJ81dhVK9nQreV12vRg/31fly7EGde1Y2Bsg+nxjAB2CSRKkEZDdpqiH2u1UNjk7mC+Mt9biutWlnvDMSZwXOL6aRFpQ7LlorJWzrHGid18iuLkdN7PCqnX0Tf1pu9eFM1XcLmU4RuGWUtUeFzEHbOeKzl0X7FG1tmhgGGnL1lpPsGIRnU5Zf9Np8OJd/lo2yZXz5YB10itRyAJ4VnkXx3pQe7ORfR8cx4Zlx7VapkzLTu8d2sMLbNwytuNdfDseuaskP7DT/kt+WKtsXYCu538EXJMKSFwCYkB0H3lK2DYrKUhtTXHmfbubarSyFXVmddjj1/gFQIUYjyUFGyLKTQe11F5JWQayU2xR05u5652T1i3j7gay4pzfoNNWXpwpMWvkOnXEGqLqAaL+F1WmqptK+EfQMsNmop7ctaLFXFi2Uj6TsE9mzE2uItgSarMM8uhrF1hwPHr4i5romvpItRJtd9xPwYnE+a6Pli+ttuRxBeZTGs6mqy0ggfr5S/UQ/QfnoEoW0FcsDjNpuEuHJ9xx98jPEuk7fudCCu9PlaW9S4XM/2TDE+SqdcyeTQq21TNMo7mWOB1OftQ94W5ln+vq4cDfvCWVs3z61mDruek5p1klEFKuAqs6K4z5YIF3zD++sZk58x9KABJhUjzMExULrJbZnIkBvi48vCNYx7idaCWDM53wUvog3+bYyEsr0cSrbM3SHu/2xbAHCzzf/E2le0iSzXIDfI/tOPYzFylxi6CP8USM9GKM+h8V+7sLTP63yFQn4rimGfFdzgLbnif39xOYg6srGnelzeb9wI4xIM5SmBORpnpy5FkcAJTOtxOh//kV6mS+zoqONKiJSuHRRMcOu2ycuebSZcelD1ncIaTo/EnTDXqxMrN1WQGrUwKbYfTgRUBhnpvzb1ve1QjSvvs/Ht6tp/S0v8Fzjcrhzuyz5TKp4S3+3CcgKHy514ERCPG/4N637APiqqVcCMLR13xHn8qD0lOZmrsvu7bK42V5Ldx1OM1Jgxl7LBd1Sa2N2YMepIgAgcgao4tbfFpFVt+yi0em3oaT0cf8URX4brCzQCpt5C0H33JdU5b7GHWoTn0N43gNNbvyxQVygqfI+wDNe1e7baXT59914iu60Id8i6CgJ8TDulRHATEqEuF8ojlYO2+a/iChJk8MZx72UgFCdacTNpM1kGJjcKpyo018KyVccHYldk4ivpaIw+H5D2YowsL0qp9sL8pqlZXhTFhxg0RxPx7S9kBK9QA1yqsCljJSfDnmzWeOgXXUnitYJeXHB2rzusXyLscF/6wE04kXLpCvgb0EnQZq03lcsmrD6A4/O7UOClnatobI4n/pbYhKKa5h8dD7T6h8+FupUnFogl5JMuvKKrEhxCo/pC2JESx7PcrbXmfrn2398vGZNYqtE/DyM4OigKELXSZHBsRu1HZD/uv7MF09Zri4H1zL/G005TnjR6RrBN26999I8FUZVHKX+Sc9aNOOWmIMWo0rp7n6V2Oy4FHyoGjtfVPdY7u3ltnjd/0yO54qYFf9HV3gfHlbwuspAxy6iHuE7l4N3k9fgOVDqTW4DUNaM4CHC4t3lJRUUxei+rHpbgtpruSsXKP7z7cxnsxOoLIss488J09MEh+QE9n8ph/EoMUgsvlC8/IPsbfzTpmYKEFueMiK03uhCB3XQ+GL6TpOjj4OtfL1lqlnxpDcBugeu1YpFrU6pEBqktgex1iXN2vTm2HMZxQ9v9r0Xe0v6gbFjtTUdnBmgPbONkh3xusu4g3Z4Bcb5z3FJty0QWP1xcdVrNB5H8dx7ANUAKD2QqbwWMrYND2V1eNZBs0S+kQ8ONrOBaZH2k0Sn+HBfvo3twbEAZLk3kWuQ+oAcUGNlJTId1k/SHWPH86a0zBItDPxh1BRp/nD5giCi4Nn/DW8O9HaJKfr2BC+tOtAuzm1JkHb/K3WZjqKw67QS+sE9ORzi/frOr2LaAsWFZ2r18tDP5THJpdpGWCj3Hq37fknBUSBwvD5yOtrbGCxAb0baMZvfczoJM/CFy32hdbexlgYN8Zfd1gITMPDWe/KBtf4SslKowDkw/vz/6LPfEv6kVfD9P4jyRios/Af66K9v6bi+7MWMoztJix1vg/fl+mo3iwgjl/0W01+P+9qFuBy05xOAfOY5tpRXF1poNv4zTsqM8pxk83fMr5ny0BnksgpzBJQikhXhqs+gkFnp2UdVI+jYVMiLHqO9nKE9ipShl4M+7Fu/J+rF9WBWtom+V4xF00KaSB3J4MdRT7EolXbCfjIIblLsK7dAuUlydj1UfG9DbQ/IxTA2wka/JmxEajxHp+ooqiEYzSdlxU17JzwpQAjATPUzF86KBtb4D6hvX0z27NoGjGmE2sh+4wLjitUjMPvSea1DoIRvGOiqosANHqm9rjYqkx4jGsH05EIlEkech4OuK13SrMjOPjNcpYd0uGl65eTwybEvu7P9ezXJyrFCt3PTXN6gP6EmHpsnepTAaxl7pSq3KpGdLE75qp25RjcriBQLxe5MjFHjl1GBzQkeF89JPbld42gl0BqPzb/QQhd2o9WXtsUi9MuqFtzfJBAAAAA==",alt:""})}),"\n",(0,a.jsx)(c.p,{children:(0,a.jsx)("img",{src:b,alt:""})}),"\n",(0,a.jsx)(c.p,{children:"可以关联，也可以不关联，比如加上 hidden，就是生成 sourcemap 但是不关联："}),"\n",(0,a.jsx)(c.p,{children:(0,a.jsx)("img",{src:u,alt:""})}),"\n",(0,a.jsx)(c.p,{children:(0,a.jsx)("img",{src:m,alt:""})}),"\n",(0,a.jsx)(c.p,{children:"生产环境就不需要关联 sourcemap，但是可能要生成 sourcemap 文件，把它上传到错误管理平台之类的，用来映射线上代码报错位置到对应的源码。"}),"\n",(0,a.jsx)(c.p,{children:"此外，还可以配置成 inline 的："}),"\n",(0,a.jsx)(c.p,{children:(0,a.jsx)("img",{src:j,alt:""})}),"\n",(0,a.jsx)(c.p,{children:"这个就是通过 dataUrl 的方式内联在打包后的文件里："}),"\n",(0,a.jsx)(c.p,{children:(0,a.jsx)("img",{src:x,alt:""})}),"\n",(0,a.jsx)(c.p,{children:"这几个配置还是很好懂的，我们来看下一个基础配置："}),"\n",(0,a.jsxs)(c.h2,{id:"cheap",children:["cheap",(0,a.jsx)(c.a,{className:"header-anchor","aria-hidden":"true",href:"#cheap",children:"#"})]}),"\n",(0,a.jsx)(c.p,{children:"sourcemap 慢主要是处理映射比较慢，很多情况下我们不需要映射到源码的行和列，只要精确到行就行，这时候就可以用 cheap。"}),"\n",(0,a.jsx)(c.p,{children:"不精确到列能提升 souremap 生成速度，但是会牺牲一些精准度："}),"\n",(0,a.jsx)(c.p,{children:(0,a.jsx)("img",{src:t,alt:""})}),"\n",(0,a.jsx)(c.p,{children:"我们再来看下一个基础配置："}),"\n",(0,a.jsxs)(c.h2,{id:"module",children:["module",(0,a.jsx)(c.a,{className:"header-anchor","aria-hidden":"true",href:"#module",children:"#"})]}),"\n",(0,a.jsx)(c.p,{children:"webpack 中对一个模块会进行多次处理，比如经过 loader A 做一次转换，再用 loader B 做一次转换，之后打包到一起。"}),"\n",(0,a.jsx)(c.p,{children:"每次转换都会生成 sourcemap，那也就是有多个 sourcemap："}),"\n",(0,a.jsx)(c.p,{children:(0,a.jsx)("img",{src:o,alt:""})}),"\n",(0,a.jsx)(c.p,{children:"默认 sourcemap 只是能从 bundle 关联到模块的代码，也就是只关联了最后那个 sourcemap。"}),"\n",(0,a.jsx)(c.p,{children:(0,a.jsx)("img",{src:h,alt:""})}),"\n",(0,a.jsx)(c.p,{children:"那如果你想调试最初的源码怎么办呢？"}),"\n",(0,a.jsx)(c.p,{children:"那就把每一次的 loader 的 sourcemap 也关联起来，这就是 module 配置的作用。这样就能一次性映射回最初的源码："}),"\n",(0,a.jsx)(c.p,{children:(0,a.jsx)("img",{src:l,alt:""})}),"\n",(0,a.jsx)(c.p,{children:"当你想调试最初的源码的时候，module 的配置就很有用了。"}),"\n",(0,a.jsx)(c.p,{children:"接下来还有最后一个基础配置："}),"\n",(0,a.jsxs)(c.h2,{id:"nosources",children:["nosources",(0,a.jsx)(c.a,{className:"header-anchor","aria-hidden":"true",href:"#nosources",children:"#"})]}),"\n",(0,a.jsx)(c.p,{children:"sourcemap 里是有 sourceContent 部分的，也就是直接把源码贴在这里，这样的好处是根据文件路径查不到文件也可以映射，但这样会增加 sourcemap 的体积。"}),"\n",(0,a.jsx)(c.p,{children:"如果你确定根据文件路径能查找到源文件，那不生成 sourceContent 也行。"}),"\n",(0,a.jsx)(c.p,{children:"比如 devtool 配置为 source-map，生成的 sourcemap 是这样的："}),"\n",(0,a.jsx)(c.p,{children:(0,a.jsx)("img",{src:i,alt:""})}),"\n",(0,a.jsx)(c.p,{children:"当你加上 nosources 之后，生成的 sourcemap 就没有 sourceContent 部分了："}),"\n",(0,a.jsx)(c.p,{children:(0,a.jsx)("img",{src:p,alt:""})}),"\n",(0,a.jsx)(c.p,{children:"sourcemap 文件大小会小很多。"}),"\n",(0,a.jsx)(c.p,{children:"基础配置讲完了，接下来就是各种组合了，这个就比较简单了，就算组合错了，webpack 也会提示你应该按照什么顺序来组合。"}),"\n",(0,a.jsx)(c.p,{children:"它是按照这个正则来校验的：^(inline-|hidden-|eval-)?(nosources-)?(cheap-(module-)?)?source-map$"}),"\n",(0,a.jsx)(c.p,{children:"不知道有没有同学会觉得这样写比较麻烦，能不能每个基础配置用 true、false 的方式配置呢？"}),"\n",(0,a.jsx)(c.p,{children:"确实可以，有这样一个插件： SourceMapDevToolPlugin"}),"\n",(0,a.jsx)(c.p,{children:"它有很多 option，比如 module、columns、noSources 等："}),"\n",(0,a.jsx)(c.p,{children:(0,a.jsx)("img",{src:d,alt:""})}),"\n",(0,a.jsx)(c.p,{children:"相当于是 devtool 的另一种配置方式，启用它需要把 devtool 设置为 false。"}),"\n",(0,a.jsx)(c.p,{children:"而且它可以控制更多东西，比如修改 sourcemap 的 url 和文件名等："}),"\n",(0,a.jsx)(c.p,{children:(0,a.jsx)("img",{src:r,alt:""})}),"\n",(0,a.jsx)(c.p,{children:"当你需要做更多的 sourcemap 生成方式的控制的时候，可以使用这个 webpack 插件。"}),"\n",(0,a.jsxs)(c.h2,{id:"总结",children:["总结",(0,a.jsx)(c.a,{className:"header-anchor","aria-hidden":"true",href:"#总结",children:"#"})]}),"\n",(0,a.jsx)(c.p,{children:"想要彻底搞懂 sourcemap，还需要掌握 webpack 的 sourcemap 配置。"}),"\n",(0,a.jsx)(c.p,{children:"webpack 的 sourcemap 配置比较麻烦，但也是有规律的。"}),"\n",(0,a.jsx)(c.p,{children:"它是对一些基础配置按照一定顺序的组合，理解了每个基础配置，知道了怎么组合就理解了各种 devtool 配置。"}),"\n",(0,a.jsxs)(c.ul,{children:["\n",(0,a.jsxs)(c.li,{children:[(0,a.jsx)(c.strong,{children:"eval"}),"：浏览器 devtool 支持通过 sourceUrl 来把 eval 的内容单独生成文件，还可以进一步通过 sourceMappingUrl 来映射回源码，webpack 利用这个特性来简化了 sourcemap 的处理，可以直接从模块开始映射，不用从 bundle 级别。"]}),"\n",(0,a.jsxs)(c.li,{children:[(0,a.jsx)(c.strong,{children:"cheap"}),"：只映射到源代码的某一行，不精确到列，可以提升 sourcemap 生成速度"]}),"\n",(0,a.jsxs)(c.li,{children:[(0,a.jsx)(c.strong,{children:"source-map"}),"：生成 sourcemap 文件，可以配置 inline，会以 dataURL 的方式内联，可以配置 hidden，只生成 sourcemap，不和生成的文件关联"]}),"\n",(0,a.jsxs)(c.li,{children:[(0,a.jsx)(c.strong,{children:"nosources"}),"：不生成 sourceContent 内容，可以减小 sourcemap 文件的大小"]}),"\n",(0,a.jsxs)(c.li,{children:[(0,a.jsx)(c.strong,{children:"module"}),"： sourcemap 生成时会关联每一步 loader 生成的 sourcemap，可以映射回最初的源码"]}),"\n"]}),"\n",(0,a.jsx)(c.p,{children:"理解了这些基础配置项，根据 ^(inline-|hidden-|eval-)?(nosources-)?(cheap-(module-)?)?source-map$ 的规律来进行组合，就可以实现各种需求下的 sourcemap 配置。"}),"\n",(0,a.jsx)(c.p,{children:"当然，这种 sourcemap 配置还不够细致，比如 sourcemap 的 url 怎么生成，文件名是什么。如果想对这些做配置，可以关掉 devtool，启用 SourceMapDevToolPlugin 来配置。"}),"\n",(0,a.jsx)(c.p,{children:"虽然 webapck 的 sourcemap 配置方式比较多，但最底层也就是浏览器支持的文件级别的 sourcemap 还有 eval 代码的 source 映射和 sourcemap 这两种机制。其余的方式都是基于这两种机制的封装。"}),"\n",(0,a.jsx)(c.p,{children:"理解了 webpack 封装出的基础配置，知道了组合规则，就可以应对各种需求的 sourcemap 配置。"})]})}function O(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:c}=Object.assign({},(0,n.ah)(),e.components);return c?(0,a.jsx)(c,{...e,children:(0,a.jsx)(C,{...e})}):C(e)}let y=O;O.__RSPRESS_PAGE_META={},O.__RSPRESS_PAGE_META["%E5%89%8D%E7%AB%AF%E8%B0%83%E8%AF%95%E9%80%9A%E5%85%B3%E7%A7%98%E7%B1%8D%2F6.Webpack%20%E7%9A%84%20sourcemap%20%E9%85%8D%E7%BD%AE.md"]={toc:[{text:"eval",id:"eval",depth:2},{text:"source-map",id:"source-map",depth:2},{text:"cheap",id:"cheap",depth:2},{text:"module",id:"module",depth:2},{text:"nosources",id:"nosources",depth:2},{text:"总结",id:"总结",depth:2}],title:"6.Webpack 的 sourcemap 配置",headingTitle:"6.Webpack 的 sourcemap 配置",frontmatter:{}}}}]);