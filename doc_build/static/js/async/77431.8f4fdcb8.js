"use strict";(self.webpackChunkjue_jin_book_press=self.webpackChunkjue_jin_book_press||[]).push([["77431"],{976467:function(n,e,i){i.r(e),i.d(e,{default:()=>l});var d=i(552676),s=i(740453);function t(n){let e=Object.assign({h1:"h1",a:"a",p:"p",h2:"h2",img:"img",code:"code",pre:"pre",h3:"h3",br:"br"},(0,s.ah)(),n.components);return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(e.h1,{id:"9服务器接收客户端请求并返回-h5-页面",children:["9服务器接收客户端请求，并返回 H5 页面",(0,d.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#9服务器接收客户端请求并返回-h5-页面",children:"#"})]}),"\n",(0,d.jsx)(e.p,{children:"在前几节中，我们讲解了客户端与服务器端数据的交互及图片的上传加载，这一节将讲解 H5 页面的请求及加载。"}),"\n",(0,d.jsx)(e.p,{children:"在 App 客户端的设计中，一般的公司都会要求两个端，分别为 Android 和 iOS 端。如果是客户端负责页面的生成，那 Android 端和 iOS 端都将分别做重复的工作，另一个问题是，可能由于开发人员不一样，页面的设计有出入。现在主流的思想会倾向于使用 H5 嵌入客户端当中，H5 文件存放在服务器端，客户端只负责请求并加载。这样就给服务器端提出了一个问题：如何将服务器上的 H5 文件返回给客户端？本小节将解答这个问题。"}),"\n",(0,d.jsxs)(e.h2,{id:"调用逻辑",children:["调用逻辑",(0,d.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#调用逻辑",children:"#"})]}),"\n",(0,d.jsx)(e.p,{children:"在第 6 小节的讲解中，用户的信息已注册并写入数据库，这一小节中，我们将模拟该用户登录请求，并在登录成功后，返回 App 首页（即本小节预设的 H5 页面）。下面是本小节涉及的请求流程图。"}),"\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.img,{src:"https://user-gold-cdn.xitu.io/2018/4/15/162c75200f75aacc?w=708&h=635&f=png&s=27319",alt:""})}),"\n",(0,d.jsxs)(e.p,{children:["由于我们需要通过浏览器代替 App 客户端进行用户注册请求模拟，此次客户端请求将使用 GET 方法。请求进入服务器端的 ",(0,d.jsx)(e.code,{children:"main.py"})," 后，将调用 ",(0,d.jsx)(e.code,{children:"url_router"})," 转发到 ",(0,d.jsx)(e.code,{children:"users_url.py"})," 中，在 ",(0,d.jsx)(e.code,{children:"users_urls.py"})," 中，对应的 URL 将调用 ",(0,d.jsx)(e.code,{children:"users_views.py"})," 的 ",(0,d.jsx)(e.code,{children:"LoginHandle"}),"  类。",(0,d.jsx)(e.code,{children:"LoginHandle"}),"  为真正的代码处理逻辑，在校验用户信息正确的情况下，返回 ",(0,d.jsx)(e.code,{children:"index.html"})," 页面给客户端，客户端加载该页面。"]}),"\n",(0,d.jsxs)(e.h2,{id:"服务器端实现",children:["服务器端实现",(0,d.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#服务器端实现",children:"#"})]}),"\n",(0,d.jsxs)(e.p,{children:["由上面的调用逻辑图可知，我们将从 ",(0,d.jsx)(e.code,{children:"main.py"})," 开始修改，由于在第 6 小节中， ",(0,d.jsx)(e.code,{children:"main.py"})," 针对 ",(0,d.jsx)(e.code,{children:"users"})," 的路由已配置，这里 ",(0,d.jsx)(e.code,{children:"main.py"})," 不需要修改。接下来修改 ",(0,d.jsx)(e.code,{children:"users_url.py"}),"，在 ",(0,d.jsx)(e.code,{children:"users_url.py"})," 中增加 ",(0,d.jsx)(e.code,{children:"LoginHandle"})," 的调用，添加如下两行。"]}),"\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.img,{src:"https://user-gold-cdn.xitu.io/2018/4/15/162c7a800ee5ed2f?w=595&h=290&f=png&s=10318",alt:""})}),"\n",(0,d.jsx)(e.p,{children:"完整代码如下："}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-python",children:"#! /usr/bin/python3\n# -*- coding:utf-8 -*-\n\n\nfrom __future__ import unicode_literals\nfrom .users_views import (\n    RegistHandle,\n    LoginHandle\n)\n\nurls = [\n    #从/users/regist过来的请求，将调用users_views里面的RegistHandle类\n    (r'regist', RegistHandle),\n    (r'login', LoginHandle)\n]\n"})}),"\n",(0,d.jsxs)(e.p,{children:["接下来，添加真正的代码处理，修改 ",(0,d.jsx)(e.code,{children:"users_views.py"}),"，增加 ",(0,d.jsx)(e.code,{children:"LoginHandle"})," 类代码如下："]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-python",children:'class LoginHandle(tornado.web.RequestHandler):\n    """handle /user/regist request\n    :param phone: users sign up phone\n    :param password: users sign up password\n    """\n    \n    @property\n    def db(self):\n        return self.application.db\n        \n    def get(self):\n        try:\n            #获取入参\n            phone = self.get_argument( "phone" )\n            password = self.get_argument( "password" )\n        except:\n            #获取入参失败时，抛出错误码及错误信息\n            logger.info("LoginHandle: request argument incorrect")\n            http_response(self, ERROR_CODE[\'1001\'], 1001)\n            return \n        \n        #从数据库 Users 表查找入参中的 phone 是否存在    \n        ex_user = self.db.query(Users).filter_by(phone=phone).first()\n        if ex_user:\n            #如果手机号已存在，返回首页 H5 页面 index.html\n            logger.debug( "LoginHandle: get user login: %s" %phone )\n            self.render( "index.html" )\n            self.db.close()\n            return\n        else:\n            #用户不存在，提示用户未注册\n            http_response( self, ERROR_CODE[\'1003\'], 1003 )\n            self.db.close()\n            return\n'})}),"\n",(0,d.jsxs)(e.p,{children:["这里的新增错误码 ",(0,d.jsx)(e.code,{children:"1003"})," 表示用户未注册，需在配置文件中添加此错误码，编辑 ",(0,d.jsx)(e.code,{children:"base.py"})," 增加如下代码："]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-python",children:'"1003": "用户尚未注册，请先注册",\n'})}),"\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.img,{src:"https://user-gold-cdn.xitu.io/2018/4/22/162eb107c1edd1e1?w=556&h=172&f=png&s=8902",alt:""})}),"\n",(0,d.jsxs)(e.p,{children:["至此，服务器端的代码逻辑已基本完成，现在唯一缺少的就是 ",(0,d.jsx)(e.code,{children:"index.html"})," 这个文件。"]}),"\n",(0,d.jsxs)(e.h2,{id:"h5-页面代码",children:["H5 页面代码",(0,d.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#h5-页面代码",children:"#"})]}),"\n",(0,d.jsx)(e.p,{children:"由于本小册的重点并不是讲解 H5，这里请读者直接按照指导将 H5 涉及的代码输入服务器端，本小册不做另外的讲解。"}),"\n",(0,d.jsxs)(e.h3,{id:"新增-indexhtml-文件",children:["新增 index.html 文件",(0,d.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#新增-indexhtml-文件",children:"#"})]}),"\n",(0,d.jsxs)(e.p,{children:["进入 “templates” 目录，创建并编辑 ",(0,d.jsx)(e.code,{children:"index.html"})," 文件，输入如下代码："]}),"\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.img,{src:"https://user-gold-cdn.xitu.io/2018/4/15/162c75a1b09eb2d5?w=907&h=184&f=png&s=21218",alt:""})}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-HTML",children:'<!DOCTYPE html>\n<html>\n<head>\n    <meta charset="UTF-8" />\n    <title>css网页布局</title>\n    <link rel="stylesheet" href="../static/css/index.css">\n</head>\n<body>\n\x3c!--整体到部分，左到右，上到下--\x3e\n    \x3c!--头部--\x3e\n    <div class="header">\n        <div class="logo">\n            <ul>\n                <li>DEMO</li>\n            </ul>\n        </div>\n        <div class="nav">\n            <ul>\n                <li>About</li>\n            </ul>\n        </div>\n    </div>\n    \x3c!--主体--\x3e\n    <div class="main">\n        <div class="top">\n            <img src="../static/image/index/index.jpg" alt="topimg">\n        </div>\n        \x3c!--遮罩层--\x3e\n        <div class="topplayer"></div>\n        \x3c!--最上层的内容--\x3e\n        <div class="topplayer-top">\n            <div class="word">MY DEMO H5</div>\n        </div>\n        <div class="middle">\n            <div class="m-top">\n                <div class="demo-layer demo1">\n                    <img src="../static/image/index/1.jpg" alt="DEMO1">\n                    <div class="demo">DEMO1</div>\n                </div>\n                <div class="demo-layer demo1">\n                    <img src="../static/image/index/2.jpg" alt="DEMO2">\n                    <div class="demo">DEMO2</div>\n                </div>\n                <div class="demo-layer demo3">\n                    <img src="../static/image/index/3.jpg" alt="DEMO3">\n                    <div class="demo">DEMO3</div>\n                </div>\n                <div class="clear"></div>\n            </div>\n            <div class="m-middle">\n                "Life is like riding a bicycle. To keep your balance, you must keep moving."\n            </div>\n            <div class="m-bottom">\n                <div class="m-com">\n                    <img src="../static/image/index/4.jpg" alt="4.jpg">\n                    <div class="demo4">Cool Demo</div>\n                    <div class="demo5">Make it cool</div>\n                </div>\n                <div class="m-com">\n                    <img src="../static/image/index/5.jpg" alt="5.jpg">\n                    <div class="demo4">Great Demo</div>\n                    <div class="demo5">Make it great</div>\n                </div>\n                <div class="m-com">\n                    <img src="../static/image/index/6.jpg" alt="6.jpg">\n                    <div class="demo4">Wonderful Demo</div>\n                    <div class="demo5">Make it wonderful</div>\n                </div>\n            </div>\n        </div>\n    </div>\n</body>\n</html>\n'})}),"\n",(0,d.jsxs)(e.h3,{id:"新增-indexcss-文件",children:["新增 index.css 文件",(0,d.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#新增-indexcss-文件",children:"#"})]}),"\n",(0,d.jsxs)(e.p,{children:["进入 “static/css” 目录，创建并编辑 ",(0,d.jsx)(e.code,{children:"index.css"})," 文件，输入如下代码："]}),"\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.img,{src:"https://user-gold-cdn.xitu.io/2018/4/15/162c75a6be8f0e49?w=980&h=163&f=png&s=19497",alt:""})}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-css",children:'* {\n    margin: 0;\n    padding: 0;\n}\n.header {\n    width: 100%;\n    height: 100px;\n}\n.header img {\n    width: 300px;\n    height: 85px;\n    padding-left: 100px;\n    padding-top: 8px;\n}\n.header .logo {\n    float: left;\n    margin-top: 40px;\n    margin-left: 40px;\n}\n.header .nav {\n    float: right;\n}\n.header .nav ul {\n    margin-right: 20px;\n}\n.header .nav ul li {\n    float: left;\n    list-style: none;\n    width: 80px;\n    height: 100px;\n    line-height: 100px;\n    color: #7d7d7d;\n    font-size: 15px;\n    font-weight: bolder;\n}\n.main .top {\n    width: 100%;\n    height: 600px;\n}\n.main .top img {\n    width: 100%;\n    height: 600px;\n}\n.main .topplayer {\n    position: absolute;\n    top: 100px;\n    background: #000000;\n    width: 100%;\n    height: 600px;\n    opacity: 0.5; /* 透明度 */\n}\n.main .topplayer-top {\n    width: 500px;\n    height: 300px;\n    position: absolute;\n    top: 400px;\n    margin-top: -150px;\n    z-index: 2;\n    right: 50%;\n    margin-right: -250px;\n}\n.main .topplayer-top .word {\n    padding-top: 100px;\n    color: #ffffff;\n    font-size: 45px;\n    font-weight: bolder;\n    text-align: center;\n    font-family: "微软雅黑";\n}\n.main .topplayer-top button {\n    width: 200px;\n    height: 60px;\n    margin-top: 50px;\n    color: #ffffff;\n    background: #f5704f;\n    font-family: 微软雅黑;\n    text-align: center;\n    font-weight: bolder;\n    font-size: 14px;\n    border-radius: 8px; /* 圆角 */\n    margin-left: 150px;\n}\n.main .middle {\n    width: 1000px;\n    margin: 0 auto;\n}\n.main .middle .m-top .demo-layer {\n    float: left;\n    width: 33.3%;\n    padding-top: 50px;\n    text-align: center;\n}\n.main .middle .m-top .demo-layer img {\n    width: 100px;\n    height: 100px;\n}\n.main .middle .m-top .demo-layer .demo {\n    font-size: 20px;\n    color: #7d7c7f;\n    font-weight: bold;\n    padding-top: 20px;\n}\n.main .middle .m-middle {\n    font-size: 25px;\n    color: #000000;\n    font-weight: bold;\n    padding-top: 50px;\n    text-align: center;\n    padding-bottom: 50px;\n}\n.clear {\n    clear: both;\n}\n.main .middle .m-bottom .m-com {\n    float: left;\n    padding: 10px;\n    text-align: center;\n    font-weight: bold;\n    font-size: 20px;\n}\n.main .middle .m-bottom .m-com img {\n    width: 310px;\n    height: 260px;\n}\n.main .middle .m-bottom .demo4 {\n    padding-top: 20px;\n    color: #7d7d7f;\n}\n.main .middle .m-bottom .demo5 {\n    padding-top: 10px;\n    color: #bdbdbc;\n}\n.main .bottom {\n    width: 1000px;\n    margin: 0 auto;\n}\n.footer {\n    width: 100%;\n    height: 100px;\n    text-align: center;\n    line-height: 100px;\n    background: #292c35;\n    color: white;\n    font-family: "微软雅黑";\n    font-size: 15px;\n}\n'})}),"\n",(0,d.jsxs)(e.h3,{id:"上传-h5-页面图片",children:["上传 H5 页面图片",(0,d.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#上传-h5-页面图片",children:"#"})]}),"\n",(0,d.jsxs)(e.p,{children:["进入 “static/image” 目录，创建 ",(0,d.jsx)(e.code,{children:"index"})," 文件夹，上传 H5 页面图片。"]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{children:"mkdir index\ncd index/\nrz -be\n"})}),"\n",(0,d.jsxs)(e.p,{children:["具体如下图所示：\n",(0,d.jsx)(e.img,{src:"https://user-gold-cdn.xitu.io/2018/4/15/162c75aca938c399?w=898&h=202&f=png&s=24452",alt:""})]}),"\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.img,{src:"https://user-gold-cdn.xitu.io/2018/4/15/162c75b0998b006b?w=743&h=217&f=png&s=20033",alt:""})}),"\n",(0,d.jsx)(e.p,{children:"至此，H5 的页面准备工作已结束， 服务器端的代码已全部完成。接下来将测试请求是否成功。"}),"\n",(0,d.jsxs)(e.h3,{id:"客户端请求-h5-页面",children:["客户端请求 H5 页面",(0,d.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#客户端请求-h5-页面",children:"#"})]}),"\n",(0,d.jsxs)(e.p,{children:["由于 App 客户端嵌入 H5 页面和手机浏览器直接打开 H5 页面的效果一样，这里在手机的浏览器中直接输入请求 URL 进行测试，URL 为：\n",(0,d.jsx)(e.code,{children:"http://150.109.33.132:8000/users/login?phone=18866668888&password=demo123456"}),"。请求成功后，可以看到加载的效果如下："]}),"\n",(0,d.jsxs)(e.h2,{id:"代码下载",children:["代码下载",(0,d.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#代码下载",children:"#"})]}),"\n",(0,d.jsxs)(e.p,{children:["到目前为止，服务器端代码及图片如下：",(0,d.jsx)(e.br,{}),"\n",(0,d.jsx)(e.a,{href:"https://github.com/Jawish185/demo10.git",target:"_blank",rel:"noopener noreferrer",children:"demo10"})]}),"\n",(0,d.jsxs)(e.h2,{id:"小结",children:["小结",(0,d.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#小结",children:"#"})]}),"\n",(0,d.jsx)(e.p,{children:"这一小节中，我们探讨了为什么建议客户端嵌套 H5 页面，并完成了客户端向服务器端请求 H5 页面的整个代码逻辑学习过程，希望读者能触类旁通，提高产品上线效率。"})]})}function r(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}=Object.assign({},(0,s.ah)(),n.components);return e?(0,d.jsx)(e,{...n,children:(0,d.jsx)(t,{...n})}):t(n)}let l=r;r.__RSPRESS_PAGE_META={},r.__RSPRESS_PAGE_META["%E5%9F%BA%E4%BA%8E%20Python%20%E8%BD%BB%E6%9D%BE%E8%87%AA%E5%BB%BA%20App%20%E6%9C%8D%E5%8A%A1%E5%99%A8%2F9%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%8E%A5%E6%94%B6%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%AF%B7%E6%B1%82%EF%BC%8C%E5%B9%B6%E8%BF%94%E5%9B%9E%20H5%20%E9%A1%B5%E9%9D%A2.md"]={toc:[{text:"调用逻辑",id:"调用逻辑",depth:2},{text:"服务器端实现",id:"服务器端实现",depth:2},{text:"H5 页面代码",id:"h5-页面代码",depth:2},{text:"新增 index.html 文件",id:"新增-indexhtml-文件",depth:3},{text:"新增 index.css 文件",id:"新增-indexcss-文件",depth:3},{text:"上传 H5 页面图片",id:"上传-h5-页面图片",depth:3},{text:"客户端请求 H5 页面",id:"客户端请求-h5-页面",depth:3},{text:"代码下载",id:"代码下载",depth:2},{text:"小结",id:"小结",depth:2}],title:"9服务器接收客户端请求，并返回 H5 页面",headingTitle:"9服务器接收客户端请求，并返回 H5 页面",frontmatter:{}}}}]);