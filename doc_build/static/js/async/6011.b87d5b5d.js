"use strict";(self.webpackChunkjue_jin_book_press=self.webpackChunkjue_jin_book_press||[]).push([["6011"],{428025:function(e,n,r){r.r(n),r.d(n,{default:()=>S});var s=r(552676),i=r(740453);let c=r.p+"static/image/0d4d6e9ffb9645ceefa60b580c216e44.5466c7bb.webp",a=r.p+"static/image/9c643f420f16fbb668896b7908b3c3bf.73cf04fd.webp",t=r.p+"static/image/9e2efdcb1d06686506dfe1c7f6e495e0.85f1021b.webp",A=r.p+"static/image/b5a6316c81ab3c1c8d19d93411a13166.18f0fb55.webp",l=r.p+"static/image/6b7a329fc4712db866a9c27d592d574a.b4ce058e.webp",d=r.p+"static/image/113346fc4229d44119de62b1700c2839.03f85c74.webp",g=r.p+"static/image/ff7a1f056c2227b308f425cd8733aac7.735d4ce3.webp",p=r.p+"static/image/1faf8b77f45eca070dff52edb13a86b1.412a48c6.webp",j=r.p+"static/image/4d51fd37c6ed86e33027daf610f1bada.54e84b0d.webp",h=r.p+"static/image/bbbd842cb26a36486322c63e00aa3d8c.3b2ae11b.webp",o=r.p+"static/image/ee663c324f2e0b5a9d6a163980ed8917.a963e5ab.webp",x=r.p+"static/image/e413361867156bd423a94bd0ab69fb1a.e2ba573d.webp",u=r.p+"static/image/11ef9517f94c32ba1750f437e909c73f.167d4740.webp",m=r.p+"static/image/85f5a218e98004528ba70092ae636589.2b348c26.webp",f=r.p+"static/image/307587d7f7e9bcb6478c17d730003bc4.dfbc2e2f.webp",y=r.p+"static/image/402468b61aa46be05e6bac7da9198526.61845a85.webp",w=r.p+"static/image/59f4276440c2e7038b84f0a6465ef92e.3c93ea35.webp",b=r.p+"static/image/59ed63e64b18c21e1041b26f0e2ffcc5.dafb2127.webp",P=r.p+"static/image/8444b9f14235bd7884efdde85c648120.d63ce41c.webp";function E(e){let n=Object.assign({h1:"h1",a:"a",p:"p",h2:"h2",strong:"strong",pre:"pre",code:"code",img:"img"},(0,i.ah)(),e.components);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.h1,{id:"13真实案例说明类型编程的意义",children:["13.真实案例说明类型编程的意义",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#13真实案例说明类型编程的意义",children:"#"})]}),"\n",(0,s.jsx)(n.p,{children:"我们学了类型编程的各种套路，写了很多高级类型，也学了 TypeScript 内置的高级类型，对类型编程这一块算是有一定程度的掌握了。"}),"\n",(0,s.jsx)(n.p,{children:"那么类型编程在实际开发中会用到么？它的意义是什么呢？这节我们就通过一些案例来说明类型编程有什么用。"}),"\n",(0,s.jsxs)(n.h2,{id:"类型编程的意义",children:["类型编程的意义",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#类型编程的意义",children:"#"})]}),"\n",(0,s.jsx)(n.p,{children:"ts 基础是学习怎么给 js 代码声明各种类型，比如索引类型、函数类型、数组类型等，但是如果需要动态生成一些类型，或者对类型做一些变化呢？"}),"\n",(0,s.jsxs)(n.p,{children:["这就是类型编程做的事情了，",(0,s.jsx)(n.strong,{children:"类型编程可以动态生成类型，对已有类型做修改。"})]}),"\n",(0,s.jsx)(n.p,{children:"类型编程是对类型参数做一系列运算之后产生新的类型。需要动态生成类型的场景必然会用到类型编程，比如返回值的类型和参数的类型有一定的关系，需要经过计算才能得到。"}),"\n",(0,s.jsx)(n.p,{children:"有的情况下不用类型编程也行，比如返回值可以是一个字符串类型 string，但用了类型编程的话，可能能更精确的提示出是什么 string，也就是具体的字符串字面量类型，那类型提示的精准度自然就提高了一个级别，体验也会更好。"}),"\n",(0,s.jsxs)(n.p,{children:["这就是类型编程的意义：",(0,s.jsx)(n.strong,{children:"需要动态生成类型的场景，必然要用类型编程做一些运算。有的场景下可以不用类型编程，但是用了能够有更精准的类型提示和检查。"})]}),"\n",(0,s.jsx)(n.p,{children:"我们还是通过例子来说明："}),"\n",(0,s.jsxs)(n.h2,{id:"parsequerystring",children:["ParseQueryString",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#parsequerystring",children:"#"})]}),"\n",(0,s.jsx)(n.p,{children:"前面我们实现了一个复杂的高级类型 ParseQueryString，用到了提取、构造、递归的套路。"}),"\n",(0,s.jsx)(n.p,{children:"这么复杂的高级类型能用在哪里呢？有什么意义呢？想必很多同学都有疑问，那么我们就先聊一下这个高级类型的应用场景。"}),"\n",(0,s.jsx)(n.p,{children:"首先，我们写一个 JS 函数，实现对 query string 的 parse，如果有同名的参数就合并，大概实现是这样的："}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"function parseQueryString(queryStr) {\n    if (!queryStr || !queryStr.length) {\n        return {};\n    }\n    const queryObj = {};\n    const items = queryStr.split('&');\n    items.forEach(item => {\n        const [key, value] = item.split('=');\n        if (queryObj[key]) {\n            if(Array.isArray(queryObj[key])) {\n                queryObj[key].push(value);\n            } else {\n                queryObj[key] = [queryObj[key], value]\n            }\n        } else {\n            queryObj[key] = value;\n        }\n    });\n    return queryObj;\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"这种逻辑大家写的很多，就不过多解释了："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:P,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"如果要给这个函数加上类型，大家会怎么加呢？"}),"\n",(0,s.jsx)(n.p,{children:"大部分人会这么加："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:b,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"参数是 string 类型，返回值是 parse 之后的对象类型 object。"}),"\n",(0,s.jsx)(n.p,{children:"这样是可以的，而且 object 还可以写成 Record<string, any>，因为对象是索引类型（索引类型就是聚合多个元素的类型，比如对象、class、数组都是）。"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:w,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"Record 前面介绍过，是 TS 内置的一个高级类型，会通过映射类型的语法来生成索引类型："}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"type Record<K extends string | number | symbol, T> = { \n    [P in K]: T;\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"比如传入 'a' | 'b' 作为 key，1 作为 value，就可以生成这样索引类型："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:"data:image/webp;base64,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",alt:""})}),"\n",(0,s.jsx)(n.p,{children:"所以这里的 Record<string, any> 也就是 key 为 string 类型，value 为任意类型的索引类型，可以代替 object 来用，更加语义化一点："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:y,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"但是不管是返回值类型为 object 还是 Record<string, any> 都存在一个问题：返回的对象不能提示出有哪些属性："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:"data:image/webp;base64,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",alt:""})}),"\n",(0,s.jsx)(n.p,{children:"对于习惯了 ts 的提示的同学来说，没有提示太不爽了。怎么能让这个函数的返回的类型有提示呢？"}),"\n",(0,s.jsx)(n.p,{children:"这就要用到类型编程了。"}),"\n",(0,s.jsx)(n.p,{children:"我们把函数的类型定义改成这样："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:f,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"声明一个类型参数 Str，约束为 string 类型，函数参数的类型指定是这个 Str，返回值的类型通过对 Str 做类型运算得到，也就是 ParseQueryString<Str>。"}),"\n",(0,s.jsx)(n.p,{children:"这个 ParseQueryString 的类型做的事情就是把传入的 Str 通过各种类型运算产生对应的索引类型。"}),"\n",(0,s.jsx)(n.p,{children:"这样返回的类型就有提示了："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:m,alt:""})}),"\n",(0,s.jsxs)(n.p,{children:["这里最好通过函数重载的方式来声明类型，不然返回值可能和 ParseQueryString"," 的返回值类型匹配不上，需要 as any 才行，那样比较麻烦。"]}),"\n",(0,s.jsx)(n.p,{children:"这里的 ParseQueryString 就是前面实现的那个高级类型，在这里可以用来实现更精准的类型提示，这就是类型体操的意义。"}),"\n",(0,s.jsx)(n.p,{children:"这个类型的实现思路可以看顺口溜那节，就不赘述了："}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"type ParseParam<Param extends string> = \n    Param extends `${infer Key}=${infer Value}`\n        ? {\n            [K in Key]: Value \n        } : Record<string, any>;\n\ntype MergeValues<One, Other> = \n    One extends Other \n        ? One\n        : Other extends unknown[]\n            ? [One, ...Other]\n            : [One, Other];\n\ntype MergeParams<\n    OneParam extends Record<string, any>,\n    OtherParam extends Record<string, any>\n> = {\n  readonly [Key in keyof OneParam | keyof OtherParam]: \n    Key extends keyof OneParam\n        ? Key extends keyof OtherParam\n            ? MergeValues<OneParam[Key], OtherParam[Key]>\n            : OneParam[Key]\n        : Key extends keyof OtherParam \n            ? OtherParam[Key] \n            : never\n}\n\ntype ParseQueryString<Str extends string> = \n    Str extends `${infer Param}&${infer Rest}`\n        ? MergeParams<ParseParam<Param>, ParseQueryString<Rest>>\n        : ParseParam<Str>;\n\nfunction parseQueryString<Str extends string>(queryStr: Str): ParseQueryString<Str> ;\nfunction parseQueryString(queryStr: string) {\n    if (!queryStr || !queryStr.length) {\n        return {};\n    }\n    const queryObj:Record<string, any> = {};\n    const items = queryStr.split('&');\n    items.forEach(item => {\n        const [key, value] = item.split('=');\n        if (queryObj[key]) {\n            if(Array.isArray(queryObj[key])) {\n                queryObj[key].push(value);\n            } else {\n                queryObj[key] = [queryObj[key], value]\n            }\n        } else {\n            queryObj[key] = value;\n        }\n    });\n    return queryObj;\n}\n\n\nconst res = parseQueryString('a=1&b=2&c=3');\n"})}),"\n",(0,s.jsx)(n.p,{children:"这里的实现和之前那个还是有一些区别的，主要是这里："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:u,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"当提取 a=1 中的 key 和 value，构造成索引类型的时候，如果提取不出来，之前返回的是空对象，现在改成了 Record<string, any>。"}),"\n",(0,s.jsx)(n.p,{children:"因为 ParseQueryString 是针对字符串字面量类型做运算的，如果传入的不是字面量类型，而是 string，那就会走到这里，如果返回空对象，那取它的任何属性都会报错。"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:x,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"所以要把不满足条件时返回的类型改为 Record<string, any>："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:o,alt:""})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://www.typescriptlang.org/play?ts=4.5.0-beta#code/C4TwDgpgBACghgJwM4XguBbAPGzUIAewEAdgCZJRLAICWJA5gHxQC8UAUFN7InocXKUABgBIA3vQBmEBFADSEEAF9WE6bKgA1OABsArhGXCuPMwH4o402dtQA2vKj0FSgLoAubXsOc73ZSgvACUIAGMAewQyLGo6RgAaKDgSECYAbg4OUEgoAFlZBggdAwgkLAB5EggkiuAAC1kWdhsoKugBUgo2hs1Wizbq-p4vOsa5TqEofRIAaxIIgHcSezdhu0t7dqSAOj2x2TX-Wy8t6trehDdM7PBoAoQi3Axy1vbn-CIuylDI6NiaPQGEkUmkEm9Lh9Jt1flEYnEgSDUkwOM0rKYEBA4GQIiRdCAHIoCS5ZkoIlJBqg+BgoAAfKCkkDknrjZ6ePw8ImfQTdRnM97U9ZQSxc6GUPkUg4IZ5CgYPIolQzlAXoDCOdwXVnU9UgNwo45mUbVZ46o7+Lyir5TCUs2QfWU8SxSk1Etwcg1BKDVABusg4yiyOWgaBQAEVDAgQABlQGMLAxiZW7oIxho1oJ7nfKBiSQkGRyZ7KABk6jzmlC1GMQss8qpqvKIbrmBw1KYSUb4dk0djDCwFeATH15t4yCb2ATGSyUhmYWAtFxUDAiDDEe78V7GbFVB7TAAFABHVcJrwJgCUXg7R578ZoLEy05Is-nJEXy4gncjCaBB6vCC8KYYU90TMWgKV3ABCQ8uwzWl6Ug38dl0UgGAaIDrGOTFgH0BAX3EZRMjMAMzEiEhqCgKDIwqAAjAArDxYX+ACkTSNgrHw1oSLI2hiBeViKLXHYkDAXRuN3AByIsxNPAieG4iAXh2KQogAUTgMJ6l3OSaVYFh0P8TjgAcRkkm9HwIDddgtME4TRLE1gpJkuxQKgH8u2omj7EZNw0IdbhQN3ABBBB0BAHZaCQIKQtcyjaM89xTx8j07H49y4t1HYwH0JANNM0ppN8qBAggXQUGApKzBS2KvNY+xKo8ryTLMs0PSI-wipK6A9I9Oq0osqBcsMRzbFagJ8rMTDsJfOrMgDLIDKgTFKHYJdRw-NdvzEuBWAARiLKjWAAJiLMJWAAZgcjggA",target:"_blank",rel:"noopener noreferrer",children:"试一下"})}),"\n",(0,s.jsx)(n.p,{children:"对比下用类型编程和不用类型编程的体验："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:"data:image/webp;base64,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",alt:""})}),"\n",(0,s.jsx)(n.p,{children:"vs"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:"data:image/webp;base64,UklGRtwIAABXRUJQVlA4INAIAACQMgCdASpuAW4APp1MokulpCMhpNFaCLATiWdu4XPxB0FsDM2j7rev+hzbwc71ppHoAdKr/k8mk82dlf+m8J/F/70ka0n+F3enwArfnZoZv/hvQC9XPs3/I8EzUg7zeaj+oXtN/qvAGoB/yz+5/8z2Wf7r/1eXr6x9gj9gx2S+tTU217aKetEUUfSJJnwZ9pNlzEyGQ2W5esvfvaXUyucImcWK9q3IxEVG8QJOkITfYmHR7wtFS+VAJBN6LvOEoCPLciWU4vzmgpqIo4Ks0KPoZVT9aEl3XD9fcb8LwQkczgoW5CvCJdqVof1OAFtwIdHD0ERjRG7V33MbzdZGfo+6Qm3mytO7bP7Sce8/SIFYwQP9fZaXdPFiJy6IvRg2qK3RL9sepsA8+PiTBkiJzxJAJeBcARoOrjNOK8JJ+MpzHxHW+Vs+AQ6ePiNd3gqPlbPgEOnj4jrfK2USk6hMBEiexoPgDUHxJBoEuk87wVdIow+4CP3A7t+801VJTtB7Gg+AiRPUF2ExFyDi4HAiZv5xOGH5XsZJ6530/iNwAAD+/u6rvr9gspdzXdWZuLOvYUcmo5xDtaOH12TJlD8QXhUeh7S9FCUq0PMZavM7wq5EnUjU70H68EVT2+X5A3OjG4CAFC7vpaM79ATAJtw5lOzC1x9zeoy+YxdycBrbCjV58IEBm+IUYjc41JPoCvwGXEhn0dStDLVA+RDmg7a/7l6ZdL/yjLa5XDccqH2fn33vamrxro35j4dkCE58zA+yOHs4mwIsNzy9gMxp3nF5EHaE6MmAymFrfq2IfSnpc0O1LAhCFUlnar6vAbk7N/NhvVj1luS6scfo2bN0KvryGzGh5CqCnnN2tJZH817WAUT4qBJmZsCrc0SyEnhvqmTnhk7X4fhwaL2qb1J+WiipOjwACt9wADnGXz+HJqxQXbBbK0z5eY89c5NXYTI3pjUnXsiaEbT8h3ZN4wmsBWCTUTtrCUoOGT7ERD315cxjj0bzRetA/tqhjkLphtSOAOFsEAdCXwu9LFVYkgdA7GxLPhQdN/DwSdmqDXPj62B7ksiy8tlAojeJ9wng07HVe9TOLDYsN+ETgrexafEZpVz6q7Vk7BytCNi2HZzhr51JfiYvoSJofMV1RVEAg+qtpkiCSD0TVIzZYfl19w6wPXdcbbJLMZaDdMwM9N1OP89fNs6C82z506DfeswVDlYGMnfeZhPysju34m0dhpKdGRtlzQhubjfBXHNe4lHkOH80D4RjqWMWdpH0uwyylJMir9sWBXOsmTHmyMnlgCPOwjvvUwXjnXcGzQIP+cEGed71K0VUvyGgVY0c/OQjmV/9svXAypR0ZVjHCQ+2TyJFE/fJJ524wrejc65DJXlb+PxP4NfhckeqDZZgL3jetXnHjQFu88tQbAkir/Cq4opUJyLyvdJ9DIz49Kbgk6MKLNwmnn/N1SPb8LNZ/94QgGmmbm9EsG59XZlTv3YLDv7xbZMIeSjYvGj8nsJD3xG2ZwpnSaC5FN2iaU3aZVJjFvhZJ/IFFQP5swZNINIW86AfR47+mBDKNy3oPk1qYCcEWJknbGOJZp7OAqsHDGqqLPNEDRN1oMpu6VX7WLSOtJSr7babhHdM5MrHXe7fQ5MTF/KHwhw4kcSISSJy24vzIApHYjtzfp9b04Jz1BfxNqMu4sNiL9MTphY4MQPzlboOZmLm5DfuDr3A+3py7UGB7sTNwQ0VwAEjE93dZgvf+HY/jKwXN62hj2+0zeJoB0q+/r5Z+ficK2tYhkJltIt0Ouf8PSN/4htz80YmpWZernGjnfSRMVsMGwfgAkza8sY+y+ZeVCre3D2gwpJVhCgM+jhYG45Yg2bVFk4RAPPjGgHSBqKkdTBfc4xvxDd8NXCBx53Fhz7llWF8DBoUeNe+MALS+nzYDLVKnGtQh2CqGhgHIkjbtyegnvsAo+/vBskC4MBO1pk4vY78doz7GECq+/1zAvlQbjgjgfkEg8CZWuDdK4VSyVUN1RKoIi6SkZYuX24OFhu4cP1htJerznVwFZU3En/jOep3y2ukyGcTQeO6VPx8sCxXZrlHIePTht0ixApEddDNfl3ThphzRcra7ouH1cG5BK/ef0QHYEp84I0qDtaIRACwjG8SqkaWq4LA0/lOljQnEpvOCLlc90dn0f1vjSVMULJ9ME6bb0cQuLRTbtCK2LrHhfQtJ+vnNC1TOUc39pO8WhMkC6oR19Z4wtAZwfT2U3g6fpzHDB8ffmGaDkMZ0yUGGKknCRebrZv8EjKEfwif0vYHVQF8ZwAA6BagGzCmMsyZuihlrg8KEFnY7o5Zo4cHKN/3NpccW3nL/34tAXa/tRK5RMg6A4CB94FqBNj0otF9JCpctsIin0Lk9dtvjT+vvo1l03UUpg6xHBlhlJ0vdeXY7Zonwo4UR1p1zBqPcH0nNuOYD9OErvWrJXaKjoK0vRY6OWg7ci8reVw0RKneloGVguYg4GNJMwXqPYkmwAzF/7AYHsk6r9im1u0m4Bq3AqasMvKnCVBHWh93Wd2frlJYb9dR3Z3pB5SsQzBlj/pC5HeHwcTeufE6QtfGtU8wKaSADknKEWoyzVQpWWX14WwKiBFaTbAmlXrvGLSkai+nKXMz+g6DM561rDR/cA95uW75voPF3YtWMSj83NbMcoO0nQeFLiU/IsNdykV93Qx+oSePu71q6MHdR38ATw93jQMECkg+jeWqGtzk4eZK6aMNrub+FGuDrhKLasM5WOE4VOMumJUEn2/CrT5yFxQgx6qoHoSf9H9+L3jektp3b602rEkOclZmSfaDvpEOe5eM2MJHbDRLyD/hTtp5oNDv1t1BXRSlGp0gdXT9lOhltYU5mQYUNaY1v+dfLa8CqkYIbGxtewgk//X8/N94Bo1YGn82OhAV8smr99ilBLVZuZ/wcc6BRi59fO+LXSUKhyP+B5njXp8h2gr922LRtFhcXRSsjtA6MEfvge5cOsVV5fOEgTvyDdxF5iegb7wAAAA=",alt:""})}),"\n",(0,s.jsx)(n.p,{children:"这就是类型体操的意义之一：实现更精准的类型提示和检查。"}),"\n",(0,s.jsxs)(n.h2,{id:"promiseall",children:["Promise.all",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#promiseall",children:"#"})]}),"\n",(0,s.jsx)(n.p,{children:"前面提到过，需要动态生成类型的场景，必然会用到类型编程，我们来看个例子。"}),"\n",(0,s.jsx)(n.p,{children:"Promise 的 all 和 race 方法的类型声明是这样的："}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"interface PromiseConstructor {\n    all<T extends readonly unknown[] | []>\n        (values: T): Promise<{\n            -readonly [P in keyof T]: Awaited<T[P]>\n        }>;\n\n    race<T extends readonly unknown[] | []>\n        (values: T): Promise<Awaited<T[number]>>;\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"因为 Promise.all 是等所有 promise 执行完一起返回，Promise.race 是有一个执行完就返回。返回的类型都需要用到参数 Promise 的 value 类型："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:h,alt:""})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:j,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"所以自然要用类型编程来提取出 Promise 的 value 的类型，构造成新的 Promise 类型。"}),"\n",(0,s.jsx)(n.p,{children:"具体来看下这两个类型定义："}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"interface PromiseConstructor {\n    all<T extends readonly unknown[] | []>\n        (values: T): Promise<{\n            -readonly [P in keyof T]: Awaited<T[P]>\n        }>;\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"类型参数 T 是待处理的 Promise 数组，约束为 unknown[] 或者空数组 []。"}),"\n",(0,s.jsx)(n.p,{children:"这个类型参数 T 就是传入的函数参数的类型。"}),"\n",(0,s.jsx)(n.p,{children:"返回一个新的数组类型，也可以用映射类型的语法构造个新的索引类型（class、对象、数组等聚合多个元素的类型都是索引类型）。"}),"\n",(0,s.jsx)(n.p,{children:"新的索引类型的索引来自之前的数组 T，也就是 P in keyof T，值的类型是之前的值的类型，但要做下 Promise 的 value 类型提取，用内置的高级类型 Awaited，也就是 Awaited<T[P]>。"}),"\n",(0,s.jsx)(n.p,{children:"同时要把 readonly 的修饰去掉，也就是 -readonly。"}),"\n",(0,s.jsx)(n.p,{children:"这就是 Promise.all 的类型定义。因为返回值的类型和参数的类型是有关联的，所以必然会用到类型编程。"}),"\n",(0,s.jsx)(n.p,{children:"Promise.race 的类型定义也是这样："}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"interface PromiseConstructor {\n    race<T extends readonly unknown[] | []>\n        (values: T): Promise<Awaited<T[number]>>;\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"类型参数 T 是待处理的参数的类型，约束为 unknown[] 或者空数组 []。"}),"\n",(0,s.jsx)(n.p,{children:"返回值的类型可能是传入的任何一个 Promise 的 value 类型，那就先取出所有的 Promise 的 value 类型，也就是 T[number]。"}),"\n",(0,s.jsx)(n.p,{children:"因为数组类型也是索引类型，所以可以用索引类型的各种语法。"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:p,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"用 Awaited 取出这个联合类型中的每一个类型的 value 类型，也就是 Awaited<T[number]>，这就是 race 方法的返回值的类型。"}),"\n",(0,s.jsx)(n.p,{children:"同样，因为返回值的类型是由参数的类型做一些类型运算得到的，也离不开类型编程。"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://www.typescriptlang.org/play?ts=4.5.0-beta#code/JYOwLgpgTgZghgYwgAgApQPYFtgGcIDCGIuYUArgmBlMgN4BQyzycANmwDwAqyEAHpBAATXMigQ4w4mwCeyciADWIDAHcQAbQC6yAD7IdAPiYszACgBu7chFwAuZNwCUj9NjwROjM75YBaCSkZeU1UZFBkJQhZDBgnbUcAQTU4YEhhHjDtEz9mAF8jAG4GU2YoRC9eASFRcUlpEDkFZVUNHX1DHLLfKxs7Rxc3TBx8ThS0jKyQciwAI2gc4oZ80uEIBDY4CWQEYlJkAAcRz2GPfCISMkpqKBKGPavWDgAlO2QAXiOT-AA6djY5jCPwgvwkuAwbEsEHMAEZnAAaNAgsF2SHQ8wAJkRyPOoPB6JhAGZnNpnPdHgcKkg3mIvsc8WDKkD3KN8WioTD4UjWZ5URDOVicby-gTBSSyfcwLJDihwZ9DCKvLCjAilZxMar1USjNpNDN5osSkA",target:"_blank",rel:"noopener noreferrer",children:"试一下"})}),"\n",(0,s.jsx)(n.p,{children:"这里 T 的类型约束为什么是 unknown[] | [] 也要专门讲一下："}),"\n",(0,s.jsx)(n.p,{children:"ts 里有个 as const 的语法，加上之后，ts 就会推导出常量字面量类型，否则推导出对应的基础类型："}),"\n",(0,s.jsx)(n.p,{children:"没有 as const 时："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:g,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"加上 as const 后："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:d,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"没有 as const 时："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:l,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"加上 as const 后："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:A,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"这里类型参数 T 是通过 js 函数的参数传入的，然后取 typeof，也会遇到 as const 的这个问题，约束为 unknown[] | [] 就是 as const 的意思。"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:t,alt:""})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:a,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"这个地方确实比较特殊，要记一下。"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://www.typescriptlang.org/play?ts=4.5.0-beta#code/CYUwxgNghgTiAEAzArgOzAFwJYHtXw0IB4AVeEADwxFWAGd44pg8IBPeNAa1RwHdUAbQC6APgAUANygRkIOgC54JAJRKSAbgBQWsHjoZG8+AF4ChcYICMAGngAmOwGZhK7TtCRYCFOmx5zDHtScioaeiNmVg5uXgEReAAfeBEJaVl5dTVldz1UAyM6e1NA+0tbB2dXXP1DHAAjACsSgG8teA74KCUrLQBfHQw2AAcEBsaSEYQzIdGcRHhxmvy6puKzNs6unv6uhjyDd1mxpsnR9YIp+cW15YLYGBLrG0cXQamumBgz6cu5hYed0MDwuz1ewj28AOGCOHwePwux2uII0QA",target:"_blank",rel:"noopener noreferrer",children:"试一下"})}),"\n",(0,s.jsxs)(n.h2,{id:"currying",children:["currying",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#currying",children:"#"})]}),"\n",(0,s.jsx)(n.p,{children:"做了一个参数类型和返回值类型有关系的案例，再来看一个更复杂点的："}),"\n",(0,s.jsx)(n.p,{children:"有这样一个 curring 函数，接受一个函数，返回柯里化后的函数。"}),"\n",(0,s.jsx)(n.p,{children:"也就是当传入的函数为："}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"const func = (a: string, b: number, c: boolean) => {};\n"})}),"\n",(0,s.jsx)(n.p,{children:"返回的函数应该为："}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"(a: string) => (b: number) => (c: boolean) => void\n"})}),"\n",(0,s.jsx)(n.p,{children:"JS 怎么实现不用关注，我们只关注这个 curring 函数的类型怎么定义："}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"declare function currying(fn: xxx): xxx;\n"})}),"\n",(0,s.jsx)(n.p,{children:"明显，这里返回值类型和参数类型是有关系的，所以要用类型编程。"}),"\n",(0,s.jsx)(n.p,{children:"传入的是函数类型，可以用模式匹配提取参数和返回值的类型来，构造成新的函数类型返回。"}),"\n",(0,s.jsx)(n.p,{children:"每有一个参数就返回一层函数，具体层数是不确定的，所以要用递归。"}),"\n",(0,s.jsx)(n.p,{children:"那么，这个类型的定义就是这样的："}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"type CurriedFunc<Params, Return> = \n    Params extends [infer Arg, ...infer Rest]\n        ? (arg: Arg) => CurriedFunc<Rest, Return>\n        : never;\n\ndeclare function currying<Func>(fn: Func): \n    Func extends (...args: infer Params) => infer Result ? CurriedFunc<Params, Result> : never;\n"})}),"\n",(0,s.jsx)(n.p,{children:"curring 函数有一个类型参数 Func，由函数参数的类型指定。"}),"\n",(0,s.jsx)(n.p,{children:"返回值的类型要对 Func 做一些类型运算，通过模式匹配提取参数和返回值的类型，传入 CurriedFunc 来构造新的函数类型。"}),"\n",(0,s.jsx)(n.p,{children:"构造的函数的层数不确定，所以要用递归，每次提取一个参数到 infer 声明的局部变量 Arg，其余参数到 infer 声明的局部变量 Rest。"}),"\n",(0,s.jsx)(n.p,{children:"用 Arg 作为构造的新的函数函数的参数，返回值的类型继续递归构造。"}),"\n",(0,s.jsx)(n.p,{children:"这样就递归提取出了 Params 中的所有的元素，递归构造出了柯里化后的函数类型。"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:c,alt:""})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://www.typescriptlang.org/play?ts=4.5.0-beta#code/C4TwDgpgBAwgrgJwQSwgEwGJwHYGMA8ACgIYLEC2AzgDRQBKEwi2AfFALxQBQUvUJZKlAgAPYBGxpKUANrJsAMwgIoAQQQBzWgDpd8pSoaVgAXR58LAfigAKUhoBcazQEoObeElSYcBI8FoGJgRWcwteJ2wIADdlAG4uLjQIXAAbUmgFX2BkAHtsKFxEBBB5DXwsPBYbBWwnStwXJzCoBuExCSlbXW17Sid9ZX5SCko3djZBwwhKOFTgKGtPFHQGohGqQJm54DZImPjE3HzjKCy8DltiJ2MUbC0oACNIuHJH5VpcJ0fc3NSIYjYcZsADeAF8ElxjthTkUvKtfJc4SUyjVfC44kA",target:"_blank",rel:"noopener noreferrer",children:"试一下"})}),"\n",(0,s.jsx)(n.p,{children:"这个柯里化的函数类型定义，因为返回值的类型和参数的类型是有关系的，所以离不开类型编程。"}),"\n",(0,s.jsxs)(n.h2,{id:"总结",children:["总结",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#总结",children:"#"})]}),"\n",(0,s.jsxs)(n.p,{children:["类型编程是对类型参数做一系列类型运算，产生新的类型。",(0,s.jsx)(n.strong,{children:"需要对已有类型做修改，需要动态生成类型的场景，必然会用到类型编程"}),"，比如 Promise.all、Promise.race、柯里化等场景。"]}),"\n",(0,s.jsxs)(n.p,{children:["有的时候不用类型编程也行，但用了类型编程",(0,s.jsx)(n.strong,{children:"能够实现更精准的类型提示和检查"}),"，比如 parseQueryString 这个函数的返回值。"]}),"\n",(0,s.jsx)(n.p,{children:"这就是类型编程或者说类型体操的意义。"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://www.typescriptlang.org/play?ts=4.5.0-beta#code/PTAEAUEMCcGcFMCKBXe0CeBlALtAlgHYDmAUCdugA7wQwJTSQC2APA86PAB7bwEAmsULFyEiAPlABeUCVDzajJpx59BoAAYASAN6EAZmlABpeOgC+U3QaMA1SABtU5jXIXuA-KB1v3f0ADaxqCEJmYAugBcoPZONL5+5qDRAErwAMYA9tD8LCL4xAA0oJAE6OIA3GQU1KAAsmhE8LGosCwA8gTwxe3YABZokjIJnTTcvAJCvQPQsv7yXqMJ7tHTRuNqQsgEANYEmQDuBAHhy-NeAaPFAHS3a9Cn837Rl109-WjhVeRUNA3QTXYTDaIy6QJUE3UaSyOTyoiKJTK4kKIw+0HBG0moGh2Vy+TExVK5RIQ28bmg8Eg-EyBAc6ECpnpoR2Zky+lAo3BAB9QCz0GyOWigVE5gpGRDNrzWezOTBmGcFmF6Zj1HyBfcgQq-F5-k0WvA2rKlEEIu8ZkCTehwuItSsOWC5UxLY95tFxSqhGqZULHaKnoqNY7nX7-dEugA3NAkczVX6KBAoNBYeFEFg4WYe4Qp0kJdMSrHaPQEQyzIHmABk1mLRjSIhcWp1jXgQLaDHojrYjuR8aQqAw6bELFr2HENqe0TbzY76cqZH023S2DwNNAlDovaTA+Iadw+fU+OI4gAFABHPvJ6DRdMASgn68T-ZTO+gkiq84Ii+XBFX9-PW6Ip5-rg0QHkQ15ku4eDskeACEZ6bruXI8nBQHQNcDh8EQ-TgT4TwUtgyDQN+OjmFU7gxu4WQECIoDwRg7QAEYAFaRDisKgYSSLSN4pEJFRNF4LwwLcXRF7XLAlAOIJR4AOTljJ15kQognwMC1z6NkACikDpH0R4qcoUiSLh8z8dggR8sU4aOKg4TcQZ4mSdJMlSApSn+FBoCAUmjFMQEfLhDhtrKfoR4AILQIw6DXHgsARVF3n0cx-kRNeQX+vMom+SlVrXJQyCwHp1lxIpwXyEk8AOAgEEZX4WXJQF3EBPVfkBVZNnwC6GUUfMFVVTQJkZS1OV2TIxWoO5iQJOYpXuPhhHfi1VQxmQZmgLwIgAEzcWucAbo+BQATJkBSAAjOWDFSJt5bpFIADMblkE9IAQNAmRMLF8AAMI0vkyCLtkZCELw0D6DpNDgG9H0ID91G4P92DZDV8iOA4LAACp7kIFJUjSdKgNseyHMcdk8icY7zEe40GtE6O3q972fSwg3+gAtDj1K0vSATgCE35eqA6MimFByQCpuTozz1pauYs4JIw6TwBjWOgBzeP0oT+xHCcoBk9LTxUx1sC0-TkOMwgLAi2LvASwEBDIEwDGfKOy1kPwGQODANBrZQUOfROfsw798MA9A3xrajtY7YH8DXKjR48zH1wUrAmQOJGR6ndexRm9Dscp2nGebdnDN58nBqF-AR53degXh8Hqvg1HMi++b+fgwnuefeXqfp1XWc50nBd90exeD23PeV9XtelT8tQbeZMiJ23LCnciXcW5t68xywd3iOEdsO07DzfCQ7vpJ7FKgO+n4rtg9-K5matcwTuxayTx7U8bgv0+j9dw6rA03F77YATqdYom1ih3Trm7D2Xtr4LiXHfe+m1H6qCxM-fGmtiY6z1p-I2Jtab-xoinbaMgQGbTARAqBMCSBrUyMxbiLNIDRFOtGWMtQGFMXRnGchvwBRcOIeZLhZDkYlFYdGEoQgzJPRqDQLhPDqCiLkQI5im0hElEik1cBkDoEcJoDAaAiiaB8OoAKQxGjDGiICDowo0CpGgDMt8ORmijG-GUfw9kVjvgvS+oRDAYh9GgD8ZFPA8B+AADEFydiULAYoaQCJERzO4FsKsAg2FmBFIgNxbgZOxAabAXVtReRgEQaIWTwJGWCf4sJkTonDnifARJBAKb+DDPASMYdYEX3gTfJB350j+PQIOKJH5jz6AINEUZ6R6YJGmSrI8tw44Am-nklslTJB5NrMgBw5kvAhPwOE6ZMTmBxPybAHZI5kigAjGgDRN9uJHhYVmQ6xQGJhiPmgYo6RogMUyGnSkBANk8Q0YM0JRyFzcTBQE4gR4b6KSAA",target:"_blank",rel:"noopener noreferrer",children:"本文的案例合并"})})]})}function B(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,i.ah)(),e.components);return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(E,{...e})}):E(e)}let S=B;B.__RSPRESS_PAGE_META={},B.__RSPRESS_PAGE_META["TypeScript%20%E7%B1%BB%E5%9E%8B%E4%BD%93%E6%93%8D%E9%80%9A%E5%85%B3%E7%A7%98%E7%B1%8D%2F13.%E7%9C%9F%E5%AE%9E%E6%A1%88%E4%BE%8B%E8%AF%B4%E6%98%8E%E7%B1%BB%E5%9E%8B%E7%BC%96%E7%A8%8B%E7%9A%84%E6%84%8F%E4%B9%89.md"]={toc:[{text:"类型编程的意义",id:"类型编程的意义",depth:2},{text:"ParseQueryString",id:"parsequerystring",depth:2},{text:"Promise.all",id:"promiseall",depth:2},{text:"currying",id:"currying",depth:2},{text:"总结",id:"总结",depth:2}],title:"13.真实案例说明类型编程的意义",headingTitle:"13.真实案例说明类型编程的意义",frontmatter:{}}}}]);