"use strict";(self.webpackChunkjue_jin_book_press=self.webpackChunkjue_jin_book_press||[]).push([["8835"],{223167:function(e,n,s){s.r(n),s.d(n,{default:()=>f});var c=s(552676),r=s(740453);let d=s.p+"static/image/9f04aba8e23a41d4d8ba4586054c6f76.f385b9fe.webp",a=s.p+"static/image/1a89a47ed4c45844c7306c7c2509c0ba.0b6b5997.webp",l=s.p+"static/image/fe61ca21fb069bc80a8892abdd6bdbdc.52f571fc.webp",i=s.p+"static/image/77f1546542c25e81c5be08654ede13fe.18856d5a.webp",t=s.p+"static/image/b5f2337b1d4945fe7bc7c6d70671a958.132b6c6e.webp",p=s.p+"static/image/39bf7067b8f17ca47d78241572274567.194a1423.webp",x=s.p+"static/image/cff85a53451f29cc1f3dcaa0b53f172a.a3f03ce4.webp",h=s.p+"static/image/0340cf4b996066ba716d6ae1be9d0281.7aa962d4.webp",o=s.p+"static/image/76cca4d38404e57395c48bdaf585078b.1089fe01.webp",j=s.p+"static/image/68f78198ad8a24ca779b06fce1760680.0e53d0cb.webp",E=s.p+"static/image/a1ce9301b81389aab68eb811f04bac4d.c0f9d705.webp",m=s.p+"static/image/ffa725224fd31e8e4537e64c37f8c7fb.e9db6328.webp",g=s.p+"static/image/eb6ac84d6e47b834b66e69f79be01e47.50313adc.webp",b=s.p+"static/image/66f751568242422a106272bf7cba910a.2af62921.webp";function u(e){let n=Object.assign({h1:"h1",a:"a",p:"p",img:"img",pre:"pre",code:"code",h2:"h2"},(0,r.ah)(),e.components);return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)(n.h1,{id:"52-mysql-的视图存储过程和函数",children:["52. MySQL 的视图、存储过程和函数",(0,c.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#52-mysql-的视图存储过程和函数",children:"#"})]}),"\n",(0,c.jsx)(n.p,{children:"和 mysql server 建立连接之后，可以看到它下面所有的 database。"}),"\n",(0,c.jsx)(n.p,{children:"每个 database 包含表、视图、存储过程、函数："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:b,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"表的增删改查我们已经学会了。"}),"\n",(0,c.jsx)(n.p,{children:"那视图、存储过程、函数都是什么呢？"}),"\n",(0,c.jsx)(n.p,{children:"我们分别来看下："}),"\n",(0,c.jsx)(n.p,{children:"用之前的 customers、orders 表来建立视图："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sql",children:"CREATE VIEW customer_orders AS \n    SELECT \n        c.name AS customer_name, \n        o.id AS order_id, \n        o.order_date, \n        o.total_amount\n    FROM customers c\n    JOIN orders o ON c.id = o.customer_id;\n"})}),"\n",(0,c.jsx)(n.p,{children:"下面的 select 语句我们很熟悉，就是关联 customers、orders 表，查出一些字段。"}),"\n",(0,c.jsx)(n.p,{children:"然后加上 CREATE VIEW ... AS 就是把这个查询的结果建立一个视图。"}),"\n",(0,c.jsx)(n.p,{children:"我们查询下刚创建的视图："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sql",children:"select * from customer_orders\n"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:g,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"视图有什么好处呢？"}),"\n",(0,c.jsx)(n.p,{children:"明显感受到的就是能简化查询，之前要写一堆 sql，现在只要查这个视图就好了。"}),"\n",(0,c.jsx)(n.p,{children:"再就是还可以控制权限，让开发者只能看到需要的字段，其余的给隐藏掉。"}),"\n",(0,c.jsx)(n.p,{children:"视图一般只用来做查询，因为它增删改的限制比较多，比如只有单表的视图可以增删改，并且要求不在视图里的字段都有默认值等。"}),"\n",(0,c.jsx)(n.p,{children:"了解即可。"}),"\n",(0,c.jsx)(n.p,{children:"再就是存储过程。"}),"\n",(0,c.jsx)(n.p,{children:"这段 sql 就是创建了一个存储过程，传入 custom_id 查询出所有关联的订单："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sql",children:"DELIMITER $$\nCREATE PROCEDURE get_customer_orders(IN customer_id INT)\nBEGIN\n        SELECT o.id AS order_id, o.order_date, o.total_amount\n        FROM orders o\n		WHERE o.customer_id = customer_id;\nEND $$\nDELIMITER ;\n"})}),"\n",(0,c.jsx)(n.p,{children:"首先 DELIMITER $$ 定义分隔符为 $$，因为默认是 ;"}),"\n",(0,c.jsx)(n.p,{children:"这样中间就可以写 ; 了，不会中止存储过程的 sql。"}),"\n",(0,c.jsx)(n.p,{children:"最后再恢复为之前的分隔符：DELIMITER ;"}),"\n",(0,c.jsx)(n.p,{children:"存储过程内部执行了一个查询，用到的 customer_id 是参数传入的。"}),"\n",(0,c.jsx)(n.p,{children:"创建这个存储过程："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:m,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"刷新就可以看到这个刚创建的存储过程："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:E,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"点击第二个图标就可以传参数调用："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:j,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"当然你可以在 sql 里调用："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sql",children:"CALL get_customer_orders(5);\n"})}),"\n",(0,c.jsx)(n.p,{children:"调用使用 CALL 存储过程(参数) 的形式："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:o,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"可以看到，存储过程可以封装一些 sql，用的时候传入参数 CALL 一下就行。"}),"\n",(0,c.jsx)(n.p,{children:"此外，如果你想调用的时候返回值，可以使用函数："}),"\n",(0,c.jsx)(n.p,{children:"比如一个求平方的函数："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sql",children:"DELIMITER $$\nCREATE FUNCTION square(x INT)\nRETURNS INT\nBEGIN\n    DECLARE result INT;\n    SET result = x * x;\n    RETURN result;\nEND $$\nDELIMITER ;\n"})}),"\n",(0,c.jsx)(n.p,{children:"还是先通过 DELIMITER 指定分隔符为 $$。"}),"\n",(0,c.jsx)(n.p,{children:"CREATE FUNCTION 声明函数的名字和参数 x，并且通过 RETURNS 声明返回值类型。"}),"\n",(0,c.jsx)(n.p,{children:"BEGIN、END 中间的是函数体。"}),"\n",(0,c.jsx)(n.p,{children:"先 DECLARE 一个 INT 类型的变量，然后 SET 它的值为 x * x，之后通过 RETURN 返回这个结果。"}),"\n",(0,c.jsx)(n.p,{children:"但默认 mysql 是不允许创建函数的。"}),"\n",(0,c.jsx)(n.p,{children:"需要先设置下这个变量："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sql",children:"SET GLOBAL log_bin_trust_function_creators = 1;\n"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:h,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"之后之后再创建 function："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:x,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"创建成功之后就可以在 sql 里用它了："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:p,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"比如创建这个视图的 price 的平方："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sql",children:"CREATE VIEW order_items_view AS \n    SELECT product_name, price FROM practice.order_items;\n"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:t,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"就可以用上这个函数："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sql",children:"select product_name, square(price) from order_items_view\n"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:i,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"你也可以可视化的调用这个 function："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:l,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"当然，这个函数没啥意义，我们再创建个有意义一点的："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sql",children:"DELIMITER $$\nCREATE FUNCTION get_order_total(order_id INT)\nRETURNS DECIMAL(10,2)\nBEGIN\n	DECLARE total DECIMAL(10,2);\n	SELECT SUM(quantity * price) INTO total\n		FROM order_items\n		WHERE order_id = order_items.order_id;\n	RETURN total;\nEND $$\nDELIMITER ;\n"})}),"\n",(0,c.jsx)(n.p,{children:"创建一个函数  get_order_total，参数为 INT 类型的 order_id，返回值为 DECIMAL(10, 2) 类型。"}),"\n",(0,c.jsx)(n.p,{children:"声明 total 变量，执行查询订单详情表综合的 select 语句，把结果放到 total 变量里，也就是 SELECT INTO。"}),"\n",(0,c.jsx)(n.p,{children:"最后 RETURN 这个 total 变量。"}),"\n",(0,c.jsx)(n.p,{children:"然后我们调用下："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sql",children:"select id, get_order_total(id) from orders;\n"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:a,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"我们自己来算算对不对："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:d,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"id 为 3 的订单的总额是对的："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:"data:image/webp;base64,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",alt:""})}),"\n",(0,c.jsx)(n.p,{children:"这就是自定义函数。"}),"\n",(0,c.jsxs)(n.h2,{id:"总结",children:["总结",(0,c.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#总结",children:"#"})]}),"\n",(0,c.jsx)(n.p,{children:"这节我们了解了下视图、存储过程、函数。"}),"\n",(0,c.jsx)(n.p,{children:"视图就是把查询结果保存下来，可以对这个视图做查询，简化了查询语句并且也能隐藏一些字段。"}),"\n",(0,c.jsx)(n.p,{children:"它增删改的限制比较多，一般只是来做查询。"}),"\n",(0,c.jsx)(n.p,{children:"存储过程就是把一段 sql 封装起来，传参数调用。"}),"\n",(0,c.jsx)(n.p,{children:"函数也是把一段 sql 或者其他逻辑封装起来，传参数调用，但是它还有返回值。"}),"\n",(0,c.jsx)(n.p,{children:"这些概念了解即可，实际上用的并不多。"})]})}function R(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,r.ah)(),e.components);return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(u,{...e})}):u(e)}let f=R;R.__RSPRESS_PAGE_META={},R.__RSPRESS_PAGE_META["Nest%20%E9%80%9A%E5%85%B3%E7%A7%98%E7%B1%8D%20%20%E6%9C%80%E6%96%B0200%E7%AB%A0%2F52.%20MySQL%20%E7%9A%84%E8%A7%86%E5%9B%BE%E3%80%81%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E5%92%8C%E5%87%BD%E6%95%B0.md"]={toc:[{text:"总结",id:"总结",depth:2}],title:"52. MySQL 的视图、存储过程和函数",headingTitle:"52. MySQL 的视图、存储过程和函数",frontmatter:{}}}}]);