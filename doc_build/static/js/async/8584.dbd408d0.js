"use strict";(self.webpackChunkjue_jin_book_press=self.webpackChunkjue_jin_book_press||[]).push([["8584"],{853439:function(e,n,r){r.r(n),r.d(n,{default:()=>t});var s=r(552676),i=r(740453);function h(e){let n=Object.assign({h1:"h1",a:"a",p:"p",h2:"h2",ol:"ol",li:"li",img:"img",h3:"h3",br:"br",pre:"pre",code:"code"},(0,i.ah)(),e.components);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.h1,{id:"11基于-https-的数据加密",children:["11基于 HTTPS 的数据加密",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#11基于-https-的数据加密",children:"#"})]}),"\n",(0,s.jsx)(n.p,{children:"本小节为可选章节，因为 HTTPS 证书需要域名（域名需另行购买）才能申请。有域名的读者可以按步骤实践，没有域名的读者，只需要了解即可。"}),"\n",(0,s.jsxs)(n.h2,{id:"https-与-http-区别",children:["HTTPS 与 HTTP 区别",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#https-与-http-区别",children:"#"})]}),"\n",(0,s.jsx)(n.p,{children:"在前面的小节中，客户端与服务器端的请求响应都是用的 HTTP， HTTP 和 HTTPS 有什么区别呢？"}),"\n",(0,s.jsx)(n.p,{children:"HTTP 协议传输的数据都是未加密的，也就是明文的，因此使用 HTTP 协议传输隐私信息非常不安全，为了保证这些隐私数据能加密传输，网景公司设计了 SSL（Secure Sockets Layer）协议用于对 HTTP 协议传输的数据进行加密，从而就诞生了 HTTPS。简单来说，HTTPS 协议是由 SSL+HTTP 协议构建的可进行加密传输、身份认证的网络协议，要比 HTTP 协议安全。"}),"\n",(0,s.jsx)(n.p,{children:"HTTPS 和 HTTP 的区别主要如下："}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"HTTPS 协议需要到 CA 中心申请证书"}),"\n",(0,s.jsx)(n.li,{children:"HTTP 是超文本传输协议，信息是明文传输，HTTPS 则是具有安全性的 SSL 加密传输协议"}),"\n",(0,s.jsx)(n.li,{children:"HTTP 和 HTTPS 使用的是完全不同的连接方式，前者默认是 80，后者是 443"}),"\n",(0,s.jsx)(n.li,{children:"HTTP 的连接很简单，是无状态的；HTTPS 协议是由 SSL+HTTP 协议构建的可进行加密传输、身份认证的网络协议，比 HTTP 协议安全"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"HTTP 由于是明文传输未加密，缺点可见一斑。这里插入一个小故事，在笔者开发第一款 App 的时候，为了提高效率，采用了 HTTP，在 客户端和服务器调试期间，笔者发现客户端的最下面，经常会莫名其妙地出现垃圾广告，一开始并不清楚为啥会出现这种情况，客户端和服务器端还花好长一段时间进行调试定位。最后发现是运营商的问题，广告也是运营商嵌入的，这就是不加密的后果：HTTP 被劫持了。后面改为 HTTPS，整个世界也就清静了。"}),"\n",(0,s.jsxs)(n.h2,{id:"https-工作原理",children:["HTTPS 工作原理",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#https-工作原理",children:"#"})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"https://user-gold-cdn.xitu.io/2018/4/26/162ff2a191787c9d?w=781&h=160&f=png&s=18154",alt:""})}),"\n",(0,s.jsxs)(n.p,{children:["这里涉及很多新的概念，如公钥和私钥。简单的理解即为，我们的服务器端需要安装 CA 证书（证书下载后面会讲解），证书包含两个东西，一个是私钥，一个是公钥，私钥就是自己留着的，别人不会知道，公钥是别人使用 HTTPS 请求时，发给别人的密钥。当客户端需要发送加密报文时，会使用服务器端给的公钥进行加密，此时在网络中传输的就是一串无序的字符串。当报文被服务器端接收到时，服务器端使用私钥进行解密，这样就能保证整个链路的安全性。关于公钥和私钥，这里有一篇有趣的讲解供读者参考（",(0,s.jsx)(n.a,{href:"https://www.cnblogs.com/shijingjing07/p/5965792.html",target:"_blank",rel:"noopener noreferrer",children:"公钥与私钥，HTTPS详解"}),"），本节作为简单的抛砖引玉，不作过多的阐述。下面看一下整个通信流程。"]}),"\n",(0,s.jsx)(n.p,{children:"客户端在使用 HTTPS 方式与服务器端通信时有以下几个步骤，如图所示。"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"https://user-gold-cdn.xitu.io/2018/4/26/162ff2a5c8f7a7c3?w=365&h=411&f=gif&s=5305",alt:""})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"客户使用 HTTPS 的 URL 访问服务器，要求与服务器建立 SSL 连接"}),"\n",(0,s.jsx)(n.li,{children:"服务器收到客户端请求后，会将站点的证书信息（证书中包含公钥）传送一份给客户端"}),"\n",(0,s.jsx)(n.li,{children:"客户端与服务器开始协商SSL连接的安全等级，也就是信息加密的等级"}),"\n",(0,s.jsx)(n.li,{children:"客户端的浏览器根据双方同意的安全等级，建立会话密钥，然后利用服务器端的公钥将会话密钥加密，并传送给客户端"}),"\n",(0,s.jsx)(n.li,{children:"服务器利用自己的私钥解密出会话密钥"}),"\n"]}),"\n",(0,s.jsxs)(n.h2,{id:"下载证书",children:["下载证书",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#下载证书",children:"#"})]}),"\n",(0,s.jsx)(n.p,{children:"如上所述，首先需要申请下载证书，并将其存放在服务器端。目前安全性较高的数字证书都是付费的。读者可以根据自身项目的诉求，选择不同的证书级别，个人或者小微企业可选择使用免费的数字证书。由于我们只是 Demo，这里选择免费证书。免费的证书可以直接上公有云提供商下载，如腾讯云、阿里云等。本小册以腾讯云为例。"}),"\n",(0,s.jsxs)(n.h3,{id:"申请证书",children:["申请证书",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#申请证书",children:"#"})]}),"\n",(0,s.jsxs)(n.p,{children:["登录腾讯云，输入如下链接，申请“域名型免费版(DV)”：",(0,s.jsx)(n.br,{}),"\n",(0,s.jsx)(n.a,{href:"https://buy.cloud.tencent.com/ssl?fromSource=ssl",target:"_blank",rel:"noopener noreferrer",children:"https://buy.cloud.tencent.com/ssl?fromSource=ssl"})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"https://user-gold-cdn.xitu.io/2018/4/26/162ff2ab8a3f1b33?w=1009&h=837&f=png&s=80937",alt:""})}),"\n",(0,s.jsx)(n.p,{children:"按照步骤一步步完成购买。"}),"\n",(0,s.jsxs)(n.h3,{id:"下载上传",children:["下载上传",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#下载上传",children:"#"})]}),"\n",(0,s.jsx)(n.p,{children:"将证书从腾讯云上下载下来（214225718810040.zip），并将其上传到服务器上。假定证书也放在 demo 目录下，在 demo 目录下创建 cert 目录。并将其解压至此目录。"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"https://user-gold-cdn.xitu.io/2018/4/26/162ff2aec17cbc15?w=1007&h=394&f=png&s=47529",alt:""})}),"\n",(0,s.jsxs)(n.h3,{id:"配置-nginx",children:["配置 Nginx",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#配置-nginx",children:"#"})]}),"\n",(0,s.jsx)(n.p,{children:"正如前面介绍 HTTPS 时所述，HTTPS 使用的是 443 端口，此时需要修改 Nginx 监听的端口为 443。另外，需要在 Nginx 的配置文件中指定 HTTPS 证书的路径。配置 Nginx 的 server 如下："}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"listen 443;\r\nserver_name  _;\r\nssl on;\r\nroot html;\r\nindex index.html index.htm;\r\nssl_certificate   cert/214225718810040.pem;\r\nssl_certificate_key  cert/214225718810040.key;\r\nssl_session_timeout 5m;\r\nssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;\r\nssl_protocols TLSv1 TLSv1.1 TLSv1.2;\r\nssl_prefer_server_ciphers on;\n"})}),"\n",(0,s.jsxs)(n.p,{children:["具体位置如下：\r\n",(0,s.jsx)(n.img,{src:"https://user-gold-cdn.xitu.io/2018/4/26/162ff2b23641a07c?w=1221&h=420&f=png&s=44459",alt:""})]}),"\n",(0,s.jsxs)(n.h3,{id:"重启-nginx",children:["重启 Nginx",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#重启-nginx",children:"#"})]}),"\n",(0,s.jsx)(n.p,{children:"配置完成后，需要重启 Nginx，在服务器上直接输入如下命令重启 Nginx："}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"service nginx stop\r\nservice nginx start\n"})}),"\n",(0,s.jsx)(n.p,{children:"至此，已完成服务器端 HTTPS 的准备，此时从客户端使用 HTTPS 请求，就可以保证数据的安全性。"}),"\n",(0,s.jsxs)(n.h2,{id:"小结",children:["小结",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#小结",children:"#"})]}),"\n",(0,s.jsx)(n.p,{children:"本小节介绍了 HTTPS 的原理及在 Nginx 上的配置和使用方法。作为可选章节，读者在有条件的时候练习即可。"})]})}function d(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,i.ah)(),e.components);return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}let t=d;d.__RSPRESS_PAGE_META={},d.__RSPRESS_PAGE_META["%E5%9F%BA%E4%BA%8E%20Python%20%E8%BD%BB%E6%9D%BE%E8%87%AA%E5%BB%BA%20App%20%E6%9C%8D%E5%8A%A1%E5%99%A8%2F11%E5%9F%BA%E4%BA%8E%20HTTPS%20%E7%9A%84%E6%95%B0%E6%8D%AE%E5%8A%A0%E5%AF%86.md"]={toc:[{text:"HTTPS 与 HTTP 区别",id:"https-与-http-区别",depth:2},{text:"HTTPS 工作原理",id:"https-工作原理",depth:2},{text:"下载证书",id:"下载证书",depth:2},{text:"申请证书",id:"申请证书",depth:3},{text:"下载上传",id:"下载上传",depth:3},{text:"配置 Nginx",id:"配置-nginx",depth:3},{text:"重启 Nginx",id:"重启-nginx",depth:3},{text:"小结",id:"小结",depth:2}],title:"11基于 HTTPS 的数据加密",headingTitle:"11基于 HTTPS 的数据加密",frontmatter:{}}}}]);