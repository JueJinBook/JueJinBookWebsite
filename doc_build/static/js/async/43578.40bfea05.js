"use strict";(self.webpackChunkjue_jin_book_press=self.webpackChunkjue_jin_book_press||[]).push([["43578"],{631443:function(e,n,s){e.exports=s.p+"static/image/51a27974bcd806928b86bdeb0d8d24e4.492cea25.gif"},458459:function(e,n,s){e.exports=s.p+"static/image/ccbcefeec87bf09b3da5747b7fc7aec7.b7aadf7f.webp"},105336:function(e,n,s){s.r(n),s.d(n,{default:()=>m});var c=s(552676),o=s(740453);let r=s.p+"static/image/2e7e2c6ef2742e495a74cfa4395d3dae.fb5880a6.gif",i=s.p+"static/image/5e60a4a0a064ce1628fc91b9eae809cf.42a16a1e.gif",a=s.p+"static/image/d4853e8b1557612ff4b57e176cb9d1dd.6111d857.webp";var l=s(631443);let t=s.p+"static/image/8afdff02fd2c14e3e3165e1c7baa87a8.fbbb151e.webp",d=s.p+"static/image/d8e6c7b3c0ad9363ac392f669923e374.e9974a22.gif",h=s.p+"static/image/963d614f668f026bccaeaff510df883b.3c9505c9.webp",p=s.p+"static/image/34b970b90898b953d6d002696cd57c80.41abd5af.gif",g=s.p+"static/image/a6616bb2e09cc8e7ddd6f92763c1f2ab.f63db587.webp";var j=s(458459);function f(e){let n=Object.assign({h1:"h1",a:"a",p:"p",img:"img",pre:"pre",code:"code",h2:"h2"},(0,o.ah)(),e.components);return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)(n.h1,{id:"134-会议室预定系统google-账号登录前端开发",children:["134. 会议室预定系统：Google 账号登录前端开发",(0,c.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#134-会议室预定系统google-账号登录前端开发",children:"#"})]}),"\n",(0,c.jsx)(n.p,{children:"上节实现了 Google 账号登录的后端代码，这节在前端代码里调用下就好了。"}),"\n",(0,c.jsxs)(n.p,{children:["类似 ",(0,c.jsx)(n.a,{href:"https://login.docker.com/u/login",target:"_blank",rel:"noopener noreferrer",children:"https://login.docker.com/u/login"})]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:j,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"在登录框下加个 google 账号登录的按钮。"}),"\n",(0,c.jsx)(n.p,{children:"改下 Login.tsx"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:g,alt:""})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:'<Form.Item\n    {...layout2}\n>\n    <div>\n        <a href="#" onClick={() => {\n            window.location.href = "http://localhost:3005/user/google";\n        }}>Google 账号登录</a>\n    </div>\n</Form.Item>\n'})}),"\n",(0,c.jsx)(n.p,{children:"点击的时候跳转 google 登录页面。"}),"\n",(0,c.jsx)(n.p,{children:"试一下："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:p,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"跳转没问题。"}),"\n",(0,c.jsx)(n.p,{children:"再看下 cookie："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:h,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"也没问题。"}),"\n",(0,c.jsx)(n.p,{children:"接下来只需要在首页处理下 cookie，同步登录状态就好了。"}),"\n",(0,c.jsx)(n.p,{children:"那怎么同步登录状态呢？"}),"\n",(0,c.jsx)(n.p,{children:"看下之前的登录流程："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:d,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"登录后再 localStorage 里保存了 access_token、refresh_token、user_info 这三个信息，这就是保存了登录状态了。"}),"\n",(0,c.jsx)(n.p,{children:"那现在只要判断下有这三个 cookie，就把它设置到 localStorage，然后刷新下页面不就好了？"}),"\n",(0,c.jsx)(n.p,{children:"安装下操作 cookie 的包："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"npm install --save js-cookie\nnpm i --save-dev @types/js-cookie\n"})}),"\n",(0,c.jsx)(n.p,{children:"然后在 Index 组件里写下逻辑："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:t,alt:""})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:"useEffect(() => {\n    const userInfo = cookies.get('userInfo');\n    const accessToken = cookies.get('accessToken');\n    const refreshToken = cookies.get('refreshToken');\n\n    if(userInfo && accessToken && refreshToken) {\n        localStorage.setItem('user_info', userInfo);\n        localStorage.setItem('access_token', accessToken);\n        localStorage.setItem('refresh_token', refreshToken);\n\n        cookies.remove('userInfo');\n        cookies.remove('accessToken');\n        cookies.remove('refreshToken');\n    }\n}, []);\n"})}),"\n",(0,c.jsx)(n.p,{children:"如果 cookie 包含 userInfo、accessToken、refreshToken，就设置到 localStorage，然后把 cookie 删掉。"}),"\n",(0,c.jsx)(n.p,{children:"再试下："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:l,alt:""})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:a,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"登录成功！"}),"\n",(0,c.jsx)(n.p,{children:"短时间内再次登录不需要再次授权："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:i,alt:""})}),"\n",(0,c.jsxs)(n.p,{children:["你用 ",(0,c.jsx)(n.a,{href:"https://hub.docker.com/u/login",target:"_blank",rel:"noopener noreferrer",children:"dockerhub"})," 也是这样："]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:r,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"这样，Google 账号登录的前端代码就完成了。"}),"\n",(0,c.jsxs)(n.p,{children:["案例代码上传了",(0,c.jsx)(n.a,{href:"https://github.com/QuarkGluonPlasma/nestjs-course-code/tree/main/meeting_room_booking_system_frontend_user",target:"_blank",rel:"noopener noreferrer",children:"小册仓库"})]}),"\n",(0,c.jsxs)(n.h2,{id:"总结",children:["总结",(0,c.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#总结",children:"#"})]}),"\n",(0,c.jsx)(n.p,{children:"这节我们实现了 Google 账号登录的前端部分。"}),"\n",(0,c.jsx)(n.p,{children:"点击 Google 登录按钮的时候修改 location.href 为 /user/google 触发 Google 账号登录授权。"}),"\n",(0,c.jsx)(n.p,{children:"授权后会回调 /user/callback/google，我们在接口查询了用户信息，通过 cookie 返回 userInfo 和 jwt 的 token，然后重定向到首页。"})]})}function x(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,o.ah)(),e.components);return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(f,{...e})}):f(e)}let m=x;x.__RSPRESS_PAGE_META={},x.__RSPRESS_PAGE_META["Nest%20%E9%80%9A%E5%85%B3%E7%A7%98%E7%B1%8D%20%20%E6%9C%80%E6%96%B0200%E7%AB%A0%2F134.%20%E4%BC%9A%E8%AE%AE%E5%AE%A4%E9%A2%84%E5%AE%9A%E7%B3%BB%E7%BB%9F%EF%BC%9AGoogle%20%E8%B4%A6%E5%8F%B7%E7%99%BB%E5%BD%95%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91.md"]={toc:[{text:"总结",id:"总结",depth:2}],title:"134. 会议室预定系统：Google 账号登录前端开发",headingTitle:"134. 会议室预定系统：Google 账号登录前端开发",frontmatter:{}}}}]);