"use strict";(self.webpackChunkjue_jin_book_press=self.webpackChunkjue_jin_book_press||[]).push([["85300"],{412418:function(e,n,c){c.r(n),c.d(n,{default:()=>P});var i=c(552676),r=c(740453);let d=c.p+"static/image/3b9648c258890e3e9a1acd4c1c95321b.b2f50f69.webp",s=c.p+"static/image/0070e477048f6f846346050da434c3e5.ae484dea.webp",l=c.p+"static/image/01a2580e5692b9b24bcf2f1f83b9efcc.3ad786ff.webp",a=c.p+"static/image/d75563a591a4f6088e2e97d71855a7fa.e89533c0.webp",p=c.p+"static/image/1ce90157c41ac5e9865eae483548601f.af07c44a.webp",t=c.p+"static/image/68c0cb0d79ea67e921a5dd6318fb6178.38f902fc.webp",h=c.p+"static/image/996c989a8bb08d591d43392fa86b3762.9c157fe7.webp",j=c.p+"static/image/f43b0528c3c78d1cd2ceaa3d5b1a04b6.26f56181.webp",x=c.p+"static/image/123a0f5b461718eca78c4ae8a7c38373.4b0c32fb.webp",b=c.p+"static/image/339fc7054b4ca30d0ef609a9a131a4ad.8a8d089e.webp",f=c.p+"static/image/a1026bc7e37d510385b7e2dd14db43af.12373b49.webp",o=c.p+"static/image/1d47433624dff2053c1e9a309b993f38.26fa8408.webp",k=c.p+"static/image/72b094e4099eca809735222c39c509f4.f011cfb0.webp",m=c.p+"static/image/ce65a52e4a488480a1d21e2f18b57173.9c5b356c.webp",A=c.p+"static/image/6e4efacc543ad7456817ff16b83a3638.55a65d38.webp",g=c.p+"static/image/f5e90d1ad773407c88a5c9729d833c88.e0402231.webp",u=c.p+"static/image/57b5a2bdfb6554d97598888e1ca38218.d4d4f6d1.webp",w=c.p+"static/image/faaec905c53997a08973259c1338e324.bbc365fe.webp",O=c.p+"static/image/008ca3cd92d3ce337ea1d486fd989f74.5506f9d2.webp",v=c.p+"static/image/e114afb996021c90d0cd90204d3b73bd.a16736f9.webp",E=c.p+"static/image/566af2b9ffbc938faa1a0e4a0142591d.07c89bdb.webp";function I(e){let n=Object.assign({h1:"h1",a:"a",p:"p",pre:"pre",code:"code",ul:"ul",li:"li",img:"img",h2:"h2"},(0,r.ah)(),e.components);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.h1,{id:"40-你的第一个-dockerfile",children:["40. 你的第一个 Dockerfile",(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#40-你的第一个-dockerfile",children:"#"})]}),"\n",(0,i.jsx)(n.p,{children:"上节我们通过 desktop 从 docker hub 拉取了 nginx 的镜像，并把它跑了起来。"}),"\n",(0,i.jsx)(n.p,{children:"跑这个镜像的时候指定了映射的端口、挂载的数据卷、环境变量等。"}),"\n",(0,i.jsx)(n.p,{children:"跑起来的容器就已经有可用的 nginx 服务了。"}),"\n",(0,i.jsx)(n.p,{children:"那如果我们要自己制作一个这样的镜像，怎么做呢？"}),"\n",(0,i.jsx)(n.p,{children:"docker 容器内就是一个独立的系统环境，想想如果在这样一个系统上，要安装 nginx 服务，怎么做呢？"}),"\n",(0,i.jsx)(n.p,{children:"需要执行一些命令、复制一些文件进来，然后启动服务。"}),"\n",(0,i.jsx)(n.p,{children:"制作镜像自然也要进行这样的过程，不过可以自动化。"}),"\n",(0,i.jsx)(n.p,{children:"只要在 dockerfile 里声明要做哪些事情，docker build 的时候就会根据这个 dockerfile 来自动化构建出一个镜像来。"}),"\n",(0,i.jsx)(n.p,{children:"比如这样："}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-docker",children:'FROM node:latest\n\nWORKDIR /app\n\nCOPY . .\n\nRUN npm config set registry https://registry.npmmirror.com/\n\nRUN npm install -g http-server\n\nEXPOSE 8080\n\nCMD ["http-server", "-p", "8080"]\n'})}),"\n",(0,i.jsx)(n.p,{children:"这些指令的含义如下："}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"FROM：基于一个基础镜像来修改"}),"\n",(0,i.jsx)(n.li,{children:"WORKDIR：指定当前工作目录"}),"\n",(0,i.jsx)(n.li,{children:"COPY：把容器外的内容复制到容器内"}),"\n",(0,i.jsx)(n.li,{children:"EXPOSE：声明当前容器要访问的网络端口，比如这里起服务会用到 8080"}),"\n",(0,i.jsx)(n.li,{children:"RUN：在容器内执行命令"}),"\n",(0,i.jsx)(n.li,{children:"CMD：容器启动的时候执行的命令"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"我们先通过 FROM 继承了 node 基础镜像，里面就有 npm、node 这些命令了。"}),"\n",(0,i.jsx)(n.p,{children:"通过 WORKDIR 指定当前目录。"}),"\n",(0,i.jsx)(n.p,{children:"然后通过 COPY 把 Dockerfile 同级目录下的内容复制到容器内，这里的 . 也就是 /app 目录"}),"\n",(0,i.jsx)(n.p,{children:"之后通过 RUN 执行 npm install，全局安装 http-server"}),"\n",(0,i.jsx)(n.p,{children:"通过 EXPOSE 指定要暴露的端口"}),"\n",(0,i.jsx)(n.p,{children:"CMD 指定容器跑起来之后执行的命令，这里就是执行 http-server 把服务跑起来。"}),"\n",(0,i.jsx)(n.p,{children:"把这个文件保存为 Dockerfile，然后在同级添加一个 index.html"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)("img",{src:E,alt:""})}),"\n",(0,i.jsx)(n.p,{children:"然后通过 docker build 就可以根据这个 dockerfile 来生成镜像。"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"docker build -t aaa:ccc .\n"})}),"\n",(0,i.jsx)(n.p,{children:"aaa 是镜像名，ccc 是镜像的标签"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)("img",{src:v,alt:""})}),"\n",(0,i.jsx)(n.p,{children:"FROM 是继承一个基础镜像，看输出也可以看出来，前面都是 node 镜像的内容，会一层层下载下来。"}),"\n",(0,i.jsx)(n.p,{children:"最后才是本地的我们添加的那些。"}),"\n",(0,i.jsx)(n.p,{children:"这时你在 desktop 的 images 列表里就可以看到这个镜像了："}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)("img",{src:O,alt:""})}),"\n",(0,i.jsx)(n.p,{children:"然后执行 docker run 把这个镜像跑起来，用 desktop 我们就直接点击 run 按钮了："}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)("img",{src:w,alt:""})}),"\n",(0,i.jsx)(n.p,{children:"会让你输入这些内容："}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)("img",{src:u,alt:""})}),"\n",(0,i.jsx)(n.p,{children:"是不是上节用 nginx 镜像的感觉回来了？这次是我们自己 build 的镜像。"}),"\n",(0,i.jsx)(n.p,{children:"指定容器名、映射的端口、点击 run："}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)("img",{src:g,alt:""})}),"\n",(0,i.jsx)(n.p,{children:"然后可以看到容器内的日志，服务启动成功了："}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)("img",{src:A,alt:""})}),"\n",(0,i.jsx)(n.p,{children:"当然，容器内打印的是 8080 端口，但在容器外要用映射的 8888 端口访问："}),"\n",(0,i.jsxs)(n.p,{children:["访问 ",(0,i.jsx)(n.a,{href:"http://localhost:8888",target:"_blank",rel:"noopener noreferrer",children:"http://localhost:8888"})," 就可以看到我们在 html 写的内容了："]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)("img",{src:"data:image/webp;base64,UklGRiYPAABXRUJQVlA4IBoPAACwYACdASpyAsIAPp1Oo0ylpKMiI1O4oLATiWlu4XaxFzN78y/2/tu/3Hhr44vdHtv64OTfy3+a8zf5j90f2Xlf3p/GrUF/If5x/t/y492t7s4F9tvrHgGajXgz2Av5lwsPnXsAfz7/TerL/i//Py6fX3sHfr76bXtC9F4SJpO8hA+apbM8X7Ccpop63joLfakzSKbZ7LOaibSjWbbMSPxKL4HTN+YVaQfSwF9DIDYrzHMqiJEc5tsAAYcADheSqe5JIq+TmrioUDsvagm7JnwVKmo+sizd+aLjUzmNOmy496R3cXpEuJfvN6nn4Ju7wC70eeDXrbG3morhTGkiQJ/5o7J/PI1i1V4aiJMdt4zVQfS5tSpzz+RCa2GlstBqA10c58dfQJaSr+cjKwbdXY8hBlfxkVFaGHCoA2eKwmorOwKxUeqTfD2Y37ZwaBEW20+JuADWF78W1BEXPparKQAVelSQHOOxyv6doE98ldBq6PzyvegkWEASlM+F3ooGe4tSu6DfsAL3leNOjykwSqXvvpvqKnxIPfxHkO7HtvRQQbwlr/6GHAcPOpB6jnbepjOlhtg8rONYPIK3NC1V92gb5+Wk4HSckpuyVXpaz85eCcvBOXJId2Le8hA+beG3Vb3kIHzbw26eTophLDs1vIMxh/QwOAv1mZw19KwH5s9b/vJmuKERNUnfA7aIpRS+kLCeI0c5SLAcjbOEXVTkzqXlO7hQA02TFpmGnS5t4bdVveQgfNvDbhLkgk8anAg7AuBJrf+ZXKEztv3MZgwk2xMWaZT585XzH4g+UZM0T9+69WsKMrjOPmIIZvJWcWxDuxb3kIHzbw26re8jws/phuId2Le8hA+beG3Vb3kIHzbw26re8hA+beG3Vb3kIHzbw26re8hA+beG3Vb3kIHpwhfkXZ8njLrxixB728wBR0eXVMmkaznV+I8h3Yt7yED5t4bdVvdV4hQGRVRaYu+JirpULbnDK3P6rottngib33DGQvRx4iLu1S1gAMxvJ3xDuxb3kIHzbw26re8hA+bbgAD+/7qAZ5NmcIzR6OEVYnfpbfMO1+gr5kLBnMhYM5kLBnMhYM5kLBnMhFIUIArxHvq0Bvvda3SACcKU0vTLBsOVCEKBU8Ls7c+RHloXd4ORzT6ZJqTOHF8659QFYSdPZEkVimaLnDWb3qXU/lBzlFMLpw8wN46Fx2o1MsJVc1YSO9Z/tKcxXAQNiCeVtdx/G1z5JopVNPoH6Kg8vBsG0cIeCdFvV7deNYvuDaf4bjotBhc0lZjxvIeWY/NHm2CNq6qklHHX2N0GIoY0pCxD0Hbz94EtwZTSZMum0Ab1X20ywRhbZ5Cmuaz8usIpLTdIkza+5Mkjy11xpi2Rj/rQEHELCUucNon3ZgJMS8DHYNxyOdOOHBZEKIgDg7AqsI0jrRGmZjat6OgSqVaaptopVjBQeI94RCl/AjJWviA5NW2ISIa5MgCxp/oTwlL5HLAVwwhL12oLn50dxDDxQXUhpuYWUVw/Ny/fWCgfR40ycsTaphxercvlxxxDH6kMkjkjawEPXGF8F8LdD8nhrrAZl3hyzTNcxS1ofogUkuDpNliKE9DnznQv+HouxZvutWmMiIwfWnfshOIlpIt/TmfBXNtnjc9pPx3yu/tifKI950gjb37R3Ra3VuxDdGY/50IjfQYMHOi7urOEhXO9/VPd+NhJ4AU6N46tVcyj6LWQZdjL66+FlHMg2y2fB9Ujymofhe/Mxg3zbFM/xlFsUHu5hrKY5w5wfh3NFlZbqrViJLQSJVmRacWFvyGUnN9b7AURjlTbRdZZQEbfqPDNtBQGP+RAn72ckoILSTR/a4jwbFGzY6jm+HVV+sRCOPskv/iu7iTZuQ8E3vsXAfz589HlWehNUFwCe/7L7ES7uNHZ+1ZoODPzP0HHswQHgSBHt7/Txj4mtiIBX2lZMnrAKcfwnZLw/6G1m+4WYu7GQSZRu2DP5SD3aU2VymMUT9HoPFz5LTaTMVBsaBCei+dMOZUw1+o90l1ttBZf4FJaShpzo071kDkt8urAWiZYIBf6/EUPXuR0Z9R2iXx19SG5qCdwMMVXAZqA+xHuY6mh2JJPnAmth2IJW+08wvlWinxqC2WkSlOUrQN/4WWQAVB4juuz7UEg+msRaib8QWOEWqhFCKHPAnCnI4RBayy2V75pKhLKX5ktuVs4J+h4gOKThXWBHa/Ly0P1s9Ac+Kv7r8zoGbjwjNiVq1OjBc+IucyIsdnHCITU/ktEdsNmjEVY9YtA8+2An9yJgVs657lsiYBLiN+CPMfz935VFyj40rYIlfT95bYVMM4UtnpShZnqXuarXkgPDSVCAYFGR71rYDMdU74PZwHREidy9/NArgTFvhbmKOIS4EoPv8Ep2f8uktnfvOC+US+vFk/8GqWTHsg9rSPdYCKkI0lsXDHuHMz9cfWncOlbLOpEdLVGKZ51ZVpbaKdCOb34tciCiM2HvT44nBWZg/pag1ElC6ch4+J5G7rTLKRPS+iSucwrzX9Hr6yJDuPCgoZjMEAfUiJbaqUEFJ6/x+sKQvCoWn98tYUZ+XuCvtHPpQnfy7eVkYRhS+LeubzotpHJQHi1O60+p1YidghltJM1kKNccATBs91i3qEJWOHyvtfohq35LmhZ6ei+4AHkIWwzzWS59CUe9WeSnLTCawJe6SUlvlUxanj2ELZyY1mu3PzDrcF77FNEpGZp/bcIIbIsnDBub75H7e39xBwbUUcAb3g1+190hKnADcuI3FAxj+FehwUZOqIFlymVrzH/nJEpnGcGWer+Eaw7BVkvoVvvRlUyhtb3n1ldqJ25J7bx0tVdAbwIq0atfHW+bn2kS3bQIXkcRCN1sTCpJkyOD2FgYHTpvPTXEWY1O48+ipfGq2ZCHLlkbi7pZcZJxBmvYvoIqx1BZomlrW1r4DDMIxjazXgvSqeF1cnqM9WjLqal4UL49m492hTiSzJUqXRll3I9g0jtJObEjC9pBPD9uT0i2BIGzLfaaJLHvtPNkIUyNV1c/nWsEv+PlSywoPA5SGdbRFa6rpzE+dI1eqpDgvap7EPMrc3+KSPMtQwWXoJfVcPeaOmxPMKHVUXXGXiq7hrwQWwT7uP91UFyaWt84dRerkuQe5fGgRQ5fNN/4nrcIQWUEXyr8/nZloUm+50qSS9kY134ABRhTj0crpwRWYLUiuAAAD1zr78LAcdZ2RhZPytbQKEWO/nt6IH+BBOi2BxpweHX2MSyZsQYtKdoUYh8je90yTUMcExomven5uX0N1jkrUmND5FWSZ+8dqTwHkb35Ck1dMy16Suzv36XmMa5F+fktmcCrYwPMqf4MCVbvX/Co9CU4gA83ugTLdLoDn734WA4601+0QIj9iX39db1b1nOAYPj6zIrs9JA7NjvRddrJjQ1NT43bbzgf2ypC9OcdQm1QwnAoqd+4GiQgGHbH4/krbIZprrd+h1GybKjPZ4xLcA9xuKCFPEWeh7ZueNFL5V9EAUwhJdIWtO/YsM//T4roQulRdRQG5tMyiMBBKWtt/74Z7agVwootk/Kz7oy4iuQtEeV8PpDDvwe9h0RfiuFX2z9xTb04CvMXcX/1fB551YSpjPhbvFctKfr6376hjg9rxPltT5CbYeIfsPByXkLgMQ3i73OjojWsceYiQvayhPV40XgCZWpMaHyKqkMekPdi8PYA41dB89gfIzFqe/MYO0fJsiMeDeFjyrjwTUCQEz2dZs+bg0Rzy7lpn9/wm7S5lCntYHYyYymO9GJJlATeRMsGKrREZjEo68qjBjGJLtvDd8HF0h4RZuINSTBOepeeVj4ejGCS/Z3QGZTF8WT+qJCY9fuhQDzHiwxbqjwOGcp8Jquvyr4K0OOORWhwekfE55Qm44zK6rUT5u64CNghfiGsi18G3/w9kPdy7sdmNDesnHPEMYcplnxHlWcwb0R9xRYmiAMt7w4UeOe1PHIajVqZSXmubJhAi7YVdUVUmptnu/tk1mGmwfZt4NkZm988xxufmXS16Zl5cjaqMhAAP/Wji+pisrgWWRSQ1erolVZAv4hv/OG7Ajb+F8a6x77hdWx5TY9iladryo1ezTHQYnNlIDlaXQczmvb258KdhwfbA/xA+g5NwNkS+vkqjsI40GEjsvyQuySG6dtVEGwKOVBGrR0WJq/5h63EQHX6fRadW7/7mhlANGuFRVEbZlpFqCSUQSMp8Gaivs2NWnKFylE3MRVQsK+1ii2ut6q5/A0qWd8fr0x73gvtGz4AkcLZ0Q1x2dnJgVKXvo/vkAo5EjLJ6Lk0cW649F2rON3etXdbaERmYim6DQ4B4u+NzdiQ6czpxEOvGxsFjH+APUo+nIyW6uQO2noXWliZd/hdydLdpYtKLiLa0MffskFmJ8/s9vQ2F/k8uqb7s4HbixgMeaOfNLnLbIYbTsWb4ct8TS13Fee5PL/6mG/TAtcdaigRNGLeYd+qeVflGcqCcPKRTfyd9+GXSWSKjWLrFytAzMuFO2HOYdHXrvPwjfaG3JMvJfYdJQP1TuZEFZKIF1UYMjNl3KAR/pTbWZAcbqGTOZDb8kzinioOBbLK9f4nSkAAAAAAAARPT9q/+pTua5nr6o6pFPszJvdnGtR71iPGpNNx9yYSuJGEc1/ALGu8gmJd1YwWKp6Uizdslntv6IC+iog3Pr0ZkVFRnqavK+muKtc5WL1nGYwpyueOSELe6BeK8Vd/jUkhwXXA47zvXI6kz7ei0154W42cb+XGMDDXXBNTVY1kXQ2GJybU664+DxWY0qc4qsB9wkot6pcL0bSLAH1CyHofR64fop0TytuwcAj1tyzEkaxVNtJfLBiDWbjuLtZSbYzTgvuX00cf7faEupQYGcwkZkbdyKtsHUxuaqGt+ytJ9bR51Tzcgs7rgk2jNnsGjlyosxRsChxJKdYyekiw3Zi0AuI7I2PH6Fj3hqTcoUEX8GmG/tBu4kTB1yv0JWLPdL+8xT2vpUlJqcXXkITkh+y12G3P4dsom9m16TVAV9Ep2Dv1DhRwV3oOONKI+gvUJCcJCCBP45RSBYZc8+DIB6FK5ASkuYN6kpP3jIB1HIY1hKttDInK4Ob18jrQpXeLkePQOUXIqHLW4zL6ECmkiT5HtufygtD5jJnJ0EAAAAAAA==",alt:""})}),"\n",(0,i.jsx)(n.p,{children:"在容器内页打印了一条访问日志："}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)("img",{src:m,alt:""})}),"\n",(0,i.jsx)(n.p,{children:"至此，我们写的第一个 dockerfile 和 build 出的第一个镜像就跑成功了！"}),"\n",(0,i.jsx)(n.p,{children:"我们在 files 里看看 /app 下是啥内容："}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)("img",{src:k,alt:""})}),"\n",(0,i.jsx)(n.p,{children:"双击 index.html，可以看到这就是我们 build 镜像的时候 COPY 进去的文件。"}),"\n",(0,i.jsx)(n.p,{children:"但是我们想修改静态文件怎么办呢？"}),"\n",(0,i.jsx)(n.p,{children:"进入容器内改太麻烦，不如把这个 /app 目录设置为挂载点吧。"}),"\n",(0,i.jsx)(n.p,{children:"这样改下 Dockerfile："}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)("img",{src:o,alt:""})}),"\n",(0,i.jsx)(n.p,{children:"然后重新 build 出一个镜像来："}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"docker build -t aaa:ddd -f 2.Dockerfile .\n"})}),"\n",(0,i.jsx)(n.p,{children:"因为现在不是默认的 Dockerfile 了，需要用 -f 指定下 dockefile 的文件名。"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)("img",{src:f,alt:""})}),"\n",(0,i.jsx)(n.p,{children:"构建完之后再 run 一下这个新镜像："}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)("img",{src:b,alt:""})}),"\n",(0,i.jsx)(n.p,{children:"这次我把我的桌面目录作为数据卷挂载到 /app 目录了："}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)("img",{src:x,alt:""})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)("img",{src:j,alt:""})}),"\n",(0,i.jsx)(n.p,{children:"容器跑起来后可以看到确实挂载上去了，也标识为了 mount："}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)("img",{src:h,alt:""})}),"\n",(0,i.jsx)(n.p,{children:"浏览器访问下："}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)("img",{src:t,alt:""})}),"\n",(0,i.jsx)(n.p,{children:"在 inspect 这里也可以看到挂载的目录："}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)("img",{src:p,alt:""})}),"\n",(0,i.jsx)(n.p,{children:"有同学说，就算不在 dockerfile 里指定 VOLUME，我还是可以 docker run 的时候通过 -v 挂载数据卷呀。"}),"\n",(0,i.jsx)(n.p,{children:"那我为啥还要指定 VOLUME？"}),"\n",(0,i.jsx)(n.p,{children:"在 dockerfile 里指定 VOLUME 之后，如果你 docker run 的时候没有带 -v，那会放在一个临时的目录里。"}),"\n",(0,i.jsx)(n.p,{children:"比如我直接点击 run，不设置参数："}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)("img",{src:a,alt:""})}),"\n",(0,i.jsx)(n.p,{children:"docker 会随机给他生成一个名字。"}),"\n",(0,i.jsx)(n.p,{children:"还会随机生成一个目录作为数据卷挂载上去："}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)("img",{src:l,alt:""})}),"\n",(0,i.jsx)(n.p,{children:"inspect 可以看到这时候的路径是一个临时的目录："}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)("img",{src:s,alt:""})}),"\n",(0,i.jsx)(n.p,{children:"这样就算你删了容器，数据也可以在这里找回。"}),"\n",(0,i.jsx)(n.p,{children:"设想下，如果你跑了个 mysql 容器，存了很多数据，但是跑容器的时候没指定数据卷。有一天，你把容器删了，所有数据都没了，可不可怕？"}),"\n",(0,i.jsx)(n.p,{children:"为了避免这种情况，mysql 的 dockerfile 里是必须声明 volume 的，这样就算你没通过 -v 指定数据卷，将来也可以找回数据。"}),"\n",(0,i.jsx)(n.p,{children:"在镜像详情可以看到 mysql 的 dockerfile，确实声明了 volume"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)("img",{src:d,alt:""})}),"\n",(0,i.jsx)(n.p,{children:"这样就能保证数据不丢失。"}),"\n",(0,i.jsxs)(n.p,{children:["dockerfile 在",(0,i.jsx)(n.a,{href:"https://github.com/QuarkGluonPlasma/nestjs-course-code/tree/main/docker-test",target:"_blank",rel:"noopener noreferrer",children:"小册仓库"}),"。"]}),"\n",(0,i.jsxs)(n.h2,{id:"总结",children:["总结",(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#总结",children:"#"})]}),"\n",(0,i.jsx)(n.p,{children:"docker 镜像是通过 dockerfile 构建出来的。"}),"\n",(0,i.jsx)(n.p,{children:"我们写了第一个 dockerfile，通过 FROM、WORKDIR、COPY、RUN、EXPOSE、CMD 等指令声明了一个 http-server 提供静态服务的镜像。"}),"\n",(0,i.jsx)(n.p,{children:"docker run 这个镜像就可以生成容器，指定映射的端口、挂载的数据卷、环境变量等。"}),"\n",(0,i.jsx)(n.p,{children:"VOLUME 指令看起来没啥用，但能保证你容器内某个目录下的数据一定会被持久化，能保证没挂载数据卷的时候，数据不丢失。"}),"\n",(0,i.jsx)(n.p,{children:"写完这个 dockerfile，相信你会对 docker 镜像、容器有更具体的理解了。"})]})}function R(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,r.ah)(),e.components);return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(I,{...e})}):I(e)}let P=R;R.__RSPRESS_PAGE_META={},R.__RSPRESS_PAGE_META["Nest%20%E9%80%9A%E5%85%B3%E7%A7%98%E7%B1%8D%20%20%E6%9C%80%E6%96%B0200%E7%AB%A0%2F40.%20%E4%BD%A0%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AA%20Dockerfile.md"]={toc:[{text:"总结",id:"总结",depth:2}],title:"40. 你的第一个 Dockerfile",headingTitle:"40. 你的第一个 Dockerfile",frontmatter:{}}}}]);