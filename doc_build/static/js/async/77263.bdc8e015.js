"use strict";(self.webpackChunkjue_jin_book_press=self.webpackChunkjue_jin_book_press||[]).push([["77263"],{56962:function(e,n,c){c.r(n),c.d(n,{default:()=>h});var s=c(552676),r=c(740453);let d=c.p+"static/image/512fbaabf87a0ce4779ec0d5ed20d1d1.7ac58217.webp",i=c.p+"static/image/2a855eee22904e5b1d5771fe33014fc9.7f6993c0.webp";function l(e){let n=Object.assign({h1:"h1",a:"a",blockquote:"blockquote",p:"p",h3:"h3",code:"code",img:"img",strong:"strong",h5:"h5",pre:"pre",ul:"ul",li:"li",hr:"hr",input:"input"},(0,r.ah)(),e.components);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.h1,{id:"8访问加密还用http访问url不怕被劫持吗",children:["8.访问加密：还用HTTP访问URL，不怕被劫持吗？",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#8访问加密还用http访问url不怕被劫持吗",children:"#"})]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"技术要点：HTTPS、Certbot"}),"\n"]}),"\n",(0,s.jsxs)(n.h3,{id:"前言",children:["前言",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#前言",children:"#"})]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"Nginx"}),"部署完毕可通过",(0,s.jsx)(n.code,{children:"http://yangzw.vip"}),"访问自己的个人官网。打开个人官网，有强迫症的同学可能很快会注意到浏览器地址栏左边显示一个不安全的标记。"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:"data:image/webp;base64,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",alt:"不安全"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"HTTP报文"}),"以明文形式传输，若网站只支持",(0,s.jsx)(n.code,{children:"HTTP协议"}),"，就有可能遭受到安全攻击。使用",(0,s.jsx)(n.code,{children:"Chrome"}),"打开",(0,s.jsx)(n.code,{children:"HTTP协议"}),"的个人官网，自然就会在浏览器地址栏左边显示该标记。若不加以处理，轻则挂满垃圾广告，重则被不法分子盗用。本章将带领你",(0,s.jsx)(n.strong,{children:"不花一分钱部署HTTPS证书"}),"，把自己域名中所有网站升级为",(0,s.jsx)(n.code,{children:"HTTPS协议"}),"，通过",(0,s.jsx)(n.code,{children:"HTTPS"}),"为",(0,s.jsx)(n.code,{children:"HTTP报文"}),"提供一个加密传输通道，这样攻击者就无法窃听或篡改传输内容了。"]}),"\n",(0,s.jsxs)(n.h3,{id:"背景有免费https证书却不用",children:["背景：有免费HTTPS证书却不用",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#背景有免费https证书却不用",children:"#"})]}),"\n",(0,s.jsxs)(n.p,{children:["要启用",(0,s.jsx)(n.code,{children:"HTTPS"}),"，必须向一个可信任机构申请一个",(0,s.jsx)(n.code,{children:"HTTPS证书"}),"。发现很多公司都会寻求阿里云、腾讯云、百度云、华为云等第三方平台提供免费或付费的",(0,s.jsx)(n.code,{children:"HTTPS证书"}),"，像阿里云会提供一年的免费的",(0,s.jsx)(n.code,{children:"HTTPS证书"}),"，但一年有何用，又不是一直免费，到期续费还要",(0,s.jsx)(n.code,{children:"2000"}),"多一年，要你有何用？"]}),"\n",(0,s.jsxs)(n.p,{children:["专业的",(0,s.jsx)(n.code,{children:"HTTPS证书"}),"申请需收费，不过对于个人官网来说可用免费的",(0,s.jsx)(n.code,{children:"HTTPS证书"}),"，推荐一个免费好用的",(0,s.jsx)(n.code,{children:"HTTPS证书"}),"服务商",(0,s.jsx)(n.a,{href:"https://letsencrypt.org",target:"_blank",rel:"noopener noreferrer",children:"Letsencrypt"}),"。"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Letsencrypt"}),"作为一个公共且提供免费",(0,s.jsx)(n.code,{children:"SSL"}),"的项目逐渐被广大用户传播与使用。它由",(0,s.jsx)(n.code,{children:"Mozilla"}),"、",(0,s.jsx)(n.code,{children:"Cisco"}),"、",(0,s.jsx)(n.code,{children:"Akamai"}),"、",(0,s.jsx)(n.code,{children:"IdenTrust"}),"、",(0,s.jsx)(n.code,{children:"EFF"}),"等组织发起，主要目的是为了推进网站从",(0,s.jsx)(n.code,{children:"HTTP"}),"向",(0,s.jsx)(n.code,{children:"HTTPS"}),"过渡的进程，目前已有越来越多的商家加入与赞助支持。相信在未来，所有",(0,s.jsx)(n.code,{children:"HTTPS证书"}),"都能让你白嫖。"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"Letsencrypt"}),"不仅提供免费的",(0,s.jsx)(n.code,{children:"HTTPS证书"}),"申请服务且申请过程很简单，关键是能与第7章学习的",(0,s.jsx)(n.code,{children:"Nginx"}),"完美契合，可谓一劳永逸。"]}),"\n",(0,s.jsxs)(n.h3,{id:"方案不花一分钱部署https证书",children:["方案：不花一分钱部署HTTPS证书",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#方案不花一分钱部署https证书",children:"#"})]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"Letsencrypt"}),"提供一个称为",(0,s.jsx)(n.code,{children:"certbot"}),"的工具，它可快速生成或刷新",(0,s.jsx)(n.code,{children:"HTTPS证书"}),"。不过",(0,s.jsx)(n.code,{children:"CentOS8"}),"的",(0,s.jsx)(n.code,{children:"yum"}),"中未包括",(0,s.jsx)(n.code,{children:"certbot源"}),"，所以无法使用",(0,s.jsx)(n.code,{children:"yum"}),"安装。当然可用",(0,s.jsx)(n.code,{children:"dnf"}),"代替",(0,s.jsx)(n.code,{children:"yum"}),"安装",(0,s.jsx)(n.code,{children:"certbot"}),"，",(0,s.jsx)(n.code,{children:"CentOS8"}),"已内置",(0,s.jsx)(n.code,{children:"dnf"}),"，它也是一个",(0,s.jsx)(n.strong,{children:"Shell软件包管理器"}),"。"]}),"\n",(0,s.jsxs)(n.h5,{id:"安装",children:["安装",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#安装",children:"#"})]}),"\n",(0,s.jsxs)(n.p,{children:["打开",(0,s.jsx)(n.code,{children:"CMD工具"}),"，登录服务器。执行",(0,s.jsx)(n.code,{children:"dnf --version"}),"，输出版本表示软件可用。通过以下方式安装",(0,s.jsx)(n.code,{children:"certbot"}),"。"]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"增加epel源"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"dnf install https://dl.fedoraproject.org/pub/epel/epel-release-latest-8.noarch.rpm\n"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"更新dnf仓库"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"dnf upgrade\n"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"安装snap"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.a,{href:"https://certbot.eff.org/instructions?ws=nginx&os=centosrhel8",target:"_blank",rel:"noopener noreferrer",children:"certbot"}),"官网也推荐使用",(0,s.jsx)(n.code,{children:"snap"}),"安装",(0,s.jsx)(n.code,{children:"certbot"}),"。"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"dnf install snapd -y\n"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"设置开机自启"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"systemctl enable --now snapd.socket\n"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"设置软链接"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["可通过",(0,s.jsx)(n.code,{children:"snapd"}),"快速调用命令。"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"ln -s /var/lib/snapd/snap /snap\n"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"更新快照"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"snap install core\nsnap refresh core\n"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"安装certbot"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"因为文件体积较大，安装有点慢，请耐心等待。"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"snap install --classic certbot\n"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"设置软链接"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["可通过",(0,s.jsx)(n.code,{children:"certbot"}),"快速调用命令。"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"ln -s /snap/bin/certbot /usr/bin/certbot\n"})}),"\n",(0,s.jsxs)(n.p,{children:["相比",(0,s.jsx)(n.code,{children:"CentOS7"}),"，",(0,s.jsx)(n.code,{children:"CentOS8"}),"安装",(0,s.jsx)(n.code,{children:"certbot"}),"复杂很多，一定要根据上述命令逐条执行完毕。若安装失败，请从第一步重新开始。"]}),"\n",(0,s.jsxs)(n.h5,{id:"配置",children:["配置",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#配置",children:"#"})]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"certbot"}),"安装完毕执行",(0,s.jsx)(n.code,{children:"certbot --version"}),"，输出版本表示安装成功。"]}),"\n",(0,s.jsxs)(n.p,{children:["执行",(0,s.jsx)(n.code,{children:"certbot --nginx"}),"扫描",(0,s.jsx)(n.code,{children:"Nginx"}),"所有配置，输出以下信息。"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"Saving debug log to /var/log/letsencrypt/letsencrypt.log\nEnter email address (used for urgent renewal and security notices)\n (Enter 'c' to cancel): young.joway@aliyun.com\n\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nPlease read the Terms of Service at\nhttps://letsencrypt.org/documents/LE-SA-v1.2-November-15-2017.pdf. You must\nagree in order to register with the ACME server. Do you agree?\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n(Y)es/(N)o: y\n\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nWould you be willing, once your first certificate is successfully issued, to\nshare your email address with the Electronic Frontier Foundation, a founding\npartner of the Let's Encrypt project and the non-profit organization that\ndevelops Certbot? We'd like to send you email about our work encrypting the web,\nEFF news, campaigns, and ways to support digital freedom.\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n(Y)es/(N)o: n\nAccount registered.\n\nWhich names would you like to activate HTTPS for?\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n1: yangzw.vip\n2: www.yangzw.vip\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nSelect the appropriate numbers separated by commas and/or spaces, or leave input\nblank to select all options shown (Enter 'c' to cancel): 1,2\nRequesting a certificate for yangzw.vip and www.yangzw.vip\n\nSuccessfully received certificate.\nCertificate is saved at: /etc/letsencrypt/live/yangzw.vip/fullchain.pem\nKey is saved at:         /etc/letsencrypt/live/yangzw.vip/privkey.pem\nThis certificate expires on 2022-05-23.\nThese files will be updated when the certificate renews.\nCertbot has set up a scheduled task to automatically renew this certificate in the background.\n\nDeploying certificate\nSuccessfully deployed certificate for yangzw.vip to /etc/nginx/conf.d/yangzw.vip.conf\nSuccessfully deployed certificate for www.yangzw.vip to /etc/nginx/conf.d/yangzw.vip.conf\nCongratulations! You have successfully enabled HTTPS on https://yangzw.vip and https://www.yangzw.vip\n"})}),"\n",(0,s.jsx)(n.p,{children:"翻译上述英文，跟随我填写。"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["输入电子邮箱：输入",(0,s.jsx)(n.code,{children:"邮箱"}),"，用于",(0,s.jsx)(n.code,{children:"紧急续签"}),"与",(0,s.jsx)(n.code,{children:"安全通知"})]}),"\n",(0,s.jsxs)(n.li,{children:["是否同意服务条款：输入",(0,s.jsx)(n.code,{children:"y"}),"同意"]}),"\n",(0,s.jsxs)(n.li,{children:["是否接受新闻邮件：输入",(0,s.jsx)(n.code,{children:"n"}),"不同意"]}),"\n",(0,s.jsx)(n.li,{children:"注册账户成功：自动处理，请耐心等待"}),"\n",(0,s.jsxs)(n.li,{children:["选择需激活",(0,s.jsx)(n.code,{children:"HTTPS协议"}),"的域名：根据列表输入",(0,s.jsx)(n.code,{children:"数字"}),"，以",(0,s.jsx)(n.code,{children:"空格"}),"或",(0,s.jsx)(n.code,{children:"英文逗号"}),"分隔"]}),"\n",(0,s.jsx)(n.li,{children:"申请证书服务：自动处理，请耐心等待"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"HTTPS证书"}),"最终生成到",(0,s.jsx)(n.code,{children:"/etc/letsencrypt/live/yangzw.vip"}),"目录中。打开",(0,s.jsx)(n.code,{children:"FTP工具"}),"，进入到该目录，以下文件就是通过",(0,s.jsx)(n.code,{children:"certbot"}),"自动签发的",(0,s.jsx)(n.code,{children:"HTTPS证书"}),"。"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:i,alt:"证书文件"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"HTTPS证书"}),"的有效期为三个月，三个月后不续签就会自动失效。因为",(0,s.jsx)(n.code,{children:"certbot"}),"已设置开机自启，所以",(0,s.jsx)(n.code,{children:"certbot"}),"会一直在后台运行，这些文件将在",(0,s.jsx)(n.code,{children:"HTTPS证书"}),"续订时自动更新，以达到一直免费使用的效果。"]}),"\n",(0,s.jsxs)(n.h3,{id:"解读nginx配置文件改动哪些内容",children:["解读：Nginx配置文件改动哪些内容",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#解读nginx配置文件改动哪些内容",children:"#"})]}),"\n",(0,s.jsxs)(n.p,{children:["签发",(0,s.jsx)(n.code,{children:"HTTPS证书"}),"会自动修改对应",(0,s.jsx)(n.code,{children:"Nginx配置文件"}),"。看看",(0,s.jsx)(n.code,{children:"certbot"}),"对",(0,s.jsx)(n.code,{children:"Nginx"}),"的配置文件做了哪些改动。还记得第7章个人官网的",(0,s.jsx)(n.code,{children:"yangzw.vip.conf"}),"的内容吗？"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"server {\n	listen 80;\n	server_name yangzw.vip www.yangzw.vip;\n	location / {\n		root /www/client/yangzw;\n		index index.html;\n	}\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["执行",(0,s.jsx)(n.code,{children:"vim /etc/nginx/conf.d/yangzw.vip.conf"}),"，发现变成以下内容。凡是后方有这段注释",(0,s.jsx)(n.code,{children:"# managed by Certbot"}),"的代码都是由",(0,s.jsx)(n.code,{children:"certbot"}),"生成。"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"server {\n	server_name yangzw.vip www.yangzw.vip;\n	location / {\n		root /www/client/yangzw;\n		index index.html;\n	}\n	listen 443 ssl; # managed by Certbot\n	include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot\n	ssl_certificate /etc/letsencrypt/live/yangzw.vip/fullchain.pem; # managed by Certbot\n	ssl_certificate_key /etc/letsencrypt/live/yangzw.vip/privkey.pem; # managed by Certbot\n	ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot\n}\nserver {\n	if ($host = www.yangzw.vip) {\n		return 301 https://$host$request_uri;\n	} # managed by Certbot\n	if ($host = yangzw.vip) {\n		return 301 https://$host$request_uri;\n	} # managed by Certbot\n	listen 80;\n	server_name yangzw.vip www.yangzw.vip;\n	return 404; # managed by Certbot\n}\n"})}),"\n",(0,s.jsxs)(n.h5,{id:"修改端口",children:["修改端口",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#修改端口",children:"#"})]}),"\n",(0,s.jsxs)(n.p,{children:["端口从原来的",(0,s.jsx)(n.code,{children:"80"}),"改成",(0,s.jsx)(n.code,{children:"443"}),"并从第一个",(0,s.jsx)(n.code,{children:"server块"}),"移动到第二个",(0,s.jsx)(n.code,{children:"server块"}),"中，第二个",(0,s.jsx)(n.code,{children:"server块"}),"也是由",(0,s.jsx)(n.code,{children:"certbot"}),"生成。"]}),"\n",(0,s.jsxs)(n.h5,{id:"导入证书",children:["导入证书",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#导入证书",children:"#"})]}),"\n",(0,s.jsxs)(n.p,{children:["加入以下核心代码，告知",(0,s.jsx)(n.code,{children:"Nginx"}),"要使用",(0,s.jsx)(n.code,{children:"HTTPS协议"}),"，通过绝对路径导入",(0,s.jsx)(n.code,{children:"证书文件"}),"。这些文件在上述已通过",(0,s.jsx)(n.code,{children:"FTP工具"}),"展示出来了。"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"ssl_certificate /etc/letsencrypt/live/yangzw.vip/fullchain.pem;\nssl_certificate_key /etc/letsencrypt/live/yangzw.vip/privkey.pem;\n"})}),"\n",(0,s.jsxs)(n.h5,{id:"重定向",children:["重定向",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#重定向",children:"#"})]}),"\n",(0,s.jsxs)(n.p,{children:["加入两个",(0,s.jsx)(n.code,{children:"if ($host = xyz) {}"}),"的判断，当使用非",(0,s.jsx)(n.code,{children:"HTTPS协议"}),"访问域名时，直接",(0,s.jsx)(n.code,{children:"301"}),"重定向到",(0,s.jsx)(n.code,{children:"https://$host$request_uri"}),"。若出现其他情况则",(0,s.jsx)(n.code,{children:"404"}),"。"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"certbot"}),"会根据选择的域名自动匹配出对应",(0,s.jsx)(n.code,{children:"Nginx配置文件"}),"并对其做上述三部分改动，所以每次增加一个网站都需单独创建",(0,s.jsx)(n.code,{children:"xyz.yangzw.conf"}),"文件到",(0,s.jsx)(n.code,{children:"conf.d"}),"文件夹中，目的是为了隔离每个网站的",(0,s.jsx)(n.code,{children:"Nginx配置"}),"。"]}),"\n",(0,s.jsxs)(n.p,{children:["在浏览器地址栏中输入",(0,s.jsx)(n.code,{children:"https://yangzw.vip"}),"，发现网页",(0,s.jsx)(n.code,{children:"404"}),"。每次新开端口都需在服务器中配置安全组，可回看第7章的",(0,s.jsx)(n.code,{children:"个人官网-安全组配置"}),"。这次增加",(0,s.jsx)(n.code,{children:"443"}),"端口，在安全组中配置一个",(0,s.jsx)(n.code,{children:"443"}),"端口。再次输入",(0,s.jsx)(n.code,{children:"https://yangzw.vip"}),"就可正常访问了。"]}),"\n",(0,s.jsxs)(n.p,{children:["在浏览器地址栏中输入",(0,s.jsx)(n.code,{children:"http://yangzw.vip"}),"，发现其重定向到",(0,s.jsx)(n.code,{children:"https://yangzw.vip"}),"，后续所有网站都可通过该方案升级为",(0,s.jsx)(n.code,{children:"HTTPS协议"}),"的网站了。"]}),"\n",(0,s.jsxs)(n.p,{children:["打开",(0,s.jsx)(n.a,{href:"https://www.ssllabs.com/ssltest",target:"_blank",rel:"noopener noreferrer",children:"SslTest"}),"或",(0,s.jsx)(n.a,{href:"https://www.sslshopper.com/ssl-checker.html",target:"_blank",rel:"noopener noreferrer",children:"SslChecker"}),"，输入域名就可检查证书是否有效。"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:d,alt:"检测HTTPS"})}),"\n",(0,s.jsxs)(n.h3,{id:"总结",children:["总结",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#总结",children:"#"})]}),"\n",(0,s.jsxs)(n.p,{children:["得益于",(0,s.jsx)(n.code,{children:"certbot"}),"才能无限期使用免费的",(0,s.jsx)(n.code,{children:"HTTPS证书"}),"，更应响应号召，通过上述方案把所有",(0,s.jsx)(n.code,{children:"HTTP协议"}),"网站升级",(0,s.jsx)(n.code,{children:"HTTPS协议"}),"网站。当然也不要再花钱购买那些厂商的",(0,s.jsx)(n.code,{children:"HTTPS证书"}),"了，简直是亏大发。"]}),"\n",(0,s.jsxs)(n.p,{children:["其实",(0,s.jsx)(n.code,{children:"Nginx"}),"的功能很强大，后续章节会继续结合其他应用场景聊聊",(0,s.jsx)(n.code,{children:"Nginx"}),"在实际开发中的应用。"]}),"\n",(0,s.jsx)(n.p,{children:"本章内容到此为止，希望能对你有所启发，欢迎你把自己的学习心得打到评论区！"}),"\n",(0,s.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",checked:!0,disabled:!0})," ","示例项目：",(0,s.jsx)(n.a,{href:"https://github.com/JowayYoung/fe-engineering",target:"_blank",rel:"noopener noreferrer",children:"fe-engineering"})]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",checked:!0,disabled:!0})," ","正式项目：",(0,s.jsx)(n.a,{href:"https://github.com/JowayYoung/bruce",target:"_blank",rel:"noopener noreferrer",children:"bruce"})]}),"\n"]})]})}function t(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,r.ah)(),e.components);return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}let h=t;t.__RSPRESS_PAGE_META={},t.__RSPRESS_PAGE_META["%E4%BB%8E%200%20%E5%88%B0%201%20%E8%90%BD%E5%9C%B0%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96%2F8.%E8%AE%BF%E9%97%AE%E5%8A%A0%E5%AF%86%EF%BC%9A%E8%BF%98%E7%94%A8HTTP%E8%AE%BF%E9%97%AEURL%EF%BC%8C%E4%B8%8D%E6%80%95%E8%A2%AB%E5%8A%AB%E6%8C%81%E5%90%97%EF%BC%9F.md"]={toc:[{text:"前言",id:"前言",depth:3},{text:"背景：有免费HTTPS证书却不用",id:"背景有免费https证书却不用",depth:3},{text:"方案：不花一分钱部署HTTPS证书",id:"方案不花一分钱部署https证书",depth:3},{text:"解读：Nginx配置文件改动哪些内容",id:"解读nginx配置文件改动哪些内容",depth:3},{text:"总结",id:"总结",depth:3}],title:"8.访问加密：还用HTTP访问URL，不怕被劫持吗？",headingTitle:"8.访问加密：还用HTTP访问URL，不怕被劫持吗？",frontmatter:{}}}}]);