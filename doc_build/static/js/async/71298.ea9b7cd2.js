"use strict";(self.webpackChunkjue_jin_book_press=self.webpackChunkjue_jin_book_press||[]).push([["71298"],{417377:function(e,n,o){o.r(n),o.d(n,{default:()=>j});var d=o(552676),t=o(740453);let r=o.p+"static/image/23d7b893f3ad8a3a16a39e91d4bf5d3e.da3704b5.webp",s=o.p+"static/image/f73e5875e1d9a0f9e3dff9a5c4669b28.b9694f77.webp",l=o.p+"static/image/ef4e7e9cbbbf5f1a13d082aaab681605.b74442d2.webp",c=o.p+"static/image/ad8a1346088fe640fccb29ad4e454e50.d5835437.webp",h=o.p+"static/image/edc0c1644c4d9c19b12beb0287cba4e2.2f57bccb.webp",i=o.p+"static/image/be8f63908cd50cebfa463bdc99dae21e.2528fe90.webp";function p(e){let n=Object.assign({h1:"h1",a:"a",p:"p",pre:"pre",code:"code",h2:"h2",img:"img"},(0,t.ah)(),e.components);return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(n.h1,{id:"47编译-chrome-devtools-frontend-源码然后用它来调试",children:["47.编译 chrome devtools frontend 源码，然后用它来调试",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#47编译-chrome-devtools-frontend-源码然后用它来调试",children:"#"})]}),"\n",(0,d.jsx)(n.p,{children:"前面我们通过 npm 下载过 chrome devtools frontend 的代码："}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"npm install chrome-devtools-frontend@1.0.672485\n"})}),"\n",(0,d.jsx)(n.p,{children:"但是那个是比较老的版本，不需要 build。"}),"\n",(0,d.jsx)(n.p,{children:"如果想用新版本的 chrome devtools frontend，就需要下载源码自己 build 了。"}),"\n",(0,d.jsx)(n.p,{children:"这节我们一起来编译下 chrome devtools frontend 源码，并且做下修改，生成新的 chrome devtools。"}),"\n",(0,d.jsxs)(n.h2,{id:"下载-depot_tools",children:["下载 depot_tools",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#下载-depot_tools",children:"#"})]}),"\n",(0,d.jsx)(n.p,{children:"chrome devtools frontend 有一套自己的工具链，我们先把这套工具链下载下来。"}),"\n",(0,d.jsx)(n.p,{children:"从 google code 下载即可（需要科学上网）："}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"git clone https://chromium.googlesource.com/chromium/tools/depot_tools.git\n"})}),"\n",(0,d.jsx)(n.p,{children:"它有很多命令，我们要把它夹到环境变量里，这样就能直接用了："}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"export PATH=/本地的路径/depot_tools:$PATH\n"})}),"\n",(0,d.jsx)(n.p,{children:"我们会用到这个工具链的 fetch/gn/autoninja/gclient 这些命令。"}),"\n",(0,d.jsx)(n.p,{children:"下面下载 chrome devtools frontend 代码："}),"\n",(0,d.jsxs)(n.h2,{id:"下载和编译-devtools-frontend",children:["下载和编译 devtools frontend",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#下载和编译-devtools-frontend",children:"#"})]}),"\n",(0,d.jsx)(n.p,{children:"创建个 devtools 目录："}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"mkdir devtools\n\ncd devtools\n"})}),"\n",(0,d.jsx)(n.p,{children:"然后在 devtools 目录下执行 fetch 下载 devtools frontend 代码（这步也是从谷歌网站下载代码，需要科学上网）："}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"fetch devtools-frontend\n"})}),"\n",(0,d.jsx)(n.p,{children:"这个 fetch 命令就是前面那个 depot_tools 工具包里的。"}),"\n",(0,d.jsx)(n.p,{children:"下载完之后，font_end 目录下就是 devtools 的前端代码："}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:i,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"我们改一些代码，比如 front_end/panels/profiler/ProfileLauncherView.ts 里加两行代码："}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:h,alt:""})}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:'this.controlButton.textContent="快照测试"\nthis.controlButton.style.backgroundColor = "red";\n'})}),"\n",(0,d.jsx)(n.p,{children:"然后执行编译。"}),"\n",(0,d.jsx)(n.p,{children:"在 devtools-frontend 目录下执行："}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"gn gen out/Default --args='devtools_skip_typecheck=true'\n\nautoninja -C out/Default\n"})}),"\n",(0,d.jsx)(n.p,{children:"gn 是生成编译配置的，而 autoninja 是编译的，这俩都是 depot_tools 工具包的命令。"}),"\n",(0,d.jsx)(n.p,{children:"编译完之后就可以在 out/Default/gen/front_end 下看到编译产物了："}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:c,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"这些 html 是不是似曾相识？"}),"\n",(0,d.jsx)(n.p,{children:"没错，这就是我们之前测试 CDP 用的那些 chrome-devtools-fontend 包里的 html。"}),"\n",(0,d.jsx)(n.p,{children:"在这个目录下执行 npx http-server ."}),"\n",(0,d.jsx)(n.p,{children:"然后点开 html 就可以了。"}),"\n",(0,d.jsx)(n.p,{children:"比如 devtools_app.html："}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:l,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"看到那个大红按钮了没？"}),"\n",(0,d.jsx)(n.p,{children:"这就是我们修改 ts 源码然后编译产生的 devtools frontend。"}),"\n",(0,d.jsx)(n.p,{children:"那能不能平时也用自己改过的 chrome_devtools_frontend 来调试呢？"}),"\n",(0,d.jsx)(n.p,{children:"当然是可以的："}),"\n",(0,d.jsx)(n.p,{children:"chrome 有个 --custom-devtools-frontend 的启动参数可以自定义 frontend："}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:'sudo "/Applications/Google Chrome.app/Contents/MacOS/Google Chrome" --custom-devtools-frontend=file://本地路径/devtools/devtools-frontend/out/Default/gen/front_end\n'})}),"\n",(0,d.jsx)(n.p,{children:"跑起来在用 chrome devtools 你就会发现是用的我们改过的了："}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:s,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"那在用 vscode debugger 调试的时候，能不能用呢？"}),"\n",(0,d.jsx)(n.p,{children:"当然可以："}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-json",children:' {\n    "name": "Launch Chrome",\n    "request": "launch",\n    "type": "chrome",\n    "runtimeArgs": [\n        "--auto-open-devtools-for-tabs",\n        "--custom-devtools-frontend=file:///Users/guang/code/devtools/devtools-frontend/out/Default/gen/front_end"\n    ],\n    "url": "http://localhost:3001",\n    "webRoot": "${workspaceFolder}"\n}\n'})}),"\n",(0,d.jsx)(n.p,{children:"我们之前加过启动参数，再加一个 --custom-devtools-frontend 的启动参数即可。"}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)("img",{src:r,alt:""})}),"\n",(0,d.jsx)(n.p,{children:"这样我们平时调试就可以用自己修改过后的 chrome devtools 了。"}),"\n",(0,d.jsxs)(n.h2,{id:"总结",children:["总结",(0,d.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#总结",children:"#"})]}),"\n",(0,d.jsx)(n.p,{children:"这节我们编译了 chrome devtools frontend 的 ts 源码，并且修改之后在 chrome 里使用。"}),"\n",(0,d.jsx)(n.p,{children:"下载和编译 devtools frontend 代码需要使用 depot_tools 的工具链，它提供了一些命令，加到 PATH 环境变量中就可以直接用了。"}),"\n",(0,d.jsx)(n.p,{children:"通过 --custom-devtools-frontend  的启动参数就可以指定 chrome 用自定义的 chrome devtools，我们平时用 VSCode Debugger 调试的时候也可以使用。"}),"\n",(0,d.jsx)(n.p,{children:"你完全可以定制自己的 chrome devtools，比如删掉一些工具，加上你自己的一些小工具，然后平时用这个 chrome devtools 来调试！"})]})}function a(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,t.ah)(),e.components);return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(p,{...e})}):p(e)}let j=a;a.__RSPRESS_PAGE_META={},a.__RSPRESS_PAGE_META["%E5%89%8D%E7%AB%AF%E8%B0%83%E8%AF%95%E9%80%9A%E5%85%B3%E7%A7%98%E7%B1%8D%2F47.%E7%BC%96%E8%AF%91%20chrome%20devtools%20frontend%20%E6%BA%90%E7%A0%81%EF%BC%8C%E7%84%B6%E5%90%8E%E7%94%A8%E5%AE%83%E6%9D%A5%E8%B0%83%E8%AF%95.md"]={toc:[{text:"下载 depot_tools",id:"下载-depot_tools",depth:2},{text:"下载和编译 devtools frontend",id:"下载和编译-devtools-frontend",depth:2},{text:"总结",id:"总结",depth:2}],title:"47.编译 chrome devtools frontend 源码，然后用它来调试",headingTitle:"47.编译 chrome devtools frontend 源码，然后用它来调试",frontmatter:{}}}}]);