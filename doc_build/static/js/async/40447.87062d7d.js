"use strict";(self.webpackChunkjue_jin_book_press=self.webpackChunkjue_jin_book_press||[]).push([["40447"],{754956:function(e,n,s){e.exports=s.p+"static/image/f66a57a27cd1490af21916a3fcee9361.e32eba78.webp"},128109:function(e,n,s){s.r(n),s.d(n,{default:()=>ee});var c=s(552676),d=s(740453);let i=s.p+"static/image/df1452b7953eba7204c4c59ca4b6d227.5b2ad6ed.webp",r=s.p+"static/image/2cf3c87c6805289cd3e68ce6c07b5737.6c3389a1.webp",a=s.p+"static/image/28d7bd1de108befbbc5d6af559eb9d45.29dc937e.webp",t=s.p+"static/image/37833f66d682fcfdce4a3ec6cfcac94f.9a8bdb5c.webp",l=s.p+"static/image/6ef673ab9f4398a9a5501015f3828979.4595f611.webp",p=s.p+"static/image/517df061ed21921ad2fe893f2defd884.32ba02ef.webp",x=s.p+"static/image/18b66b659c0013f1f6db6b464e4f7ab6.63fa5208.webp",h=s.p+"static/image/aa2a5c1bd4b2f12fce88570b04c91f19.427c796b.webp",j=s.p+"static/image/a8e3db64fe2eb25b9cab894d736dc555.e74509cf.webp",m=s.p+"static/image/9eec4e51b92dac7c4bba5211d745b8d4.b381f49b.webp",b=s.p+"static/image/5a454376388abc20e632e347519cbd88.e1d658d4.webp",g=s.p+"static/image/e1f2fd271f15118945414328c9ad55e1.9cf2b767.webp",o=s.p+"static/image/3a565fb55586d6bebc4a3cba317d9f07.0d7f662f.webp",f=s.p+"static/image/ea289b221a53184132bc4c4d6935d57f.2431a24d.webp",u=s.p+"static/image/ea295a9b53e9ed7b18e2102943d6dea2.919d20c0.webp",A=s.p+"static/image/60670a6e3344090fd9e7d9b652ab3fca.5985235e.webp",w=s.p+"static/image/4674f81e0bad0bcce24608a94beb281b.4e1f8c6f.webp",v=s.p+"static/image/fa5c0adeca35829b5f454b1db792b641.59bb3670.webp",E=s.p+"static/image/9c11487a9f88eb511364655cfef3403b.5986b615.webp",I=s.p+"static/image/315a1cbbbf9daddaa675455059037e72.4fcbd8d1.webp",S=s.p+"static/image/a129abe9aa7eeea40786ca4dff02d7c3.2cf830d0.webp",T=s.p+"static/image/9045e0d5c0dfd3274b4b580f3fb5e093.412f0662.webp",P=s.p+"static/image/45a684af3742f90eb525b8d22a56c1e6.a469b77f.webp",q=s.p+"static/image/ddbaa5e3ad28b3d52ffb9296050a09d2.62860059.webp",H=s.p+"static/image/4fd36887758e6434a9149846b741f938.840d9ade.webp",Y=s.p+"static/image/777e1bfa6eec228063d1abee8eda0288.eb3c1568.webp",R=s.p+"static/image/16ddb33d7451957a89332e8b5dd06a61.7eedf1dd.webp",C=s.p+"static/image/d8c7a3f8525ec350adff1d473fc0d1bb.b8fa75d1.webp",K=s.p+"static/image/84f515adc29d75ccc551888e2ac34b52.4f4dcf04.webp",k=s.p+"static/image/52fe1c04ecda1db2ed9a337ad18ea036.f84bae99.webp",B=s.p+"static/image/fce5e1f310c8d945af420ec84bda8f8a.689e3616.webp",y=s.p+"static/image/33941b1eccfb8ccc9de473631c0c5e2d.6c36ff47.gif",U=s.p+"static/image/178ecf1341500fa9b76d60138a165e07.0ae74a6e.webp",V=s.p+"static/image/54b173608815cb8aabd0c1f04901bec7.57967dae.webp",D=s.p+"static/image/8601b744d7e8deaa291ccc027fb9ed99.acb53e64.webp",W=s.p+"static/image/5b0cadbbd01b72f08fac83052d6fc0c3.07c0b1b3.webp",X=s.p+"static/image/ae0091731d3fc0c82fcfdaba3e86cc18.b4c51578.webp",Q=s.p+"static/image/baaabf6ef1ab37f5b822a82c196f0d5d.3b680e7d.webp",Z=s.p+"static/image/cb5c18c3b11643429f2c7ba1d7b843bb.e7447ed5.webp",N=s.p+"static/image/24efccebb47074bec8140025ca104760.a1bd5d67.webp",z=s.p+"static/image/2e26e6f61b6008232feb138802569c10.b1ad8fd1.webp",G=s.p+"static/image/25f642ef11ca4c163778ba1a7a6aac50.f3fc048f.webp",J=s.p+"static/image/4b47fdb882bb8aeaec59e89115730544.0de96806.webp",M=s.p+"static/image/797c94bf9ad08ddda1ee397cf4d2459e.906ae43a.webp";var O=s(754956);let F=s.p+"static/image/bd9dc060f1c848962228a7e56f9a89bd.f6724066.webp",L=s.p+"static/image/d1baaa1617dfbdbba60cb9e1819e54fd.e4db5a30.webp";function _(e){let n=Object.assign({h1:"h1",a:"a",p:"p",pre:"pre",code:"code",img:"img",h2:"h2",ul:"ul",li:"li",strong:"strong"},(0,d.ah)(),e.components);return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)(n.h1,{id:"148-prisma-的全部-schema-语法",children:["148. Prisma 的全部 schema 语法",(0,c.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#148-prisma-的全部-schema-语法",children:"#"})]}),"\n",(0,c.jsx)(n.p,{children:"这节我们来学习下 Prisma 的 schema 文件的全部语法。"}),"\n",(0,c.jsx)(n.p,{children:"先创建个新项目："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"mkdir prisma-schema\ncd prisma-schema\nnpm init -y\n"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:L,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"全局安装 prisma："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"npm install -g prisma\n"})}),"\n",(0,c.jsx)(n.p,{children:"然后进入项目，执行 init 命令："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"prisma init\n"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:F,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"生成了 .env 和 schema 文件："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:"data:image/webp;base64,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",alt:""})}),"\n",(0,c.jsx)(n.p,{children:"然后改下 .env 文件的数据库连接信息："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:O,alt:""})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:'DATABASE_URL="mysql://root:guang@localhost:3306/prisma_test"\n'})}),"\n",(0,c.jsx)(n.p,{children:"改一下 db 的 provider 为 mysql，并且添加一个 model"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:M,alt:""})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-prisma",children:'generator client {\n  provider = "prisma-client-js"\n}\n\ndatasource db {\n  provider = "mysql"\n  url      = env("DATABASE_URL")\n}\n\nmodel User {\n  id    Int     @id @default(autoincrement())\n  email String  @unique\n  name  String?\n}\n'})}),"\n",(0,c.jsx)(n.p,{children:"然后执行 generate 命令："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"prisma generate\n"})}),"\n",(0,c.jsx)(n.p,{children:"会在 node_modules/@prisma/client 下生成客户端代码："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:J,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"这个生成位置是可以改的："}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)("img",{src:G,alt:""}),"\n在 generator 指定 output 的位置即可："]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:'generator client {\n  provider = "prisma-client-js"\n  output   = "../generated/client"\n}\n'})}),"\n",(0,c.jsx)(n.p,{children:"然后再次 generate："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"prisma generate\n"})}),"\n",(0,c.jsx)(n.p,{children:"这时候就是在根目录生成的代码："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:z,alt:""})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:N,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"此外，generator 除了可以生成 client 代码外，还可以生成别的东西。"}),"\n",(0,c.jsxs)(n.p,{children:["在",(0,c.jsx)(n.a,{href:"https://www.prisma.io/docs/concepts/components/prisma-schema/generators#community-generators",target:"_blank",rel:"noopener noreferrer",children:"文档"}),"里可以看到有很多社区的 generator："]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:Z,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"我们试一下这个 json 和 docs 的 generator："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"npm install --save-dev prisma-docs-generator\nnpm install --save-dev prisma-json-schema-generator\n"})}),"\n",(0,c.jsx)(n.p,{children:"先安装相关的包。"}),"\n",(0,c.jsx)(n.p,{children:"然后在 schema 文件里配置 3 个 generator："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:Q,alt:""})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:'generator client {\n  provider = "prisma-client-js"\n  output   = "../generated/client"\n}\n\ngenerator docs {\n  provider = "node node_modules/prisma-docs-generator"\n  output   = "../generated/docs"\n}\n\ngenerator json {\n  provider = "prisma-json-schema-generator"\n  output   = "../generated/json"\n}\n'})}),"\n",(0,c.jsx)(n.p,{children:"把 generated 目录删掉，重新生成："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"npx prisma generate\n"})}),"\n",(0,c.jsx)(n.p,{children:"注意，这里要用 npx 执行，因为如果是执行全局命令，会找不到项目目录下安装的 generator。"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:X,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"提示三个 generator 的产物都输出到了对应目录。"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:W,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"json schema 的 generator 会把 schema 文件转为 json 版："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:D,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"而 docs 则是会生成文档。"}),"\n",(0,c.jsx)(n.p,{children:"我们跑起来看看："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"npx http-server ./generated/docs\n"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:V,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"文档里会列出 model 的所有字段："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:U,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"还有它的所有 CRUD 方法，每个方法的参数的类型等："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:y,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"当你想做 crud 的时候，查下这个生成的文档，特别方便。"}),"\n",(0,c.jsx)(n.p,{children:"datasource 部分是配置数据库连接信息的。"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:B,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"provider 里指定连接的数据库的类型。"}),"\n",(0,c.jsx)(n.p,{children:"url 部分是连接的 url，也就是这个"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:k,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"在 schema 文件里可以用这种方式读取某个 env 的变量："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:K,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"接下来是 model 部分。"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"model User {\n  id    Int     @id @default(autoincrement())\n  email String  @unique\n  name  String?\n}\n"})}),"\n",(0,c.jsx)(n.p,{children:"这部分很容易看懂，第一列是字段名，第二列是类型，第三列是一些其他信息。"}),"\n",(0,c.jsx)(n.p,{children:"首先重置一下："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"prisma migrate reset\n"})}),"\n",(0,c.jsx)(n.p,{children:"我们用 migrate 命令生成 sql："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"prisma migrate dev --name aaa\n"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:C,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"然后创建一个 aaa 的迁移："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:R,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"它会创建对应的 sql 文件并执行："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:Y,alt:""})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:H,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"可以看到 model 的声明和生成的 sql 的对应关系："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"model User {\n  id    Int     @id @default(autoincrement())\n  email String  @unique\n  name  String?\n}\n"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:q,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"String 默认是 VARCHAR(191)"}),"\n",(0,c.jsx)(n.p,{children:"@id 会创建主键约束，@default 是默认值，而 autoincrement 是自增。"}),"\n",(0,c.jsx)(n.p,{children:"@unique 会创建唯一约束。"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:P,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"我们再创建一个 model"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:T,alt:""})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:'model Test {\n  id Int @id @default(autoincrement())\n  aaa String @db.Text\n  bbb Int @db.TinyInt @map("bbb2")\n  ccc String @db.VarChar(50) @unique\n\n  @@map("test_test")\n  @@index([bbb, ccc])\n}\n'})}),"\n",(0,c.jsx)(n.p,{children:"这是 @db.xxx 可以指定具体的 mysql 的数据类型，有括号的是可以填入参数的，比如 VARCHAR 可以指定长度："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:S,alt:""})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:I,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"@map 是给字段指定另一个名字，@@map 是给表指定另一个名字。"}),"\n",(0,c.jsx)(n.p,{children:"而 @@index 则是创建一个索引，这里创建了 bbb、ccc 的联合索引。"}),"\n",(0,c.jsx)(n.p,{children:"索引就像书的目录一样，可以加快 sql 查询速度，sql 优化的时候我们经常会把高频查询的字段创建索引。"}),"\n",(0,c.jsx)(n.p,{children:"我们测试下："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"npx prisma migrate dev --name bbb\n"})}),"\n",(0,c.jsx)(n.p,{children:"创建 bbb 的数据库迁移。"}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)("img",{src:E,alt:""}),"\n生成的 sql 如下："]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:v,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"对比下 model 语法和生成的 sql："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:'model Test {\n  id Int @id @default(autoincrement())\n  aaa String @db.Text\n  bbb Int @db.TinyInt @map("bbb2")\n  ccc String @db.VarChar(50) @unique\n\n  @@map("test_test")\n  @@index([bbb, ccc])\n}\n'})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:w,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"可以看到 @db.xxx、@map、@@map、@@index 都生效了"}),"\n",(0,c.jsx)(n.p,{children:"在 mysql workbench 里也可以看到这个表："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:A,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"那表和表之间的一对多、多对多关系呢？"}),"\n",(0,c.jsx)(n.p,{children:"我们再添加几个 model："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:u,alt:""})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"model Department {\n  id        Int    @id @default(autoincrement())\n  name      String  @db.VarChar(20)\n  createTime DateTime @default(now())\n  updateTime DateTime @updatedAt\n  employees     Employee[]\n}\n\nmodel Employee {\n  id         Int       @id @default(autoincrement())\n  name      String     @db.VarChar(20)\n  phone     String     @db.VarChar(30)\n\n  deaprtmentId Int\n  department     Department      @relation(fields: [deaprtmentId], references: [id])\n}\n"})}),"\n",(0,c.jsx)(n.p,{children:"这里用到了几个新语法："}),"\n",(0,c.jsx)(n.p,{children:"创建时间我们使用 @default(now()) 的方式指定，这样插入数据的时候会自动填入当前时间。"}),"\n",(0,c.jsx)(n.p,{children:"更新时间使用 @updatedAt，会自动设置当前时间。"}),"\n",(0,c.jsx)(n.p,{children:"员工和部门是多对一关系，在员工那一侧添加一个 departmentId 的列，然后通过 @relation 声明 deaprtmentId 的列引用 department 的 id 列。"}),"\n",(0,c.jsx)(n.p,{children:"测试下："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"npx prisma migrate dev --name ccc\n"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:f,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"可以看到，生成的 sql 是符合预期的："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:o,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"并且在数据库里可以看到创建了对应的外键："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:g,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"然后是多对多："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:b,alt:""})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"model Post {\n  id        Int          @id @default(autoincrement())\n  title     String\n  content   String?\n  published Boolean      @default(false)\n  tags      TagOnPosts[]\n}\n\nmodel Tag {\n  id    Int          @id @default(autoincrement())\n  name  String\n  posts TagOnPosts[]\n}\n\nmodel TagOnPosts {\n  post   Post @relation(fields: [postId], references: [id])\n  postId Int\n\n  tag    Tag @relation(fields: [tagId], references: [id])\n  tagId  Int\n\n  @@id([postId, tagId])\n}\n"})}),"\n",(0,c.jsx)(n.p,{children:"有 sql 的基础很容易看懂，多对多需要创建一个中间表，中间表里有两个外键分别关联这两个表。"}),"\n",(0,c.jsx)(n.p,{children:"然后用 @@id 创建一个联合主键。"}),"\n",(0,c.jsx)(n.p,{children:"测试下："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"npx prisma migrate dev --name ddd\n"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:m,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"生成的 sql 如下："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:j,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"中间表创建了 postId 和 tagId 的联合主键，并且创建了两个外键。"}),"\n",(0,c.jsx)(n.p,{children:"在 mysql 里可以看到这两个外键："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:h,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"这就是一对多、多对多的映射方式。"}),"\n",(0,c.jsx)(n.p,{children:"至于一对一，那个就是在多的那一侧添加一个 unique 约束就好了："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:x,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"这样就把一对多变成了一对一。"}),"\n",(0,c.jsx)(n.p,{children:"此外，还有一个 enum 的语法，就是可以指定某个字段只能取一些枚举值："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:p,alt:""})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"model Aaa {\n  id      Int      @id @default(autoincrement())\n  name    String?\n  role    EEE     @default(CCC)\n}\n\nenum EEE {\n  BBB\n  CCC\n  DDD\n}\n"})}),"\n",(0,c.jsx)(n.p,{children:"创建迁移："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"npx prisma migrate dev --name eee\n"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:l,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"生成的 sql 如下："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:t,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"这个 enum 也是 sql 支持的语法（我们前面貌似没用过）。"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:a,alt:""})}),"\n",(0,c.jsxs)(n.p,{children:["这就是 prisma schema 的常用语法了，有一些不常用的没有列出来，大家遇去查",(0,c.jsx)(n.a,{href:"https://www.prisma.io/docs/concepts/components/prisma-schema",target:"_blank",rel:"noopener noreferrer",children:"schema 文档"}),"就好了。"]}),"\n",(0,c.jsx)(n.p,{children:"最后，再看下生成的文档："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"npx http-server ./generated/docs\n"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:r,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"每一个表的字段还有可用的 CRUD 方法都列出来了："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:i,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"确实很方便。"}),"\n",(0,c.jsxs)(n.p,{children:["案例代码在",(0,c.jsx)(n.a,{href:"https://github.com/QuarkGluonPlasma/nestjs-course-code/tree/main/prisma-schema",target:"_blank",rel:"noopener noreferrer",children:"小册仓库"})]}),"\n",(0,c.jsxs)(n.h2,{id:"总结",children:["总结",(0,c.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#总结",children:"#"})]}),"\n",(0,c.jsx)(n.p,{children:"这节我们学习了 prisma schema 的常用语法。"}),"\n",(0,c.jsx)(n.p,{children:"generator 部分可以指定多种生成器，比如生成 json 生成 docs 等，可以指定生成代码的位置。"}),"\n",(0,c.jsx)(n.p,{children:"datasource 是配置数据库的类型和连接 url 的。"}),"\n",(0,c.jsx)(n.p,{children:"model 部分定义和数据库表的对应关系："}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"@id"})," 定义主键"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"@default"})," 定义默认值"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"@map"})," 定义字段在数据库中的名字"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"@db.xx"})," 定义对应的具体类型"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"@updatedAt"})," 定义更新时间的列"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"@unique"})," 添加唯一约束"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"@relation"})," 定义外键引用"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"@@map"})," 定义表在数据库中的名字"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"@@index"})," 定义索引"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"@@id"})," 定义联合主键"]}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:"此外，还可以通过 enum 来创建枚举类型。"}),"\n",(0,c.jsx)(n.p,{children:"这些就是常用的 schema 语法了。"})]})}function $(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,d.ah)(),e.components);return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(_,{...e})}):_(e)}let ee=$;$.__RSPRESS_PAGE_META={},$.__RSPRESS_PAGE_META["Nest%20%E9%80%9A%E5%85%B3%E7%A7%98%E7%B1%8D%20%20%E6%9C%80%E6%96%B0200%E7%AB%A0%2F148.%20Prisma%20%E7%9A%84%E5%85%A8%E9%83%A8%20schema%20%E8%AF%AD%E6%B3%95.md"]={toc:[{text:"总结",id:"总结",depth:2}],title:"148. Prisma 的全部 schema 语法",headingTitle:"148. Prisma 的全部 schema 语法",frontmatter:{}}}}]);