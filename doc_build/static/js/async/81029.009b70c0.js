"use strict";(self.webpackChunkjue_jin_book_press=self.webpackChunkjue_jin_book_press||[]).push([["81029"],{954202:function(e,n,i){i.r(n),i.d(n,{default:()=>R});var s=i(552676),c=i(740453);let a=i.p+"static/image/8a175a477d65617c6ebea1fc0239f198.3019fb9e.webp",l=i.p+"static/image/db57f0733b5423b81cc1fe992996b6e5.e6d7cb92.webp",t=i.p+"static/image/286b9f4746292a3a7f2307ef780cda16.d4617696.webp",r=i.p+"static/image/a379e1341e53a29e92cccd72f0543d3f.6c913e04.webp",d=i.p+"static/image/a4baf1b71511191a3e361e239a6369a3.b44fc810.webp",p=i.p+"static/image/a4dfb92c0f53d2ae96698cbce6495900.99e0f262.webp",x=i.p+"static/image/2d29917e1ae7ba62e728544b323705e8.53d88c79.webp",j=i.p+"static/image/06a3cf2e93514714d32d32407737729a.caf1df11.webp",h=i.p+"static/image/4c5e06b9ad46f5fa1abe559129bdb341.fc990245.webp",f=i.p+"static/image/34aee6f1bb5fef5e7d65f323d6d31c3a.22daa88b.webp",b=i.p+"static/image/9f73fd7d3bfe703c785b29795e84a56a.97345399.webp",m=i.p+"static/image/43b80490e1d853d27106eba3cf074ae5.8af7117a.webp",o=i.p+"static/image/39dda4d8ca4f77814c50b0814f7fa953.f38f2e6a.webp",u=i.p+"static/image/0caf63bffcce5a63d2f3bd0e34b54413.0628077a.webp",A=i.p+"static/image/5040caebd1ece668797f5b5d590a7817.eb46420b.webp",E=i.p+"static/image/4f6f8f3cb00ea2702e90b3add3ce9f74.2c4e7a4e.webp",g=i.p+"static/image/ac1dc133fe8b81377f9e9a8de44df5d0.dbcc5bf9.webp",S=i.p+"static/image/6df529fceb73dcad1de17e5629a376ca.ec5057c8.webp",w=i.p+"static/image/431fb831ff026b81f1d4e3d75cdf56c1.4a6dcc25.webp",v=i.p+"static/image/75a9cc69dc61c2cd14a4e591859bf57a.6d7e6a22.webp",F=i.p+"static/image/b457df61982c027c64b2a374215c10bb.160e0c1d.webp",N=i.p+"static/image/8b6a5acc478448328f65bce4408d9e68.e3d1ee8a.webp",q=i.p+"static/image/0ed9bfdc50b4226bc33ca48ac7867f7d.1048004b.webp",C=i.p+"static/image/a6ec33402d5108d0efaf7785bed5bd96.419f3d79.webp",L=i.p+"static/image/c5f095202885297e7653513be8c9cedd.2af83967.webp",k=i.p+"static/image/299be34eefd194c5363ca45a2e775b31.50e74a20.webp";function T(e){let n=Object.assign({h1:"h1",a:"a",p:"p",h2:"h2",img:"img",pre:"pre",code:"code"},(0,c.ah)(),e.components);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.h1,{id:"18命令行工具的两种调试方式以-eslint-源码调试为例",children:["18.命令行工具的两种调试方式（以 ESLint 源码调试为例）",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#18命令行工具的两种调试方式以-eslint-源码调试为例",children:"#"})]}),"\n",(0,s.jsx)(n.p,{children:"前端的命令行工具太多了，比如 webpack、vite、babel、tsc、eslint 等等，每天我们都会用各种命令行工具。"}),"\n",(0,s.jsx)(n.p,{children:"这些命令行工具都提供了两种入口：命令行和 api。"}),"\n",(0,s.jsx)(n.p,{children:"平时用我们会通过命令行的方式，比如 eslint xxx --fix，但是别的工具集成这些工具的时候就会使用 api 了，它更灵活。"}),"\n",(0,s.jsx)(n.p,{children:"所以，调试这些工具的时候也就有两种方式，通过命令行调试和通过 api 调试。"}),"\n",(0,s.jsx)(n.p,{children:"这节我们以 eslint 为例子来试下两种调试方式，大家可以跟着调试一下。"}),"\n",(0,s.jsxs)(n.h2,{id:"命令行的方式调试-eslint-源码",children:["命令行的方式调试 ESLint 源码",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#命令行的方式调试-eslint-源码",children:"#"})]}),"\n",(0,s.jsx)(n.p,{children:"我们创建一个 index.js 文件"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:k,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"配置下 .eslintrc"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"module.exports = {\n  extends: 'standard'\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"安装 eslint，然后执行 npx eslint ./index.js 会看到这样的报错："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:L,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"后面三个错误都是格式错误，eslint 可以修复。"}),"\n",(0,s.jsx)(n.p,{children:"执行 npx eslint ./index.js --fix 就会自动修复错误。"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:C,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"我们想探究下 fix 的原理，就要调试下源码了。"}),"\n",(0,s.jsx)(n.p,{children:"用命令行的方式调试的话，就要添加一个这样的调试配置："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:q,alt:""})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n    "name": "eslint 调试",\n    "program": "${workspaceFolder}/node_modules/.bin/eslint",\n    "args": [\n        "./index.js",\n        "--fix"\n    ],\n    "skipFiles": [\n        "<node_internals>/**"\n    ],\n    "console": "integratedTerminal",\n    "cwd": "${workspaceFolder}",\n    "request": "launch",\n    "type": "node"\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"在 .bin 下找到 eslint 的文件打个断点："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:N,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"然后调试启动："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:F,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"代码执行到这里断住了。"}),"\n",(0,s.jsx)(n.p,{children:"你发现它引入了 lib/cli 的模块，然后再去那个模块里看一下："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:v,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"你会发现它创建了 ESLint 实例，然后调用了它的 lintFiles 方法。"}),"\n",(0,s.jsx)(n.p,{children:"点进去就会发现它调用了 executeOnFiles 方法："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:w,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"点击 step into 进入函数内部："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:"data:image/webp;base64,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",alt:""})}),"\n",(0,s.jsx)(n.p,{children:"然后点击 stop over 单步执行："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:"data:image/webp;base64,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",alt:""})}),"\n",(0,s.jsx)(n.p,{children:"之后代码会走到 verifyText 的函数调用："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:S,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"这就是实现 lint 的部分，因为它的返回值就是 lint 结果。"}),"\n",(0,s.jsx)(n.p,{children:"step into 进入这个函数，会执行到 verifyAndFix 的函数调用："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:g,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"继续 step into，然后单步执行。"}),"\n",(0,s.jsx)(n.p,{children:"这时候你发现了一个循环："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:E,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"每次都调用 verify 对传入的文本进行 lint："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:A,alt:""})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:u,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"返回的结果里包含了错误的信息和如何修复，就是把 range 范围的字符串替换成 text。"}),"\n",(0,s.jsx)(n.p,{children:"然后再调用 applyFixes 执行 fix 的修复。"}),"\n",(0,s.jsx)(n.p,{children:"我们分别看下如何 lint 的，以及如何 fix 的："}),"\n",(0,s.jsx)(n.p,{children:"verify 部分调用了 _verifyWithoutProcessors："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:o,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"单步执行你会发现会对文本做 parse，产生 AST："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:m,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"然后传入 AST，调用各种 rule 来实现检查，返回的结果就是 problem 的数组："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:b,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"具体调用插件的过程，大家可以调试下 runRules 这个方法，这里就不展开了。"}),"\n",(0,s.jsx)(n.p,{children:"然后拿到了 problems 和怎么 fix 的信息就可以执行自动修复了："}),"\n",(0,s.jsx)(n.p,{children:"进入 applyFixes 方法，你会发现它会有个标记变量，默认为 false："}),"\n",(0,s.jsx)(n.p,{children:"然后尝试修复，修复完设置为 true："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:f,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"具体修复的实现就是个字符串替换："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:h,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"那为什么会有 remainingMessages，也就是剩下的错误，然后还要循环多次来修复呢？"}),"\n",(0,s.jsx)(n.p,{children:"有两个原因，一个是有的 problem 本身不支持 fix，没有 fix，那自然要把问题留下来："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:j,alt:""})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:x,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"还有一个原因是两个 fix 冲突了："}),"\n",(0,s.jsx)(n.p,{children:"比如上一个 fix 修复完之后，最新的位置是 10，而下一个 fix 要求从 9 开始替换文本，那自然就不行了。所以这条 fix 就被留了下来："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:p,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"这也是为什么我们会看到这样一个循环："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:d,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"如果有 fix 冲突的话，也就是上次修复完的文本还有问题，那会重新 lint，然后再 fix。"}),"\n",(0,s.jsx)(n.p,{children:"当然，自动 fix 的次数也是有上限的，默认修复 10 次还没修复完就终止。"}),"\n",(0,s.jsx)(n.p,{children:"这就是 eslint 的实现原理："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:r,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"lint 的实现是基于 AST，调用 rule 来做的检查。"}),"\n",(0,s.jsx)(n.p,{children:"fix 的实现就是字符串的替换，多个 fix 有冲突的话会循环多次修复。"}),"\n",(0,s.jsx)(n.p,{children:"我们通过命令行的方式实现了 ESLint 源码的调试，但其实这样有很多没必要的部分，比如我们知道前面的命令行参数的解析的流程。"}),"\n",(0,s.jsx)(n.p,{children:"如果我们知道它最终调用的是 lintText 的 api，那完全可以从 api 入口开始调试："}),"\n",(0,s.jsxs)(n.h2,{id:"api-的方式调试-eslint-源码",children:["api 的方式调试 ESLint 源码：",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#api-的方式调试-eslint-源码",children:"#"})]}),"\n",(0,s.jsx)(n.p,{children:"通过命令行的方式调试 ESLint 源码的时候，我们知道了 ESLint 会创建 ESLint 实例，然后调用 lintText 方法来对代码 lint。"}),"\n",(0,s.jsx)(n.p,{children:"那我们可以自己调用这些 api 来 lint。"}),"\n",(0,s.jsx)(n.p,{children:".eslintrc 文件还是这样："}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"module.exports = {\n  extends: 'standard'\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"通过 api 的方式对这段代码进行 lint："}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:'\nconst { ESLint } = require("eslint");\n\nconst engine = new ESLint({\n    fix: false\n});\n\n(async function main() {\n    const results = await engine.lintText(`\n    function add (a, b) \n{\n  return a + b\n}\n  `);\n  \n    console.log(results[0].output);\n  \n    const formatter = await engine.loadFormatter("stylish");\n    const resultText = formatter.format(results);\n    console.log(resultText);\n  })();\n'})}),"\n",(0,s.jsx)(n.p,{children:"返回的结果用 formatter 打印下。"}),"\n",(0,s.jsx)(n.p,{children:"首先直接 node 执行，可以看到打印出的错误和我们用命令行的方式是一样的："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:t,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"然后创建个 debug 配置来跑："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:l,alt:""})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n    "name": "调试 eslint api",\n    "program": "${workspaceFolder}/api-test.js",\n    "request": "launch",\n    "skipFiles": [\n        "<node_internals>/**"\n    ],\n    "console": "integratedTerminal",\n    "type": "pwa-node"\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"你可以直接从实现 lint 的部分开始调试，跳过了前面命令行参数解析的部分，这样更有针对性："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:a,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"之后的调试流程倒是和命令行的方式一样，就不展开了。"}),"\n",(0,s.jsxs)(n.h2,{id:"总结",children:["总结",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#总结",children:"#"})]}),"\n",(0,s.jsx)(n.p,{children:"命令行工具都有命令行和 api 两种入口，我们以 ESLint 源码的调试为例试了下两种调试方式。"}),"\n",(0,s.jsx)(n.p,{children:"api 的方式更精准一些，可以跳过命令行参数解析的部分，直接调试感兴趣的 api。"}),"\n",(0,s.jsx)(n.p,{children:"通过调试，我们知道了 ESLint 是通过 AST 实现的检查，具体检查是 rule 里做的，fix 的实现就是字符串替换，但因为多个 rule 的 fix 可能冲突，所以会循环来做，但最多循环 10 次"}),"\n",(0,s.jsx)(n.p,{children:"ESLint 源码的调试还是相对简单，因为没有经过编译，如果做了编译的话，那就需要 sourcemap 了。"})]})}function P(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,c.ah)(),e.components);return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(T,{...e})}):T(e)}let R=P;P.__RSPRESS_PAGE_META={},P.__RSPRESS_PAGE_META["%E5%89%8D%E7%AB%AF%E8%B0%83%E8%AF%95%E9%80%9A%E5%85%B3%E7%A7%98%E7%B1%8D%2F18.%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7%E7%9A%84%E4%B8%A4%E7%A7%8D%E8%B0%83%E8%AF%95%E6%96%B9%E5%BC%8F%EF%BC%88%E4%BB%A5%20ESLint%20%E6%BA%90%E7%A0%81%E8%B0%83%E8%AF%95%E4%B8%BA%E4%BE%8B%EF%BC%89.md"]={toc:[{text:"命令行的方式调试 ESLint 源码",id:"命令行的方式调试-eslint-源码",depth:2},{text:"api 的方式调试 ESLint 源码：",id:"api-的方式调试-eslint-源码",depth:2},{text:"总结",id:"总结",depth:2}],title:"18.命令行工具的两种调试方式（以 ESLint 源码调试为例）",headingTitle:"18.命令行工具的两种调试方式（以 ESLint 源码调试为例）",frontmatter:{}}}}]);