"use strict";(self.webpackChunkjue_jin_book_press=self.webpackChunkjue_jin_book_press||[]).push([["31077"],{656044:function(e,n,c){c.r(n),c.d(n,{default:()=>en});var a=c(552676),s=c(740453);let i=c.p+"static/image/b26ac0ca7a9492907ffcc2f33198a830.be722a01.webp",r=c.p+"static/image/c86f274cf8c2dcc7af4609b29e782bc8.ccfe6728.webp",p=c.p+"static/image/e8944e2624a1ead2f5f16c56937a6655.b47727a0.webp",t=c.p+"static/image/df26399ec24939f67fb33eb1ca94ea66.d42ae715.webp",d=c.p+"static/image/1ab73ed06bdbb4c7a4486107ee5d7b16.37cea7f3.webp",l=c.p+"static/image/8fb6e9d1e4e880934629e746a3e9156d.6cebbbc2.webp",j=c.p+"static/image/76440f5fe71f1b3634a1c5a7a9a8dc68.164c5e54.webp",b=c.p+"static/image/d1278919712efd87540823224929a2bd.be5ee341.webp",x=c.p+"static/image/733471f9a1278a3c9f0e4d53ed8e8c10.ee5be6fb.webp",o=c.p+"static/image/0691aee3dfe3ff689fd55f3a94e27b00.45f1d11e.webp",h=c.p+"static/image/8d30aabff95359d33b16cba81227424f.5829ce3f.webp",g=c.p+"static/image/e30b49668601f71669247d46bbe7a7dd.9a11ba11.webp",m=c.p+"static/image/47604dda73e4fa3eee70e408c8746b48.753c4a45.webp",f=c.p+"static/image/e7690227c3cfe5b30974ed566e511a60.37727000.webp",u=c.p+"static/image/e6123f8be381eef97a7ddaf85d582f7b.8c017b36.webp",A=c.p+"static/image/e784f8bd02f298d193065a43a4e8e50f.32c0bc52.webp",w=c.p+"static/image/5ea6e44ff91fc8bdbea4fa437e2c6d94.691f7a99.webp",y=c.p+"static/image/9fe519fd8e5675afff62b273408fa9c0.9948533b.webp",E=c.p+"static/image/6aacac777490ec215f506e9562ae7187.406041c8.webp",v=c.p+"static/image/da4ced86d0ab60f545f62df3905472ba.d40f1645.webp",P=c.p+"static/image/f68b33515c1a6dd10818f8095bf660c6.765a8f29.webp",k=c.p+"static/image/a64eb645599a382bc1b031fbc26c4aba.27bb08d4.webp",D=c.p+"static/image/b625e35f5cafc66b6013350bb716b755.564a6888.webp",V=c.p+"static/image/002e15756ef53f01398d8c181e47c783.77ad28f5.webp",B=c.p+"static/image/556210155d43467b88949f29a6d2ccf3.5e71b983.webp",S=c.p+"static/image/54662393102dbd92f0c8116ba598a7c8.c3c346fe.webp",G=c.p+"static/image/555a595b40ab8b3c5511708f298856be.843ec5ea.webp",N=c.p+"static/image/78517e7ae44e6eec2836c83262fdd7e3.54a26cdd.webp",O=c.p+"static/image/9881a7e14c178a82ee780306a63c2a6b.0752f019.webp",H=c.p+"static/image/a0fac10a34163ba52eb2bf3a1122fcc4.ff0ef1ce.webp",q=c.p+"static/image/c11594ab6426645e1b8389194e1b5f56.12ac92f0.webp",C=c.p+"static/image/3b2bc03ee10b34b206dcfb10c023639b.3c72d8bb.webp",K=c.p+"static/image/1ca61d9c5cb5f8fb7fbc2691ff253cfb.3adfc871.webp",R=c.p+"static/image/7457bab6c753c2e26e75517805d5c066.4c4acab5.webp",T=c.p+"static/image/70331dd6b70ddaaa191f3e6a4680ef8d.80347c8e.webp",Q=c.p+"static/image/34c4add17b1b106b24a24886bf1dbc26.147b4db4.webp",Y=c.p+"static/image/31d001444d0bb9dcae36a76a75969ff5.97f2f1bb.webp",M=c.p+"static/image/2d069b2db9687eef68366604bd5fc943.62c00bf7.webp",I=c.p+"static/image/d3d87ba3edd24fc07ea49b5a79f02c17.a427348c.webp",U=c.p+"static/image/3b0c6b11d503ff915fc0066c0ac9405a.869363bf.webp",z=c.p+"static/image/2eb0a91858cad8676d7d86fffaa97ee1.25fa900c.webp",J=c.p+"static/image/8e2913af87d9cab420130d8fe7900eaa.0d07c19a.webp",L=c.p+"static/image/6162ffd65574052a7550d414245ecdc1.30fd8e1e.webp",F=c.p+"static/image/19e6c40864bd0a1d510ada02c86eabc4.ecc983f8.webp",Z=c.p+"static/image/9f216ed66007827ee20b5c57b061bf27.9ba1939a.webp",W=c.p+"static/image/c3838574ed82df961507125d913c7c4f.b3cfdc76.webp",X=c.p+"static/image/334ff1c7942340bc777bf4cda69d4bc1.d3b0e10f.webp",_=c.p+"static/image/5f87246c5fd6e765039660b68cca04d3.03e86d2b.webp";function $(e){let n=Object.assign({h1:"h1",a:"a",p:"p",pre:"pre",code:"code",img:"img",h2:"h2",ul:"ul",li:"li"},(0,s.ah)(),e.components);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(n.h1,{id:"83-用-swagger-自动生成-api-文档",children:["83. 用 Swagger 自动生成 api 文档",(0,a.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#83-用-swagger-自动生成-api-文档",children:"#"})]}),"\n",(0,a.jsx)(n.p,{children:"后端开发完接口后，需要给前端一份接口文档，描述有哪些接口，是 GET 还是 POST，有哪些参数，响应是什么。"}),"\n",(0,a.jsx)(n.p,{children:"但是写完代码后再去单独写一份这样的文档还是很麻烦的，并且改动接口之后也要同步去修改接口文档。"}),"\n",(0,a.jsx)(n.p,{children:"能不能自动生成 API 接口文档呢？"}),"\n",(0,a.jsx)(n.p,{children:"是可以的，就是这节要讲的 swagger。"}),"\n",(0,a.jsx)(n.p,{children:"我们新建个项目："}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"nest new swagger-test -p npm\n"})}),"\n",(0,a.jsx)(n.p,{children:"安装 swagger 的包："}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"npm install --save @nestjs/swagger\n"})}),"\n",(0,a.jsx)(n.p,{children:"然后在 main.ts 添加这样一段代码："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:_,alt:""})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"const config = new DocumentBuilder()\n    .setTitle('Test example')\n    .setDescription('The API description')\n    .setVersion('1.0')\n    .addTag('test')\n    .build();\nconst document = SwaggerModule.createDocument(app, config);\nSwaggerModule.setup('doc', app, document);\n"})}),"\n",(0,a.jsx)(n.p,{children:"通过 DocumentBuilder 创建 config。"}),"\n",(0,a.jsx)(n.p,{children:"然后用 SwaggerModule.createDocument 根据 config 创建文档。"}),"\n",(0,a.jsx)(n.p,{children:"之后用 SwaggerModule.setup 指定在哪个路径可以访问文档。"}),"\n",(0,a.jsx)(n.p,{children:"跑起来试试："}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"npm run start:dev\n"})}),"\n",(0,a.jsxs)(n.p,{children:["访问 ",(0,a.jsx)(n.a,{href:"http://localhost:3000/doc",target:"_blank",rel:"noopener noreferrer",children:"http://localhost:3000/doc"})," 就可以看到 swagger 的 api 文档了："]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:X,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"和 DocumentBuilder 填的配置的对应关系如下："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:W,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"现在只有一个接口，调用会返回 hello world："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:Z,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"点击 try it out，再点击 execute，就可以看到返回的响应体和 header："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:F,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"我们在 AppController 加几个接口试试："}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"@Get('aaa')\naaa(@Query('a1') a1, @Query('a2') a2) {\n    console.log(a1, a2);\n    return 'aaa success';\n}\n\n@Get('bbb/:id')\nbbb(@Param('id') id) {\n    console.log(id);\n    return 'bbb success';\n}\n\n@Post('ccc')\nccc(@Body('ccc') ccc) {\n    console.log(ccc);\n    return 'ccc success';\n}\n"})}),"\n",(0,a.jsx)(n.p,{children:"加了一个有 query 参数、一个有 param 参数、一个有 body 参数的接口。"}),"\n",(0,a.jsx)(n.p,{children:"刷新下可以看到，这几个接口都列出来了："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:L,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"但是都没有 param 的描述和 response 的描述："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:J,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"这时就需要我们手动标注了："}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"@ApiOperation({ summary: '测试 aaa',description: 'aaa 描述' })\n@ApiResponse({\n    status: HttpStatus.OK,\n    description: 'aaa 成功',\n    type: String\n})\n@Get('aaa')\naaa(@Query('a1') a1, @Query('a2') a2) {\n    console.log(a1, a2);\n    return 'aaa success';\n}\n"})}),"\n",(0,a.jsx)(n.p,{children:"给 aaa 接口添加 @ApiOperation 和 @ApiResponse 的装饰器。"}),"\n",(0,a.jsx)(n.p,{children:"这俩分别是指定这个接口的描述，接口的响应的。"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:z,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"再加上 @ApiQuery 来添加 query 参数的说明："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:U,alt:""})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"@ApiQuery({\n    name: 'a1',\n    type: String,\n    description: 'a1 param',\n    required: false,\n    example: '1111',\n})\n@ApiQuery({\n    name: 'a2',\n    type: Number,\n    description: 'a2 param',\n    required: true,\n    example: 2222,\n})  \n"})}),"\n",(0,a.jsx)(n.p,{children:"刷新下，可以看到 swagger 文档里出现了这两个参数的说明："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:I,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"点击 try it out 和 execute，就可以看到发送了请求并返回了响应："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:M,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"这样，一个接口就描述完了："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:Y,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"通过 @ApiOperation 描述接口的信息，@ApiResponse 描述返回值信息，@ApiQuery 描述 query 参数信息。"}),"\n",(0,a.jsx)(n.p,{children:"就能生成对应的 swagger 文档："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:Q,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"我们接着来生成 bbb 接口的 swagger 文档："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:T,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"这里用到的是 @ApiParam 而不是 @ApiQuery，其余部分一样："}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"@ApiOperation({ summary: '测试 bbb',description: 'bbb 描述' })\n@ApiResponse({\n    status: HttpStatus.OK,\n    description: 'bbb 成功',\n    type: String\n})\n@ApiParam({\n    name: 'id',\n    description: 'ID',\n    required: true,\n    example: 222,\n})\n"})}),"\n",(0,a.jsx)(n.p,{children:"刷新可以看到 bbb 接口的文档："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:R,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"那如果 id 不合法的时候，我返回了一个 401 的响应呢？"}),"\n",(0,a.jsx)(n.p,{children:"那就再加一个 @ApiResponse"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:K,alt:""})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"@ApiOperation({ summary: '测试 bbb',description: 'bbb 描述' })\n@ApiResponse({\n    status: HttpStatus.OK,\n    description: 'bbb 成功',\n    type: String\n})\n@ApiResponse({\n    status: HttpStatus.UNAUTHORIZED,\n    description: 'id 不合法'\n})\n@ApiParam({\n    name: 'id',\n    description: 'ID',\n    required: true,\n    example: 222,\n})\n@Get('bbb/:id')\nbbb(@Param('id') id: number) {\n    console.log(id);\n    if(id !== 111) {\n      throw new UnauthorizedException();\n    }\n    return 'bbb success';\n}\n"})}),"\n",(0,a.jsx)(n.p,{children:"刷新下，可以看到 swagger 文档标识出了这两种响应："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:C,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"然后再来写 ccc 接口的文档："}),"\n",(0,a.jsx)(n.p,{children:"ccc 接收的是请求体的参数，我们创建个 CccDto。"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:q,alt:""})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"export class CccDto {\n    aaa: string;\n    bbb: number;\n    ccc: Array<string>;\n}\n"})}),"\n",(0,a.jsx)(n.p,{children:"接收参数通过 dto 来接收，而返回值放在 vo 里："}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"@Post('ccc')\nccc(@Body('ccc') ccc: CccDto) {\n    console.log(ccc);\n    return {\n      aaa: 111,\n      bbb: 222\n    };\n}\n"})}),"\n",(0,a.jsx)(n.p,{children:"创建个 vo 的 class："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:H,alt:""})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"export class CccVo {\n    aaa: number;\n    bbb: number;\n}\n"})}),"\n",(0,a.jsx)(n.p,{children:"返回值就可以改成这样了："}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"@Post('ccc')\nccc(@Body('ccc') ccc: CccDto) {\n    console.log(ccc);\n\n    const vo = new CccVo();\n    vo.aaa = 111;\n    vo.bbb = 222;\n    return vo;\n}\n"})}),"\n",(0,a.jsx)(n.p,{children:"这里的 dto、vo 随便搜一下就能查到解释："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:O,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"在 Nest 里要能清楚的区分 dto、vo、entity 的区别："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:N,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"dto 是 data transfer object，用于参数的接收。"}),"\n",(0,a.jsx)(n.p,{children:"vo 是 view object，用于返回给视图的数据的封装。"}),"\n",(0,a.jsx)(n.p,{children:"而 entity 是和数据库表对应的实体类。"}),"\n",(0,a.jsx)(n.p,{children:"然后我们继续来写 ccc 接口的 swagger 文档。"}),"\n",(0,a.jsx)(n.p,{children:"很容易想到，body 的描述是通过 @ApiBody 的装饰器："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:G,alt:""})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"@ApiOperation({summary:'测试 ccc'})\n@ApiResponse({\n    status: HttpStatus.OK,\n    description: 'ccc 成功',\n    type: CccVo\n})\n@ApiBody({\n    type: CccDto\n})\n@Post('ccc')\nccc(@Body('ccc') ccc: CccDto) {\n    console.log(ccc);\n\n    const vo = new CccVo();\n    vo.aaa = 111;\n    vo.bbb = 222;\n    return vo;\n}\n"})}),"\n",(0,a.jsx)(n.p,{children:"刷新页面，你会看到除了接口外，还生成了俩 schema。"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:S,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"也就是说对象的响应会对应 swagger 的 schema。"}),"\n",(0,a.jsx)(n.p,{children:"只不过现在 CccDto、CccVo 的 schema 没有内容，这是因为我们还没有标注。"}),"\n",(0,a.jsx)(n.p,{children:"在 CccDto 加一下："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:B,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"aaa、bbb、ccc 通过 @ApiProperty 标识下，并且 bbb 是 @ApiPropertyOptional，也就是可选，这个和 @ApiProperty({ required: false }) 等价。"}),"\n",(0,a.jsx)(n.p,{children:"aaa 可以传 enum 的值，取值范围是 a1、a2、a3。"}),"\n",(0,a.jsx)(n.p,{children:"同样，CccVo 也加一下："}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"import { ApiProperty } from \"@nestjs/swagger\";\n\nexport class CccVo {\n    @ApiProperty({ name: 'aaa' })\n    aaa: number;\n\n    @ApiProperty({ name: 'bbb' })\n    bbb: number;\n}\n"})}),"\n",(0,a.jsx)(n.p,{children:"刷新下，现在就可以看到 CccDto、CccVo 的 schema 有属性了："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:V,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"其中 bbb 是没有 * 的，代表可不传。"}),"\n",(0,a.jsx)(n.p,{children:"上面的接口部分也有了请求和响应的示例："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:D,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"点下 try it out，可以自己编辑请求体："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:k,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"然后点击 execute 就可以看到响应的内容和 header："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:P,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"服务端也确实接收到了这个请求："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:v,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"可以用 swagger 来方便的测试接口。"}),"\n",(0,a.jsx)(n.p,{children:"此外，还可以通过 @ApiTags 来给接口分组："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:E,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"比如 controller 是 xxx 开头的，那可以用 @ApiTags 来分组到 xxx。"}),"\n",(0,a.jsx)(n.p,{children:"显示的时候，就会把这个 controller 的接口分到一个组下："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:y,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"也可以添加在 handler 上："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:w,alt:""})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:A,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"比如把 aaa、bbb 接口分到 xxx-get 的组。"}),"\n",(0,a.jsx)(n.p,{children:"那显示的时候就会把这俩接口分出来："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:u,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"当接口多了之后，分组还是很有必要的。"}),"\n",(0,a.jsx)(n.p,{children:"回过头来，再讲下 @ApiProperty，其实它还有很多属性："}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"import { ApiProperty, ApiPropertyOptional } from \"@nestjs/swagger\";\n\nexport class CccDto {\n    @ApiProperty({ name: 'aaa', enum: ['a1', 'a2', 'a3'], maxLength: 30, minLength: 2, required: true})\n    aaa: string;\n\n    @ApiPropertyOptional({ name: 'bbb', maximum: 60, minimum: 40, default: 50, example: 55})\n    bbb: number;\n\n    @ApiProperty({ name: 'ccc' })\n    ccc: Array<string>;\n}\n"})}),"\n",(0,a.jsx)(n.p,{children:"比如 required、minium、maximum、default、maxLength 等。"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:f,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"此外，很多接口是需要登录才能访问的，那如何限制呢？"}),"\n",(0,a.jsx)(n.p,{children:"swagger 也提供了这方面的支持。"}),"\n",(0,a.jsx)(n.p,{children:"常用的认证方式就是 jwt、cookie。"}),"\n",(0,a.jsx)(n.p,{children:"分别在 aaa、bbb、ccc 接口添加 @ApiBearerAuth、@ApiCookieAuth、@ApiBasicAuth"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:m,alt:""})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:g,alt:""})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:h,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"然后在 main.ts 里添 3 种认证方式的信息："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:o,alt:""})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"const config = new DocumentBuilder()\n    .setTitle('Test example')\n    .setDescription('The API description')\n    .setVersion('1.0')\n    .addTag('test')\n    .addBasicAuth({\n      type: 'http',\n      name: 'basic',\n      description: '用户名 + 密码'\n    })\n    .addCookieAuth('sid', {\n      type: 'apiKey',\n      name: 'cookie',\n      description: '基于 cookie 的认证'\n    })\n    .addBearerAuth({\n      type: 'http',\n      description: '基于 jwt 的认证',\n      name: 'bearer'\n    })\n    .build();\n"})}),"\n",(0,a.jsx)(n.p,{children:"刷新页面就可以看到接口出现了锁的标记："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:x,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"点击 aaa 的锁："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:b,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"输入 jwt 的 token，然后点击 authorize。"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:"data:image/webp;base64,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",alt:""})}),"\n",(0,a.jsx)(n.p,{children:"锁会变成锁住状态，代表授权成功了。"}),"\n",(0,a.jsx)(n.p,{children:"这时候再发一个请求："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:j,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"会发现带上了 Authorization 的 header，这就是我们见过的 jwt 认证方式。"}),"\n",(0,a.jsx)(n.p,{children:"同理，下面的 cookie 会带上对应的 cookie来认证："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:l,alt:""})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:d,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"而 basic 的方式，会要求你输入用户名密码："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:t,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"请求时会带上 Authorization： Basic xxx 的 header 来访问。"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:p,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"这样，这些需要授权的接口就分别添加上了不同的认证方式的标识。"}),"\n",(0,a.jsx)(n.p,{children:"其实，swagger 是一种叫做 openapi 标准的实现。"}),"\n",(0,a.jsx)(n.p,{children:"在 /doc 后加上个 -json 就可以看到对应的 json"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:r,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"装个格式化 chrome 插件格式化一下，大概是这样的："}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)("img",{src:i,alt:""})}),"\n",(0,a.jsx)(n.p,{children:"如果你觉得 swagger 文档比较丑，可以这个 json 导入别的平台。"}),"\n",(0,a.jsx)(n.p,{children:"一般 api 接口的平台都是支持 openapi 的。"}),"\n",(0,a.jsxs)(n.p,{children:["案例代码在",(0,a.jsx)(n.a,{href:"https://github.com/QuarkGluonPlasma/nestjs-course-code/tree/main/swagger-test",target:"_blank",rel:"noopener noreferrer",children:"小册仓库"})]}),"\n",(0,a.jsxs)(n.h2,{id:"总结",children:["总结",(0,a.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#总结",children:"#"})]}),"\n",(0,a.jsx)(n.p,{children:"这节我们学习了 swagger 自动生成文档。"}),"\n",(0,a.jsx)(n.p,{children:"需要先安装 @nestjs/swagger 的包。"}),"\n",(0,a.jsx)(n.p,{children:"然后在 main.ts 里用 DocumentBuilder + SwaggerModule.createDocuemnt 创建 swagger 文档配置，然后 setup 跑起来就好了。"}),"\n",(0,a.jsx)(n.p,{children:"还需要手动加一些装饰器来标注："}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"ApiOperation：声明接口信息"}),"\n",(0,a.jsx)(n.li,{children:"ApiResponse：声明响应信息，一个接口可以多种响应"}),"\n",(0,a.jsx)(n.li,{children:"ApiQuery：声明 query 参数信息"}),"\n",(0,a.jsx)(n.li,{children:"ApiParam：声明 param 参数信息"}),"\n",(0,a.jsx)(n.li,{children:"ApiBody：声明 body 参数信息，可以省略"}),"\n",(0,a.jsx)(n.li,{children:"ApiProperty：声明 dto、vo 的属性信息"}),"\n",(0,a.jsx)(n.li,{children:"ApiPropertyOptional：声明 dto、vo 的属性信息，相当于 required: false 的 ApiProperty"}),"\n",(0,a.jsx)(n.li,{children:"ApiTags：对接口进行分组"}),"\n",(0,a.jsx)(n.li,{children:"ApiBearerAuth：通过 jwt 的方式认证，也就是 Authorization: Bearer xxx"}),"\n",(0,a.jsx)(n.li,{children:"ApiCookieAuth：通过 cookie 的方式认证"}),"\n",(0,a.jsx)(n.li,{children:"ApiBasicAuth：通过用户名、密码认证，在 header 添加 Authorization: Basic xxx"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"swagger 是 openapi 标准的实现，可以在 url 后加个 -json 拿到对应的 json，然后导入别的接口文档平台来用。"}),"\n",(0,a.jsx)(n.p,{children:"绝大多数公司的接口文档都是用 swagger 来自动生成的，不然手动维护太麻烦了。"}),"\n",(0,a.jsx)(n.p,{children:"而且 swagger 还可以方便的测试接口，自动添加身份认证等。"}),"\n",(0,a.jsx)(n.p,{children:"你们公司用的是 swagger 生成的接口文档么？"})]})}function ee(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,s.ah)(),e.components);return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)($,{...e})}):$(e)}let en=ee;ee.__RSPRESS_PAGE_META={},ee.__RSPRESS_PAGE_META["Nest%20%E9%80%9A%E5%85%B3%E7%A7%98%E7%B1%8D%20%20%E6%9C%80%E6%96%B0200%E7%AB%A0%2F83.%20%E7%94%A8%20Swagger%20%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90%20api%20%E6%96%87%E6%A1%A3.md"]={toc:[{text:"总结",id:"总结",depth:2}],title:"83. 用 Swagger 自动生成 api 文档",headingTitle:"83. 用 Swagger 自动生成 api 文档",frontmatter:{}}}}]);