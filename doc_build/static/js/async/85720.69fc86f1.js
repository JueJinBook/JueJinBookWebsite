"use strict";(self.webpackChunkjue_jin_book_press=self.webpackChunkjue_jin_book_press||[]).push([["85720"],{219819:function(e,n,s){s.r(n),s.d(n,{default:()=>P});var c=s(552676),i=s(740453);let p=s.p+"static/image/2acf1a2e6ab5b976ae1801f715dc281e.0225b5db.webp",r=s.p+"static/image/db23c8da966ad5ff6b31579b4480e0d5.9902245b.webp",d=s.p+"static/image/91784a674cae027148d82cd4e76a5bef.d9687470.webp",a=s.p+"static/image/6a9532f1e171ee4dc8c676ee856f5e0b.1b9a78c6.webp",t=s.p+"static/image/77c371c22bd046f357592d15d99c583b.302730d6.webp",l=s.p+"static/image/0ff689b4d3961fe8d425ddd55becf9a4.ed34baed.webp",x=s.p+"static/image/11104e3230416342e477f378849b11ec.3ee78121.webp",j=s.p+"static/image/978f8df3d0817ad6c9d932d42052f578.a8f8a2b8.webp",h=s.p+"static/image/8735b0a38aa81411c468fb0d561abe9c.1f8976dd.webp",m=s.p+"static/image/8551ed31fa5aaae3e249cda8ef24e535.50fdd0bf.webp",b=s.p+"static/image/484a6ffec3105af2f4260e16f4fb3b73.fd15dd88.webp",g=s.p+"static/image/1e1dae870648554c5423dc244e2db453.7d1c13d5.webp",f=s.p+"static/image/8b35f73602e388747c6544b91f322077.69a8c2d3.webp",o=s.p+"static/image/5b9598c78caa3275c43089080c6c37f2.4995a88e.webp",u=s.p+"static/image/e407820fff20e6b30bf2ae3c8329485c.4b89cf94.webp",w=s.p+"static/image/fec78ccc8d7e74ddd7c2922c0be038ce.ac5f7241.webp",E=s.p+"static/image/2751550f152f5f59f0beb06c969d81a6.7c1e983a.webp",_=s.p+"static/image/5fee8e48ae9f34ee0f8472682163c8e7.2e4b08f9.webp",k=s.p+"static/image/c816e8c3e953c15de118f591bd27496c.7081693e.webp",v=s.p+"static/image/b22b51d8876a99fe168d2aaef4be2c06.8706c587.webp",A=s.p+"static/image/42348bf7aa0d2d4f3eb31049684c3257.73185045.webp",B=s.p+"static/image/b961b9a8873bca3df29e04f6d1720b2e.60b95953.webp",C=s.p+"static/image/a56bc021297fa4dc4778ef17e8838e7d.1400f873.webp",S=s.p+"static/image/543ccc5276ec230948acaeac9a3083fe.4717f3de.webp",D=s.p+"static/image/e38521390fd81b4254036d7d8d9318c3.b78a9b20.webp";function F(e){let n=Object.assign({h1:"h1",a:"a",p:"p",img:"img",ul:"ul",li:"li",h2:"h2"},(0,i.ah)(),e.components);return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)(n.h1,{id:"14跑-npm-scripts有更香的方式",children:["14.跑 npm scripts，有更香的方式",(0,c.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#14跑-npm-scripts有更香的方式",children:"#"})]}),"\n",(0,c.jsx)(n.p,{children:"每个前端项目都有 npm scripts，我们会用 npm scripts 来组织编译、打包、lint 等任务。"}),"\n",(0,c.jsx)(n.p,{children:"大家可能经常会跑 npm scripts，但却对这些命令行工具是怎么实现的并不了解。"}),"\n",(0,c.jsx)(n.p,{children:"那如果想了解这些工具的实现原理，应该怎么做呢？"}),"\n",(0,c.jsx)(n.p,{children:"这就是今天的主题：调试 npm scripts。"}),"\n",(0,c.jsx)(n.p,{children:"这些命令行工具的 package.json 里都会有个 bin 字段，来声明有哪些命令："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:D,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"npm install 这个包以后，就会放到 node_modules/.bin 目录下："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:S,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"这样我们就可以通过 node ./node_modules/.bin/xx 来跑不同的工具了。"}),"\n",(0,c.jsx)(n.p,{children:"我们也可以用 npx 来跑，比如 npx xx，它的作用就是执行 node_modules/.bin 下的本地命令，如果没有的话会从 npm 下载然后执行。"}),"\n",(0,c.jsx)(n.p,{children:"当然，最常用的还是放到 npm scripts 里："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:C,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"这样就直接 npm run xxx 跑就行了。"}),"\n",(0,c.jsx)(n.p,{children:"npm scripts 本质上还是用 node 来跑这些 script 代码，所以调试他们和调试其他 node 代码没啥区别。"}),"\n",(0,c.jsx)(n.p,{children:"也就是可以这样跑："}),"\n",(0,c.jsx)(n.p,{children:"在 .vscode/launch.json 的调试文件里，选择 node 的 launch program："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:B,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"用 node 执行 node_modules/.bin 下的文件，传入参数即可："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:A,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"其实还有更简单的方式，VSCode Debugger 对 npm scripts 调试的场景做了封装，可以直接选择 npm 类型的调试配置："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:v,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"直接指定运行的命令即可："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:k,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"比如我们就用这个 create-react-app 创建的 react 项目来尝试下 npm scripts 的调试："}),"\n",(0,c.jsx)(n.p,{children:"先去 node_modules/.bin 下这个文件里打个断点："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:_,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"然后点击 debug 启动："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:E,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"你会发现会执行 scripts 下的 start 模块："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:w,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"我们再去 start 下打个断点："}),"\n",(0,c.jsx)(n.p,{children:"代码执行到这里断住："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:u,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"这个 config 就是 webpack 的配置："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:o,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"再往下走，会发现启动了一个 server："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:f,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"我们在 server 启动的回调函数里打个断点，看看浏览器是怎么打开的："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:g,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"点击 step into 进入这个断点："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:b,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"然后单步执行，会走到这样的代码："}),"\n",(0,c.jsx)(n.p,{children:"依次通过 osascript 来启动这些浏览器，启动失败的话，try catch 里直接忽略了："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:m,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"这些浏览器 hover 上去就可以看到："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:h,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"释放断点，你就会发现浏览器打开了："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:j,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"这样，我们不就梳理了一遍 react-scripts start 的流程么？"}),"\n",(0,c.jsx)(n.p,{children:"总结一下就是这样的："}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"根据输入的 start 命令，执行 scripts/start 模块"}),"\n",(0,c.jsx)(n.li,{children:"根据配置，创建 webpack 的 Compiler 对象"}),"\n",(0,c.jsx)(n.li,{children:"创建 WebpackDevServer"}),"\n",(0,c.jsx)(n.li,{children:"server 启动之后，启动浏览器打开 url"}),"\n",(0,c.jsx)(n.li,{children:"打开 url 的实现就是通过 osascripts 依次尝试那些浏览器"}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:"这样调试完一遍，我们就对 npm run start 有了更深入的认识。"}),"\n",(0,c.jsx)(n.p,{children:"而且，调试的方式跑 script 和直接命令行 npm run start 没啥区别。"}),"\n",(0,c.jsx)(n.p,{children:"要说区别，唯一的区别可能就是这个："}),"\n",(0,c.jsx)(n.p,{children:"默认调试模式下，输出的内容会在 Debug Console 面板显示："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:x,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"但这个也可以改："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:l,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"可以切换成 integratedTerminal，那就会输出在 terminal 了："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:t,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"这样就和平时 npm run start 执行没了任何区别，而且还可以断点调试，它不香么？"}),"\n",(0,c.jsx)(n.p,{children:"我们再来看个例子，比如 vue cli 创建的 vue 项目，在 vue.config.js 里可以改 webpack 配置："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:a,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"但如果你想知道默认的配置是啥呢？console.log 么？"}),"\n",(0,c.jsx)(n.p,{children:"console.log 打印大对象可不是个好主意，它是这样的："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:d,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"有的同学说用 JSON.stringify，那个更难看，特别长的一串。"}),"\n",(0,c.jsx)(n.p,{children:"如果你会了调试 npm scripts 呢？"}),"\n",(0,c.jsx)(n.p,{children:"你就可以加一个 npm 类型的调试配置："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:r,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"然后打个断点，debug 来跑："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:p,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"啥配置都能看到，这不香么？"}),"\n",(0,c.jsx)(n.p,{children:"我举的例子只是 webpack 的，但其余的 npm scripts，比如 babel、tsc、eslint、vite 等等都是一样的调试方式。"}),"\n",(0,c.jsxs)(n.h2,{id:"总结",children:["总结",(0,c.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#总结",children:"#"})]}),"\n",(0,c.jsx)(n.p,{children:"每个项目都有 npm scripts，大多数人只是用它们而不会调试它们，所以就算每天用也不知道这些工具的原理。"}),"\n",(0,c.jsx)(n.p,{children:"这些命令行工具都是在 package.json 中声明一个 bin 字段，然后 install 之后就会放到 node_modules/.bin 下。"}),"\n",(0,c.jsx)(n.p,{children:"可以 node node_modules/.bin/xx 来跑，可以 npx xx 来跑，最常用的还是 npm scripts，通过 npm run xx 来跑。"}),"\n",(0,c.jsx)(n.p,{children:"npm scripts 的调试就是 node 的调试，只不过 VSCode Debugger 做了简化，可以直接创建 npm 类型的调试配置。"}),"\n",(0,c.jsx)(n.p,{children:"把 console 配置为 integratedTerminal 之后，日志会输出到 terminal，和平时直接跑 npm run xx 就没区别了。而且还可以断点看看执行逻辑。"}),"\n",(0,c.jsx)(n.p,{children:"跑 npm scripts 之余，还可以理一下它的实现逻辑，哪里感兴趣断在哪里，这不比直接跑香么？"})]})}function T(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,i.ah)(),e.components);return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(F,{...e})}):F(e)}let P=T;T.__RSPRESS_PAGE_META={},T.__RSPRESS_PAGE_META["%E5%89%8D%E7%AB%AF%E8%B0%83%E8%AF%95%E9%80%9A%E5%85%B3%E7%A7%98%E7%B1%8D%2F14.%E8%B7%91%20npm%20scripts%EF%BC%8C%E6%9C%89%E6%9B%B4%E9%A6%99%E7%9A%84%E6%96%B9%E5%BC%8F.md"]={toc:[{text:"总结",id:"总结",depth:2}],title:"14.跑 npm scripts，有更香的方式",headingTitle:"14.跑 npm scripts，有更香的方式",frontmatter:{}}}}]);