"use strict";(self.webpackChunkjue_jin_book_press=self.webpackChunkjue_jin_book_press||[]).push([["56842"],{206510:function(n,e,s){n.exports=s.p+"static/image/2c89b9e452080be0eda5514fad9c0a25.e55ddec8.gif"},344137:function(n,e,s){n.exports=s.p+"static/image/38ede77b408a09c74131a536d20037ea.7672670a.webp"},452890:function(n,e,s){n.exports=s.p+"static/image/ff87b7949aabccd35884fb4c17b61ba2.35f1f732.webp"},829770:function(n,e,s){s.r(e),s.d(e,{default:()=>E});var a=s(552676),i=s(740453);let r=s.p+"static/image/96f7472957681eea83a844c3ee0dfbb1.617af9ab.gif";var t=s(452890);let c=s.p+"static/image/d80fdb55c1f2a1fc0799d9a8e8aae202.1c878c37.webp",d=s.p+"static/image/d08873781e31106ce1495f469cc08b30.70b840b1.webp",o=s.p+"static/image/27495d8daa30835d252eda754b8c2e5d.fbd243cd.webp",p=s.p+"static/image/f9b339b78da2d73816116de4c00c50a2.5d2a483d.webp",m=s.p+"static/image/5daf4dfd45e8c85da693cd06d86f46d1.5c936b25.webp",l=s.p+"static/image/d9a175321cb9842b53e9388eddd2a8e1.fa4e3628.webp",x=s.p+"static/image/6c5db2aec068a35c1871ee489225fc1d.e3ea7689.gif",h=s.p+"static/image/d8914d9acc0cdedfdd3e27cfe326600f.3592ea29.gif",u=s.p+"static/image/9033964089e73688ee9e582205747630.eb292a33.gif";var f=s(344137);let j=s.p+"static/image/96b9f411a79b757bcbaeefcbbd495843.be7c7452.webp",g=s.p+"static/image/6940378f2a474f5066e2d1369f95b090.3555d1af.webp",b=s.p+"static/image/5fb24a5ccd632883058d850c2c36059a.dd04dc44.webp";var w=s(206510);function v(n){let e=Object.assign({h1:"h1",a:"a",p:"p",img:"img",pre:"pre",code:"code",h2:"h2"},(0,i.ah)(),n.components);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(e.h1,{id:"168-考试系统自动判卷",children:["168. 考试系统：自动判卷",(0,a.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#168-考试系统自动判卷",children:"#"})]}),"\n",(0,a.jsx)(e.p,{children:"上节实现了答卷的提交，但是提交之后的分数页面还没写："}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)("img",{src:w,alt:"2024-08-27 16.14.41.gif"})}),"\n",(0,a.jsx)(e.p,{children:"这节来写一下。"}),"\n",(0,a.jsx)(e.p,{children:"我们现在并没有做分数的计算："}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)("img",{src:b,alt:"image.png"})}),"\n",(0,a.jsx)(e.p,{children:"答卷表里的 score 都是 0"}),"\n",(0,a.jsx)(e.p,{children:"那怎么实现分数的计算呢？"}),"\n",(0,a.jsx)(e.p,{children:"也很简单，每个试卷的内容保存在 exam 表里，并且都保存了正确答案。"}),"\n",(0,a.jsx)(e.p,{children:"我们只要根据 id 和 answer 表里的答案对比下就知道了："}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)("img",{src:g,alt:"image.png"})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)("img",{src:j,alt:"image.png"})}),"\n",(0,a.jsx)(e.p,{children:"改下 AnswerService 的 add 方法："}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)("img",{src:f,alt:"image.png"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-javascript",children:"async add(dto: AnswerAddDto, userId: number) {\n  const exam = await this.prismaService.exam.findUnique({\n    where: {\n      id: dto.examId\n    }\n  });\n\n  let quesitons = [];\n  try{\n    quesitons = JSON.parse(exam.content);\n  } catch(e) {}\n\n  let answers = [];\n  try{\n    answers = JSON.parse(dto.content);\n  } catch(e) {}\n  \n  let totalScore = 0;\n  answers.forEach(answer => {\n    const question = quesitons.find(item => item.id === answer.id);\n\n    if(question.type === 'input') {\n      if(answer.answer.includes(question.answer)) {\n        totalScore += question.score\n      }\n    } else {\n      if(answer.answer === question.answer) {\n        totalScore += question.score\n      }\n    }\n  })\n\n  return this.prismaService.answer.create({\n    data: {\n      content: dto.content,\n      score: totalScore,\n      answerer: {\n        connect: {\n            id: userId\n        }\n      },\n      exam: {\n        connect: {\n            id: dto.examId\n        }\n      }\n    },\n  })\n}\n"})}),"\n",(0,a.jsx)(e.p,{children:"测试下："}),"\n",(0,a.jsx)(e.p,{children:"新建试卷，进入编辑器："}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)("img",{src:u,alt:"2024-08-27 17.34.37.gif"})}),"\n",(0,a.jsx)(e.p,{children:"每种类型问题添加一个："}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)("img",{src:h,alt:"2024-08-27 17.36.09.gif"})}),"\n",(0,a.jsx)(e.p,{children:"点击保存后，去答卷："}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)("img",{src:x,alt:"2024-08-27 17.42.38.gif"})}),"\n",(0,a.jsx)(e.p,{children:"可以看到，计算出的分数是对的："}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)("img",{src:l,alt:"image.png"})}),"\n",(0,a.jsx)(e.p,{children:"然后我们写下结果页面，显示下分数："}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)("img",{src:m,alt:"image.png"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-javascript",children:'{\n    path: "res/:id",\n    element: <Res />,\n},\n'})}),"\n",(0,a.jsx)(e.p,{children:"创建 pages/Res/index.tsx"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-javascript",children:'import { Link, useParams } from "react-router-dom";\nimport { useEffect } from "react";\n\nexport function Res() {\n\n    let { id } = useParams();\n\n    async function query() {\n        if(!id) {\n            return;\n        }\n\n    }\n\n    useEffect(() => {\n        query();        \n    }, [])\n\n    return <div id="res-container">\n        <div>\n            得分: 10\n        </div>\n        <div>\n            正确答案：\n        </div>\n    </div>\n}\n'})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)("img",{src:p,alt:"image.png"})}),"\n",(0,a.jsx)(e.p,{children:"在 interface/index.tsx 添加 find 接口："}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-javascript",children:"export async function answerFind(id: number) {\n    return await answerServiceInstance.get('/answer/find/' + id);\n}\n"})}),"\n",(0,a.jsx)(e.p,{children:"调用下："}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)("img",{src:o,alt:"image.png"})}),"\n",(0,a.jsx)(e.p,{children:"根据 id 查询答卷，设置 score。"}),"\n",(0,a.jsx)(e.p,{children:"并且根据 examId 查询下试卷："}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)("img",{src:d,alt:""})}),"\n",(0,a.jsx)(e.p,{children:"渲染 json 的逻辑和编辑器一样，只不过 value 直接指定为正确答案："}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)("img",{src:c,alt:"image.png"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-javascript",children:'import { Link, useParams } from "react-router-dom";\nimport { useEffect, useState } from "react";\nimport { answerFind, examFind } from "../../interfaces";\nimport { Button, Checkbox, Input, message, Radio } from "antd";\nimport { Question } from "../Edit";\nimport \'./index.scss\';\n\nexport function Res() {\n\n    let { id } = useParams();\n\n    const [score, setScore] = useState();\n    const [json, setJson] = useState<Question[]>([]);\n\n    async function query() {\n        if(!id) {\n            return;\n        }\n        try {\n            const res = await answerFind(+id);\n\n            if(res.status === 201 || res.status === 200) {\n                setScore(res.data.score);\n\n                await queryExam(res.data.examId)\n            } \n        } catch(e: any){\n            message.error(e.response?.data?.message || \'系统繁忙，请稍后再试\');\n        }\n    }\n\n    async function queryExam(examId: number) {\n        try {\n            const res = await examFind(+examId);\n\n            if(res.status === 201 || res.status === 200) {\n                try{\n                    const questions = JSON.parse(res.data.content);\n\n                    setJson(questions);\n                } catch(e) {}\n            } \n        } catch(e: any){\n            message.error(e.response?.data?.message || \'系统繁忙，请稍后再试\');\n        }\n    }\n\n    useEffect(() => {\n        query();        \n    }, [])\n\n    function renderComponents(arr: Array<Question>) {\n        return arr.map(item => {\n            let formComponent;\n            if(item.type === \'radio\') {\n                formComponent = <Radio.Group value={item.answer}>\n                    {\n                        item.options?.map(option => <Radio value={option}>{option}</Radio>)\n                    }\n                </Radio.Group>\n            } else if(item.type === \'checkbox\') {\n                formComponent = <Checkbox.Group options={item.options} value={item.answer.split(\',\')}/>\n            } else if(item.type === \'input\'){\n                formComponent =  <Input value={item.answer}/>\n            }\n\n            return <div className="component-item" key={item.id}>\n                <p className="question">{item.question}</p>\n                <div className="options">\n                    {formComponent}\n                </div>\n                <p className="score">\n                    分值：{item.score}\n                </p>\n                <p className="answerAnalyse">\n                    答案解析：{item.answerAnalyse}\n                </p>\n            </div>\n        })\n    }\n\n    return <div id="res-container">\n        <div className="score-container">\n            得分: <span>{score}</span>\n        </div>\n        <div className="answer-list">\n            正确答案：{renderComponents(json)}\n        </div>\n        <Button type="primary"><Link to="/">返回试卷列表</Link></Button>\n    </div>\n}\n\n\n'})}),"\n",(0,a.jsx)(e.p,{children:"index.scss"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-scss",children:"#res-container {\n    padding: 20px;\n\n    .score-container {\n        span {\n            font-size: 50px;\n            color: red;\n            font-weight: bold;\n        }\n        margin-bottom: 20px;\n    }\n\n    .component-item {\n        margin: 20px;\n\n        line-height: 40px;\n        font-size: 20px;\n\n        .answerAnalyse {\n            color: green;\n        }\n    }\n}\n"})}),"\n",(0,a.jsx)(e.p,{children:"看下效果："}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)("img",{src:t,alt:"image.png"})}),"\n",(0,a.jsx)(e.p,{children:"没啥问题。"}),"\n",(0,a.jsx)(e.p,{children:"我们整体试一下："}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)("img",{src:r,alt:"2024-08-27 18.07.53.gif"})}),"\n",(0,a.jsx)(e.p,{children:"没啥问题。"}),"\n",(0,a.jsx)(e.p,{children:"案例代码在小册仓库："}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.a,{href:"https://github.com/QuarkGluonPlasma/nestjs-course-code/tree/main/exam-system-frontend",target:"_blank",rel:"noopener noreferrer",children:"前端代码"})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.a,{href:"https://github.com/QuarkGluonPlasma/nestjs-course-code/tree/main/exam-system",target:"_blank",rel:"noopener noreferrer",children:"后端代码"})}),"\n",(0,a.jsxs)(e.h2,{id:"总结",children:["总结",(0,a.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#总结",children:"#"})]}),"\n",(0,a.jsx)(e.p,{children:"这节我们实现了自动判卷，其实就是根据 id 一一对比试卷里的正确答案和答卷里的答案。"}),"\n",(0,a.jsx)(e.p,{children:"然后实现了结果页面，查询判卷的分数还有试卷的正确答案。"}),"\n",(0,a.jsx)(e.p,{children:"这样，从新建试卷、编辑试卷、答卷、到自动判卷的流程就完成了。"})]})}function y(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}=Object.assign({},(0,i.ah)(),n.components);return e?(0,a.jsx)(e,{...n,children:(0,a.jsx)(v,{...n})}):v(n)}let E=y;y.__RSPRESS_PAGE_META={},y.__RSPRESS_PAGE_META["Nest%20%E9%80%9A%E5%85%B3%E7%A7%98%E7%B1%8D%20%20%E6%9C%80%E6%96%B0200%E7%AB%A0%2F168.%20%E8%80%83%E8%AF%95%E7%B3%BB%E7%BB%9F%EF%BC%9A%E8%87%AA%E5%8A%A8%E5%88%A4%E5%8D%B7.md"]={toc:[{text:"总结",id:"总结",depth:2}],title:"168. 考试系统：自动判卷",headingTitle:"168. 考试系统：自动判卷",frontmatter:{}}}}]);