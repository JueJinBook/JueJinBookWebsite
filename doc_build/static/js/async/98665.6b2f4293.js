"use strict";(self.webpackChunkjue_jin_book_press=self.webpackChunkjue_jin_book_press||[]).push([["98665"],{331078:function(e,n,t){t.r(n),t.d(n,{default:()=>v});var i=t(552676),s=t(740453);let r=t.p+"static/image/514a10404cc0f9dcf241f49f85fbbb22.82c6c331.webp",l=t.p+"static/image/049365c014477437ee1bb124ce130ab6.04d6e7a6.webp",c=t.p+"static/image/2ab3677a9326fa34f29d1b02647309a0.54eee961.webp",d=t.p+"static/image/43437b709bfbc5e50f616b2e7d493eda.1ac0221b.webp",a=t.p+"static/image/5147627c670a8de19959193b6632c7a4.a4ab114d.webp",o=t.p+"static/image/c3b3a492db25ddc67d0cad600742d1e1.826c6a4a.webp",p=t.p+"static/image/b5c3fd00d1a1d10bafc773b5c1614914.12810134.webp",h=t.p+"static/image/bcd0ede7210f13c0175b18cae72bc6bb.ace000ff.webp",u=t.p+"static/image/d70373891c6979c3564fab3f978606f1.54f79d18.webp",x=t.p+"static/image/9c6b0f0d51683473de0b83a7fa795160.14027ac2.webp",b=t.p+"static/image/11626eb9a9566d8bfd09da77245dac56.8d6a2efc.webp",f=t.p+"static/image/77e4d79c94ecb9db40383fda0b31792e.f236b8d9.webp";function j(e){let n=Object.assign({h1:"h1",a:"a",blockquote:"blockquote",p:"p",h2:"h2",strong:"strong",code:"code",pre:"pre",img:"img"},(0,s.ah)(),e.components);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.h1,{id:"41-svelte-4--actions",children:["41-Svelte 4 ❘ Actions",(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#41-svelte-4--actions",children:"#"})]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"推荐学习指数：⭐️️，了解即可"}),"\n"]}),"\n",(0,i.jsxs)(n.h2,{id:"1-前言",children:["1. 前言",(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#1-前言",children:"#"})]}),"\n",(0,i.jsx)(n.p,{children:"本篇我们讲解 Svelte 中的重要概念 —— Actions。虽然本身比较简单，但它极大的增强了 Svelte 的功能。简单来说，就是能玩出花儿……本篇我们会举出丰富的例子帮助大家理解 Actions 的作用。"}),"\n",(0,i.jsx)(n.p,{children:"那就让我们来看看怎么使用吧！"}),"\n",(0,i.jsxs)(n.h2,{id:"2-actions-介绍",children:["2. Actions 介绍",(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#2-actions-介绍",children:"#"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Actions 是元素级别的生命周期函数。"})," 也就是说，当它搭配 ",(0,i.jsx)(n.code,{children:"use"}),"指令用在 HTML 元素时，可设置该元素的生命周期函数。其用法如下："]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-xml",children:"<script>\n  export let bar;\n\n  function foo(node, bar) {\n    // node 表示元素的引用，bar 是自定义传入的值\n    // 挂载 DOM 的时候执行\n\n    return {\n      update(bar) {\n        // 当 bar 的值改变的时候执行\n      },\n\n      destroy() {\n        // 从 DOM 中移除的时候执行\n      }\n    };\n  }\n<\/script>\n\n<div use:foo={bar} />\n"})}),"\n",(0,i.jsx)(n.p,{children:"举个最简单的例子："}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-xml",children:"<script>\n  let name = 'world';\n\n  function log(node) {\n  console.log(node)\n  }\n<\/script>\n\n<h1 use:log>Hello {name}!</h1>\n"})}),"\n",(0,i.jsxs)(n.p,{children:["我们使用 ",(0,i.jsx)(n.code,{children:"use"}),"指令调用了自定义的 log 函数，这个 log 函数在 Svelte 中就被称为“Action”。"]}),"\n",(0,i.jsxs)(n.p,{children:["函数的第一个参数为 ",(0,i.jsx)(n.code,{children:"node"}),"，表示引用的 DOM 节点。该函数会在元素挂载到 DOM 上的时候执行，相当于元素的 ",(0,i.jsx)(n.code,{children:"onMount"})," 函数。"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"https://svelte.dev/repl/0c5a2b9d42ed46859f942e473bdd9be0?version=4.2.18",title:"https://svelte.dev/repl/0c5a2b9d42ed46859f942e473bdd9be0?version=4.2.18",target:"_blank",rel:"noopener noreferrer",children:"浏览器效果如下："})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)("img",{src:f,alt:""})}),"\n",(0,i.jsx)(n.p,{children:"我们举个更复杂的例子，包含挂载、更新、销毁："}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-xml",children:"<script>\n  let name = 'world';\n  let checked = true;\n\n  function log(node, params) {\n    node.innerHTML = params\n    return {\n      update(newParams) {\n        console.log(newParams)\n        node.innerHTML = newParams\n      },\n      destroy() {\n        console.log('destroy')\n      }\n    }\n  }\n<\/script>\n\n<label>\n  <input type=\"checkbox\" bind:checked={checked} />\n  show\n</label>\n\n{#if checked}\n  <input bind:value={name} />\n  <h1 use:log={name}>'loading'</h1>\n{/if}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"https://svelte.dev/repl/8a044663ca744ac2ac25f0efa0edb2f7?version=4.2.18",title:"https://svelte.dev/repl/8a044663ca744ac2ac25f0efa0edb2f7?version=4.2.18",target:"_blank",rel:"noopener noreferrer",children:"浏览器效果如下："})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)("img",{src:b,alt:""})}),"\n",(0,i.jsxs)(n.p,{children:["当元素挂载的时候的时候，运行 ",(0,i.jsx)(n.code,{children:"log()"})," 函数，打印 ",(0,i.jsx)(n.code,{children:'"mounted"'}),"，当元素销毁的时候，触发 ",(0,i.jsx)(n.code,{children:"destroy()"})," 函数，打印 ",(0,i.jsx)(n.code,{children:'"destroy"'}),"。当自定义传入 Action 的 name 值发生改变的时候，触发 update 函数。"]}),"\n",(0,i.jsxs)(n.p,{children:["Actions 的用法就这么多，Svelte Tutorial 中介绍的也不多，但",(0,i.jsx)(n.strong,{children:"实际上 Actions 是一个非常强大的功能"}),"。我们举几个例子，大家可以在实际操作中体会。"]}),"\n",(0,i.jsxs)(n.h2,{id:"3-用途-1输入框聚焦",children:["3. 用途 1：输入框聚焦",(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#3-用途-1输入框聚焦",children:"#"})]}),"\n",(0,i.jsx)(n.p,{children:"现在我们来实现这样一个效果："}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)("img",{src:"data:image/webp;base64,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",alt:""})}),"\n",(0,i.jsxs)(n.p,{children:["效果本身是比较简单的，实现的重点在于",(0,i.jsx)(n.strong,{children:"当点击编辑按钮的时候，输入框要聚焦，方便用户输入"}),"。"]}),"\n",(0,i.jsx)(n.p,{children:"第一种实现方式如下："}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-xml",children:"<script>\n  import { tick } from 'svelte';\n\n  let input;\n  let name = 'YaYu';\n  let editing = false;\n\n  async function toggleEdit() {\n    editing = !editing\n    if (editing) {\n      await tick()\n      input.focus();\n    }\n  }\n<\/script>\n\n昵称：\n{#if editing}\n  <label>\n    <input type=\"text\" bind:this={input} bind:value={name}>\n  </label>\n{:else}\n  {name}\n{/if}\n\n<button on:click={toggleEdit} style=\"display: inline\">\n  {editing ? '确定' : '编辑'}\n</button>\n"})}),"\n",(0,i.jsxs)(n.p,{children:["在这段代码中，我们首先使用 ",(0,i.jsx)(n.code,{children:"bind:this"})," 获取 ",(0,i.jsx)(n.code,{children:"<input>"}),"引用，然后在点击编辑的时候，调用 ",(0,i.jsx)(n.code,{children:".focus()"}),"方法。"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"https://svelte.dev/repl/9e2f5e53f7b34d6385e39de6afc75e03?version=4.2.18",title:"https://svelte.dev/repl/9e2f5e53f7b34d6385e39de6afc75e03?version=4.2.18",target:"_blank",rel:"noopener noreferrer",children:"浏览器效果如下："})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)("img",{src:x,alt:""})}),"\n",(0,i.jsx)(n.p,{children:"第二种实现方式如下："}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-xml",children:"\x3c!-- App.svelte --\x3e\n<script>\n  import Input from './Input.svelte';\n  let name = 'YaYu';\n  let editing = false;\n\n  function toggleEdit() {\n    editing = !editing\n  }\n<\/script>\n\n昵称：\n{#if editing}\n  <Input bind:value={name} />\n{:else}\n  {name}\n{/if}\n\n<button on:click={toggleEdit} style=\"display: inline\">\n  {editing ? '确定' : '编辑'}\n</button>\n\n\x3c!-- Input.svelte --\x3e\n<script>\n  export let value;\n  let input;\n\n  import { onMount } from 'svelte';\n  onMount(() => {\n    input.focus();\n  });\n<\/script>\n\n<label>\n  <input type=\"text\" bind:this={input} bind:value>\n</label>\n"})}),"\n",(0,i.jsx)(n.p,{children:"在这段代码中，我们将输入框移到一个单独的组件中，在挂载的时候，将输入框聚焦。"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"https://svelte.dev/repl/be46883f681a44e68ec14bf344bdfa16?version=4.2.18",title:"https://svelte.dev/repl/be46883f681a44e68ec14bf344bdfa16?version=4.2.18",target:"_blank",rel:"noopener noreferrer",children:"浏览器效果如下"}),"（其实效果跟上面是一样的）："]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)("img",{src:u,alt:""})}),"\n",(0,i.jsx)(n.p,{children:"第三种方法是使用 Actions："}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"<script>\n  import { tick } from 'svelte';\n\n  let input;\n  let name = 'YaYu';\n  let editing = false;\n\n  function toggleEdit() {\n    editing = !editing\n  }\n\n  function focusOnMount(node) {\n    node.focus();\n  }\n<\/script>\n\n昵称：\n{#if editing}\n  <label>\n    <input use:focusOnMount type=\"text\" bind:this={input} bind:value={name}>\n  </label>\n{:else}\n  {name}\n{/if}\n\n<button on:click={toggleEdit}>\n  {editing ? '确定' : '编辑'}\n</button>\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"https://svelte.dev/repl/9de235b2f51d45bdae2f0f7cb4fc0546?version=4.2.18",title:"https://svelte.dev/repl/9de235b2f51d45bdae2f0f7cb4fc0546?version=4.2.18",target:"_blank",rel:"noopener noreferrer",children:"浏览器效果同上"})}),"\n",(0,i.jsx)(n.p,{children:"这三种方法中，哪种更好一点呢？"}),"\n",(0,i.jsxs)(n.p,{children:["理论上，Actions 这个方法更好，因为复用方便。如果还有其他输入框，直接添加 ",(0,i.jsx)(n.code,{children:"use:focusOnMount"}),"即可。"]}),"\n",(0,i.jsx)(n.p,{children:"借这个简单的例子是为了说明 Actions 可以解决 DOM 操作的复用问题。我们再进阶看一个例子。"}),"\n",(0,i.jsxs)(n.h2,{id:"4-用途-2双击事件",children:["4. 用途 2：双击事件",(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#4-用途-2双击事件",children:"#"})]}),"\n",(0,i.jsx)(n.p,{children:"现在我们来实现一个双击效果，即当双击按钮的时候，打印一个值："}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-xml",children:"<script>\n  function doubleClick(element) {\n    let count = 0;\n    let timeoutId;\n\n    function onClick() {\n      if (++count === 2) {\n        element.dispatchEvent(new CustomEvent('doubleClick'));\n      }\n\n      timeoutId && clearTimeout(timeoutId);\n      timeoutId = setTimeout(() => {\n        timeoutId = null;\n        count = 0;\n      }, 800);\n    }\n\n    element.addEventListener('click', onClick);\n    return {\n      destroy() {\n        element.removeEventListener('click', onClick);\n      }\n    }\n  }\n<\/script>\n\n<button\n  use:doubleClick\n  on:doubleClick={() => console.log('doubleClick!')}\n>doubleClick</button>\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"https://svelte.dev/repl/fa522461330d45659a27bc2f187816de?version=4.2.18",title:"https://svelte.dev/repl/fa522461330d45659a27bc2f187816de?version=4.2.18",target:"_blank",rel:"noopener noreferrer",children:"浏览器效果如下："})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)("img",{src:h,alt:""})}),"\n",(0,i.jsxs)(n.p,{children:["这是 Actions 一个非常常见的例子。当元素加上 ",(0,i.jsx)(n.code,{children:"use:doubleClick"}),"指令的时候，元素会监听点击事件，并在双击的时候，发送自定义的 doubleClick 事件，然后元素可以使用 ",(0,i.jsx)(n.code,{children:"on:doubleClick"}),"监听该事件。"]}),"\n",(0,i.jsxs)(n.p,{children:["这也是 ",(0,i.jsx)(n.a,{href:"https://learn.svelte.dev/tutorial/actions",title:"https://learn.svelte.dev/tutorial/actions",target:"_blank",rel:"noopener noreferrer",children:"Tutorial"})," 中介绍的常见的 4 种用法之一："]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)("img",{src:p,alt:""})}),"\n",(0,i.jsx)(n.p,{children:"当然不止双击，各种手势操作都可以通过这种方式实现。"}),"\n",(0,i.jsxs)(n.h2,{id:"5-用途-3tooltips",children:["5. 用途 3：tooltips",(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#5-用途-3tooltips",children:"#"})]}),"\n",(0,i.jsx)(n.p,{children:"tooltips 是 Tutorial 中介绍的例子。我们再列举一遍当做复习了。"}),"\n",(0,i.jsxs)(n.p,{children:["有的时候，为了开发方便，你需要引入一些三方库，Actions 就可以搭配三方库一起使用。就比如实现 tooltips 的 ",(0,i.jsx)(n.a,{href:"https://atomiks.github.io/tippyjs/",title:"https://atomiks.github.io/tippyjs/",target:"_blank",rel:"noopener noreferrer",children:"tippy"}),"。它的基本用法如下："]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:'<button id="myButton">My Button</button>;\n\ntippy("#myButton", {\n  content: "I\'m a Tippy tooltip!",\n});\n'})}),"\n",(0,i.jsx)(n.p,{children:"浏览器效果如下："}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)("img",{src:o,alt:""})}),"\n",(0,i.jsx)(n.p,{children:"如果我们要在 Svelte 项目中使用："}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-xml",children:"<script>\n  import tippy from 'tippy.js';\n  import 'tippy.js/dist/tippy.css';\n  import 'tippy.js/themes/material.css';\n\n  let content = 'Hello!';\n\n  function tooltip(node, options) {\n    const tooltip = tippy(node, options);\n\n    return {\n      update(options) {\n        tooltip.setProps(options);\n      },\n      destroy() {\n        tooltip.destroy();\n      }\n    };\n  }\n<\/script>\n\n<input bind:value={content} />\n\n<button use:tooltip={{ content, theme: 'material' }}>\n  Hover me\n</button>\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"https://learn.svelte.dev/tutorial/adding-parameters-to-actions",title:"https://learn.svelte.dev/tutorial/adding-parameters-to-actions",target:"_blank",rel:"noopener noreferrer",children:"浏览器效果如下："})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)("img",{src:"data:image/webp;base64,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",alt:""})}),"\n",(0,i.jsx)(n.p,{children:"当然不止是 tippy，因为在函数中提供了元素的引用，可以搭配使用很多三方库，这极大的拓展了 Svelte 能够实现的功能。"}),"\n",(0,i.jsxs)(n.p,{children:["我认为这个例子很好的展示了 ",(0,i.jsx)(n.a,{href:"https://learn.svelte.dev/tutorial/actions",title:"https://learn.svelte.dev/tutorial/actions",target:"_blank",rel:"noopener noreferrer",children:"Tutorial"})," 中介绍的用法："]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)("img",{src:a,alt:""})}),"\n",(0,i.jsxs)(n.h2,{id:"6-用途-4clickoutside-与-modal",children:["6. 用途 4：clickOutside 与 Modal",(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#6-用途-4clickoutside-与-modal",children:"#"})]}),"\n",(0,i.jsx)(n.p,{children:"这个例子类似于双击事件，只不过是自定义的 clickOutside 事件："}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-xml",children:"<script>\n  import { scale } from 'svelte/transition'\n\n  let open = false\n\n  function openModal() {\n    open = true\n  }\n\n  function closeModal() {\n    open = false\n  }\n\n  const clickOutside = (element) => {\n    function handleClick(event) {\n      if (element && !element.contains(event.target)) {\n        const clickOutsideEvent = new CustomEvent('outside')\n        element.dispatchEvent(clickOutsideEvent)\n      }\n    }\n\n    document.addEventListener('click', handleClick, true)\n\n    return {\n      destroy() {\n        document.removeEventListener('click', handleClick, true)\n      },\n    }\n  }\n<\/script>\n\n{#if open}\n  <div class=\"background\">\n    <div\n      class=\"modal\"\n      use:clickOutside\n      on:outside={closeModal}\n      transition:scale\n    >\n      <h2>Modal</h2>\n      <p>What's up?</p>\n    </div>\n  </div>\n{/if}\n\n<button on:click={openModal}>\n  Open\n</button>\n\n<style>\n  .background {\n    position: absolute;\n    inset: 0;\n    display: grid;\n    place-content: center;\n\n    & .modal {\n      width: 400px;\n      min-height: 300px;\n      padding: 2rem;\n      background-color: hsl(200 10% 10% / 80%);\n      backdrop-filter: blur(20px);\n      border: 1px solid hsl(200 10% 12%);\n      border-radius: 8px;\n      box-shadow: 1px 1px 10px hsl(0 0% 0% / 20%);\n\n      & p {\n        margin-top: 1rem;\n      }\n    }\n  }\n</style>\n"})}),"\n",(0,i.jsxs)(n.p,{children:["我们在 modal 元素上添加了 ",(0,i.jsx)(n.code,{children:"use:clickOutside"}),"，在 ",(0,i.jsx)(n.code,{children:"clickOutside"})," Action 函数中我们判断 Modal 是否包含点击的元素，如果没有，那说明点击了 Modal 之外的位置，于是发送自定义的 ",(0,i.jsx)(n.code,{children:"outside"}),"事件。然后我们在 modal 元素上监听 outside 事件，关闭 modal。"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"https://svelte.dev/repl/4613dd3be38b4abfb4cc4c468776422c?version=4.2.18",title:"https://svelte.dev/repl/4613dd3be38b4abfb4cc4c468776422c?version=4.2.18",target:"_blank",rel:"noopener noreferrer",children:"浏览器效果如下："})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)("img",{src:d,alt:""})}),"\n",(0,i.jsxs)(n.h2,{id:"7-用途-5图片懒加载",children:["7. 用途 5：图片懒加载",(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#7-用途-5图片懒加载",children:"#"})]}),"\n",(0,i.jsxs)(n.p,{children:["图片懒加载就是当图片出现在视口内的时候，再开始加载图片。我们新建一个 ",(0,i.jsx)(n.code,{children:"lazyLoad.js"}),"："]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:'export function lazyLoadImage(node) {\n  const src = node.getAttribute("data-src");\n  let intersecting = false;\n\n  const handleIntersection = (entries) => {\n    intersecting = entries[0].isIntersecting;\n    if (entries[0].intersectionRatio > 0) {\n      node.src = src;\n    }\n    if (intersecting) {\n      observer.unobserve(node);\n    }\n  };\n\n  const observer = new IntersectionObserver(handleIntersection);\n\n  observer.observe(node);\n\n  return {\n    destroy() {\n      observer.unobserve(node);\n    },\n  };\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"当需要使用懒加载的时候："}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-xml",children:'<script>\n  import { lazyLoadImage } from \'./lazyLoad.js\'\n<\/script>\n\n{#each [...Array(15).keys()] as _}\n  <p>\n    Lorem ipsum dolor sit amet consectetur adipisicing elit. Aspernatur obcaecati ex totam laboriosam, culpa ipsa quis nostrum odio dolore aut eos numquam ratione quam maiores voluptates quas eius labore error?\n  </p>\n{/each}\n\n<img use:lazyLoadImage width="400px" data-src="https://plus.unsplash.com/premium_photo-1720706435477-bb1d79c2224c?q=80&w=4480&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" alt="">\n'})}),"\n",(0,i.jsxs)(n.p,{children:["在图片元素上加上 ",(0,i.jsx)(n.code,{children:"use:lazyLoadImage"}),"，并在 ",(0,i.jsx)(n.code,{children:"data-src"}),"属性上加上该图片的实际地址。Actions 就会在该元素进入视口的时候，根据 ",(0,i.jsx)(n.code,{children:"data-src"}),"属性值加载对应图片。"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"https://svelte.dev/repl/f12988de576b4bf9b541a2a59eb838f6?version=3.23.2",title:"https://svelte.dev/repl/f12988de576b4bf9b541a2a59eb838f6?version=3.23.2",target:"_blank",rel:"noopener noreferrer",children:"浏览器效果如下："})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)("img",{src:c,alt:""})}),"\n",(0,i.jsxs)(n.p,{children:["这个例子展示了 ",(0,i.jsx)(n.a,{href:"https://learn.svelte.dev/tutorial/actions",title:"https://learn.svelte.dev/tutorial/actions",target:"_blank",rel:"noopener noreferrer",children:"Tutorial"})," 中介绍的懒加载用法："]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)("img",{src:l,alt:""})}),"\n",(0,i.jsxs)(n.h2,{id:"8-注意-1顺序问题",children:["8. 注意 1：顺序问题",(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#8-注意-1顺序问题",children:"#"})]}),"\n",(0,i.jsx)(n.p,{children:"使用 Actions 的时候要注意，Bindings 和 Actions 的顺序可能会影响最终的结果。我们举个例子："}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-xml",children:"<script>\n  let value1 = '';\n  let value2 = '';\n\n  function uppercase(element) {\n    function onInput(event) {\n      element.value = element.value.toUpperCase();\n    }\n    element.addEventListener('input', onInput);\n    return {\n      destroy() {\n        element.removeEventListener('input', onInput);\n      }\n    }\n  }\n<\/script>\n\n<input\n  bind:value={value1}\n  use:uppercase\n/>\n<input\n  use:uppercase\n  bind:value={value2} />\n\n<div>{value1}</div>\n<div>{value2}</div>\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"https://svelte.dev/repl/de54ff5709d9457bb54f7166efe52bdd?version=4.2.18",title:"https://svelte.dev/repl/de54ff5709d9457bb54f7166efe52bdd?version=4.2.18",target:"_blank",rel:"noopener noreferrer",children:"浏览器效果如下："})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)("img",{src:r,alt:""})}),"\n",(0,i.jsxs)(n.p,{children:["我们的第一个输入框使用的是 ",(0,i.jsx)(n.code,{children:"<input bind:value={value1} use:uppercase />"}),"，当输入小写字母的时候，虽然输入框显示没有问题，但实际 value1 的值的最后一个字母是小写的。"]}),"\n",(0,i.jsxs)(n.p,{children:["这是因为按照顺序，我们先进行的双向绑定，然后再使用 Actions 修改的值。当输入第一个小写字符",(0,i.jsx)(n.code,{children:"a"}),"的时候，因为进行了双向绑定，所以 value1 的值显示为 ",(0,i.jsx)(n.code,{children:"a"}),"，但输入框有 Action，所以显示为大写。当输入第二个小写字符 ",(0,i.jsx)(n.code,{children:"s"}),"的时候，因为输入框之前的值 ",(0,i.jsx)(n.code,{children:"A"}),"，加上刚输入的 ",(0,i.jsx)(n.code,{children:"s"}),"，双向绑定后，修改 value 的值为 ",(0,i.jsx)(n.code,{children:"As"}),"，输入框因为有 Action，继续显示为大写 ",(0,i.jsx)(n.code,{children:"AS"}),"。以此类推……所以实际值的最后一个字符总是小写。"]}),"\n",(0,i.jsxs)(n.p,{children:["第二个输入框使用的是 ",(0,i.jsx)(n.code,{children:"<input use:uppercase bind:value={value2} />"}),"，按照顺序，我们先使用 Actions 修改输入框的值，再进行双向绑定，所以字符始终为大写。"]}),"\n",(0,i.jsxs)(n.h2,{id:"9-最后",children:["9. 最后",(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#9-最后",children:"#"})]}),"\n",(0,i.jsx)(n.p,{children:"恭喜您完成了第四篇内容的学习！Actions 是一个非常强大的功能，擅用 Actions 可以让我们的代码功能拆分更清晰，复用更方便。"})]})}function m(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,s.ah)(),e.components);return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(j,{...e})}):j(e)}let v=m;m.__RSPRESS_PAGE_META={},m.__RSPRESS_PAGE_META["Svelte%20%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97%2F41-Svelte%204%20%E2%9D%98%20Actions.md"]={toc:[{text:"1. 前言",id:"1-前言",depth:2},{text:"2. Actions 介绍",id:"2-actions-介绍",depth:2},{text:"3. 用途 1：输入框聚焦",id:"3-用途-1输入框聚焦",depth:2},{text:"4. 用途 2：双击事件",id:"4-用途-2双击事件",depth:2},{text:"5. 用途 3：tooltips",id:"5-用途-3tooltips",depth:2},{text:"6. 用途 4：clickOutside 与 Modal",id:"6-用途-4clickoutside-与-modal",depth:2},{text:"7. 用途 5：图片懒加载",id:"7-用途-5图片懒加载",depth:2},{text:"8. 注意 1：顺序问题",id:"8-注意-1顺序问题",depth:2},{text:"9. 最后",id:"9-最后",depth:2}],title:"41-Svelte 4 ❘ Actions",headingTitle:"41-Svelte 4 ❘ Actions",frontmatter:{}}}}]);