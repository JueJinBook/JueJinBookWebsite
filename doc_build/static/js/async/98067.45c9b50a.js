"use strict";(self.webpackChunkjue_jin_book_press=self.webpackChunkjue_jin_book_press||[]).push([["98067"],{320335:function(e,n,r){r.r(n),r.d(n,{default:()=>R});var c=r(552676),s=r(740453);let i=r.p+"static/image/2969741e6c3b11ba15df287925092bcd.72e45f17.webp",t=r.p+"static/image/cc0f06a9f29b0dcdbf6dc58f623d1751.00bd0052.webp",l=r.p+"static/image/d5c07f020c796e17b6fba6b42f2957ed.4b523576.webp",p=r.p+"static/image/4ca04461799824b98f9c7e67981df8e8.15cd3db8.webp",a=r.p+"static/image/97b7dfb5c253372255f0b1a87fd91617.fbed8153.webp",d=r.p+"static/image/b18fa1c686691847b6550734de6e6a22.563d34cf.webp",o=r.p+"static/image/1c15d9d6d19c012367818dbfd2eb77f6.af546d56.webp",h=r.p+"static/image/3df5eaeaabc62a1b5c304319d0bc5356.7f1e72b4.webp",x=r.p+"static/image/0a4ff43c287a789ba4a1b3f1a69c7ffe.805b8cfe.webp",j=r.p+"static/image/f891af2195fc55f6c6ed82a4cdf3823a.4449ce94.webp",b=r.p+"static/image/daed49df04ac7d9c4f582557b150939f.3f03a872.webp",f=r.p+"static/image/2bbba41742e5b30e48cf5180554de16a.9e03e6fc.webp",m=r.p+"static/image/3900a91c61dbcebb31caca950c21da71.b391f19a.webp",g=r.p+"static/image/3f2c8190a1d782cf3f4a209663b8a3cb.3af10a30.webp",v=r.p+"static/image/53eccf8ef801f1f7de45f5ca8a164146.65856cab.webp",A=r.p+"static/image/a2a8e0d1e7da0452fc51cd7d1e62465d.ffac0552.webp",u=r.p+"static/image/ff54931d73d393558c67a759c6278a4e.245eecf2.webp",C=r.p+"static/image/b06d9c5d83fefc3fd3f8eb82a26c98f8.ba485c8e.webp",w=r.p+"static/image/7aecb94eb016db8df8e0a3eda74b2e0a.1131a531.webp",I=r.p+"static/image/c72dc774431dfa1042b74b54e1456563.7c2617a9.webp",S=r.p+"static/image/53c62671e7cc71bbe4cb5ce9b7ebb85b.879750ff.webp",O=r.p+"static/image/aceb9752ec85f51b8b9675fc632f473f.b072afd5.webp",E=r.p+"static/image/e4dcc69fb42c9fef9af5354f96e2bac9.de6adfee.webp";function W(e){let n=Object.assign({h1:"h1",a:"a",p:"p",ul:"ul",li:"li",pre:"pre",code:"code",img:"img",h2:"h2"},(0,s.ah)(),e.components);return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)(n.h1,{id:"6-ioc-解决了什么痛点问题",children:["6. IoC 解决了什么痛点问题？",(0,c.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#6-ioc-解决了什么痛点问题",children:"#"})]}),"\n",(0,c.jsx)(n.p,{children:"后端系统中，会有很多对象："}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"Controller 对象：接收 http 请求，调用 Service，返回响应"}),"\n",(0,c.jsx)(n.li,{children:"Service 对象：实现业务逻辑"}),"\n",(0,c.jsx)(n.li,{children:"Repository 对象：实现对数据库的增删改查"}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:"此外，还有数据库链接对象 DataSource，配置对象 Config 等等。"}),"\n",(0,c.jsx)(n.p,{children:"这些对象有着错综复杂的关系："}),"\n",(0,c.jsx)(n.p,{children:"Controller 依赖了 Service 实现业务逻辑，Service 依赖了 Repository 来做增删改查，Repository 依赖 DataSource 来建立连接，DataSource 又需要从 Config 对象拿到用户名密码等信息。"}),"\n",(0,c.jsx)(n.p,{children:"这就导致了创建这些对象是很复杂的，你要理清它们之间的依赖关系，哪个先创建哪个后创建。"}),"\n",(0,c.jsx)(n.p,{children:"比如这样："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:"const config = new Config({ username: 'xxx', password: 'xxx'});\n\nconst dataSource = new DataSource(config);\n\nconst repository = new Repository(dataSource);\n\nconst service = new Service(repository);\n\nconst controller = new Controller(service);\n"})}),"\n",(0,c.jsx)(n.p,{children:"要经过一系列的初始化之后才可以使用 Controller 对象。"}),"\n",(0,c.jsx)(n.p,{children:"而且像 config、dataSource、repository、service、controller 等这些对象不需要每次都 new 一个新的，一直用一个就可以，也就是保持单例。"}),"\n",(0,c.jsx)(n.p,{children:"在应用初始化的时候，需要理清依赖的先后关系，创建一大堆对象组合起来，还要保证不要多次 new，是不是很麻烦？"}),"\n",(0,c.jsx)(n.p,{children:"没错，这是一个后端系统都有的痛点问题。"}),"\n",(0,c.jsx)(n.p,{children:"解决这个痛点的方式就是 IoC（Inverse of Control）。"}),"\n",(0,c.jsx)(n.p,{children:"java 的 Spring 就实现了 IoC，Nest 也同样实现了。"}),"\n",(0,c.jsx)(n.p,{children:"那什么是 IoC 呢？"}),"\n",(0,c.jsx)(n.p,{children:"之前我们手动创建和组装对象不是很麻烦么，我能不能在 class 上声明依赖了啥，然后让工具去分析我声明的依赖关系，根据先后顺序自动把对象创建好了并组装起来呢？"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:E,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"比如这样声明 AppController 依赖了这两个 Service，然后让工具分析依赖自动帮我创建好这三个对象并设置依赖关系。"}),"\n",(0,c.jsx)(n.p,{children:"这就是 IoC 的实现思路。"}),"\n",(0,c.jsx)(n.p,{children:"它有一个放对象的容器，程序初始化的时候会扫描 class 上声明的依赖关系，然后把这些 class 都给 new 一个实例放到容器里。"}),"\n",(0,c.jsx)(n.p,{children:"创建对象的时候，还会把它们依赖的对象注入进去。"}),"\n",(0,c.jsx)(n.p,{children:"这样不就完成了自动的对象创建和组装么？"}),"\n",(0,c.jsx)(n.p,{children:"这种依赖注入的方式叫做 Dependency Injection，简称 DI。"}),"\n",(0,c.jsx)(n.p,{children:"而这种方案为什么叫 IoC 也很容易理解了，本来是手动 new 依赖对象，然后组装起来，现在是声明依赖了啥，等待被注入。"}),"\n",(0,c.jsx)(n.p,{children:"从主动创建依赖到被动等待依赖注入，这就是 Inverse of Control，反转控制。"}),"\n",(0,c.jsx)(n.p,{children:"在 class 上声明依赖的方式，大家都选择了装饰器的方式（在 java 里这种语法叫做注解）。"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:O,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"比如上面就是声明这个 class 要放到 IOC 容器里，然后它的依赖是啥。"}),"\n",(0,c.jsx)(n.p,{children:"这样 IOC 容器扫描到它就知道怎么创建它的对象了。"}),"\n",(0,c.jsx)(n.p,{children:"知道了 IOC 是啥，下面我们来看看真实的 Nest 项目里是怎么用 IoC 的："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"npx nest new nest-ioc\n"})}),"\n",(0,c.jsx)(n.p,{children:"执行上面的命令，它会创建一个 nest 项目："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:S,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"选择一个 npm 包管理工具，然后 nest cli 会自动创建项目结构并安装依赖："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:I,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"然后进入这个目录，执行 npm run start，把服务跑起来："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:w,alt:""})}),"\n",(0,c.jsxs)(n.p,{children:["浏览器访问 ",(0,c.jsx)(n.a,{href:"http://localhost:3000",target:"_blank",rel:"noopener noreferrer",children:"http://localhost:3000"})," 就可以看到 nest 服务返回的 hello world："]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:"data:image/webp;base64,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",alt:""})}),"\n",(0,c.jsx)(n.p,{children:"我们看看代码里它是怎么创建对象的："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:C,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"它有一个 AppService 声明了 @Injectable，代表这个 class 可注入，那么 nest 就会把它的对象放到 IOC 容器里。"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:u,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"AppController 声明了 @Controller，代表这个 class 可以被注入，nest 也会把它放到 IoC 容器里。"}),"\n",(0,c.jsx)(n.p,{children:"AppController 的构造器参数依赖了 AppService。"}),"\n",(0,c.jsx)(n.p,{children:"或者这样通过属性的方式声明依赖："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:A,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"前者是构造器注入，后者是属性注入，两种都可以。"}),"\n",(0,c.jsx)(n.p,{children:"为什么 Controller 是单独的装饰器呢？"}),"\n",(0,c.jsx)(n.p,{children:"因为 Service 是可以被注入也是可以注入到别的对象的，所以用 @Injectable 声明。"}),"\n",(0,c.jsx)(n.p,{children:"而 Controller 只需要被注入，所以 nest 单独给它加了 @Controller 的装饰器。"}),"\n",(0,c.jsx)(n.p,{children:"然后在 AppModule 里引入："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:v,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"通过 @Module 声明模块，其中 controllers 是控制器，只能被注入。"}),"\n",(0,c.jsx)(n.p,{children:"providers 里可以被注入，也可以注入别的对象，比如这里的 AppService。"}),"\n",(0,c.jsx)(n.p,{children:"然后在入口模块里跑起来："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:g,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"那么 nest 就会从 AppModule 开始解析 class 上通过装饰器声明的依赖信息，自动创建和组装对象。"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:m,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"所以 AppController 只是声明了对 AppService 的依赖，就可以调用它的方法了："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:f,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"nest 在背后自动做了对象创建和依赖注入的工作。"}),"\n",(0,c.jsx)(n.p,{children:"nest 还加了模块机制，可以把不同业务的 controller、service 等放到不同模块里。"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"nest g module other\n"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:b,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"会生成如下代码："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:j,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"用 nest cli 的 generate 命令生成一个模块。"}),"\n",(0,c.jsx)(n.p,{children:"会在 AppModule 里自动 imports 这个模块："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:x,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"当 import 别的模块后，那个模块 exports 的 provider 就可以在当前模块注入了。"}),"\n",(0,c.jsx)(n.p,{children:"比如我们再生成 OtherService："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"nest g service other\n"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:h,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"会生成 Service 的代码："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:o,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"并自动添加到 OtherModule 的 providers 中："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:d,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"我们改下 OtherService，添加一个方法："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:a,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"然后在 OtherModule 里 exports："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:p,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"那当 AppModule 引用了 OtherModule 之后，就可以注入它 exports 的 OtherService 了。"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:l,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"我们在 AppService 里注入下："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:"import { OtherService } from './other/other.service';\nimport { Inject, Injectable } from '@nestjs/common';\n\n@Injectable()\nexport class AppService {\n\n  @Inject(OtherService) \n  private otherService:OtherService;\n\n  getHello(): string {\n    return 'Hello World!' + this.otherService.xxx();\n  }\n}\n\n"})}),"\n",(0,c.jsx)(n.p,{children:"把服务跑起来："}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"npm run start:dev\n"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:t,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"浏览器访问下，可以看到 AppModule 的 AppService 调用 OtherModule 的 OtherService 成功了："}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)("img",{src:i,alt:""})}),"\n",(0,c.jsx)(n.p,{children:"这就是 Nest 的 IoC 机制。"}),"\n",(0,c.jsxs)(n.p,{children:["案例代码在",(0,c.jsx)(n.a,{href:"https://github.com/QuarkGluonPlasma/nestjs-course-code/tree/main/nest-ioc",target:"_blank",rel:"noopener noreferrer",children:"小册仓库"}),"。"]}),"\n",(0,c.jsxs)(n.h2,{id:"总结",children:["总结",(0,c.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#总结",children:"#"})]}),"\n",(0,c.jsx)(n.p,{children:"后端系统有很多的对象，这些对象之间的关系错综复杂，如果手动创建并组装对象比较麻烦，所以后端框架一般都提供了 IoC 机制。"}),"\n",(0,c.jsx)(n.p,{children:"IoC 机制是在 class 上标识哪些是可以被注入的，它的依赖是什么，然后从入口开始扫描这些对象和依赖，自动创建和组装对象。"}),"\n",(0,c.jsx)(n.p,{children:"Nest 里通过 @Controller 声明可以被注入的 controller，通过 @Injectable 声明可以被注入也可以注入别的对象的 provider，然后在 @Module 声明的模块里引入。"}),"\n",(0,c.jsx)(n.p,{children:"并且 Nest 还提供了 Module 和 Module 之间的 import，可以引入别的模块的 provider 来注入。"}),"\n",(0,c.jsx)(n.p,{children:"虽然 Nest 这套实现了 IoC 的模块机制看起来繁琐，但是却解决了后端系统的对象依赖关系错综复杂的痛点问题。"})]})}function N(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,s.ah)(),e.components);return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(W,{...e})}):W(e)}let R=N;N.__RSPRESS_PAGE_META={},N.__RSPRESS_PAGE_META["Nest%20%E9%80%9A%E5%85%B3%E7%A7%98%E7%B1%8D%20%20%E6%9C%80%E6%96%B0200%E7%AB%A0%2F6.%20IoC%20%E8%A7%A3%E5%86%B3%E4%BA%86%E4%BB%80%E4%B9%88%E7%97%9B%E7%82%B9%E9%97%AE%E9%A2%98%EF%BC%9F.md"]={toc:[{text:"总结",id:"总结",depth:2}],title:"6. IoC 解决了什么痛点问题？",headingTitle:"6. IoC 解决了什么痛点问题？",frontmatter:{}}}}]);