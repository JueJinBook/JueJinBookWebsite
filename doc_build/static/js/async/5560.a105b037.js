"use strict";(self.webpackChunkjue_jin_book_press=self.webpackChunkjue_jin_book_press||[]).push([["5560"],{88777:function(n,e,i){i.r(e),i.d(e,{default:()=>x});var s=i(552676),r=i(740453);let t=i.p+"static/image/37427cb3a7f601bcd40ff798bfa3bb40.2f5e9a3e.webp",c=i.p+"static/image/d97b7088f03e4e0480a86d830deea002.b3caa1da.webp",l=i.p+"static/image/7a22029f2c7f1c6fad21315e04392d8f.be176f57.webp",d=i.p+"static/image/07bddb094b55f71f7207424b5e773e65.ceceba00.webp",h=i.p+"static/image/641d07a2aeab569cd775394a8e780427.28f78a9f.webp",a=i.p+"static/image/c5b0f136522a003e6e268b116df1503a.d32cd7b5.webp",p=i.p+"static/image/24a59e8d047fb0177635fba1dfa3a367.b82c086f.webp";function j(n){let e=Object.assign({h1:"h1",a:"a",p:"p",img:"img",strong:"strong",ul:"ul",li:"li",h2:"h2",h3:"h3",pre:"pre",code:"code"},(0,r.ah)(),n.components);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(e.h1,{id:"9持续集成-ci-基于-github-action-的回归验证",children:["9.持续集成 CI： 基于 github Action 的回归验证",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#9持续集成-ci-基于-github-action-的回归验证",children:"#"})]}),"\n",(0,s.jsx)(e.p,{children:"开箱即用是一个开源产品最基本的要求，估计谁也不希望让用户下载一个不能使用的代码。为了达到这个目的，我们引入了单元测试，也使用 github hooks 保证在提交前确保代码能够通过所有的单元测试。"}),"\n",(0,s.jsx)(e.p,{children:"但是，还是有很多因素会导致版本库中的代码出现问题影响使用，比如依赖库的升级，或者开发者的开发环境不同，又或者有人使用强制提交的方式跳过了单元测试检查。"}),"\n",(0,s.jsx)(e.p,{children:"为了完全起见，需要一种独立的验证机制，去除开发环境和开发者的影响。这种机制需要在每次提交后触发，并且使用一个全新的系统运行，并执行需要的验证动作。如果验证通过会直接颁发徽章，并且实时反映到 Github 的 README 上面。比如下面这个 CI passing 的徽章就代表目前这个组件库是可以通过验证的。"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)("img",{src:"data:image/webp;base64,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",alt:"img"})}),"\n",(0,s.jsx)(e.p,{children:"其实，上面所描述的东西就是持续集成服务。"}),"\n",(0,s.jsxs)(e.p,{children:["持续集成可以认为是一种优秀的开发实践，它可以在代码变更的时候及时反映代码状态。持续集成需要服务器的支持，可以考虑通过 gitlib ci 或者 jenkins 自己搭建持续集成服务器，",(0,s.jsx)(e.strong,{children:"更好的办法是使用第三方的持续集成服务"}),"，目前比较流行的有："]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Travis CI；"}),"\n",(0,s.jsx)(e.li,{children:"CircleCI；"}),"\n",(0,s.jsx)(e.li,{children:"Github Action。"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"其实这三个服务使用方法大同小异，选用 Github Action ，就是因为它是 Github 内置的，方便而已。"}),"\n",(0,s.jsx)(e.p,{children:"对于开源项目来讲由于代码无需闭源，完全可以使用第三方持续集成服务。"}),"\n",(0,s.jsxs)(e.h2,{id:"用户故事userstory",children:["用户故事(UserStory)",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#用户故事userstory",children:"#"})]}),"\n",(0,s.jsx)(e.p,{children:"为组件库添加持续集成，实现提交代码后，调用回归测试验证代码。"}),"\n",(0,s.jsxs)(e.h2,{id:"任务分解task",children:["任务分解(Task)",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#任务分解task",children:"#"})]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"创建工作流 Workflow；"}),"\n",(0,s.jsx)(e.li,{children:"创建 Job；"}),"\n",(0,s.jsx)(e.li,{children:"运行 CI 服务；"}),"\n",(0,s.jsx)(e.li,{children:"颁发 CI 徽章。"}),"\n"]}),"\n",(0,s.jsxs)(e.h2,{id:"任务实现",children:["任务实现",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#任务实现",children:"#"})]}),"\n",(0,s.jsx)(e.p,{children:"Github Action 是一个集成服务，你可以认为它是一台远程运行的服务器。为了让同一台服务器为不同用户提供独立的配置，互不干扰，需要通过容器化技术实现虚拟机。也就是说使用 Github Action，其实就是在使用虚拟机。更准确地讲，其实就是在配置一个容器，它的配置非常类似于配置 Docker 容器配置。"}),"\n",(0,s.jsxs)(e.h3,{id:"创建workflow",children:["创建Workflow",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#创建workflow",children:"#"})]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)("img",{src:p,alt:"img"})}),"\n",(0,s.jsx)(e.p,{children:"Github Action 的配置文件需要放在项目根目录下的 .github/workflows 中，每一个配置文件是一个工作流 Workflow 。一个工作流是可以配置多个自动化任务 (Job) 的。"}),"\n",(0,s.jsx)(e.p,{children:"比如，组件库的持续集成分为两个任务 (Job) 。一个任务是运行单元测试进行回归校验，另外一个是自动运行 lint 脚本校验代码风格。 这两个任务之间并没有先后关系，而且可以并行运行。这个时候就可以新建一个工作流并且配置两个任务。"}),"\n",(0,s.jsx)(e.p,{children:"首先创建一个 yaml 文件，编写 name 属性，name 属性最终会被显示到 Action 的执行界面中。"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)("img",{src:a,alt:"img"})}),"\n",(0,s.jsx)(e.p,{children:"然后是确定触发器。所谓的触发器是指什么时候运行这个工作流 (Workflow)，比如设置 push 和 pull_request 时触发，就是在 Github 收到 push 代码时和 pull_request 请求时触发。"}),"\n",(0,s.jsx)(e.p,{children:"关于 pull_request 是什么，我们会在后续的“如何参加开源贡献”的章节中介绍。"}),"\n",(0,s.jsx)(e.p,{children:"代码如下："}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-yaml",children:"name: CI\non:\n  push:\n \xa0  branches: [ main ]\n  pull_request:\n \xa0  branches: [ main ]\njobs:\n  Lint:\n \xa0 \xa0# Lint任务\n  UnitTest:\n \xa0 \xa0# 单元测试任务\n"})}),"\n",(0,s.jsxs)(e.h3,{id:"创建-job",children:["创建 Job",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#创建-job",children:"#"})]}),"\n",(0,s.jsx)(e.p,{children:"下面来具体配置每一个Job。 Job 其实是一个运行任务，我们以 UnitTest 单元测试任务举例。"}),"\n",(0,s.jsx)(e.p,{children:"首先需要确定 Job 的 name，这个也会显示在执行界面中。"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)("img",{src:"data:image/webp;base64,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",alt:"img"})}),"\n",(0,s.jsx)(e.p,{children:"接着要设定 runs-on 属性。run-on 是为了指定运行环境（Linux or Mac），其实你可以认为是这个任务虚拟机的环境，Github 可用的虚拟机有："}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"windows-(xxx version)；"}),"\n",(0,s.jsx)(e.li,{children:"ubuntu-(xxx version)；"}),"\n",(0,s.jsx)(e.li,{children:"Macos-(xxx version)。"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"每一个 job 又包含多个 step， 每一个 step 是串行执行的。"}),"\n",(0,s.jsx)(e.p,{children:"你可以假定，在一个空的操作系统上，如果你想进行单元测试，则需要完成如下任务:"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"安装 git 软件；"}),"\n",(0,s.jsx)(e.li,{children:"检出 checkout 项目代码；"}),"\n",(0,s.jsx)(e.li,{children:"安装 pnpm 软件；"}),"\n",(0,s.jsx)(e.li,{children:"使用 pnpm 安装项目代码的依赖库；"}),"\n",(0,s.jsx)(e.li,{children:"运行 pnpm run test。"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"编写 step 可以使用下面三个方式："}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"run： 执行 shell 命令行命令；"}),"\n",(0,s.jsx)(e.li,{children:"env: 设置环境变量；"}),"\n",(0,s.jsx)(e.li,{children:"uses： 运行第三方 Action 脚本。"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"命令行是一种最好理解的执行方式，比如运行测试："}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"pnpm run test:run\n"})}),"\n",(0,s.jsx)(e.p,{children:"你可以这样设置："}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:" \xa0  - name: Run Test\n \xa0 \xa0  run: pnpm run test:run\n"})}),"\n",(0,s.jsx)(e.p,{children:"但是对于一些比较复杂过程，自己配置起来就比较繁琐了，比如安装git。"}),"\n",(0,s.jsx)(e.p,{children:"首先要考虑不同系统，也需要确定是否有比如 apt-get 或 yum 等包管理工具。还需要运行安装并配置相应的环境变量。好在这些复杂操作大多数还是通用过程，这个时候就会用到 uses 来显神威了。"}),"\n",(0,s.jsx)(e.p,{children:"uses 可以用于Action。Action 可以认为是Github 提前写好的一些常用的脚本，当然这些脚本也支持自己定义。可以在下面网址查找："}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.a,{href:"https://github.com/marketplace?type=actions&query=actions",target:"_blank",rel:"noopener noreferrer",children:"https://github.com/marketplace?type=actions&query=actions"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)("img",{src:h,alt:"img"})}),"\n",(0,s.jsx)(e.p,{children:"常见的通用操作包括："}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"部署 (AWS 、App Engine 等各种云)；"}),"\n",(0,s.jsx)(e.li,{children:"代码 Review ；"}),"\n",(0,s.jsx)(e.li,{children:"代码质量检测；"}),"\n",(0,s.jsx)(e.li,{children:"监控；"}),"\n",(0,s.jsx)(e.li,{children:"通知 （短信、飞书通知、钉钉）。"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"每个项目都遇到的常用操作，比如 checkout 检出代码、安装 pnpm 依赖等等，这些步骤显然不需要自己编写，直接使用脚本就可以了。"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"name: CI\non:\n  push:\n \xa0  branches: [ main ]\n  pull_request:\n \xa0  branches: [ main ]\njobs:\n  Lint:\n \xa0 \xa0# Lint任务\n  UnitTest:\n \xa0 \xa0# The type of runner that the job will run on\n \xa0  runs-on: ubuntu-latest\n \xa0 \xa0# Steps represent a sequence of tasks that will be executed as part of the job\n \xa0  steps:\n \xa0  - uses: actions/checkout@v2\n \xa0  - uses: pnpm/action-setup@v2.1.0\n \xa0 \xa0  with:\n \xa0 \xa0 \xa0  version: 7.2.1\n \xa0  - name: Install modules\n \xa0 \xa0  run: pnpm install\n \xa0  - name: Run Test\n \xa0 \xa0  run: pnpm run test:run\n"})}),"\n",(0,s.jsx)(e.p,{children:"最后编写完的配置是这样。"}),"\n",(0,s.jsx)(e.p,{children:"其中运行单元测试的命令还进行了一些修改，因为 vitest 是默认伺服模式，也就是说，它不会在运行完成后退出，所以就需要增加一个非伺服模式的命令。"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:'"scripts": {\n \xa0 \xa0"test:run": "vitest run",\n  },\n'})}),"\n",(0,s.jsxs)(e.h3,{id:"运行-ci-服务",children:["运行 CI 服务",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#运行-ci-服务",children:"#"})]}),"\n",(0,s.jsx)(e.p,{children:"运行 GitHub Action 比较简单，只需要将工作流配置文件提交并且 push 到 Github 就可以了。"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)("img",{src:d,alt:"img"})}),"\n",(0,s.jsx)(e.p,{children:"根据触发器的配置，持续集成脚本会在每次提交 push 代码的时候触发。"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)("img",{src:l,alt:"img"})}),"\n",(0,s.jsx)(e.p,{children:"运行成功的话会显示绿色对钩。"}),"\n",(0,s.jsx)(e.p,{children:"如果失败，那么就会显示 ❌ 并且自动发送邮件通知。"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)("img",{src:c,alt:"img"})}),"\n",(0,s.jsx)(e.p,{children:"当然你也可以查看错误日志来确定错误并加以修正。"}),"\n",(0,s.jsxs)(e.h3,{id:"颁发-ci-徽章",children:["颁发 CI 徽章",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#颁发-ci-徽章",children:"#"})]}),"\n",(0,s.jsx)(e.p,{children:"最后，为了把 CI 的运行结果实时公布到自己的 Github 页面上，可以引用一个徽章。"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)("img",{src:t,alt:"img"})}),"\n",(0,s.jsx)(e.p,{children:"可以在 README.md 加上一个这样的引用。"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)("img",{src:"data:image/webp;base64,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",alt:"img"})}),"\n",(0,s.jsx)(e.p,{children:"最后的效果是这样。"}),"\n",(0,s.jsx)(e.p,{children:"CI 徽章代表组件库是有持续集成保证质量的，这也是评价一个组件库水平的重要指标。后续我们还会专门讲解其他徽章的设置方法。"}),"\n",(0,s.jsxs)(e.h2,{id:"复盘",children:["复盘",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#复盘",children:"#"})]}),"\n",(0,s.jsx)(e.p,{children:"这节课是给组件库添加自动回归验证机制。自动回归验证是前端持续集成的一个重要任务。Github Action 也是最方便的一种持续集成实现手段。除了上面这些，包括自动通知、部署测试环境等操作也都可以通过持续集成实现。如果希望搭建私有持续集成服务可以考虑使用 gitlab CI ，使用方法和 Action 类似。"}),"\n",(0,s.jsx)(e.p,{children:"最后留一些思考题帮助大家复习，也欢迎大家在评论区讨论。"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"持续集成的定义是什么？"}),"\n",(0,s.jsx)(e.li,{children:"工作流 workflow、任务 Job、Action 都是什么？"}),"\n",(0,s.jsx)(e.li,{children:"如何获得 CI 徽章？"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"下节课，我们讲如何给自己的组件库申请版权证书，下节课见。"})]})}function o(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}=Object.assign({},(0,r.ah)(),n.components);return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(j,{...n})}):j(n)}let x=o;o.__RSPRESS_PAGE_META={},o.__RSPRESS_PAGE_META["%E5%9F%BA%E4%BA%8E%20Vite%20%E7%9A%84%E7%BB%84%E4%BB%B6%E5%BA%93%E5%B7%A5%E7%A8%8B%E5%8C%96%E5%AE%9E%E6%88%98%2F9.%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%20CI%EF%BC%9A%20%E5%9F%BA%E4%BA%8E%20github%20Action%20%E7%9A%84%E5%9B%9E%E5%BD%92%E9%AA%8C%E8%AF%81.md"]={toc:[{text:"用户故事(UserStory)",id:"用户故事userstory",depth:2},{text:"任务分解(Task)",id:"任务分解task",depth:2},{text:"任务实现",id:"任务实现",depth:2},{text:"创建Workflow",id:"创建workflow",depth:3},{text:"创建 Job",id:"创建-job",depth:3},{text:"运行 CI 服务",id:"运行-ci-服务",depth:3},{text:"颁发 CI 徽章",id:"颁发-ci-徽章",depth:3},{text:"复盘",id:"复盘",depth:2}],title:"9.持续集成 CI： 基于 github Action 的回归验证",headingTitle:"9.持续集成 CI： 基于 github Action 的回归验证",frontmatter:{}}}}]);