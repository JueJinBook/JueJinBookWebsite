"use strict";(self.webpackChunkjue_jin_book_press=self.webpackChunkjue_jin_book_press||[]).push([["74382"],{377226:function(e){e.exports="data:image/webp;base64,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"},79022:function(e,n,a){a.r(n),a.d(n,{default:()=>F});var s=a(552676),t=a(740453);let r=a.p+"static/image/02729bb5d99c495e8b62a45ae47cbfb8.be9bcf23.webp",i=a.p+"static/image/f22e98b366a9ad0111e712e51f337136.d18936f7.webp",c=a.p+"static/image/793618b4b9eab1910c04aace6f42340e.7b0f5711.webp",p=a.p+"static/image/064716a4bd01078b22a044ae1c0fee0e.63cd7241.webp",d=a.p+"static/image/54dd4296b790d1eb685fcf0552e6f747.0a747b6a.webp",l=a.p+"static/image/426716395aef49a6c9628c6fa883e696.924a1dd1.webp",o=a.p+"static/image/16434b542f7818b74dbc7ef23f9da430.25e44ab1.webp",x=a.p+"static/image/b51056016c12e5e2c4f372d74a194f60.c4559ddb.webp",m=a.p+"static/image/842253ec5b31bdb7dd43df43deb014b1.fdd61d92.webp",j=a.p+"static/image/497072e2545631dbe84dbf53e093b049.b7844726.webp",h=a.p+"static/image/b992c0cef1ecc452e7b990fc932119cd.9cfa5859.webp",b=a.p+"static/image/84ac418e4f988810fe1475b9af181393.d19988ca.webp",g=a.p+"static/image/a62cfadd8ef0593c22a7624bc755608f.8b6b88c1.webp",f=a.p+"static/image/5e43085948169acbd000fb698597c3a5.824a5a5e.webp",A=a.p+"static/image/15ef7e32d46e47a207cc0a1064411518.2d07832a.webp",u=a.p+"static/image/6a4a3f53425fd47adb5b51ad4fe1dbd0.79ffc063.webp",y=a.p+"static/image/bc716eb84b09f5356cc64b232bc1f2f6.0749001b.webp",N=a.p+"static/image/f920211e475409d7594625a0f1bddb6f.8836ee05.webp",T=a.p+"static/image/71b07c8a32a2e8094097b82c50d10d7a.5f8afb66.webp",D=a.p+"static/image/d6f6a3fb2eb62e8fde498492863e70b8.0bd9e9ad.webp",w=a.p+"static/image/b65fe5ed05e58a738e1744f040c3976d.a9f6440b.webp",P=a.p+"static/image/e7a51da2750e8314ac31e240594ef117.2a26760e.webp",B=a.p+"static/image/740ad69c04cfab2b7c9a3d4b3c36e1e9.9ba231a3.webp",U=a.p+"static/image/31b987a7d4bf5e9a106e36c2d6ff0121.e2b2e02e.webp",I=a.p+"static/image/3e0f3396bdff9cc036a1aff3f8af0443.93bd9ea3.webp",O=a.p+"static/image/6576d9850a4ee388c4e5d5f9cfeb532e.971fb366.webp",v=a.p+"static/image/aff35e429a8e5dbb3aa24805a8029bd1.27988850.webp";var C=a(377226);function E(e){let n=Object.assign({h1:"h1",a:"a",p:"p",img:"img",pre:"pre",code:"code",h2:"h2"},(0,t.ah)(),e.components);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.h1,{id:"84-如何灵活创建-dto",children:["84. 如何灵活创建 DTO",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#84-如何灵活创建-dto",children:"#"})]}),"\n",(0,s.jsx)(n.p,{children:"Pdto 是 data transfer object，用于封装请求参数，后端应用常见对象。"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:C,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"当开发 CRUD 接口的时候，你会发现 create 的 dto 对象和 update 的 dto 对象很类似。"}),"\n",(0,s.jsx)(n.p,{children:"那能不能不从头创建，而是基于已有的对象来创建呢？"}),"\n",(0,s.jsx)(n.p,{children:"可以的。"}),"\n",(0,s.jsx)(n.p,{children:"我们来试一下："}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"nest new dto-vo-test\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:v,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"创建个 nest 项目。"}),"\n",(0,s.jsx)(n.p,{children:"进入项目，创建 aaa 的 crud 模块："}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"nest g resource aaa\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:O,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"可以看到，它自动创建了 CreateAaaDto、UpdateAaaDto 用来封装 create、update 的参数："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:I,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"改下 aaa.entity.ts"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"export class Aaa {\n\n    id: number;\n\n    name: string;\n\n    age: number;\n\n    sex: boolean;\n    \n    email: string;\n\n    hoobies: string[]\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"Entity 有 id、name、age、sex、email、hobbies 这些字段。"}),"\n",(0,s.jsx)(n.p,{children:"那 CreateAaaDto 里要有 name、age、sex、email、hobbies 这些字段"}),"\n",(0,s.jsx)(n.p,{children:"而 UpdateAaaDto 里也是 name、age、sex、email、hobbies 这些字段。"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"export class CreateAaaDto {\n    name: string;\n\n    age: number;\n\n    sex: boolean;\n\n    email: string;\n\n    hoobies: string[]\n}\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"export class UpdateAaaDto  {\n\n    name: string;\n\n    age: number;\n\n    sex: boolean;\n\n    email: string;\n\n    hoobies: string[]\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"而且我们还要用 ValidationPipe 加上参数校验。"}),"\n",(0,s.jsx)(n.p,{children:"安装用到的包："}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"npm install --save class-validator class-transformer\n"})}),"\n",(0,s.jsx)(n.p,{children:"然后在 CreateAaaDto 和 UpdateAaaDto 加一下验证："}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:'import { IsBoolean, IsEmail, IsNotEmpty, IsNumber, Length, MaxLength, MinLength } from "class-validator";\n\nexport class CreateAaaDto {\n    @IsNotEmpty()\n    @MinLength(4)\n    @MaxLength(20)\n    name: string;\n\n    @IsNotEmpty()\n    @IsNumber()\n    age: number;\n\n    @IsNotEmpty()\n    @IsBoolean()\n    sex: boolean;\n\n    @IsNotEmpty()\n    @IsEmail()\n    email: string;\n\n    hoobies: string[]\n}\n'})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:'import { IsBoolean, IsEmail, IsNotEmpty, IsNumber, Length, MaxLength, MinLength } from "class-validator";\n\nexport class UpdateAaaDto {\n    @IsNotEmpty()\n    @MinLength(4)\n    @MaxLength(20)\n    name: string;\n\n    @IsNotEmpty()\n    @IsNumber()\n    age: number;\n\n    @IsNotEmpty()\n    @IsBoolean()\n    sex: boolean;\n\n    @IsNotEmpty()\n    @IsEmail()\n    email: string;\n\n    hoobies: string[]\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"然后全局启用 ValidationPipe："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:U,alt:""})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"import { NestFactory } from '@nestjs/core';\nimport { AppModule } from './app.module';\nimport { ValidationPipe } from '@nestjs/common';\n\nasync function bootstrap() {\n  const app = await NestFactory.create(AppModule);\n\n  app.useGlobalPipes(new ValidationPipe({\n    transform: true\n  }))\n\n  await app.listen(3000);\n}\nbootstrap();\n"})}),"\n",(0,s.jsx)(n.p,{children:"transform 指定为 true，这样会自动把参数的 js 对象转换为 dto 类型对象。"}),"\n",(0,s.jsx)(n.p,{children:"打印下 dto 对象："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:B,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"测试下："}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"npm run start:dev\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:P,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"create 接口，当参数没通过校验时："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:w,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"参数通过校验后："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:D,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"可以看到，打印的是 CreateAaaDto 的对象，说明 ValidationPipe 的 transform 生效了："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:T,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"再试下 update 接口："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:N,alt:""})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:y,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"也没问题。"}),"\n",(0,s.jsx)(n.p,{children:"虽然没问题，但是现在 CreateAaaDto 和 UpdateAaaDto 明显重复太多了。"}),"\n",(0,s.jsx)(n.p,{children:"很多字段重复写了两次。"}),"\n",(0,s.jsx)(n.p,{children:"有什么办法能避免这种重复呢？"}),"\n",(0,s.jsx)(n.p,{children:"很简单呀，继承不就行了？"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:'import { CreateAaaDto } from "./create-aaa.dto";\n\nexport class UpdateAaaDto extends CreateAaaDto {\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"试一下："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:u,alt:""})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:A,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"没啥问题。"}),"\n",(0,s.jsx)(n.p,{children:"当然，现在所有字段都是必填的，比如 name、age、email 等。"}),"\n",(0,s.jsx)(n.p,{children:"其实更新的时候可以只更新 name 或者 email。"}),"\n",(0,s.jsx)(n.p,{children:"这时候直接继承就不行了。"}),"\n",(0,s.jsx)(n.p,{children:"可以用 PartialType 处理下："}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"import { PartialType } from '@nestjs/mapped-types';\nimport { CreateAaaDto } from \"./create-aaa.dto\";\n\nexport class UpdateAaaDto extends PartialType(CreateAaaDto) {\n\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"试下："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:f,alt:""})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:g,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"现在只填部分字段依然校验通过了。"}),"\n",(0,s.jsx)(n.p,{children:"好神奇，我们不是指定了 @IsNotEmpty 了么？"}),"\n",(0,s.jsx)(n.p,{children:"咋继承过来就没了呢？"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:b,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"这是因为 PartialType 内部做了处理。"}),"\n",(0,s.jsx)(n.p,{children:"简单看下源码："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:h,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"它创建了一个新的 class 返回，继承了传入的 class 的属性，和 validation metadata。"}),"\n",(0,s.jsx)(n.p,{children:"但是添加一个一个 @IsOptional 的装饰器。"}),"\n",(0,s.jsx)(n.p,{children:"这样可不就变为可选的了么？"}),"\n",(0,s.jsx)(n.p,{children:"类似的这样的方法还有几个："}),"\n",(0,s.jsx)(n.p,{children:"比如 PickType："}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"import { PartialType, PickType } from '@nestjs/mapped-types';\nimport { CreateAaaDto } from \"./create-aaa.dto\";\n\nexport class UpdateAaaDto extends PickType(CreateAaaDto, ['age', 'email']) {\n\n}\n\n"})}),"\n",(0,s.jsx)(n.p,{children:"现在可以只传 age、email 这两个字段："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:j,alt:""})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:m,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"但它和 PartialType 不同，Pick 出来的字段并不会变为可选："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:x,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"或者也可以用 OmitType，从之前的 dto 删除几个字段："}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"import { OmitType, PartialType, PickType } from '@nestjs/mapped-types';\nimport { CreateAaaDto } from \"./create-aaa.dto\";\n\nexport class UpdateAaaDto extends OmitType(CreateAaaDto, ['name', 'hoobies', 'sex']) {\n\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:o,alt:""})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:l,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"效果一样。"}),"\n",(0,s.jsx)(n.p,{children:"PickType 是从中挑选几个，OmitType 是从中去掉几个取剩下的。"}),"\n",(0,s.jsx)(n.p,{children:"此外，如果你有两个 dto 想合并，可以用 IntersectionType。"}),"\n",(0,s.jsx)(n.p,{children:"创建个 xxx.dto.ts"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:'import { IsNotEmpty, IsNumber, MinLength } from "class-validator";\n\nexport class XxxDto {\n    @IsNotEmpty()\n    @MinLength(4)\n    xxx: string;\n\n    @IsNotEmpty()\n    @IsNumber()\n    yyy: number;\n}\n\n'})}),"\n",(0,s.jsx)(n.p,{children:"用 CreateAaaDto 和 XxxDto 来创建 UpdateAaaDto："}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"import { IntersectionType } from '@nestjs/mapped-types';\nimport { CreateAaaDto } from \"./create-aaa.dto\";\nimport { XxxDto } from './xxx.dto';\n\nexport class UpdateAaaDto extends IntersectionType(CreateAaaDto, XxxDto) {\n\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"可以看到，现在会提示你这些字段都是必填的："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:d,alt:""})}),"\n",(0,s.jsxs)(n.p,{children:["这些字段都填上之后，校验就通过了：\n",(0,s.jsx)("img",{src:p,alt:""})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:c,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"服务端接收到了 dto 的数据。"}),"\n",(0,s.jsx)(n.p,{children:"当然，PartialType、PickType、OmitType、IntersectionType 经常会组合用："}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"import { IntersectionType, OmitType, PartialType, PickType } from '@nestjs/mapped-types';\nimport { CreateAaaDto } from \"./create-aaa.dto\";\nimport { XxxDto } from './xxx.dto';\n\nexport class UpdateAaaDto extends IntersectionType(\n    PickType(CreateAaaDto, ['name', 'age']), \n    PartialType(OmitType(XxxDto, ['yyy']))\n) {\n\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"从 CreateAaaDto 里拿出 name 和 age 属性，从 XxxDto 里去掉 yyy 属性变为可选，然后两者合并。"}),"\n",(0,s.jsx)(n.p,{children:"试一下效果："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:i,alt:""})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:r,alt:""})}),"\n",(0,s.jsx)(n.p,{children:"name 必填、xxx 不是必填。"}),"\n",(0,s.jsx)(n.p,{children:"这样创建 dto 对象可太灵活了，随意组合已有的 dto 就行。"}),"\n",(0,s.jsxs)(n.p,{children:["案例代码在",(0,s.jsx)(n.a,{href:"https://github.com/QuarkGluonPlasma/nestjs-course-code/tree/main/dto-vo-test",target:"_blank",rel:"noopener noreferrer",children:"小册仓库"})]}),"\n",(0,s.jsxs)(n.h2,{id:"总结",children:["总结",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#总结",children:"#"})]}),"\n",(0,s.jsx)(n.p,{children:"开发 CRUD 接口的时候，经常会发现 update 的 dto 和 create 的 dto 很类似，而我们要重复的写两次。"}),"\n",(0,s.jsx)(n.p,{children:"这时候可以用 @nestjs/mapped-types 的 PartialType、PickType、OmitType、IntersectionType 来避免重复。"}),"\n",(0,s.jsx)(n.p,{children:"PickType 是从已有 dto 类型中取某个字段。"}),"\n",(0,s.jsx)(n.p,{children:"OmitType 是从已有 dto 类型中去掉某个字段。"}),"\n",(0,s.jsx)(n.p,{children:"PartialType 是把 dto 类型变为可选。"}),"\n",(0,s.jsx)(n.p,{children:"IntersectionType 是组合多个 dto 类型。"}),"\n",(0,s.jsx)(n.p,{children:"灵活运用这些方法，可以轻松的基于已有 dto 创建出新的 dto。"})]})}function X(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,t.ah)(),e.components);return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(E,{...e})}):E(e)}let F=X;X.__RSPRESS_PAGE_META={},X.__RSPRESS_PAGE_META["Nest%20%E9%80%9A%E5%85%B3%E7%A7%98%E7%B1%8D%20%20%E6%9C%80%E6%96%B0200%E7%AB%A0%2F84.%20%E5%A6%82%E4%BD%95%E7%81%B5%E6%B4%BB%E5%88%9B%E5%BB%BA%20DTO.md"]={toc:[{text:"总结",id:"总结",depth:2}],title:"84. 如何灵活创建 DTO",headingTitle:"84. 如何灵活创建 DTO",frontmatter:{}}}}]);