"use strict";(self.webpackChunkjue_jin_book_press=self.webpackChunkjue_jin_book_press||[]).push([["73361"],{334115:function(e,n,r){r.r(n),r.d(n,{default:()=>l});var s=r(552676),d=r(740453);function E(e){let n=Object.assign({h1:"h1",a:"a",h2:"h2",ul:"ul",li:"li",p:"p",strong:"strong",pre:"pre",code:"code",ol:"ol",blockquote:"blockquote",img:"img"},(0,d.ah)(),e.components);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.h1,{id:"7基础-4安装-mysql-并初始化表",children:["7基础 4：安装 MySQL 并初始化表",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#7基础-4安装-mysql-并初始化表",children:"#"})]}),"\n",(0,s.jsxs)(n.h2,{id:"本节核心内容",children:["本节核心内容",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#本节核心内容",children:"#"})]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"如何安装 MySQL 数据库"}),"\n",(0,s.jsx)(n.li,{children:"如何创建示例需要的数据库和表"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"本节主要是为第 12 节「用户业务逻辑处理」做准备工作。"}),"\n",(0,s.jsxs)(n.h2,{id:"准备工作",children:["准备工作",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#准备工作",children:"#"})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"安装 MySQL"})}),"\n",(0,s.jsx)(n.p,{children:"apiserver 用的是 MySQL，所以首先要确保服务器上安装有 MySQL，执行如下命令来检查是否安装了 MySQL（CentOS 7 上是 mariadb-server，CentOS 6 上是 mysql-server，这里以 CentOS 7 为例）："}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"$ rpm -q mariadb-server\n"})}),"\n",(0,s.jsxs)(n.p,{children:["如果提示 ",(0,s.jsx)(n.code,{children:"package mariadb-server is not installed"})," 则说明没有安装 MySQL，需要手动安装。如果出现 ",(0,s.jsx)(n.code,{children:"mariadb-server-xxx.xxx.xx.el7.x86_64"})," 则说明已经安装。"]}),"\n",(0,s.jsx)(n.p,{children:"安装 MySQL 的步骤为："}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"安装 MySQL 和 MySQL 客户端"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"$ sudo yum -y install mariadb  mariadb-server\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"2",children:["\n",(0,s.jsx)(n.li,{children:"启动 MySQL"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"$ sudo systemctl start mariadb\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"3",children:["\n",(0,s.jsx)(n.li,{children:"设置开机启动"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"$ sudo systemctl enable mariadb\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"4",children:["\n",(0,s.jsx)(n.li,{children:"设置初始密码"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"$ sudo mysqladmin -u root password root\n"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"因为版权原因，在 CentOS 7 中用的是基于 MySQL fork 的一个开源分支 MariaDB，它的功能和用法跟 MySQL 完全一样。"}),"\n",(0,s.jsx)(n.p,{children:"如果你的系统之前已经安装过 MySQL，需要在 conf/config.yaml 配置文件中更新配置。"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"创建示例需要的数据库和表"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["创建 ",(0,s.jsx)(n.code,{children:"db.sql"}),"，内容为："]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;\r\n/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;\r\n/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;\r\n/*!40101 SET NAMES utf8 */;\r\n/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */;\r\n/*!40103 SET TIME_ZONE='+00:00' */;\r\n/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */;\r\n/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;\r\n/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;\r\n/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;\r\n\r\nCREATE DATABASE /*!32312 IF NOT EXISTS*/ `db_apiserver` /*!40100 DEFAULT CHARACTER SET utf8 */;\r\n\r\nUSE `db_apiserver`;\r\n\r\n--\r\n-- Table structure for table `tb_users`\r\n--\r\n\r\nDROP TABLE IF EXISTS `tb_users`;\r\n/*!40101 SET @saved_cs_client     = @@character_set_client */;\r\n/*!40101 SET character_set_client = utf8 */;\r\nCREATE TABLE `tb_users` (\r\n  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,\r\n  `username` varchar(255) NOT NULL,\r\n  `password` varchar(255) NOT NULL,\r\n  `createdAt` timestamp NULL DEFAULT NULL,\r\n  `updatedAt` timestamp NULL DEFAULT NULL,\r\n  `deletedAt` timestamp NULL DEFAULT NULL,\r\n  PRIMARY KEY (`id`),\r\n  UNIQUE KEY `username` (`username`),\r\n  KEY `idx_tb_users_deletedAt` (`deletedAt`)\r\n) ENGINE=MyISAM AUTO_INCREMENT=2 DEFAULT CHARSET=utf8;\r\n/*!40101 SET character_set_client = @saved_cs_client */;\r\n\r\n--\r\n-- Dumping data for table `tb_users`\r\n--\r\n\r\nLOCK TABLES `tb_users` WRITE;\r\n/*!40000 ALTER TABLE `tb_users` DISABLE KEYS */;\r\nINSERT INTO `tb_users` VALUES (0,'admin','$2a$10$veGcArz47VGj7l9xN7g2iuT9TF21jLI1YGXarGzvARNdnt4inC9PG','2018-05-27 16:25:33','2018-05-27 16:25:33',NULL);\r\n/*!40000 ALTER TABLE `tb_users` ENABLE KEYS */;\r\nUNLOCK TABLES;\r\n/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */;\r\n\r\n/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;\r\n/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;\r\n/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */;\r\n/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;\r\n/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;\r\n/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;\r\n/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;\r\n\r\n-- Dump completed on 2018-05-28  0:25:41\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"2",children:["\n",(0,s.jsx)(n.li,{children:"登录 MySQL:"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"$ mysql -uroot -p \n"})}),"\n",(0,s.jsxs)(n.ol,{start:"3",children:["\n",(0,s.jsxs)(n.li,{children:["source ",(0,s.jsx)(n.code,{children:"db.sql"})]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"mysql> source db.sql\n"})}),"\n",(0,s.jsxs)(n.p,{children:["可以看到，db.sql 创建了 ",(0,s.jsx)(n.code,{children:"db_apiserver"})," 数据库和 ",(0,s.jsx)(n.code,{children:"tb_users"})," 表，并默认添加了一条记录（用户名：admin，密码：admin）："]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"mysql> select * from tb_users \\G;\r\n*************************** 1. row ***************************\r\n       id: 0\r\n username: admin\r\n password: $2a$10$veGcArz47VGj7l9xN7g2iuT9TF21jLI1YGXarGzvARNdnt4inC9PG\r\ncreatedAt: 2018-05-28 00:25:33\r\nupdatedAt: 2018-05-28 00:25:33\r\ndeletedAt: NULL\r\n1 row in set (0.00 sec)\n"})}),"\n",(0,s.jsxs)(n.h2,{id:"在配置文件中添加数据库配置",children:["在配置文件中添加数据库配置",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#在配置文件中添加数据库配置",children:"#"})]}),"\n",(0,s.jsxs)(n.p,{children:["API 启动需要连接数据库，所以需要在配置文件 ",(0,s.jsx)(n.code,{children:"conf/config.yaml"})," 中配置数据库的 IP、端口、用户名、密码和数据库名信息。"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"https://user-gold-cdn.xitu.io/2018/6/2/163be547b5b845dd?w=1713&h=1087&f=png&s=95176",alt:""})}),"\n",(0,s.jsxs)(n.h2,{id:"小结",children:["小结",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#小结",children:"#"})]}),"\n",(0,s.jsx)(n.p,{children:"本小节通过一步步操作，介绍了如何安装 MySQL 数据库，以及如何创建小册示例需要的数据库和表，为后面的小节作好环境准备。"})]})}function i(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,d.ah)(),e.components);return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(E,{...e})}):E(e)}let l=i;i.__RSPRESS_PAGE_META={},i.__RSPRESS_PAGE_META["%E5%9F%BA%E4%BA%8E%20Go%20%E8%AF%AD%E8%A8%80%E6%9E%84%E5%BB%BA%E4%BC%81%E4%B8%9A%E7%BA%A7%E7%9A%84%20RESTful%20API%20%E6%9C%8D%E5%8A%A1%2F7%E5%9F%BA%E7%A1%80%204%EF%BC%9A%E5%AE%89%E8%A3%85%20MySQL%20%E5%B9%B6%E5%88%9D%E5%A7%8B%E5%8C%96%E8%A1%A8.md"]={toc:[{text:"本节核心内容",id:"本节核心内容",depth:2},{text:"准备工作",id:"准备工作",depth:2},{text:"在配置文件中添加数据库配置",id:"在配置文件中添加数据库配置",depth:2},{text:"小结",id:"小结",depth:2}],title:"7基础 4：安装 MySQL 并初始化表",headingTitle:"7基础 4：安装 MySQL 并初始化表",frontmatter:{}}}}]);